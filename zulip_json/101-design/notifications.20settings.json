[
    {
        "content": "<p>Currently this is how we describe our notifications:<br>\n<a href=\"/user_uploads/2/29/0KD6lbhsrxlKnRtKMqwANvKl/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<p>Should \"Audible notifications\" be a sub-setting of Desktop notifications? I like how slack does this</p>\n<div class=\"codehilite\"><pre><span></span>[ ] Desktop notifications\n    [ ] Play a sound when receiving a notification\n</pre></div>\n\n\n<p>Also, I think most products just call it \"Mobile notifications\", rather than \"Mobile push notifications\".<br>\nThoughts?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/29/0KD6lbhsrxlKnRtKMqwANvKl/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/29/0KD6lbhsrxlKnRtKMqwANvKl/pasted_image.png\"></a></div>",
        "id": 292703,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1507100168
    },
    {
        "content": "<p>I like the sub-setting idea and agree that I don't think I've ever heard \"Mobile push notifs\" before</p>",
        "id": 292704,
        "sender_full_name": "Joshua Pan",
        "timestamp": 1507100225
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"rishig@zulipchat.com\" data-user-id=\"131\">@Rishi Gupta</span> Both of you suggestions seem reasonable to me.</p>",
        "id": 292854,
        "sender_full_name": "Steve Howell",
        "timestamp": 1507126047
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"rishig@zulipchat.com\" data-user-id=\"131\">@Rishi Gupta</span> I don't think we want to move sound to be a subsetting, since that would entail removing the ability to only have the sound and not the popup.</p>",
        "id": 293038,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140412
    },
    {
        "content": "<p>(I actually use that feature).</p>",
        "id": 293042,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140454
    },
    {
        "content": "<p>ah, I didn't realize that was the intended behavior :). <span class=\"emoji emoji-1f914\" title=\"thinking face\">:thinking_face:</span></p>",
        "id": 293043,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1507140470
    },
    {
        "content": "<p>And I think we did it because someone asked for it.</p>",
        "id": 293045,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140473
    },
    {
        "content": "<p>I think we do want to make it easier to toggle those 2 as a group, though, since I think that's the common case.</p>",
        "id": 293047,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140492
    },
    {
        "content": "<p>it's more I wanted to make \"audible notifications\" less confusing, since .. audible where? on my phone? on the desktop?</p>",
        "id": 293048,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1507140528
    },
    {
        "content": "<p>Yeah, I think we should make \"Desktop notifications\" a block and have 2 indented checkboxes under it</p>",
        "id": 293050,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140567
    },
    {
        "content": "<p>With something like \"Popup notifications\" and \"Play a sound\" underneath.</p>",
        "id": 293053,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140583
    },
    {
        "content": "<p>yeah, I like that. Also presumably these settings still apply, but just do different things, when one is using the desktop app?</p>",
        "id": 293057,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1507140644
    },
    {
        "content": "<p>Correct.</p>",
        "id": 293060,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1507140705
    },
    {
        "content": "<p>We're redesigning our notification settings to be more intuitive / extensible / convenient. Some goals are</p>\n<ul>\n<li>Put all the notification settings in one place (currently it's split between settings and stream settings)</li>\n<li>Make it easy to \"do the right thing\", i.e. for a new user to put some settings in place that are the right settings for them</li>\n<li>Make it easy to add features like notifications for \"topics I write on\", or \"pinned streams\"</li>\n</ul>\n<p>Here's a proposal for how it could look:<br>\n<a href=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\"></a></div><p>Two notes about this proposal:</p>\n<ul>\n<li>Some js will be needed for the interaction between \"streams\" and \"pinned streams\"; it shouldn't be possible to get a notification type for streams but not pinned streams. Same for 1-2 of the other settings.</li>\n<li>There can be as many rows as needed for \"custom settings for individual streams\". </li>\n</ul>\n<p>Thoughts?</p>",
        "id": 603084,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529802217
    },
    {
        "content": "<p>For comparison, here's what it looks like now:<br>\n<a href=\"/user_uploads/2/17/F6oS4Zk7X7aHdeCPYLhi0dbl/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/17/F6oS4Zk7X7aHdeCPYLhi0dbl/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/17/F6oS4Zk7X7aHdeCPYLhi0dbl/pasted_image.png\"></a></div>",
        "id": 603085,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529802291
    },
    {
        "content": "<p>I'd love the new addition of topics that I write to notification.</p>",
        "id": 603099,
        "sender_full_name": "Abhigyan Khaund",
        "timestamp": 1529824419
    },
    {
        "content": "<blockquote>\n<p>There can be as many rows as needed for \"custom settings for individual streams\"</p>\n</blockquote>\n<p>I think a modal for the custom settings would be great, as something with increase-able rows would not be suited on the current notification settings page.<br>\nBut the stream list for each row would also need a modal to display the list I presume, so then we would've two modals.</p>",
        "id": 603100,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529827238
    },
    {
        "content": "<blockquote>\n<p>something with increase-able rows would not be suited on the current notification settings page.</p>\n</blockquote>\n<p>Interesting. For technical reasons, or design reasons?</p>",
        "id": 603102,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529828834
    },
    {
        "content": "<p>Design reasons, wouldn't a large no. of rows on the notifications setting page push the other settings down the page</p>",
        "id": 603105,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529834503
    },
    {
        "content": "<p>hm. Ideally I would like a design where you can see all your notification settings on one page, but I agree that if someone has a lot of custom stuff it may be too long. </p>\n<p>It's worth noting though that in the typical case I expect not more than 1-2 rows for any given user, though if they have a large number of streams, the smallness of the streams input box may cause that to grow quickly.</p>",
        "id": 603129,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529858810
    },
    {
        "content": "<p>I mostly want to add that we'll probably want to keep the notification settings list on the per-stream pages (rather than removing it there), but I agree it'd be really nice to have a single page that shows everything.  I agree the per-stream exceptions list is probably going to be &lt;5 for most folks, so as long as the page is scrollable, it's not a big deal if they make the settings screen tall.</p>",
        "id": 603142,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1529862836
    },
    {
        "content": "<p>Yeah, makes sense if the expected rows are less :)</p>",
        "id": 603155,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529863798
    },
    {
        "content": "<blockquote>\n<p>I mostly want to add that we'll probably want to keep the notification settings list on the per-stream pages</p>\n</blockquote>\n<p>What do you think of replacing that section with </p>\n<div class=\"codehilite\"><pre><span></span>Notifications\n\nX Visual (desktop)   X Audible (desktop)   [check] Mobile   [check] Email\n[Update notification preferences]\n</pre></div>\n\n\n<p>where the last link would link to the settings page?<br>\nDuplicating the stream settings logic (and keeping the two in sync, etc) feels like it'll be a hassle to implement and maintain.</p>\n<p>I'd actually vote for not bothering to show the notifications section at all on the per-stream page for the V1 (and just have a link to the settings page).</p>",
        "id": 603281,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529907941
    },
    {
        "content": "<p>Well, we already have the stream settings logic, so it's more work to remove it correctly, and for me at least, the way I want to adjust my notification preferences for a given stream is by clicking the link in the left sidebar to \"Stream settings\" for that stream, not start out in the gear menu and find the stream.</p>",
        "id": 603301,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1529911645
    },
    {
        "content": "<p>ok. Well, we can continue with it there, and see how hard it ends up being.</p>\n<p><span class=\"user-mention\" data-user-id=\"5263\">@Shubham Padia</span> I think the first steps here are</p>\n<ul>\n<li>Add a field like Subscription.custom_notifications (bool)</li>\n<li>Update the behavior of these checkboxes <a href=\"/user_uploads/2/d/wT4lDUHuM6b0k61xngmb_WV0/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a><br>\nto match the new model.<div class=\"message_inline_image\"><a href=\"/user_uploads/2/d/wT4lDUHuM6b0k61xngmb_WV0/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/d/wT4lDUHuM6b0k61xngmb_WV0/pasted_image.png\"></a></div></li>\n</ul>",
        "id": 603314,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529912261
    },
    {
        "content": "<p>Cool, no visual changes to the existing behavior in this step, right?</p>",
        "id": 603318,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529912448
    },
    {
        "content": "<p>right (beyond removing the \"apply to all streams\" followup question)</p>",
        "id": 603323,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529912596
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 603328,
        "sender_full_name": "Giora Guttsait",
        "timestamp": 1529912814
    },
    {
        "content": "<blockquote>\n<p>Here's a proposal for how it could look:<br>\n<a href=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/b4/v7goeE5YkCpP5E7i0aOCjAXQ/pasted_image.png\"></a></div></blockquote>\n<p>I liked that design, I think it's fairly versatile and allows the easiest customization.</p>",
        "id": 603329,
        "sender_full_name": "Giora Guttsait",
        "timestamp": 1529912846
    },
    {
        "content": "<p>yup, just to be clear that's still the end state we're aiming for, but it'll probably be several steps before we get there :)</p>",
        "id": 603331,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529912960
    },
    {
        "content": "<blockquote>\n<p>beyond removing \"apply to all streams\" followup question.</p>\n</blockquote>\n<p>Would we be applying to all streams by default or the opposite?</p>",
        "id": 603334,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529913126
    },
    {
        "content": "<p>Applying to all streams that don't have Subscirption.custom_notifications set</p>",
        "id": 603338,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529913164
    },
    {
        "content": "<p>I guess it'll be in a bit of a broken state until <a href=\"/user_uploads/2/c4/QIaJvZ0-9E6ImzY_MTua6NK9/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> is in place.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/c4/QIaJvZ0-9E6ImzY_MTua6NK9/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/c4/QIaJvZ0-9E6ImzY_MTua6NK9/pasted_image.png\"></a></div>",
        "id": 603340,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529913291
    },
    {
        "content": "<p>so maybe: </p>\n<ul>\n<li>Add field for Subscription.custom_notifications (bool)</li>\n<li>Add the \"Custom settings for individual streams\" thing</li>\n<li>Then change the behavior of the checkboxes in the stream section</li>\n</ul>",
        "id": 603342,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529913364
    },
    {
        "content": "<p>Okay, i'm not still clear about what custom_notifications field is for. So is the idea with the first step here to check the per stream setting if custom_notification is set, and use the default setting if that field is not set.</p>",
        "id": 603347,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529913532
    },
    {
        "content": "<p>if Subscription.custom_notifications is set, then that stream appears in the custom notifications section, and the stream is not affected by changes to the general stream settings checkbox grid above it.</p>",
        "id": 603353,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529913739
    },
    {
        "content": "<p>to set it initially, we'll need to write a custom migration that sets it to True iff its current settings are different from the current default stream settings.</p>",
        "id": 603355,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529913825
    },
    {
        "content": "<p>Cool, makes sense.</p>",
        "id": 603357,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529913875
    },
    {
        "content": "<p>Okay, so should the first step be as below?</p>\n<ul>\n<li>Add field for subscription.custom_notifications</li>\n<li>Do the migration to set it to true iff current settings are different from default stream settings.</li>\n<li>Change the current notifications code to respect the newly added field   i.e the current code should check default settings if custom_notifications is unset.</li>\n</ul>",
        "id": 603362,
        "sender_full_name": "Shubham Padia",
        "timestamp": 1529914266
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"131\">@Rishi Gupta</span> why do we need to change the database model to add a <code>.custom_notifications</code> to support this?  I would have thought we could just show in that bottom list the streams that have a different value from the default set.  Or even have a model where we put <code>None</code> in the individual field if it's supposed to match the default, and <code>True/False</code> otherwise.</p>",
        "id": 603384,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1529920088
    },
    {
        "content": "<p>I think we'll be a lot happier with the <code>None</code> model (plus a property to make accessing a non-None value, or something) than adding a new field that could just have been computed from other fields.</p>",
        "id": 603386,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1529920150
    },
    {
        "content": "<p>The reason I suggested <code>.custom_notifications</code> is that I thought it would reduce the amount the existing code has to be changed. The <code>None</code> method also introduces a coupling constraint where now either each of the four <code>Subscription.desktop_notifiactions, Subscription.audible_notifications, ..</code> have to be <code>None</code>, or none of them should be <code>None</code>.</p>\n<p>But I'm fine with the <code>None</code> model as well.</p>\n<p>In that case the first step is to make our notifications code support <code>None</code> in those values, and then do the migration to change everyone's existing subscriptions.</p>",
        "id": 603525,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529944609
    },
    {
        "content": "<p>Also, whether or not we go with the <code>None</code> model, would it make sense to change our notifications fields to be BitFields with 4 values, one for each of desktop, audible, push, and email? That would solve the coupling problem mentioned above, and I think also make it cleaner to add more notifications settings (like for pinned streams, and topics I follow) in the future.</p>",
        "id": 603526,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1529944778
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"131\">@Rishi Gupta</span> can you explain why you think bitfields would be cleaner?  They're generally more annoying to work with code-wise.</p>\n<p>Also, I guess I'm not convinced that we want to couple the custom-value behavior; if I disable mobile notifications for a stream, and then change the email notifications default for my streams, do I really want it that stream to stay with email notifications running?</p>",
        "id": 606362,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1530455212
    },
    {
        "content": "<p>I'm imagining this is going to be something people set and forget, rather than something people fiddle with. So my main goal is to make it easy to set something that does something reasonable. <br>\nThe main reason I coupled the custom-value behavior is that I couldn't think of a clean UI that doesn't couple them, and it didn't seem like much of a loss.</p>\n<p>For bitfields: if we imagine eventually having 5+ rows (streams, pinned streams, topics I follow, etc.), I thought it would be more manageable to have 5 variables rather than 20, and to have them accessed/manipulated in a standardized way. I've never worked with bitfields before though, so if you think individual variables make more sense, we can go with that.</p>",
        "id": 606391,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1530457358
    }
]