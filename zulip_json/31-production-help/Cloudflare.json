[
    {
        "content": "<p>I'm setting up Zulip on a Google Compute Engine VM, and the actual IP is being masked by CloudFlare, so the LetsEncrypt setup (using <code>tls-sni-01</code>) fails.  There's a <a href=\"https://community.letsencrypt.org/t/how-to-use-cloudflare-along-with-lets-encrypt/29221/8\" target=\"_blank\" title=\"https://community.letsencrypt.org/t/how-to-use-cloudflare-along-with-lets-encrypt/29221/8\">thread</a> suggesting using the <code>webroot</code>challenge instead.  Is it possible to run the zulip setup partway to get a functional <code>nginx</code> server that can then be used to generate the certificate successfully?  Or is there something different that I should be doing (a self-signed cert for example)?</p>",
        "id": 263065,
        "sender_full_name": "David Roe",
        "timestamp": 1501885275
    },
    {
        "content": "<p>Yep, you can use self-signed to get it setup and then switch</p>",
        "id": 263067,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1501885297
    },
    {
        "content": "<p>(going AFK)</p>",
        "id": 263068,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1501885301
    },
    {
        "content": "<p>Ok, thanks!</p>",
        "id": 263070,
        "sender_full_name": "David Roe",
        "timestamp": 1501885352
    },
    {
        "content": "<p>I got through most of the setup, but get a Bad Gateway 502 error when I try to navigate to the realm creation link.  Ideas?  Is there a webserver running at this point in the installation?</p>",
        "id": 263074,
        "sender_full_name": "David Roe",
        "timestamp": 1501887619
    },
    {
        "content": "<p>I got a traceback by e-mail.</p>\n<div class=\"codehilite\"><pre><span></span>Error generated by Anonymous user (not logged in) on zulip.sagemath.org deployment\n\nTraceback (most recent call last):\n\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 42, in inner\n  response = get_response(request)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 244, in _legacy_get_response\n  response = middleware_method(request)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 62, in process_request\n  if self.should_redirect_with_slash(request):\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 80, in should_redirect_with_slash\n  not is_valid_path(request.path_info, urlconf) and\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 157, in is_valid_path\n  resolve(path, urlconf)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 27, in resolve\n  return get_resolver(urlconf).resolve(path)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 270, in resolve\n  for pattern in self.url_patterns:\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__\n  res = instance.__dict__[self.name] = self.func(instance)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 313, in url_patterns\n  patterns = getattr(self.urlconf_module, &quot;urlpatterns&quot;, self.urlconf_module)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__\n  res = instance.__dict__[self.name] = self.func(instance)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 306, in urlconf_module\n  return import_module(self.urlconf_name)\nFile &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module\n  __import__(name)\nFile &quot;./zproject/urls.py&quot;, line 7, in &lt;module&gt;\n  import zerver.forms\nFile &quot;./zerver/forms.py&quot;, line 14, in &lt;module&gt;\n  from zerver.lib.actions import do_change_password, is_inactive, user_email_is_unique\nFile &quot;./zerver/lib/actions.py&quot;, line 24, in &lt;module&gt;\n  from zerver.lib.message import (\nFile &quot;./zerver/lib/message.py&quot;, line 10, in &lt;module&gt;\n  from zerver.lib.avatar import avatar_url_from_dict\nFile &quot;./zerver/lib/avatar.py&quot;, line 11, in &lt;module&gt;\n  from zerver.lib.upload import upload_backend, MEDIUM_AVATAR_SIZE\nFile &quot;./zerver/lib/upload.py&quot;, line 17, in &lt;module&gt;\n  from boto.s3.bucket import Bucket\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/__init__.py&quot;, line 1216, in &lt;module&gt;\n  boto.plugin.load_plugins(config)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/plugin.py&quot;, line 93, in load_plugins\n  _import_module(file)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/plugin.py&quot;, line 75, in _import_module\n  return imp.load_module(name, file, filename, data)\nFile &quot;/usr/lib/python3/dist-packages/google_compute_engine/boto/compute_auth.py&quot;, line 19, in &lt;module&gt;\n  from google_compute_engine import logger\n\nImportError: No module named google_compute_engine\n\nRequest info:\n\n    path: /create_realm/....\n\n    GET: {}\n\n    REMOTE_ADDR: “[u&#39;2601:547:500:880:583a:685d:21e9:c0c9&#39;]”\n\n    QUERY_STRING: “[u&#39;&#39;]”\n\n    SERVER_NAME: “[u&#39;&#39;]”\n</pre></div>",
        "id": 263075,
        "sender_full_name": "David Roe",
        "timestamp": 1501887866
    },
    {
        "content": "<p>I tried the realm creation link again and got a slightly different traceback.</p>\n<div class=\"codehilite\"><pre><span></span>Error generated by Anonymous user (not logged in) on zulip.sagemath.org deployment\n\nTraceback (most recent call last):\n\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 42, in inner\n  response = get_response(request)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 244, in _legacy_get_response\n  response = middleware_method(request)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 62, in process_request\n  if self.should_redirect_with_slash(request):\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 80, in should_redirect_with_slash\n  not is_valid_path(request.path_info, urlconf) and\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 157, in is_valid_path\n  resolve(path, urlconf)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 27, in resolve\n  return get_resolver(urlconf).resolve(path)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 270, in resolve\n  for pattern in self.url_patterns:\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__\n  res = instance.__dict__[self.name] = self.func(instance)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 313, in url_patterns\n  patterns = getattr(self.urlconf_module, &quot;urlpatterns&quot;, self.urlconf_module)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__\n  res = instance.__dict__[self.name] = self.func(instance)\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 306, in urlconf_module\n  return import_module(self.urlconf_name)\nFile &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module\n  __import__(name)\nFile &quot;./zproject/urls.py&quot;, line 7, in &lt;module&gt;\n  import zerver.forms\nFile &quot;./zerver/forms.py&quot;, line 14, in &lt;module&gt;\n  from zerver.lib.actions import do_change_password, is_inactive, user_email_is_unique\nFile &quot;./zerver/lib/actions.py&quot;, line 24, in &lt;module&gt;\n  from zerver.lib.message import (\nFile &quot;./zerver/lib/message.py&quot;, line 10, in &lt;module&gt;\n  from zerver.lib.avatar import avatar_url_from_dict\nFile &quot;./zerver/lib/avatar.py&quot;, line 11, in &lt;module&gt;\n  from zerver.lib.upload import upload_backend, MEDIUM_AVATAR_SIZE\nFile &quot;./zerver/lib/upload.py&quot;, line 17, in &lt;module&gt;\n  from boto.s3.bucket import Bucket\nFile &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/__init__.py&quot;, line 1216, in &lt;module&gt;\n  boto.plugin.load_plugins(config)\n\nAttributeError: ‘module’ object has no attribute ‘plugin’\n\nRequest info:\n\n    path: /create_realm/....\n\n    GET: {}\n\n    REMOTE_ADDR: “[u&#39;2601:547:500:880:583a:685d:21e9:c0c9&#39;]”\n\n    QUERY_STRING: “[u&#39;&#39;]”\n\n    SERVER_NAME: “[u&#39;&#39;]”\n</pre></div>",
        "id": 263080,
        "sender_full_name": "David Roe",
        "timestamp": 1501889404
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"roed314@gmail.com\" data-user-id=\"2972\">@David Roe</span> Hmm, interesting! So we import stuff from <code>boto</code>because if you configured the server to store uploaded images in S3, we'd use <code>boto</code> to do that.  The first traceback kind of looks like a story like</p>\n<ul>\n<li>we import <code>boto</code>, it goes around looking for plugins of itself to load</li>\n<li>because you're on GCE, that somehow causes it to go try to load a GCE-related plugin</li>\n<li>we haven't installed that plugin because we don't have code to use it, so ImportError.</li>\n</ul>",
        "id": 263081,
        "sender_full_name": "Greg Price",
        "timestamp": 1501891703
    },
    {
        "content": "<p>Interesting.</p>",
        "id": 263082,
        "sender_full_name": "David Roe",
        "timestamp": 1501891804
    },
    {
        "content": "<p>The second one is odder. I think perhaps it's fallout from the first? We got an ImportError inside trying to import <code>boto</code> (in its <code>__init__.py</code>, so now the <code>boto</code> module never got the <code>plugin</code> attribute it was supposed to have (pointing to the <code>boto.plugin</code> module.)</p>",
        "id": 263083,
        "sender_full_name": "Greg Price",
        "timestamp": 1501891872
    },
    {
        "content": "<p>On that hypothesis, if you restart the server it should go back to the first error.</p>",
        "id": 263084,
        "sender_full_name": "Greg Price",
        "timestamp": 1501891888
    },
    {
        "content": "<p>Yeah, that seems likely.  Want me to try that?</p>",
        "id": 263085,
        "sender_full_name": "David Roe",
        "timestamp": 1501891903
    },
    {
        "content": "<p>Sure!</p>",
        "id": 263086,
        "sender_full_name": "Greg Price",
        "timestamp": 1501891942
    },
    {
        "content": "<p>Restarting is done by <code>/home/zulip/deployments/current/manage.py restart</code>?</p>",
        "id": 263087,
        "sender_full_name": "David Roe",
        "timestamp": 1501891950
    },
    {
        "content": "<p>(just guessing)</p>",
        "id": 263088,
        "sender_full_name": "David Roe",
        "timestamp": 1501891955
    },
    {
        "content": "<p><code>.../current/scripts/restart-server</code> is the recommended command</p>",
        "id": 263089,
        "sender_full_name": "Greg Price",
        "timestamp": 1501891997
    },
    {
        "content": "<p>Ok</p>",
        "id": 263090,
        "sender_full_name": "David Roe",
        "timestamp": 1501892007
    },
    {
        "content": "<p>Also, should we switch the topic to GCE?  What's the standard for when a conversation changes topic?</p>",
        "id": 263092,
        "sender_full_name": "David Roe",
        "timestamp": 1501892028
    },
    {
        "content": "<p>I'm not sure that's actually written down really clearly, but it's mentioned here: <a href=\"http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html\" target=\"_blank\" title=\"http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html\">http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html</a></p>",
        "id": 263093,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892035
    },
    {
        "content": "<p>My approach is usually to not worry about the topic when it's still one conversation.</p>",
        "id": 263094,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892076
    },
    {
        "content": "<p>Makes sense.</p>",
        "id": 263095,
        "sender_full_name": "David Roe",
        "timestamp": 1501892138
    },
    {
        "content": "<p>After restarting, we're back to the first error.</p>",
        "id": 263096,
        "sender_full_name": "David Roe",
        "timestamp": 1501892147
    },
    {
        "content": "<p>Cool. So basically the question is how to get boto to not try to load irrelevant plugins.</p>",
        "id": 263097,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892222
    },
    {
        "content": "<p>This looks like an explanation:<br>\n<a href=\"https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882\" target=\"_blank\" title=\"https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882\">https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882</a></p>",
        "id": 263098,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892282
    },
    {
        "content": "<p>So a workaround would be to set BOTO_CONFIG to a bogus value -- I think this should work:<br>\n<code>BOTO_CONFIG=/tmp/nowhere /home/zulip/deployments/current/scripts/restart-server</code></p>",
        "id": 263099,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892358
    },
    {
        "content": "<p>I'll try that....</p>",
        "id": 263100,
        "sender_full_name": "David Roe",
        "timestamp": 1501892409
    },
    {
        "content": "<p>If that works (or I guess also if it doesn't), I'm curious what is in your <code>/etc/boto.cfg</code></p>",
        "id": 263101,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892468
    },
    {
        "content": "<p>And probably we should add a Puppet rule to blow away that file, or something.</p>",
        "id": 263102,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892485
    },
    {
        "content": "<p>It doesn't seem to work.  Here's <code>/etc/boto.cfg</code>:</p>\n<div class=\"codehilite\"><pre><span></span># This file is automatically created at boot time by the /usr/lib/python\n# 3/dist-packages/google_compute_engine/boto/boto_config.py script. Do\n# not edit this file directly. If you need to add items to this file,\n# create or edit /etc/boto.cfg.template instead and then re-run the\n# script.\n\n[GSUtil]\ndefault_project_id = 817585749775\ndefault_api_version = 2\n\n[GoogleCompute]\nservice_account = default\n\n[Plugin]\nplugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto\n</pre></div>",
        "id": 263103,
        "sender_full_name": "David Roe",
        "timestamp": 1501892518
    },
    {
        "content": "<p>I'm still getting a 502 error, and no e-mailed traceback now.</p>",
        "id": 263104,
        "sender_full_name": "David Roe",
        "timestamp": 1501892557
    },
    {
        "content": "<p>Hmm. I suspect that command just isn't successfully setting the environment variable -- that the environment is getting cleared or something.</p>",
        "id": 263105,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892578
    },
    {
        "content": "<p>Ah of course -- because that just signals supervisord to actually start the server.</p>",
        "id": 263106,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892599
    },
    {
        "content": "<p>(also, can I keep trying to use this same realm creation link, or do I ever need to make a new one?)</p>",
        "id": 263107,
        "sender_full_name": "David Roe",
        "timestamp": 1501892644
    },
    {
        "content": "<p>These errors are at import time, so I think as far as the server is concerned you haven't tried to use it at all</p>",
        "id": 263108,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892691
    },
    {
        "content": "<p>It's not getting far enough to really look at your request</p>",
        "id": 263109,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892701
    },
    {
        "content": "<p>Okay.</p>",
        "id": 263110,
        "sender_full_name": "David Roe",
        "timestamp": 1501892736
    },
    {
        "content": "<p>OK, so look at <code>/etc/zulip/uwsgi.ini</code>, and the <code>env</code> setting there</p>",
        "id": 263111,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892740
    },
    {
        "content": "<p>If you add <code>BOTO_CONFIG=/tmp/nowhere</code> to that line, that should actually set it for the server process</p>",
        "id": 263112,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892767
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>[uwsgi]\nsocket=/home/zulip/deployments/uwsgi-socket\nmodule=zproject.wsgi:application\nchdir=/home/zulip/deployments/current/\nmaster=true\nchmod-socket=700\nchown-socket=zulip:zulip\nprocesses=5\nharakiri=20\npost-buffering=4096\nenv= LANG=en_US.UTF-8\nuid=zulip\ngid=zulip\n</pre></div>",
        "id": 263113,
        "sender_full_name": "David Roe",
        "timestamp": 1501892799
    },
    {
        "content": "<p>So, change to <code>env= \"LANG=en_US.UTF-8 BOTO_CONFIG=/tmp/nowhere\"</code></p>",
        "id": 263115,
        "sender_full_name": "David Roe",
        "timestamp": 1501892846
    },
    {
        "content": "<p>Yeah, except I'd try it without the quotes</p>",
        "id": 263116,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892905
    },
    {
        "content": "<p>(Not sure if those will be parsed away)</p>",
        "id": 263117,
        "sender_full_name": "Greg Price",
        "timestamp": 1501892914
    },
    {
        "content": "<p>Looks like <a href=\"https://docs.python.org/3/library/configparser.html#supported-ini-file-structure\" target=\"_blank\" title=\"https://docs.python.org/3/library/configparser.html#supported-ini-file-structure\">this</a> is the documentation, and no-quotes it is</p>",
        "id": 263118,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893023
    },
    {
        "content": "<p>Still getting the same error.</p>",
        "id": 263119,
        "sender_full_name": "David Roe",
        "timestamp": 1501893088
    },
    {
        "content": "<p>uwsgi is now</p>\n<div class=\"codehilite\"><pre><span></span>[uwsgi]\nsocket=/home/zulip/deployments/uwsgi-socket\nmodule=zproject.wsgi:application\nchdir=/home/zulip/deployments/current/\nmaster=true\nchmod-socket=700\nchown-socket=zulip:zulip\nprocesses=5\nharakiri=20\npost-buffering=4096\nenv= LANG=en_US.UTF-8 BOTO_CONFIG=/tmp/nowhere\nuid=zulip\ngid=zulip\n</pre></div>",
        "id": 263120,
        "sender_full_name": "David Roe",
        "timestamp": 1501893118
    },
    {
        "content": "<p>Hrm.</p>",
        "id": 263121,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893128
    },
    {
        "content": "<p>Would it help if you had access to the server?</p>",
        "id": 263122,
        "sender_full_name": "David Roe",
        "timestamp": 1501893230
    },
    {
        "content": "<p>Sure.</p>",
        "id": 263123,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893244
    },
    {
        "content": "<p>If you send me a public key I can add you.</p>",
        "id": 263124,
        "sender_full_name": "David Roe",
        "timestamp": 1501893255
    },
    {
        "content": "<p>(sent)</p>",
        "id": 263126,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893286
    },
    {
        "content": "<p>I think the next thing I'd try is just knocking out that file -- setting BOTO_CONFIG was really in the first place just a quick hack to have the same effect</p>",
        "id": 263127,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893333
    },
    {
        "content": "<p>So if it's not working out to be quick, time to bail in favor of the actual fix :)</p>",
        "id": 263128,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893348
    },
    {
        "content": "<p>Cool. So I think the next thing I'd do is</p>\n<ul>\n<li>move <code>/etc/boto.cfg</code> out of the way</li>\n<li>restart the server and see if that works</li>\n</ul>",
        "id": 263138,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893687
    },
    {
        "content": "<p>Then because of the warning at the top that the file will be regenerated at boot time, if that works go on to make a file <code>/etc/boto.cfg.template</code> that causes the script to make an empty file, or one without <code>Plugin.plugin_directory</code>.</p>",
        "id": 263139,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893747
    },
    {
        "content": "<p>Great, that worked.</p>",
        "id": 263140,
        "sender_full_name": "David Roe",
        "timestamp": 1501893844
    },
    {
        "content": "<p>Sweet</p>",
        "id": 263141,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893851
    },
    {
        "content": "<p>What should be in <code>/etc/boto.cfg.template</code>?  Just an empty file?</p>",
        "id": 263142,
        "sender_full_name": "David Roe",
        "timestamp": 1501893892
    },
    {
        "content": "<p>I'd try that. I'm failing to find docs for this file.</p>",
        "id": 263143,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893907
    },
    {
        "content": "<p>(And run the indicated script and see what it does.)</p>",
        "id": 263144,
        "sender_full_name": "Greg Price",
        "timestamp": 1501893921
    },
    {
        "content": "<p>Also I think that is not actually a script, and the script is somewhere else</p>",
        "id": 263145,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894005
    },
    {
        "content": "<p>(From reading its source)</p>",
        "id": 263146,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894009
    },
    {
        "content": "<p>Yeah, <code>python3 /usr/lib/python3/dist-packages/google_compute_engine/boto/boto_config.py</code> doesn't work.</p>",
        "id": 263147,
        "sender_full_name": "David Roe",
        "timestamp": 1501894072
    },
    {
        "content": "<p>I think <code>/usr/bin/google_instance_setup</code> is it</p>",
        "id": 263148,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894160
    },
    {
        "content": "<p>(maybe)</p>",
        "id": 263149,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894163
    },
    {
        "content": "<p>It's mentioned in similar header text in a neighboring file</p>",
        "id": 263150,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894177
    },
    {
        "content": "<p>And the one thing in that package that imports that <code>boto_config.py</code> is a file that sounds like it'd be involved in that script</p>",
        "id": 263152,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894207
    },
    {
        "content": "<p>:-)</p>",
        "id": 263153,
        "sender_full_name": "David Roe",
        "timestamp": 1501894248
    },
    {
        "content": "<p>So, running that script does in fact regenerate <code>boto.cfg</code>, but the bad one.</p>\n<div class=\"codehilite\"><pre><span></span>[GSUtil]\ndefault_project_id = 817585749775\ndefault_api_version = 2\n\n[GoogleCompute]\nservice_account = default\n\n[Plugin]\nplugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto\n</pre></div>",
        "id": 263154,
        "sender_full_name": "David Roe",
        "timestamp": 1501894577
    },
    {
        "content": "<p>Hm. Maybe make the template file just have the <code>Plugin.plugin_directory</code> setting, with an empty value?</p>",
        "id": 263155,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894621
    },
    {
        "content": "<p>I would be more impressed with GCE if I could find documentation for any of this :)</p>",
        "id": 263156,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894639
    },
    {
        "content": "<p>(or for that matter if the instructions at the top of the generated file were accurate...)</p>",
        "id": 263157,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894653
    },
    {
        "content": "<p>Nope, still has the line <code>plugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto</code>.  I can try setting it to <code>/tmp/nowhere</code>....</p>",
        "id": 263158,
        "sender_full_name": "David Roe",
        "timestamp": 1501894814
    },
    {
        "content": "<p>Nope.</p>",
        "id": 263159,
        "sender_full_name": "David Roe",
        "timestamp": 1501894855
    },
    {
        "content": "<p>Yuck.</p>",
        "id": 263160,
        "sender_full_name": "Greg Price",
        "timestamp": 1501894867
    },
    {
        "content": "<p>Current contents of <code>boto.cfg.template</code>:</p>\n<div class=\"codehilite\"><pre><span></span>[Plugin]\nplugin_directory = /tmp/nowhere\n</pre></div>",
        "id": 263161,
        "sender_full_name": "David Roe",
        "timestamp": 1501894980
    },
    {
        "content": "<p>I don't know where that template file is being parsed....</p>",
        "id": 263162,
        "sender_full_name": "David Roe",
        "timestamp": 1501894998
    },
    {
        "content": "<p>Looks awfully reasonable to me.</p>",
        "id": 263163,
        "sender_full_name": "Greg Price",
        "timestamp": 1501895002
    },
    {
        "content": "<p>So, this will currently break when the VM gets restarted, right?</p>",
        "id": 263164,
        "sender_full_name": "David Roe",
        "timestamp": 1501895341
    },
    {
        "content": "<p>Right. And it'll be fixed by removing that file again.</p>",
        "id": 263165,
        "sender_full_name": "Greg Price",
        "timestamp": 1501895362
    },
    {
        "content": "<p>So, is this the first time Zulip has been installed on GCE?</p>",
        "id": 263166,
        "sender_full_name": "David Roe",
        "timestamp": 1501895518
    },
    {
        "content": "<p>Might be!</p>",
        "id": 263167,
        "sender_full_name": "Greg Price",
        "timestamp": 1501895528
    },
    {
        "content": "<p>:-)</p>",
        "id": 263168,
        "sender_full_name": "David Roe",
        "timestamp": 1501895627
    },
    {
        "content": "<p>Okay, thanks a lot for your help.  I'm going to work on setting up Zulip for SageMath. :-)</p>\n<p>I'll let you know if I figure anything out about <code>boto.cfg.template</code></p>",
        "id": 263169,
        "sender_full_name": "David Roe",
        "timestamp": 1501895936
    },
    {
        "content": "<p>So I think a reasonable way to fix this (so that it stays fixed after reboot) would be to make a trivial systemd \"service\" that just removes that file. <a href=\"https://linuxconfig.org/how-to-automatically-execute-shell-script-at-startup-boot-on-systemd-linux\" target=\"_blank\" title=\"https://linuxconfig.org/how-to-automatically-execute-shell-script-at-startup-boot-on-systemd-linux\">This</a> looks like a decent short tutorial/example.</p>",
        "id": 263170,
        "sender_full_name": "Greg Price",
        "timestamp": 1501895977
    },
    {
        "content": "<p>Oh cool! I use SageMath or didn't it change its name?</p>",
        "id": 263171,
        "sender_full_name": "Joshua Pan",
        "timestamp": 1501895976
    },
    {
        "content": "<p>Yeah, and also moving on to set up Zulip, and leaving the on-reboot issue to deal with later, is a very sensible choice :)</p>",
        "id": 263172,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896005
    },
    {
        "content": "<p>Sounds good.</p>",
        "id": 263173,
        "sender_full_name": "David Roe",
        "timestamp": 1501896050
    },
    {
        "content": "<p>If you do make a fix for it, I'd be glad to see a PR to add it to <code>puppet/</code></p>",
        "id": 263174,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896069
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"joshuapan8@gmail.com\" data-user-id=\"857\">@Joshua Pan</span>, it's the Sage of <a href=\"http://sagemath.org\" target=\"_blank\" title=\"http://sagemath.org\">sagemath.org</a>.  I'm setting up a zulip server for Sage development.</p>",
        "id": 263175,
        "sender_full_name": "David Roe",
        "timestamp": 1501896091
    },
    {
        "content": "<p>It will be hosted at <a href=\"http://zulip.sagemath.org\" target=\"_blank\" title=\"http://zulip.sagemath.org\">zulip.sagemath.org</a> (well, it probably already is, but there's a lot of setup to do).</p>",
        "id": 263176,
        "sender_full_name": "David Roe",
        "timestamp": 1501896118
    },
    {
        "content": "<p>Greg, I'm not sure if I'll get around to that anytime soon, but I'll let you know if I do.</p>",
        "id": 263177,
        "sender_full_name": "David Roe",
        "timestamp": 1501896189
    },
    {
        "content": "<p>I'll try. <img alt=\":simple_smile:\" class=\"emoji\" src=\"/static/generated/emoji/images/emoji/unicode/1f642.png\" title=\"simple smile\"></p>",
        "id": 263178,
        "sender_full_name": "David Roe",
        "timestamp": 1501896207
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"roed314@gmail.com\" data-user-id=\"2972\">@David Roe</span> Oh hey there is already a known issue about this!<br>\n<a href=\"https://github.com/zulip/zulip/pull/4839\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/4839\">#4839</a>.</p>",
        "id": 263180,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896603
    },
    {
        "content": "<p>Found that when I went to go report one so that we'd have it to refer to if/when someone runs into it again. I guess searching the known issues would have been a smart thing for me to try up front. &lt;_&lt;</p>",
        "id": 263181,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896644
    },
    {
        "content": "<p>Hehe</p>",
        "id": 263182,
        "sender_full_name": "David Roe",
        "timestamp": 1501896658
    },
    {
        "content": "<p>Oh ha and as that thread points out, the <code>python3</code> in that path is a hint that things are going to inevitably be busted when running on Python 2.</p>",
        "id": 263183,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896722
    },
    {
        "content": "<p>Yeah.  It looks like your work on switching to python3 will be useful here. :-)</p>",
        "id": 263184,
        "sender_full_name": "David Roe",
        "timestamp": 1501896752
    },
    {
        "content": "<p>Yeah, seems likely. :-)</p>",
        "id": 263185,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896764
    },
    {
        "content": "<p>Cool, so that will be the long-term solution pretty soon, then.</p>",
        "id": 263186,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896779
    },
    {
        "content": "<p>This whole episode does not give me a lot of confidence in GCE, though.</p>",
        "id": 263187,
        "sender_full_name": "Greg Price",
        "timestamp": 1501896813
    }
]