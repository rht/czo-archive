[
    {
        "content": "<p>I'm not sure if this is a regression (but looking at past issues I think it is) emojis are not showing up in desktop notifications</p>",
        "id": 555623,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1522955417
    },
    {
        "content": "<p>Tested on CZO with OSX desktop app 1.9 and RHEL 6.9 on chrome version... <span class=\"user-mention\" data-user-id=\"3748\">@Noe Martinez</span> ?</p>",
        "id": 555625,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1522955473
    },
    {
        "content": "<p>Yeah, sounds like a regression to me (at least, that used to work).</p>",
        "id": 555637,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1522956295
    },
    {
        "content": "<blockquote>\n<p>chrome version... </p>\n</blockquote>\n<p>Chromium 61  I believe, if that's what you're asking.</p>",
        "id": 555859,
        "sender_full_name": "Noe Martinez",
        "timestamp": 1522969976
    },
    {
        "content": "<p>yup</p>",
        "id": 555864,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1522970458
    },
    {
        "content": "<p>if you guys can see the same thing I'll file an issue. usually I'm just worried about our ancient OS and chrome being the cause</p>",
        "id": 555865,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1522970496
    },
    {
        "content": "<p>That shouldn't matter.  Mention me with an emoji? <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 555866,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1522970681
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> whattup <span class=\"emoji emoji-1f419\" title=\"octopus\">:octopus:</span></p>",
        "id": 555867,
        "sender_full_name": "Noe Martinez",
        "timestamp": 1522972444
    },
    {
        "content": "<p>Do it again?  I wasn't paying attention <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 555868,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1522972471
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> <span class=\"emoji emoji-1f601\" title=\"grin\">:grin:</span> <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span> <span class=\"emoji emoji-1f389\" title=\"tada\">:tada:</span> <span class=\"emoji emoji-1f6e0\" title=\"hammer and wrench\">:hammer_and_wrench:</span></p>",
        "id": 555869,
        "sender_full_name": "Noe Martinez",
        "timestamp": 1522972568
    },
    {
        "content": "<p>Side note: Zulip is not very emoji-spam friendly (the emoji popup closes after I choose a single emoji). Unsure if feature or bug <span class=\"emoji emoji-1f604\" title=\"smile\">:smile:</span></p>",
        "id": 555870,
        "sender_full_name": "Noe Martinez",
        "timestamp": 1522972612
    },
    {
        "content": "<p>haha yeah, I've wondered the same thing ;)</p>",
        "id": 555871,
        "sender_full_name": "Rishi Gupta",
        "timestamp": 1522973146
    },
    {
        "content": "<p>I'm not sure if this is a regression. As for as I remember this never worked. We only show the emoji text in the notification content.</p>",
        "id": 556033,
        "sender_full_name": "Akash Nimare",
        "timestamp": 1523033753
    },
    {
        "content": "<p>Yeah, I think you might be right.  Let's open an issue an investigate there.</p>",
        "id": 556036,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523033812
    },
    {
        "content": "<p>Yeah, <code>git blame</code> says we made the relevant emoji changes 4 years back i.e. <a href=\"https://github.com/zulip/zulip/commit/ee3806ef5be5f09a26b3c5b99002137543efef7e\" target=\"_blank\" title=\"https://github.com/zulip/zulip/commit/ee3806ef5be5f09a26b3c5b99002137543efef7e\">this</a> commit.</p>",
        "id": 556039,
        "sender_full_name": "Akash Nimare",
        "timestamp": 1523033941
    },
    {
        "content": "<p>Yeah, so we should look at whether the world has changed and we can flip this back <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 556042,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523034012
    },
    {
        "content": "<p>Ah, i thought this was supposed to be working based on <a href=\"https://github.com/zulip/zulip/pull/7002\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7002\">this</a> PR</p>",
        "id": 556050,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523034212
    },
    {
        "content": "<p>That just fixed the fact that custom-uploaded emoji were invisible (made them also show as text)</p>",
        "id": 556052,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523034276
    },
    {
        "content": "<p>I see that now- it's just putting the alt text</p>",
        "id": 556053,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523034309
    },
    {
        "content": "<p><em>this is unacceptable. emoji are life</em></p>",
        "id": 556055,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523034324
    },
    {
        "content": "<p>good to know that it's not a regression.</p>",
        "id": 556057,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523034341
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"53\">@Akash Nimare</span> can you open an issue for this?  I think this is something someone should spend an hour trying to change in the next day or two, and I don't want it to get lost <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 556065,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523034680
    },
    {
        "content": "<p>I was going to open one but if Akash has more context on what needs to change that's probably better</p>",
        "id": 556068,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523034733
    },
    {
        "content": "<p>I think you can go for it <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 556070,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523034899
    },
    {
        "content": "<p><a href=\"https://github.com/zulip/zulip/pull/8997\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/8997\">#8997</a></p>",
        "id": 556078,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523035327
    },
    {
        "content": "<p>This can be easily done if we can add emoji codepoint to the element: a weird number eg 12815 is <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span>.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nb\">String</span><span class=\"p\">.</span><span class=\"nx\">fromCodePoint</span><span class=\"p\">(</span><span class=\"mi\">128515</span><span class=\"p\">);</span>  <span class=\"c1\">// is smiley emoji but a native one which can be displayed in notifications.</span>\n</pre></div>",
        "id": 556085,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523036178
    },
    {
        "content": "<p>That wouldn't support realm emoji though, would it?</p>",
        "id": 556118,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523039573
    },
    {
        "content": "<p>No.  We should try seeing if we can actually render the images first, and then look at workarounds.</p>",
        "id": 556120,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523039652
    },
    {
        "content": "<p>We can't render images in notifications body, this is something we can't do.</p>",
        "id": 556126,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523040564
    },
    {
        "content": "<p>We could do that in the desktop app, though, right?</p>",
        "id": 556131,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523041167
    },
    {
        "content": "<p>Just not in a normal browser?</p>",
        "id": 556132,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523041175
    },
    {
        "content": "<p>No, not possible in the desktop app too. The constructor of notification accepts a string.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">new</span> <span class=\"nx\">Notification</span><span class=\"p\">(</span><span class=\"s1\">&#39;title&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n  <span class=\"nx\">body</span><span class=\"o\">:</span> <span class=\"s1\">&#39;The notiifcation content&#39;</span> <span class=\"c1\">// we can&#39;t put image here</span>\n<span class=\"p\">})</span>\n</pre></div>",
        "id": 556137,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523041308
    },
    {
        "content": "<p>We can't without more work, but since we can run any native code we want, it's definitely possible, just a question of how much work <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span></p>",
        "id": 556138,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523041345
    },
    {
        "content": "<p>I'd look for electron libraries for supporting images in notifications.</p>",
        "id": 556139,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1523041356
    },
    {
        "content": "<p>Then there's the question again of how something like hangouts does it with web notifications</p>",
        "id": 556140,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523041431
    },
    {
        "content": "<blockquote>\n<p>hangouts does it with web notifications </p>\n</blockquote>\n<p>Is it an image that rendered, or a native emoji?</p>",
        "id": 556141,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523041494
    },
    {
        "content": "<p>rendered image</p>",
        "id": 556142,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523041511
    },
    {
        "content": "<p><a href=\"/user_uploads/2/69/c8vhxckvPqH9oMmEqoHbh_mE/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/69/c8vhxckvPqH9oMmEqoHbh_mE/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/69/c8vhxckvPqH9oMmEqoHbh_mE/pasted_image.png\"></a></div>",
        "id": 556143,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523041528
    },
    {
        "content": "<p>Yeah, that totally possible you can render a image in notification but you can render a small emoji image in the body</p>",
        "id": 556144,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523041565
    },
    {
        "content": "<p>The above is like we render profile image of user in desktop notification</p>",
        "id": 556146,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523041616
    },
    {
        "content": "<p>Hmm, that could be it. Here's how in line emoji display: <a href=\"/user_uploads/2/13/rFEyFVDWv7Yt0AAUZpzUr3LD/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/13/rFEyFVDWv7Yt0AAUZpzUr3LD/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/13/rFEyFVDWv7Yt0AAUZpzUr3LD/pasted_image.png\"></a></div>",
        "id": 556148,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523041706
    },
    {
        "content": "<p>vs<br>\n<a href=\"/user_uploads/2/fe/TRFnnuvoq48vr5jOn77r48xT/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/fe/TRFnnuvoq48vr5jOn77r48xT/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/2/fe/TRFnnuvoq48vr5jOn77r48xT/pasted_image.png\"></a></div>",
        "id": 556149,
        "sender_full_name": "Sean Wallitsch",
        "timestamp": 1523041725
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"4241\">@cPhost</span> 's solution works great in the desktop app -<br>\n<a href=\"user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png\" target=\"_blank\" title=\"user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png\">https://chat.zulip.org/user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png\" target=\"_blank\" title=\"https://chat.zulip.org/user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png\"><img src=\"user_uploads/2/84/lcHD1v3ipupc5bYlT4MSmHYc/pasted_image.png\"></a></div>",
        "id": 556285,
        "sender_full_name": "Akash Nimare",
        "timestamp": 1523087909
    },
    {
        "content": "<p>Some problems with this solution:<br>\n1: System fonts don't have glyphs for all the emojis so some emojis will get rendered as image, some as native emojis and some as empty boxes. We faced same problem in twitter integration.<br>\n2: It is not possible to change the image based on the emojiset of the user.<br>\n3: As already pointed out, realm emoji will not get rendered.</p>\n<p>I had also tried to make this happen in webapp notifications back in November but didn't find any satisfactory solution.</p>",
        "id": 558666,
        "sender_full_name": "Harshit Bansal",
        "timestamp": 1523530337
    },
    {
        "content": "<p>Hmm, agreed with all the points. I think it's better to have something for the emoji rather than just showing the text. This is how we're trying to add the emoji -</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kd\">var</span> <span class=\"nx\">emoji_codepoint_utf</span> <span class=\"o\">=</span> <span class=\"nx\">emoji_codes</span><span class=\"p\">.</span><span class=\"nx\">name_to_codepoint</span><span class=\"p\">[</span><span class=\"nx\">emoji_name</span><span class=\"p\">];</span>\n<span class=\"kd\">var</span> <span class=\"nx\">emoji_codepoint</span> <span class=\"o\">=</span> <span class=\"nb\">parseInt</span><span class=\"p\">(</span><span class=\"nx\">emoji_codepoint_utf</span><span class=\"p\">,</span> <span class=\"mi\">16</span><span class=\"p\">);</span>\n</pre></div>\n\n\n<p><span class=\"user-mention\" data-user-id=\"4241\">@Priyank</span> might know more about this.</p>",
        "id": 558671,
        "sender_full_name": "Akash Nimare",
        "timestamp": 1523530797
    },
    {
        "content": "<p>Yeah, the only thing left to encounter in webapp atlest is to figure out of emoji string is not a blank square which i kinda think is possible via a npm package or via a javascripty way just need to figure one out.</p>",
        "id": 558688,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523532651
    },
    {
        "content": "<p>Just add for completness the way to get emoji as a string form above code is this way:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"c1\">// get code point from 16 base encoded value</span>\n<span class=\"kd\">var</span> <span class=\"nx\">emoji_codepoint_utf</span> <span class=\"o\">=</span> <span class=\"nx\">emoji_codes</span><span class=\"p\">.</span><span class=\"nx\">name_to_codepoint</span><span class=\"p\">[</span><span class=\"nx\">emoji_name</span><span class=\"p\">];</span>\n<span class=\"kd\">var</span> <span class=\"nx\">emoji_codepoint</span> <span class=\"o\">=</span> <span class=\"nb\">parseInt</span><span class=\"p\">(</span><span class=\"nx\">emoji_codepoint_utf</span><span class=\"p\">,</span> <span class=\"mi\">16</span><span class=\"p\">);</span>\n\n<span class=\"kd\">var</span> <span class=\"nx\">emoji_string</span> <span class=\"o\">=</span> <span class=\"nb\">String</span><span class=\"p\">.</span><span class=\"nx\">fromCodePoint</span><span class=\"p\">(</span><span class=\"nx\">emoji_codepoint</span><span class=\"p\">);</span>\n</pre></div>",
        "id": 558689,
        "sender_full_name": "Priyank Patel",
        "timestamp": 1523532771
    },
    {
        "content": "<p>Just to chime in on this though I don't have ANY context, one possible solution could be to render text + emoji to image and then embed the image within the notification. There are libraries that convert html to images. I've used them they're quite simple to use and would cover all cases.</p>",
        "id": 560670,
        "sender_full_name": "Armaan Ahluwalia",
        "timestamp": 1523911697
    },
    {
        "content": "<p>Might be more work than its worth though considering you'd have to flush those images from the system but you could also create an api that accepts a string as a param and returns a rendered image ( no saving on disk required )</p>",
        "id": 560671,
        "sender_full_name": "Armaan Ahluwalia",
        "timestamp": 1523911792
    },
    {
        "content": "<p>That might not be as good an idea as it might first appear. It wouldn't fit with the user's system theme and widgets, and thus look too out of place. Plus, if the user wants to have some smart notification filtering system OS wide, it would completely ignore the now absent text of the notification.</p>",
        "id": 560705,
        "sender_full_name": "Rohitt Vashishtha",
        "timestamp": 1523914438
    },
    {
        "content": "<p>Fair points. I'm not so familiar with all the different variations and challenges different environments throw up when it comes to notifications. I do think at the very least that solution provides a consistent and complete representation of all settings as provided by their zulip settings. Thanks for clarifying though interesting to know about the customization and filtering possibilities.</p>",
        "id": 560763,
        "sender_full_name": "Armaan Ahluwalia",
        "timestamp": 1523917170
    }
]