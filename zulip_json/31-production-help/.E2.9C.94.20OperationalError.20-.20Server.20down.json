[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>OperationalError\nconnection to server on socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot; failed: FATAL:  could not write init file\n</code></pre></div>\n<p>it seems the zulip NPM caches are using GBs of data. Any workaround to safely free up the space?</p>\n<div class=\"codehilite\"><pre><span></span><code>7.1 GiB [##########]  webhooks_unsupported_events.log.1\n3.2 GiB [####      ]  webhooks_unsupported_events.log\n</code></pre></div>\n\n<p>It seems getting this a lot. I am using webhooks from sentry to add errors to zulip.</p>\n<div class=\"codehilite\"><pre><span></span><code>UnsupportedWebhookEventTypeError\nThe &#39;[&#39;error&#39;]&#39; event isn&#39;t currently supported by the Sentry webhook\n</code></pre></div>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n<span class=\"w\">  </span><span class=\"nt\">\"action\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"created\"</span><span class=\"p\">,</span>\n<span class=\"w\">  </span><span class=\"nt\">\"installation\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nt\">\"uuid\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2e3fa7d3-d6dc-4d1d-8a26-fa6ac0902f88\"</span>\n<span class=\"w\">  </span><span class=\"p\">},</span>\n<span class=\"w\">  </span><span class=\"nt\">\"data\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">    </span><span class=\"nt\">\"error\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span>\n<span class=\"w\">      </span><span class=\"nt\">\"event_id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"dcd0b4c115724ac4b20b66370befbf17\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"project\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"release\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"6.0-874-ga2ea5e8598\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"dist\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">null</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"platform\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"python\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"message\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"The '['error']' event isn't currently supported by the Sentry webhook\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"datetime\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2023-03-23T12:53:33.184923Z\"</span><span class=\"p\">,</span>\n<span class=\"w\">      </span><span class=\"nt\">\"tags\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"client\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"ZulipSentryWebhook\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"environment\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"production\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"handled\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"yes\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"level\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"error\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"logger\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"zulip.zerver.webhooks.unsupported\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"mechanism\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"logging\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"realm\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"root\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"runtime\"</span><span class=\"p\">,</span>\n<span class=\"w\">          </span><span class=\"s2\">\"CPython 3.8.10\"</span>\n<span class=\"w\">        </span><span class=\"p\">],</span>\n<span class=\"w\">        </span><span class=\"p\">[</span>\n<span class=\"w\">          </span><span class=\"s2\">\"runtime.name\"</span><span class=\"p\">,</span>\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>\n</code></pre></div>",
        "id": 1531411,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679575460
    },
    {
        "content": "<p>Worst is that server has 6GB ram</p>",
        "id": 1531415,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577388
    },
    {
        "content": "<p>and is seems not enough</p>",
        "id": 1531416,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577394
    },
    {
        "content": "<p>PLus now it seems to kill all nginx procs: <a href=\"/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png\"></a></div>",
        "id": 1531417,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577409
    },
    {
        "content": "<p>You guys have some serious memory leak unadressed it seems.</p>",
        "id": 1531418,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577530
    },
    {
        "content": "<p>I am the only user using the server, and few incoming webhooks.</p>",
        "id": 1531419,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577546
    },
    {
        "content": "<p>To have 6 GB and8 CPU cores not plenty to run it, then we think of finding some other solutions. Even mattermost worked great with 4 GB. with 6 seems to cause all memory to be used...</p>",
        "id": 1531420,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577603
    },
    {
        "content": "<p>I assigned now 8 GB RAM see how this works.</p>",
        "id": 1531421,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577624
    },
    {
        "content": "<p>Thats a lot of ressources to be used: <a href=\"/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png\"></a></div>",
        "id": 1531423,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577783
    },
    {
        "content": "<p>I believe this to be some serious memory leak, yet dont have now time to trace it, if are any good practices to investigate this forward, let me know. thanks</p>",
        "id": 1531424,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679577934
    },
    {
        "content": "<p>At least 2 GB RAM, and 10 GB disk space. If you expect 100+ users: 4 GB RAM, and 2 CPUs. ...  this is so not true. I am only user, server wont even start it started recently to kill nginx  after 6 GB were. used, not after last upgrade it jumped to 7 GB usage.</p>",
        "id": 1531425,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578002
    },
    {
        "content": "<p>Zulip will expand to fill the available RAM on the server -- it adjusts the memory allocations for memcached and PostgreSQL based on the total system RAM.  So it is not unexpected that it will take more RAM if you give it more RAM.</p>\n<p>That said, we have had a few reports recently of OOMs -- presumably your PostgreSQL was the victim of such, at the start of the thread.</p>",
        "id": 1531430,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679578355
    },
    {
        "content": "<p>Debugging memory leaks is difficult, but seeing which processes you see out of proportion memory gains in would help point the finger.</p>",
        "id": 1531431,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679578419
    },
    {
        "content": "<p>That was caused by the total space taken by the huge log files. Yet removing those and rebooting server leaded to nginx beying killed as above.</p>",
        "id": 1531432,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578452
    },
    {
        "content": "<p>The killing of nginx stopped once i mived ram to 8 gb and seems to work again now.</p>",
        "id": 1531433,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578477
    },
    {
        "content": "<p>PostgreSQL stopped because you ran out of disk space?</p>",
        "id": 1531434,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679578499
    },
    {
        "content": "<p>Thats what I concluded</p>",
        "id": 1531435,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578508
    },
    {
        "content": "<p>According to logs</p>",
        "id": 1531436,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578514
    },
    {
        "content": "<p>Only the space could had been issue at that point</p>",
        "id": 1531437,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679578528
    },
    {
        "content": "<p>On the topic of the NPM caches -- do you use <code>upgrade-zulip-from-git</code>, or are you using packaged releases?</p>",
        "id": 1531438,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679578590
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531438\">said</a>:</p>\n<blockquote>\n<p>On the topic of the NPM caches -- do you use <code>upgrade-zulip-from-git</code>, or are you using packaged releases?</p>\n</blockquote>\n<p>Yes i use that to upgrade.</p>",
        "id": 1531439,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679579115
    },
    {
        "content": "<p>That response is kinda ambiguous, but I'm going to assume you mean you upgrade from git. <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>\n<p>Latest <code>main</code> switches to using <code>pnpm</code>, which means we use hardlinks to reduce the footprint on disk -- and the old <code>/srv/zulip-npm-cache</code> is unnecessary.  If you've upgraded to <a href=\"https://github.com/zulip/zulip/commit/3a27b12a7dc9580e565946d3252720cbdce08934\">3a27b12a7dc9580e565946d3252720cbdce08934</a> or later, you can safely remove <code>/srv/zulip-npm-cache</code>.</p>",
        "id": 1531440,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679579585
    },
    {
        "content": "<p>Let's tackle the <code>sentry</code> errors.  It looks like you're feeding Sentry errors from Zulip back into Zulip by way of the Sentry webhook, and that may have led to a recursive loop</p>",
        "id": 1531444,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679579734
    },
    {
        "content": "<p>Can you show one of the <em>full</em> JSON payloads?</p>",
        "id": 1531445,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679579751
    },
    {
        "content": "<p>It looks like you may have checked the <code>error</code> box on the <a href=\"https://docs.sentry.io/product/integrations/integration-platform/webhooks/\">webhook configuration for Sentry</a>:<br>\n<a href=\"https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png\">https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png</a></p>\n<div class=\"message_inline_image\"><a href=\"https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png\"><img src=\"/external_content/00f7de3925f117d05b66a4d99a41e76efbe3f3b4/68747470733a2f2f646f63732e73656e7472792e696f2f7374617469632f33313366626438396436353630393838306365333965356463623865396561332f61383866362f776562686f6f6b2d636865636b626f782e706e67\"></a></div><p>Unchecking that box should remove the loop.  Zulip will only parse the <code>issue</code> events.</p>",
        "id": 1531450,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679581643
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531450\">said</a>:</p>\n<blockquote>\n<p>It looks like you may have checked the <code>error</code> box on the <a href=\"https://docs.sentry.io/product/integrations/integration-platform/webhooks/\">webhook configuration for Sentry</a>:<br>\n<a href=\"https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png\">https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png</a></p>\n<p>Unchecking that box should remove the loop.  Zulip will only parse the <code>issue</code> events.</p>\n</blockquote>\n<p>That is correct. I used that. Was thinking will work out of the box since its also a payload.</p>",
        "id": 1531462,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679583556
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531440\">said</a>:</p>\n<blockquote>\n<p>That response is kinda ambiguous, but I'm going to assume you mean you upgrade from git. :)</p>\n<p>Latest <code>main</code> switches to using <code>pnpm</code>, which means we use hardlinks to reduce the footprint on disk -- and the old <code>/srv/zulip-npm-cache</code> is unnecessary.  If you've upgraded to <a href=\"https://github.com/zulip/zulip/commit/3a27b12a7dc9580e565946d3252720cbdce08934\">3a27b12a7dc9580e565946d3252720cbdce08934</a> or later, you can safely remove <code>/srv/zulip-npm-cache</code>.</p>\n</blockquote>\n<p>Now im mobile.  When i reach home will check it out</p>",
        "id": 1531463,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679583602
    },
    {
        "content": "<p>now its on 6.0-1202-gffcdc13819</p>",
        "id": 1531497,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679587962
    },
    {
        "content": "<p>That's current <code>main</code> so <code>/srv/zulip-npm-cache</code> is not in use.  Note that removing that directory will free up space but will prevent you from failing back to earlier versions without some additional work.  That's probably not likely to be a thing you do, just noting it.</p>",
        "id": 1531500,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679588066
    },
    {
        "content": "<p>wow that was quite big it seems</p>",
        "id": 1531518,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679589024
    },
    {
        "content": "<p>I do have backups, so i could restore the folder from there if would be needed.</p>",
        "id": 1531519,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679589110
    },
    {
        "content": "<p>withh 4 GB ram,  <a href=\"/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png\"></a></div>",
        "id": 1531535,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679589740
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>●<span class=\"w\"> </span>nginx.service<span class=\"w\"> </span>-<span class=\"w\"> </span>A<span class=\"w\"> </span>high<span class=\"w\"> </span>performance<span class=\"w\"> </span>web<span class=\"w\"> </span>server<span class=\"w\"> </span>and<span class=\"w\"> </span>a<span class=\"w\"> </span>reverse<span class=\"w\"> </span>proxy<span class=\"w\"> </span>server\n<span class=\"w\">     </span>Loaded:<span class=\"w\"> </span>loaded<span class=\"w\"> </span><span class=\"o\">(</span>/lib/systemd/system/nginx.service<span class=\"p\">;</span><span class=\"w\"> </span>enabled<span class=\"p\">;</span><span class=\"w\"> </span>vendor<span class=\"w\"> </span>preset:<span class=\"w\"> </span>enabled<span class=\"o\">)</span>\n<span class=\"w\">     </span>Active:<span class=\"w\"> </span>active<span class=\"w\"> </span><span class=\"o\">(</span>running<span class=\"o\">)</span><span class=\"w\"> </span>since<span class=\"w\"> </span>Thu<span class=\"w\"> </span><span class=\"m\">2023</span>-03-23<span class=\"w\"> </span><span class=\"m\">16</span>:55:29<span class=\"w\"> </span>UTC<span class=\"p\">;</span><span class=\"w\"> </span>4min<span class=\"w\"> </span>51s<span class=\"w\"> </span>ago\n<span class=\"w\">       </span>Docs:<span class=\"w\"> </span>man:nginx<span class=\"o\">(</span><span class=\"m\">8</span><span class=\"o\">)</span>\n<span class=\"w\">   </span>Main<span class=\"w\"> </span>PID:<span class=\"w\"> </span><span class=\"m\">896</span><span class=\"w\"> </span><span class=\"o\">(</span>nginx<span class=\"o\">)</span>\n<span class=\"w\">      </span>Tasks:<span class=\"w\"> </span><span class=\"m\">10</span><span class=\"w\"> </span><span class=\"o\">(</span>limit:<span class=\"w\"> </span><span class=\"m\">1051</span><span class=\"o\">)</span>\n<span class=\"w\">     </span>Memory:<span class=\"w\"> </span><span class=\"m\">3</span>.1G\n<span class=\"w\">     </span>CGroup:<span class=\"w\"> </span>/system.slice/nginx.service\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">896</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>master<span class=\"w\"> </span>process<span class=\"w\"> </span>/usr/sbin/nginx<span class=\"w\"> </span>-g<span class=\"w\"> </span>daemon<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span>master_process<span class=\"w\"> </span>on<span class=\"p\">;</span>\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">898</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">899</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">901</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">904</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">906</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">911</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─<span class=\"w\"> </span><span class=\"m\">912</span><span class=\"w\"> </span>nginx:<span class=\"w\"> </span>cache<span class=\"w\"> </span>manager<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─3444<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>└─3468<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n</code></pre></div>",
        "id": 1531557,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679590860
    },
    {
        "content": "<p>Even with 7 GB, seems to be chaotical. Seems to be some issues with the nginx configs ? or some conflicts not sure, using the standard settings.</p>",
        "id": 1531559,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679590912
    },
    {
        "content": "<p>So here is a step by step of my actions, the difference of running nginx with default nginx.conf in RAM usage, and look at the RAM jump when using the nginx config that is recommended with zulip:</p>\n<p><a href=\"https://bin.uhl.cloud/?5db3958746a6563e#3CkrU5v35UdV2knhpWTZETVGPBTH4stU2NgYUyeJxES4\">pastebin</a></p>",
        "id": 1531576,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679591985
    },
    {
        "content": "<p>tried to move also from. nginx-full to mainstream nginx, results are same.</p>",
        "id": 1531585,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679592639
    },
    {
        "content": "<p>I would not expect nginx to be the memory hog.</p>\n<p>Are you using the S3 file upload backend?</p>",
        "id": 1531649,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679595701
    },
    {
        "content": "<p>Not using the s3</p>",
        "id": 1531673,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679596822
    },
    {
        "content": "<p>Is there anything else running on this nginx instance other than Zulip?</p>",
        "id": 1531707,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679598493
    },
    {
        "content": "<p>Only zulip nothing else</p>",
        "id": 1531708,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679598509
    },
    {
        "content": "<p>It was a clean machine dedicated to zulip only from start</p>",
        "id": 1531709,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679598541
    },
    {
        "content": "<p>Here's chat.zulip.org's <code>nginx</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>● nginx.service - A high performance web server and a reverse proxy server\n     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\n     Active: active (running) since Wed 2023-03-08 15:51:40 UTC; 2 weeks 1 days ago\n       Docs: man:nginx(8)\n   Main PID: 3143550 (nginx)\n      Tasks: 8 (limit: 19142)\n     Memory: 159.5M\n     CGroup: /system.slice/nginx.service\n             ├─3143550 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;\n             ├─3143551 nginx: worker process\n             ├─3143552 nginx: worker process\n             ├─3143553 nginx: worker process\n             ├─3143554 nginx: worker process\n             ├─3143555 nginx: worker process\n             ├─3143556 nginx: worker process\n             └─3143557 nginx: cache manager process\n</code></pre></div>\n<p>I don't have a ready explanation for how nginx could balloon to 3G with a small worker load.</p>\n<p>How many connections are you handling?</p>\n<div class=\"codehilite\"><pre><span></span><code>lsof -n | grep &#39;^nginx&#39; | grep :https | grep ESTABLISHED | wc -l\n</code></pre></div>",
        "id": 1531712,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679598913
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@post:/opt/postal/config#<span class=\"w\"> </span>lsof<span class=\"w\"> </span>-n<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span><span class=\"s1\">'^nginx'</span><span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>:https<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>grep<span class=\"w\"> </span>ESTABLISHED<span class=\"w\"> </span><span class=\"p\">|</span><span class=\"w\"> </span>wc<span class=\"w\"> </span>-l\n<span class=\"m\">1</span>\n</code></pre></div>",
        "id": 1531723,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599245
    },
    {
        "content": "<p>its 1 that was from another server, my bad.</p>",
        "id": 1531724,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599326
    },
    {
        "content": "<p>...nginx is taking 3GB to talk to one HTTP connection?</p>",
        "id": 1531725,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679599345
    },
    {
        "content": "<p>so it seems</p>",
        "id": 1531726,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599355
    },
    {
        "content": "<p>thats why i said its weird</p>",
        "id": 1531728,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599362
    },
    {
        "content": "<p>I agree that's very weird.</p>",
        "id": 1531732,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679599372
    },
    {
        "content": "<p>I just use 2 clients mobile app and desktop</p>",
        "id": 1531733,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599375
    },
    {
        "content": "<p>with default nginx.conf is not taking that much</p>",
        "id": 1531735,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599399
    },
    {
        "content": "<p>yet wont load all needed for zulip to work</p>",
        "id": 1531739,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599410
    },
    {
        "content": "<p>What do you mean \"with default nginx.conf\"?  Are you not using the nginx.conf that Zulip installs?</p>",
        "id": 1531742,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679599433
    },
    {
        "content": "<p>No, i just made a test, but returned to normal</p>",
        "id": 1531748,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599643
    },
    {
        "content": "<p>where i run and installed nginx package</p>",
        "id": 1531751,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599652
    },
    {
        "content": "<p>over nginx-full, and there i had made a backup of the configss</p>",
        "id": 1531752,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599668
    },
    {
        "content": "<p>following i did rerun an upgrade procedure, that reseted all nginx back to its original settings.</p>",
        "id": 1531753,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599699
    },
    {
        "content": "<p>So it seems something is affecting nginx since last few updates</p>",
        "id": 1531754,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599729
    },
    {
        "content": "<p>in past worked fine the server with 4 GB ram</p>",
        "id": 1531755,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599740
    },
    {
        "content": "<p>i dont have high usage</p>",
        "id": 1531756,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679599747
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>zulip<span class=\"w\">      </span><span class=\"m\">21489</span><span class=\"w\">  </span><span class=\"m\">2</span>.5<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21490</span><span class=\"w\">  </span><span class=\"m\">2</span>.9<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21491</span><span class=\"w\">  </span><span class=\"m\">2</span>.4<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21492</span><span class=\"w\">  </span><span class=\"m\">2</span>.5<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21493</span><span class=\"w\">  </span><span class=\"m\">2</span>.3<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21494</span><span class=\"w\">  </span><span class=\"m\">2</span>.5<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21495</span><span class=\"w\">  </span><span class=\"m\">2</span>.6<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">425868</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21496</span><span class=\"w\">  </span><span class=\"m\">2</span>.3<span class=\"w\">  </span><span class=\"m\">5</span>.1<span class=\"w\"> </span><span class=\"m\">525148</span><span class=\"w\"> </span><span class=\"m\">424036</span><span class=\"w\"> </span>?<span class=\"w\">       </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\nzulip<span class=\"w\">      </span><span class=\"m\">21497</span><span class=\"w\">  </span><span class=\"m\">0</span>.0<span class=\"w\">  </span><span class=\"m\">0</span>.1<span class=\"w\"> </span><span class=\"m\">111080</span><span class=\"w\"> </span><span class=\"m\">10036</span><span class=\"w\"> </span>?<span class=\"w\">        </span>S<span class=\"w\">    </span><span class=\"m\">19</span>:35<span class=\"w\">   </span><span class=\"m\">0</span>:00<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>cache<span class=\"w\"> </span>manager<span class=\"w\"> </span>process\n</code></pre></div>",
        "id": 1531761,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600220
    },
    {
        "content": "<p>Ok so it seems that lowering worker_connections from 100000 to 10240 its taking of a lot of RAM. usage.</p>",
        "id": 1531765,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600418
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>worker_rlimit_nofile<span class=\"w\"> </span><span class=\"m\">1000000</span><span class=\"p\">;</span>\nevents<span class=\"w\"> </span><span class=\"o\">{</span>\n<span class=\"w\">    </span>worker_connections<span class=\"w\"> </span><span class=\"m\">1000000</span><span class=\"p\">;</span>\n</code></pre></div>\n<p>this is default, I made it to 10240 each values, and now</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@chat:/etc/nginx#<span class=\"w\"> </span>systemctl<span class=\"w\"> </span>status<span class=\"w\"> </span>nginx\n●<span class=\"w\"> </span>nginx.service<span class=\"w\"> </span>-<span class=\"w\"> </span>A<span class=\"w\"> </span>high<span class=\"w\"> </span>performance<span class=\"w\"> </span>web<span class=\"w\"> </span>server<span class=\"w\"> </span>and<span class=\"w\"> </span>a<span class=\"w\"> </span>reverse<span class=\"w\"> </span>proxy<span class=\"w\"> </span>server\n<span class=\"w\">     </span>Loaded:<span class=\"w\"> </span>loaded<span class=\"w\"> </span><span class=\"o\">(</span>/lib/systemd/system/nginx.service<span class=\"p\">;</span><span class=\"w\"> </span>enabled<span class=\"p\">;</span><span class=\"w\"> </span>vendor<span class=\"w\"> </span>preset:<span class=\"w\"> </span>enabled<span class=\"o\">)</span>\n<span class=\"w\">     </span>Active:<span class=\"w\"> </span>active<span class=\"w\"> </span><span class=\"o\">(</span>running<span class=\"o\">)</span><span class=\"w\"> </span>since<span class=\"w\"> </span>Thu<span class=\"w\"> </span><span class=\"m\">2023</span>-03-23<span class=\"w\"> </span><span class=\"m\">19</span>:39:02<span class=\"w\"> </span>UTC<span class=\"p\">;</span><span class=\"w\"> </span>2min<span class=\"w\"> </span>7s<span class=\"w\"> </span>ago\n<span class=\"w\">       </span>Docs:<span class=\"w\"> </span>man:nginx<span class=\"o\">(</span><span class=\"m\">8</span><span class=\"o\">)</span>\n<span class=\"w\">    </span>Process:<span class=\"w\"> </span><span class=\"m\">21766</span><span class=\"w\"> </span><span class=\"nv\">ExecStartPre</span><span class=\"o\">=</span>/usr/sbin/nginx<span class=\"w\"> </span>-t<span class=\"w\"> </span>-q<span class=\"w\"> </span>-g<span class=\"w\"> </span>daemon<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span>master_process<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"nv\">code</span><span class=\"o\">=</span>exited,<span class=\"w\"> </span><span class=\"nv\">status</span><span class=\"o\">=</span><span class=\"m\">0</span>/SUCCESS<span class=\"o\">)</span>\n<span class=\"w\">    </span>Process:<span class=\"w\"> </span><span class=\"m\">21778</span><span class=\"w\"> </span><span class=\"nv\">ExecStart</span><span class=\"o\">=</span>/usr/sbin/nginx<span class=\"w\"> </span>-g<span class=\"w\"> </span>daemon<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span>master_process<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span><span class=\"o\">(</span><span class=\"nv\">code</span><span class=\"o\">=</span>exited,<span class=\"w\"> </span><span class=\"nv\">status</span><span class=\"o\">=</span><span class=\"m\">0</span>/SUCCESS<span class=\"o\">)</span>\n<span class=\"w\">   </span>Main<span class=\"w\"> </span>PID:<span class=\"w\"> </span><span class=\"m\">21780</span><span class=\"w\"> </span><span class=\"o\">(</span>nginx<span class=\"o\">)</span>\n<span class=\"w\">      </span>Tasks:<span class=\"w\"> </span><span class=\"m\">10</span><span class=\"w\"> </span><span class=\"o\">(</span>limit:<span class=\"w\"> </span><span class=\"m\">1051</span><span class=\"o\">)</span>\n<span class=\"w\">     </span>Memory:<span class=\"w\"> </span><span class=\"m\">45</span>.3M\n<span class=\"w\">     </span>CGroup:<span class=\"w\"> </span>/system.slice/nginx.service\n<span class=\"w\">             </span>├─21780<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>master<span class=\"w\"> </span>process<span class=\"w\"> </span>/usr/sbin/nginx<span class=\"w\"> </span>-g<span class=\"w\"> </span>daemon<span class=\"w\"> </span>on<span class=\"p\">;</span><span class=\"w\"> </span>master_process<span class=\"w\"> </span>on<span class=\"p\">;</span>\n<span class=\"w\">             </span>├─21781<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21782<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21783<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21784<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21785<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21786<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21787<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>├─21788<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>worker<span class=\"w\"> </span>process\n<span class=\"w\">             </span>└─21789<span class=\"w\"> </span>nginx:<span class=\"w\"> </span>cache<span class=\"w\"> </span>manager<span class=\"w\"> </span>process\n\nMar<span class=\"w\"> </span><span class=\"m\">23</span><span class=\"w\"> </span><span class=\"m\">19</span>:39:02<span class=\"w\"> </span>chat<span class=\"w\"> </span>systemd<span class=\"o\">[</span><span class=\"m\">1</span><span class=\"o\">]</span>:<span class=\"w\"> </span>Starting<span class=\"w\"> </span>A<span class=\"w\"> </span>high<span class=\"w\"> </span>performance<span class=\"w\"> </span>web<span class=\"w\"> </span>server<span class=\"w\"> </span>and<span class=\"w\"> </span>a<span class=\"w\"> </span>reverse<span class=\"w\"> </span>proxy<span class=\"w\"> </span>server...\nMar<span class=\"w\"> </span><span class=\"m\">23</span><span class=\"w\"> </span><span class=\"m\">19</span>:39:02<span class=\"w\"> </span>chat<span class=\"w\"> </span>systemd<span class=\"o\">[</span><span class=\"m\">1</span><span class=\"o\">]</span>:<span class=\"w\"> </span>Started<span class=\"w\"> </span>A<span class=\"w\"> </span>high<span class=\"w\"> </span>performance<span class=\"w\"> </span>web<span class=\"w\"> </span>server<span class=\"w\"> </span>and<span class=\"w\"> </span>a<span class=\"w\"> </span>reverse<span class=\"w\"> </span>proxy<span class=\"w\"> </span>server.\n</code></pre></div>",
        "id": 1531767,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600506
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@chat:/etc/nginx#<span class=\"w\"> </span>grep<span class=\"w\"> </span>-Rn<span class=\"w\"> </span>worker_connections\nnginx.conf:9:<span class=\"w\">    </span>worker_connections<span class=\"w\"> </span><span class=\"m\">10240</span><span class=\"p\">;</span>\nnginx.conf.dpkg-dist:7:<span class=\"w\"> </span>worker_connections<span class=\"w\"> </span><span class=\"m\">768</span><span class=\"p\">;</span>\nnginx.conf.zulip:9:<span class=\"w\">    </span>worker_connections<span class=\"w\"> </span><span class=\"m\">1000000</span><span class=\"p\">;</span>\n</code></pre></div>",
        "id": 1531769,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600541
    },
    {
        "content": "<p>default its 768, I made it to 10240, yet with the more I increase the more RAM will be used.</p>",
        "id": 1531773,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600574
    },
    {
        "content": "<p>Aha, great.  That's a recent change, and I can see how it would increase the memory usage.</p>",
        "id": 1531774,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679600584
    },
    {
        "content": "<p>Is there anything else I should be aware of, change?</p>",
        "id": 1531775,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600616
    },
    {
        "content": "<p><a href=\"/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png\"></a></div>",
        "id": 1531777,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600650
    },
    {
        "content": "<p>thats more likely to what im used to have in usage.</p>",
        "id": 1531778,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600671
    },
    {
        "content": "<p>so it seems for me works for now to change those values.</p>",
        "id": 1531779,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600682
    },
    {
        "content": "<p>Maybe you can make required changes on your side to get this somehow fixed, could cause issues to other users too, and cloud based users could be paying a lot more if they run into same issue.</p>",
        "id": 1531781,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600726
    },
    {
        "content": "<p>Lucky i run own kvms so I can change all on the fly.</p>",
        "id": 1531783,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679600762
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"20576\">Cosmic Sound</span> has marked this topic as resolved.</p>",
        "id": 1531785,
        "sender_full_name": "Notification Bot",
        "timestamp": 1679600805
    },
    {
        "content": "<p>Yes, we likely need to revert some of <a href=\"https://github.com/zulip/zulip/commit/1c76036c61d86d4fc6a574b734e1d04ad0ab43a3\">1c76036c61d86d4fc6a574b734e1d04ad0ab43a3</a>.</p>",
        "id": 1531863,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679603275
    },
    {
        "content": "<p>Maybe just the <code>worker_connections</code> line needs to be turned into an option? I think the fd limit parts of it shouldn't consume memory.</p>",
        "id": 1531864,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679603326
    },
    {
        "content": "<p>Yeah, I think that's accurate.</p>",
        "id": 1531867,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679603509
    },
    {
        "content": "<p>worker_connections 1000000; its just too much :D doubt someone would need that, if so, then surely server wont have 4. GB RAM :D</p>",
        "id": 1531906,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679606174
    },
    {
        "content": "<p>even 40000 initial value was big enough, but to go million :D :D thats just bad config</p>",
        "id": 1531907,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679606237
    },
    {
        "content": "<p>At least problem solved, you guys, can easily patch that for later updates</p>",
        "id": 1531910,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679606283
    },
    {
        "content": "<p>Pushed <a href=\"https://github.com/zulip/zulip/pull/24846\">#24846</a>.</p>\n<p>Thanks for helping track that down!</p>",
        "id": 1531946,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679607829
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down/near/1531946\">said</a>:</p>\n<blockquote>\n<p>Pushed <a href=\"https://github.com/zulip/zulip/pull/24846\">#24846</a>.</p>\n<p>Thanks for helping track that down!</p>\n</blockquote>\n<p>I Was just thinking, if the tests from CI/CD could had prevented such a push, if the test would inquire GB Ram used, aren't these values reflected in the tests?</p>",
        "id": 1532473,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1679645275
    },
    {
        "content": "<p>It's probable that the \"production\" CI suite did see changes in its memory footprint.  We could put some guardrails on the memory consumption of the final steady-state running instance, though I worry that unless we make them very loose, they're going to trigger spuriously due to slow changes or random variance.  Though in this case, the change was probably drastic enough to trip a loose guardrail.</p>",
        "id": 1532592,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1679664846
    }
]