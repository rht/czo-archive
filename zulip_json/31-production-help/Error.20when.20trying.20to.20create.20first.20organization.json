[
    {
        "content": "<p>Hello everyone,<br>\nI followed the steps of the Production Installation Guide on a Xenial VM. I had some problem with the SMTP configurations I managed to resolve (I tried to do the organization creation process when the smtp conf was wrong).<br>\nNow that I fixed it, I tried to do it again:</p>\n<div class=\"codehilite\"><pre><span></span>/home/zulip/deployments/current/manage.py generate_realm_creation_link\nOne time organization creation link generated\n=&gt; Please visit https://[redacted]/create_realm/c33c2194eb962b45a38e9087cc78cf83fcfa7c0f to create the organization\n</pre></div>\n\n\n<p>I opened the link, filled the form with my email and clicked \"Create Organization\" and I received the following:</p>\n<div class=\"codehilite\"><pre><span></span>Hello there.\nYou recently signed up for Zulip. Awesome!\nTo complete signup, visit this link below:\n    &lt;https://[redacted]/accounts/do_confirm/b0f1159323a7dd99966689b85c8e4fe399193015&gt;\n</pre></div>\n\n\n<p>I clicked on the link and it opened with a 500 internal error from zulip and with the following email sent (I only redacted the IPs):</p>\n<div class=\"codehilite\"><pre><span></span>Error generated by Anonymous user (not logged in) on [redacted] deployment\n\nTraceback (most recent call last):\n  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 39, in inner\n    response = get_response(request)\n  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 249, in _legacy_get_response\n    response = self._get_response(request)\n  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response\n    response = self.process_exception_by_middleware(e, request)\n  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File &quot;./zerver/decorator.py&quot;, line 107, in wrapper\n    return func(request, *args, **kwargs)\n  File &quot;./zerver/views/registration.py&quot;, line 189, in accounts_register\n    org_type = int(form.cleaned_data[&#39;realm_org_type&#39;])\nValueError: invalid literal for int() with base 10: &#39;&#39;\n\nRequest info:\n- path: /accounts/register/\n- POST: {u&#39;full_name&#39;: [u&#39;&#39;], u&#39;csrfmiddlewaretoken&#39;: [u&#39;**********&#39;], u&#39;from_confirmation&#39;: [u&#39;1&#39;], u&#39;key&#39;: [u&#39;**********&#39;]}\n- REMOTE_ADDR: &quot;[redacted]&quot;\n- QUERY_STRING: &quot;&quot;\n- SERVER_NAME: &quot;&quot;\n</pre></div>\n\n\n<p>I have no idea how to troubleshoot that error.<br>\nI tried to restart all the services with the same result, the errors.log shows me only this:</p>\n<div class=\"codehilite\"><pre><span></span>2017-04-24 03:43:59,969 WARNING  TornadoQueueClient lost connection to RabbitMQ, reconnecting...\n2017-04-24 05:37:24,979 WARNING  TornadoQueueClient lost connection to RabbitMQ, reconnecting...\n2017-04-24 05:37:26,983 CRITICAL Failed to reconnect to RabbitMQ, retrying...\n</pre></div>\n\n\n<p>But the command <code>supervisorctl status</code> shows that everything is running:</p>\n<div class=\"codehilite\"><pre><span></span>process-fts-updates                                             RUNNING   pid 1599, uptime 4:56:52\nzulip-django                                                    RUNNING   pid 3390, uptime 0:19:51\nzulip-senders:zulip-events-message_sender-0                     RUNNING   pid 3401, uptime 0:19:50\nzulip-senders:zulip-events-message_sender-1                     RUNNING   pid 3402, uptime 0:19:50\nzulip-senders:zulip-events-message_sender-2                     RUNNING   pid 3403, uptime 0:19:50\nzulip-senders:zulip-events-message_sender-3                     RUNNING   pid 3404, uptime 0:19:50\nzulip-senders:zulip-events-message_sender-4                     RUNNING   pid 3400, uptime 0:19:50\nzulip-tornado                                                   RUNNING   pid 3383, uptime 0:19:53\nzulip-workers:zulip-deliver-enqueued-emails                     RUNNING   pid 3432, uptime 0:19:49\nzulip-workers:zulip-events-confirmation-emails                  RUNNING   pid 3430, uptime 0:19:49\nzulip-workers:zulip-events-digest_emails                        RUNNING   pid 3436, uptime 0:19:49\nzulip-workers:zulip-events-email_mirror                         RUNNING   pid 3434, uptime 0:19:49\nzulip-workers:zulip-events-embed_links                          RUNNING   pid 3437, uptime 0:19:49\nzulip-workers:zulip-events-error_reports                        RUNNING   pid 3431, uptime 0:19:49\nzulip-workers:zulip-events-feedback_messages                    RUNNING   pid 3439, uptime 0:19:49\nzulip-workers:zulip-events-missedmessage_mobile_notifications   RUNNING   pid 3435, uptime 0:19:49\nzulip-workers:zulip-events-missedmessage_reminders              RUNNING   pid 3438, uptime 0:19:49\nzulip-workers:zulip-events-signups                              RUNNING   pid 3429, uptime 0:19:49\nzulip-workers:zulip-events-slowqueries                          RUNNING   pid 3433, uptime 0:19:49\nzulip-workers:zulip-events-user-activity                        RUNNING   pid 3428, uptime 0:19:49\nzulip-workers:zulip-events-user-activity-interval               RUNNING   pid 3427, uptime 0:19:49\nzulip-workers:zulip-events-user-presence                        RUNNING   pid 3426, uptime 0:19:49\n</pre></div>\n\n\n<p>Thanks in advance for your help.</p>\n<p>Best regards, <br>\nCivilian</p>",
        "id": 192173,
        "sender_full_name": "Civilian",
        "timestamp": 1493037978
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"jbevieux@alteca.fr\" data-user-id=\"2268\">@Civilian</span> I've never seen this before!  It would appear that the problem relates to not having selected an organization type option in the new organization creation form.  I wouldn't expect the form to submit in that case, but it could be a bug I suppose.  Can you try selecting an organization type explicitly?</p>",
        "id": 192200,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493050962
    },
    {
        "content": "<p>That's rather odd, I can't think of ever seeing it not have something selected when I've installed. I could have missed something the couple times I know I messed up the auth, I'll have to pay attention next time. They are standard radio buttons, yes? Which (presumably) would result in one or the other selected.</p>",
        "id": 192536,
        "sender_full_name": "Andrea  Longo",
        "timestamp": 1493099032
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-email=\"jbevieux@alteca.fr\" data-user-id=\"2268\">@Civilian</span> I've never seen this before!  It would appear that the problem relates to not having selected an organization type option in the new organization creation form.  I wouldn't expect the form to submit in that case, but it could be a bug I suppose.  Can you try selecting an organization type explicitly?</p>\n<p>That's rather odd, I can't think of ever seeing it not have something selected when I've installed. I could have missed something the couple times I know I messed up the auth, I'll have to pay attention next time. They are standard radio buttons, yes? Which (presumably) would result in one or the other selected.</p>\n</blockquote>\n<p>Thanks for the replies, <br>\nNo I don't see any radio button and I can't select an organization type:<br>\n<a href=\"https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png\" target=\"_blank\" title=\"https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png\">https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png</a></p>\n<p>Here is the DOM for the form I have:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;form class=&quot;form-inline&quot; id=&quot;send_confirm&quot; name=&quot;email_form&quot; action=&quot;/create_realm/9e8cf05bc67e7df7a165a80c401369cec5ca9c9c&quot; method=&quot;post&quot; novalidate=&quot;novalidate&quot; _lpchecked=&quot;1&quot;&gt;\n    &lt;input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot; value=&quot;OFSeDqMONtSnSunXLt1qwGCqwwlQPec6hqu1ixsCabBMInWCUAcKbJQiiYbKM4BK&quot;&gt;\n    &lt;input type=&quot;text&quot; class=&quot;email required&quot; placeholder=&quot;Enter your work email address&quot; id=&quot;email&quot; name=&quot;email&quot; aria-required=&quot;true&quot;&gt;\n    &lt;input type=&quot;submit&quot; class=&quot;new-organization-button btn btn-primary btn-large register-button&quot; value=&quot;Create organization&quot;&gt;\n&lt;/form&gt;\n</pre></div>\n\n\n<p>I get the error after typing my email and submitting this form.<br>\nI can attach the install.log if needed (production install on xenial vm, auto-signed cert, only ip address (no domain yet) and using ldap auth).</p>\n<div class=\"message_inline_image\"><a href=\"https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png\" target=\"_blank\" title=\"https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png\"><img src=\"https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png\"></a></div>",
        "id": 192541,
        "sender_full_name": "Civilian",
        "timestamp": 1493106335
    },
    {
        "content": "<p>The first page, you should see the field to enter your email and the button. The next one, where you fill in your name, password, is where there are organization types. The link for that is in the email you should have gotten after providing your email. If everything were working correctly, at any rate.<br>\n<a href=\"/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png\" target=\"_blank\" title=\"Screen-Shot-2017-04-25-at-8.24.13.png\">Screen-Shot-2017-04-25-at-8.24.13.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png\" target=\"_blank\" title=\"Screen-Shot-2017-04-25-at-8.24.13.png\"><img src=\"/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png\"></a></div>",
        "id": 192581,
        "sender_full_name": "Andrea  Longo",
        "timestamp": 1493134060
    },
    {
        "content": "<p>The status should show all the processes up for about the same time (at least until the scheduled restart that happens once a week.) That most (but not all) of yours have very small uptime seems unexpected. I get that sometimes when rabbitmq is misbehaving. It goes away after I restart it. (<code>/etc/init.d/rabbitmq-server restart</code>)</p>",
        "id": 192582,
        "sender_full_name": "Andrea  Longo",
        "timestamp": 1493134417
    },
    {
        "content": "<p>I don't have a test environment set up without a proper domain name, so maybe it's something there. (I do have a current task to test something with a self-signed cert, so actually am going to get to it shortly.)</p>",
        "id": 192583,
        "sender_full_name": "Andrea  Longo",
        "timestamp": 1493134528
    },
    {
        "content": "<p>Thanks but the problem occurs after the 1st page when I try to confirm my account from the link sent by mail.<br>\nI created a new xenial VM and did the whole setup process again but again with the same problem.<br>\nI just found that I have the exact same issue than: <a href=\"https://github.com/zulip/zulip/issues/96\" target=\"_blank\" title=\"https://github.com/zulip/zulip/issues/96\">https://github.com/zulip/zulip/issues/96</a></p>\n<p>By inspecting the install.log (attached) I can see there are permissions error but the install script didn't report them at the end of it.<br>\nin the guide it says I had to do this: <br>\n<code>su zulip -c /home/zulip/deployments/current/scripts/setup/initialize-database</code><br>\nBut it was asking me for the zulip user's password but I don't know what it is.<br>\nSo for that step I instead did:</p>\n<div class=\"codehilite\"><pre><span></span>su zulip\n/home/zulip/deployments/current/scripts/setup/initialize-database\n</pre></div>\n\n\n<p>And it worked (said ok for every steps).</p>\n<p>I tried to fix the rabbitmq permissions like suggested in the issue:</p>\n<div class=\"codehilite\"><pre><span></span>scripts/setup/configure-rabbitmq\n</pre></div>\n\n\n<p>But it asked me for the zulip user's password again (tried the rabbitmq_password value from secrets but didn't work).</p>\n<p>Thanks in advance.<br>\nBest regards,<br>\nCivilian</p>\n<p><a href=\"/user_uploads/2/ff/lcgzMPzVK925a4287acNI8fz/install.log\" target=\"_blank\" title=\"install.log\">install.log</a></p>",
        "id": 193198,
        "sender_full_name": "Civilian",
        "timestamp": 1493227243
    },
    {
        "content": "<p>Hmm, the install log looks to be a clear install</p>",
        "id": 193241,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231110
    },
    {
        "content": "<p>I can't really help debug the commands you're posting, since you don't show what use you're running them as</p>",
        "id": 193242,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231133
    },
    {
        "content": "<p>If you get prompted for a user's password, that's probably because you ran something not as root that you should have run as root</p>",
        "id": 193243,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231152
    },
    {
        "content": "<p>The <code>zulip</code> user doesn't have a password; it's only accessed via <code>su</code></p>",
        "id": 193244,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231163
    },
    {
        "content": "<p>from the root user</p>",
        "id": 193245,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231166
    },
    {
        "content": "<p><a href=\"https://github.com/zulip/zulip/pull/96\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/96\">#96</a> has a few issues discussed; are you having the rabbitmq one or the email one <span class=\"user-mention\" data-user-email=\"jbevieux@alteca.fr\" data-user-id=\"2268\">@Civilian</span>?</p>",
        "id": 193246,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1493231219
    },
    {
        "content": "<p>Prod is working fine on my 14.04 VM with only an ip address (and also a self-signed cert.) I don't have 16.04 or LDAP conveniently available for testing.</p>",
        "id": 194558,
        "sender_full_name": "Andrea  Longo",
        "timestamp": 1493610482
    }
]