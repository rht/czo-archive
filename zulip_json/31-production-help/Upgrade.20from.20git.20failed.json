[
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>root@chat:/home/zulip/deployments/current# /home/zulip/deployments/current/scripts/upgrade-zulip-from-git master\n2021-07-03 21:01:47,462 upgrade-zulip-from-git: Cloning the repository\n2021-07-03 21:02:15,288 upgrade-zulip-from-git: Fetching the latest commits\n2021-07-03 21:02:17,715 upgrade-zulip-stage-2: Upgrading system packages...\nHit:1 http://ppa.launchpad.net/groonga/ppa/ubuntu focal InRelease\nHit:2 http://apt.postgresql.org/pub/repos/apt focal-pgdg InRelease\nHit:3 http://archive.ubuntu.com/ubuntu focal InRelease\nGet:4 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\nGet:5 http://archive.ubuntu.com/ubuntu focal-backports InRelease [101 kB]\nGet:6 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\nHit:7 https://packages.groonga.org/ubuntu focal InRelease\nFetched 328 kB in 1s (254 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n+ apt-get -y install build-essential libffi-dev libfreetype6-dev zlib1g-dev libjpeg-dev libldap2-dev python3-dev python3-pip virtualenv libxml2-dev libxslt1-dev libpq-dev libssl-dev libmagic1 libyaml-dev libxmlsec1-dev pkg-config jq libsasl2-dev\nReading package lists...\nBuilding dependency tree...\nReading state information...\nlibffi-dev is already the newest version (3.3-4).\nlibjpeg-dev is already the newest version (8c-2ubuntu8).\nlibmagic1 is already the newest version (1:5.38-4).\nlibsasl2-dev is already the newest version (2.1.27+dfsg-2).\nlibxmlsec1-dev is already the newest version (1.2.28-2).\nlibxslt1-dev is already the newest version (1.1.34-4).\nlibyaml-dev is already the newest version (0.2.2-1).\npkg-config is already the newest version (0.29.1-0ubuntu4).\npython3-dev is already the newest version (3.8.2-0ubuntu2).\nbuild-essential is already the newest version (12.8ubuntu1.1).\nlibfreetype6-dev is already the newest version (2.10.1-2ubuntu0.1).\nlibldap2-dev is already the newest version (2.4.49+dfsg-2ubuntu1.8).\nlibssl-dev is already the newest version (1.1.1f-1ubuntu2.4).\nlibxml2-dev is already the newest version (2.9.10+dfsg-5ubuntu0.20.04.1).\nzlib1g-dev is already the newest version (1:1.2.11.dfsg-2ubuntu1.2).\njq is already the newest version (1.6-1ubuntu0.20.04.1).\npython3-pip is already the newest version (20.0.2-5ubuntu1.5).\nvirtualenv is already the newest version (20.0.17-1ubuntu0.4).\nlibpq-dev is already the newest version (13.3-1.pgdg20.04+1).\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n+ rm -rf /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv\n+ mkdir -p /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv\n+ virtualenv -p python3 /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv\ncreated virtual environment CPython3.8.10.final.0-64 in 123ms\n  creator CPython3Posix(dest=/srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv, clear=False, global=False)\n  seeder FromAppData(download=False, pip=latest, setuptools=latest, wheel=latest, pkg_resources=latest, via=copy, app_data_dir=/root/.local/share/virtualenv/seed-app-data/v1.0.1.debian.1)\n  activators BashActivator,CShellActivator,FishActivator,PowerShellActivator,PythonActivator,XonshActivator\n+ chown -R 0:0 /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv\n+ /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv/bin/pip install --force-reinstall --require-hashes -r /home/zulip/deployments/2021-07-03-21-01-47/requirements/pip.txt\nCollecting wheel==0.36.2\n  Using cached wheel-0.36.2-py2.py3-none-any.whl (35 kB)\nCollecting pip==20.3.4\n  Using cached pip-20.3.4-py2.py3-none-any.whl (1.5 MB)\nCollecting setuptools==57.0.0\n  Using cached setuptools-57.0.0-py3-none-any.whl (821 kB)\nInstalling collected packages: wheel, pip, setuptools\n  Attempting uninstall: wheel\n    Found existing installation: wheel 0.34.2\n    Uninstalling wheel-0.34.2:\n      Successfully uninstalled wheel-0.34.2\n  Attempting uninstall: pip\n    Found existing installation: pip 20.0.2\n    Uninstalling pip-20.0.2:\n      Successfully uninstalled pip-20.0.2\n  Attempting uninstall: setuptools\n    Found existing installation: setuptools 44.0.0\n    Uninstalling setuptools-44.0.0:\n      Successfully uninstalled setuptools-44.0.0\nSuccessfully installed pip-20.3.4 setuptools-57.0.0 wheel-0.36.2\n+ /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv/bin/pip install --use-deprecated=legacy-resolver --no-deps --require-hashes -r /home/zulip/deployments/2021-07-03-21-01-47/requirements/prod.txt\nIgnoring dataclasses: markers &#39;python_version &lt; &quot;3.7&quot;&#39; don&#39;t match your environment\nIgnoring importlib-metadata: markers &#39;python_version &lt; &quot;3.8&quot;&#39; don&#39;t match your environment\nCollecting apns2==0.7.2\n  Using cached apns2-0.7.2-py2.py3-none-any.whl (10.0 kB)\nCollecting argon2-cffi==20.1.0\n  Using cached argon2_cffi-20.1.0-cp35-abi3-manylinux1_x86_64.whl (97 kB)\nCollecting asgiref==3.3.4\n  Using cached asgiref-3.3.4-py3-none-any.whl (22 kB)\nCollecting attrs==21.2.0\n  Using cached attrs-21.2.0-py2.py3-none-any.whl (53 kB)\nCollecting backcall==0.2.0\n  Using cached backcall-0.2.0-py2.py3-none-any.whl (11 kB)\nCollecting backoff==1.10.0\n  Using cached backoff-1.10.0-py2.py3-none-any.whl (31 kB)\nCollecting beautifulsoup4==4.9.3\n  Using cached beautifulsoup4-4.9.3-py3-none-any.whl (115 kB)\nCollecting boto3==1.17.89\n  Downloading boto3-1.17.89-py2.py3-none-any.whl (131 kB)\nCollecting botocore==1.20.89\n  Downloading botocore-1.20.89-py2.py3-none-any.whl (7.6 MB)\nCollecting cachetools==4.2.2\n  Using cached cachetools-4.2.2-py3-none-any.whl (11 kB)\nCollecting cchardet==2.1.7\n  Using cached cchardet-2.1.7-cp38-cp38-manylinux2010_x86_64.whl (265 kB)\nCollecting certifi==2021.5.30\n  Downloading certifi-2021.5.30-py2.py3-none-any.whl (145 kB)\nCollecting cffi==1.14.5\n  Using cached cffi-1.14.5-cp38-cp38-manylinux1_x86_64.whl (411 kB)\nCollecting chardet==4.0.0\n  Using cached chardet-4.0.0-py2.py3-none-any.whl (178 kB)\nCollecting cryptography==3.4.7\n  Using cached cryptography-3.4.7-cp36-abi3-manylinux2014_x86_64.whl (3.2 MB)\nCollecting cssselect==1.1.0\n  Using cached cssselect-1.1.0-py2.py3-none-any.whl (16 kB)\nCollecting cssutils==2.3.0\n  Downloading cssutils-2.3.0-py3-none-any.whl (404 kB)\nCollecting decorator==5.0.9\n  Downloading decorator-5.0.9-py3-none-any.whl (8.9 kB)\nCollecting defusedxml==0.6.0\n  Using cached defusedxml-0.6.0-py2.py3-none-any.whl (23 kB)\nCollecting dictpath==0.1.3\n  Downloading dictpath-0.1.3-py3-none-any.whl (8.4 kB)\nCollecting disposable-email-domains==0.0.65\n  Downloading disposable_email_domains-0.0.65-py2.py3-none-any.whl (21 kB)\nCollecting distro==1.5.0\n  Using cached distro-1.5.0-py2.py3-none-any.whl (18 kB)\nCollecting django-auth-ldap==2.0.0zulip1\n  Using cached https://github.com/zulip/django-auth-ldap/archive/e26d0ef2a7ff77ab3fdd7b6578a76081f780778c.zip (66 kB)\n  WARNING: Requested django-auth-ldap==2.0.0zulip1 from https://github.com/zulip/django-auth-ldap/archive/e26d0ef2a7ff77ab3fdd7b6578a76081f780778c.zip#egg=django-auth-ldap==2.0.0zulip1 (from -r /home/zulip/deployments/2021-07-03-21-01-47/requirements/prod.txt (line 237)), but installing version 2.0.0\nCollecting django-bitfield==2.1.0\n  Downloading django_bitfield-2.1.0-py2.py3-none-any.whl (18 kB)\nCollecting django-bmemcached==0.3.0\n  Using cached django-bmemcached-0.3.0.tar.gz (3.0 kB)\nCollecting django-formtools==2.3\n  Using cached django_formtools-2.3-py3-none-any.whl (148 kB)\nCollecting django-otp==1.0.6\n  Downloading django_otp-1.0.6-py3-none-any.whl (58 kB)\nCollecting django-phonenumber-field==5.2.0\n  Downloading django_phonenumber_field-5.2.0-py3-none-any.whl (60 kB)\nCollecting django-sendfile2==0.6.0\n  Using cached django-sendfile2-0.6.0.tar.gz (23 kB)\nCollecting django-statsd-mozilla==0.4.0\n  Using cached django_statsd_mozilla-0.4.0-py3-none-any.whl (18 kB)\nCollecting django-two-factor-auth[call,phonenumberslite,sms]==1.13.1\n  Using cached django_two_factor_auth-1.13.1-py2.py3-none-any.whl (197 kB)\nCollecting django[argon2]==3.2.4\n  Downloading Django-3.2.4-py3-none-any.whl (7.9 MB)\nCollecting ecdsa==0.17.0\n  Downloading ecdsa-0.17.0-py2.py3-none-any.whl (119 kB)\nCollecting future==0.18.2\n  Using cached future-0.18.2.tar.gz (829 kB)\nCollecting h2==2.6.2\n  Using cached h2-2.6.2-py2.py3-none-any.whl (71 kB)\nCollecting hpack==3.0.0\n  Using cached hpack-3.0.0-py2.py3-none-any.whl (38 kB)\nCollecting html2text==2020.1.16\n  Using cached html2text-2020.1.16-py3-none-any.whl (32 kB)\nCollecting html5lib==1.1\n  Using cached html5lib-1.1-py2.py3-none-any.whl (112 kB)\nCollecting hyper==0.7.0\n  Using cached hyper-0.7.0-py2.py3-none-any.whl (269 kB)\nCollecting hyperframe==3.2.0\n  Using cached hyperframe-3.2.0-py2.py3-none-any.whl (13 kB)\nCollecting idna==2.10\n  Using cached idna-2.10-py2.py3-none-any.whl (58 kB)\nCollecting ipython-genutils==0.2.0\n  Using cached ipython_genutils-0.2.0-py2.py3-none-any.whl (26 kB)\nCollecting ipython==7.16.1\n  Using cached ipython-7.16.1-py3-none-any.whl (785 kB)\nCollecting isodate==0.6.0\n  Using cached isodate-0.6.0-py2.py3-none-any.whl (45 kB)\nCollecting jedi==0.17.2\n  Using cached jedi-0.17.2-py2.py3-none-any.whl (1.4 MB)\nCollecting jinja2==3.0.1\n  Downloading Jinja2-3.0.1-py3-none-any.whl (133 kB)\nCollecting jmespath==0.10.0\n  Using cached jmespath-0.10.0-py2.py3-none-any.whl (24 kB)\nCollecting jsonref==0.2\n  Using cached jsonref-0.2-py3-none-any.whl (9.3 kB)\nCollecting jsonschema==3.2.0\n  Using cached jsonschema-3.2.0-py2.py3-none-any.whl (56 kB)\nCollecting jsx-lexer==1.0.0\n  Using cached jsx_lexer-1.0.0-py2.py3-none-any.whl (3.9 kB)\nCollecting lazy-object-proxy==1.6.0\n  Using cached lazy_object_proxy-1.6.0-cp38-cp38-manylinux1_x86_64.whl (58 kB)\nCollecting lxml==4.6.3\n  Using cached lxml-4.6.3-cp38-cp38-manylinux2014_x86_64.whl (6.8 MB)\nCollecting markdown-include==0.6.0\n  Using cached markdown-inc\n</code></pre></div>",
        "id": 1224709,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625346552
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"operations\"><pre><span></span><code>  Apply all migrations: analytics, auth, confirmation, contenttypes, otp_static, otp_totp, sessions, social_django, two_factor, zerver\nRunning migrations:\n  Applying zerver.0326_alter_realm_authentication_methods... OK\n  Applying zerver.0327_realm_edit_topic_policy... OK\n  Applying zerver.0328_migrate_to_edit_topic_policy... OK\n  Applying zerver.0329_remove_realm_allow_community_topic_editing... OK\n  Applying zerver.0330_linkifier_pattern_validator... OK\n2021-07-03 21:05:21,734 upgrade-zulip-stage-2: Restarting Zulip...\n2021-07-03 21:05:21,775 restart-server: Filling memcached caches\n2021-07-03 21:05:23.156 INFO [] Successfully populated user cache!  Consumed 1 remote cache queries (0.01 time)\n2021-07-03 21:05:23.158 INFO [] Successfully populated client cache!  Consumed 1 remote cache queries (0.0 time)\n2021-07-03 21:05:23.162 INFO [] Successfully populated stream cache!  Consumed 1 remote cache queries (0.0 time)\n2021-07-03 21:05:23.163 INFO [] Successfully populated huddle cache!  Consumed 1 remote cache queries (0.0 time)\n2021-07-03 21:05:23.165 INFO [] Successfully populated session cache!  Consumed 1 remote cache queries (0.0 time)\n2021-07-03 21:05:23,529 restart-server: Restarting zulip-workers:zulip_deliver_scheduled_emails\n2021-07-03 21:05:24,673 restart-server: Restarting zulip-workers:zulip_deliver_scheduled_messages\n2021-07-03 21:05:25,820 restart-server: Restarting zulip-workers:zulip_events_deferred_work\n2021-07-03 21:05:26,965 restart-server: Restarting zulip-workers:zulip_events_digest_emails\n2021-07-03 21:05:28,338 restart-server: Restarting zulip-workers:zulip_events_email_mirror\n2021-07-03 21:05:29,490 restart-server: Restarting zulip-workers:zulip_events_email_senders\n2021-07-03 21:05:30,870 restart-server: Restarting zulip-workers:zulip_events_embed_links\n2021-07-03 21:05:32,015 restart-server: Restarting zulip-workers:zulip_events_embedded_bots\n2021-07-03 21:05:33,356 restart-server: Restarting zulip-workers:zulip_events_error_reports\n2021-07-03 21:05:34,538 restart-server: Restarting zulip-workers:zulip_events_invites\n2021-07-03 21:05:35,855 restart-server: Restarting zulip-workers:zulip_events_missedmessage_emails\n2021-07-03 21:05:37,093 restart-server: Restarting zulip-workers:zulip_events_missedmessage_mobile_notifications\n2021-07-03 21:05:38,372 restart-server: Restarting zulip-workers:zulip_events_outgoing_webhooks\n2021-07-03 21:05:39,629 restart-server: Restarting zulip-workers:zulip_events_user_activity\n2021-07-03 21:05:40,900 restart-server: Restarting zulip-workers:zulip_events_user_activity_interval\n2021-07-03 21:05:42,113 restart-server: Restarting zulip-workers:zulip_events_user_presence\n2021-07-03 21:05:43,355 restart-server: Restarting zulip_deliver_scheduled_emails\nTraceback (most recent call last):\n  File \"./scripts/restart-server\", line 113, in &lt;module&gt;\n    subprocess.check_call([\"supervisorctl\", \"restart\", worker])\n  File \"/usr/lib/python3.8/subprocess.py\", line 364, in check_call\n    raise CalledProcessError(retcode, cmd)\nsubprocess.CalledProcessError: Command '['supervisorctl', 'restart', 'zulip_deliver_scheduled_emails']' returned non-zero exit status 1.\nTraceback (most recent call last):\n  File \"/home/zulip/deployments/2021-07-03-21-01-47/scripts/lib/upgrade-zulip-stage-2\", line 309, in &lt;module&gt;\n    subprocess.check_output([\"./scripts/restart-server\", \"--fill-cache\"], preexec_fn=su_to_zulip)\n  File \"/usr/lib/python3.8/subprocess.py\", line 415, in check_output\n    return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,\n  File \"/usr/lib/python3.8/subprocess.py\", line 516, in run\n    raise CalledProcessError(retcode, process.args,\nsubprocess.CalledProcessError: Command '['./scripts/restart-server', '--fill-cache']' returned non-zero exit status 1.\nroot@chat:/home/zulip/deployments/current#```\n</code></pre></div>",
        "id": 1224710,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625346586
    },
    {
        "content": "<p>when runned a second time,</p>",
        "id": 1224712,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625346789
    },
    {
        "content": "<p>root@chat:/home/zulip/deployments/current# /home/zulip/deployments/current/scripts/upgrade-zulip-from-git master<br>\n2021-07-03 21:11:13,133 upgrade-zulip-from-git: Fetching the latest commits<br>\n2021-07-03 21:11:15,351 upgrade-zulip-stage-2: Upgrading system packages...<br>\nHit:1 <a href=\"http://archive.ubuntu.com/ubuntu\">http://archive.ubuntu.com/ubuntu</a> focal InRelease<br>\nHit:2 <a href=\"http://archive.ubuntu.com/ubuntu\">http://archive.ubuntu.com/ubuntu</a> focal-updates InRelease<br>\nHit:3 <a href=\"http://archive.ubuntu.com/ubuntu\">http://archive.ubuntu.com/ubuntu</a> focal-backports InRelease<br>\nHit:4 <a href=\"http://security.ubuntu.com/ubuntu\">http://security.ubuntu.com/ubuntu</a> focal-security InRelease<br>\nHit:5 <a href=\"http://ppa.launchpad.net/groonga/ppa/ubuntu\">http://ppa.launchpad.net/groonga/ppa/ubuntu</a> focal InRelease<br>\nHit:6 <a href=\"http://apt.postgresql.org/pub/repos/apt\">http://apt.postgresql.org/pub/repos/apt</a> focal-pgdg InRelease<br>\nHit:7 <a href=\"https://packages.groonga.org/ubuntu\">https://packages.groonga.org/ubuntu</a> focal InRelease<br>\nReading package lists...<br>\nReading package lists...<br>\nBuilding dependency tree...<br>\nReading state information...<br>\nCalculating upgrade...<br>\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</p>\n<ul>\n<li>\n<p>apt-get -y install build-essential libffi-dev libfreetype6-dev zlib1g-dev libjpeg-dev libldap2-dev python3-dev python3-pip virtualenv libxml2-dev libxslt1-dev libpq-dev libssl-dev libmagic1 libyaml-dev libxmlsec1-dev pkg-config jq libsasl2-dev<br>\nReading package lists...<br>\nBuilding dependency tree...<br>\nReading state information...<br>\nlibffi-dev is already the newest version (3.3-4).<br>\nlibjpeg-dev is already the newest version (8c-2ubuntu8).<br>\nlibmagic1 is already the newest version (1:5.38-4).<br>\nlibsasl2-dev is already the newest version (2.1.27+dfsg-2).<br>\nlibxmlsec1-dev is already the newest version (1.2.28-2).<br>\nlibxslt1-dev is already the newest version (1.1.34-4).<br>\nlibyaml-dev is already the newest version (0.2.2-1).<br>\npkg-config is already the newest version (0.29.1-0ubuntu4).<br>\npython3-dev is already the newest version (3.8.2-0ubuntu2).<br>\nbuild-essential is already the newest version (12.8ubuntu1.1).<br>\nlibfreetype6-dev is already the newest version (2.10.1-2ubuntu0.1).<br>\nlibldap2-dev is already the newest version (2.4.49+dfsg-2ubuntu1.8).<br>\nlibssl-dev is already the newest version (1.1.1f-1ubuntu2.4).<br>\nlibxml2-dev is already the newest version (2.9.10+dfsg-5ubuntu0.20.04.1).<br>\nzlib1g-dev is already the newest version (1:1.2.11.dfsg-2ubuntu1.2).<br>\njq is already the newest version (1.6-1ubuntu0.20.04.1).<br>\npython3-pip is already the newest version (20.0.2-5ubuntu1.5).<br>\nvirtualenv is already the newest version (20.0.17-1ubuntu0.4).<br>\nlibpq-dev is already the newest version (13.3-1.pgdg20.04+1).<br>\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.<br>\nUsing cached Python venv from /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv</p>\n</li>\n<li>\n<p>ln -nsf /srv/zulip-venv-cache/36afeea635364c14f58375b18b44b6009dfdf1d0/zulip-py3-venv /home/zulip/deployments/2021-07-03-21-11-13/zulip-py3-venv<br>\nNode version 14.17.0 is already installed.<br>\ngenerate_secrets: No new secrets to generate.<br>\n2021-07-03 21:11:18,715 upgrade-zulip-stage-2: Building static assets...<br>\nCached version not found! Installing node modules.</p>\n</li>\n<li>\n<p>/srv/zulip-yarn/bin/yarn install --non-interactive --frozen-lockfile --prod<br>\nyarn install v1.22.10<br>\n[1/4] Resolving packages...<br>\n[2/4] Fetching packages...<br>\ninfo <a href=\"mailto:fsevents@2.3.2\">fsevents@2.3.2</a>: The platform \"linux\" is incompatible with this module.<br>\ninfo \"<a href=\"mailto:fsevents@2.3.2\">fsevents@2.3.2</a>\" is an optional dependency and failed compatibility check. Excluding it from installation.<br>\ninfo <a href=\"mailto:fsevents@1.2.13\">fsevents@1.2.13</a>: The platform \"linux\" is incompatible with this module.<br>\ninfo \"<a href=\"mailto:fsevents@1.2.13\">fsevents@1.2.13</a>\" is an optional dependency and failed compatibility check. Excluding it from installation.<br>\n[3/4] Linking dependencies...<br>\nwarning \"@formatjs/cli &gt; @vue/compiler-sfc@3.1.1\" has unmet peer dependency \"<a href=\"mailto:vue@3.1.1\">vue@3.1.1</a>\".<br>\nwarning \"swagger-parser &gt; @apidevtools/swagger-parser@10.0.2\" has unmet peer dependency \"openapi-types@&gt;=7\".<br>\n[4/4] Building fresh packages...<br>\nwarning Ignored scripts due to flag.<br>\nDone in 9.16s.<br>\nUsing cached node modules from /srv/zulip-npm-cache/f413e5f5d8bad3bbe0e4f4644dc41d88a8f9e871/node_modules</p>\n</li>\n<li>\n<p>./tools/setup/emoji/build_emoji<br>\nbuild_emoji: Using cached emojis from /srv/zulip-emoji-cache/6b1c0aff5d7a20084dc50f56491b07237b1ac5ec/emoji</p>\n</li>\n<li>\n<p>./scripts/setup/inline_email_css.py</p>\n</li>\n<li>./tools/setup/generate_zulip_bots_static_files.py</li>\n<li>./tools/setup/build_pygments_data</li>\n<li>./tools/setup/build_timezone_values</li>\n<li>\n<p>./tools/webpack --quiet<br>\n(node:1750019) V8: /srv/zulip-npm-cache/f413e5f5d8bad3bbe0e4f4644dc41d88a8f9e871/node_modules/ttf2woff2/jssrc/ttf2woff2.js:3 Invalid asm.js: Invalid member of stdlib<br>\n(Use <code>node --trace-warnings ...</code> to show where the warning was created)<br>\ni ｢wdm｣: Webpack compilation successful.</p>\n</li>\n<li>\n<p>./manage.py collectstatic --no-default-ignore -v0 --noinput --ignore=assets --ignore=emoji-styles --ignore=html --ignore=js --ignore=styles --ignore=templates</p>\n</li>\n<li>./manage.py compilemessages -v0<br>\n2021-07-03 21:12:11,941 upgrade-zulip-stage-2: Caching Zulip Git version...<br>\n2021-07-03 21:12:12,093 upgrade-zulip-stage-2: Checking for needed migrations<br>\n2021-07-03 21:12:13,829 upgrade-zulip-stage-2: Stopping Zulip...<br>\nprocess-fts-updates: ERROR (not running)<br>\nzulip-django: ERROR (not running)<br>\nzulip-tornado: ERROR (not running)<br>\nzulip-workers:zulip_events_missedmessage_emails: stopped<br>\nzulip-workers:zulip_deliver_scheduled_emails: stopped<br>\nzulip-workers:zulip_deliver_scheduled_messages: stopped<br>\nzulip-workers:zulip_events_email_mirror: stopped<br>\nzulip-workers:zulip_events_missedmessage_mobile_notifications: stopped<br>\nzulip-workers:zulip_events_error_reports: stopped<br>\nzulip-workers:zulip_events_outgoing_webhooks: stopped<br>\nzulip-workers:zulip_events_invites: stopped<br>\nzulip-workers:zulip_events_email_senders: stopped<br>\nzulip-workers:zulip_events_deferred_work: stopped<br>\nzulip-workers:zulip_events_digest_emails: stopped<br>\nzulip-workers:zulip_events_user_activity: stopped<br>\nzulip-workers:zulip_events_user_activity_interval: stopped<br>\nzulip-workers:zulip_events_embed_links: stopped<br>\nzulip-workers:zulip_events_embedded_bots: stopped<br>\nzulip-workers:zulip_events_user_presence: stopped<br>\nzulip_deliver_scheduled_emails: ERROR (no such process)<br>\nzulip_deliver_scheduled_messages: ERROR (no such process)<br>\nTraceback (most recent call last):<br>\n  File \"./scripts/stop-server\", line 51, in &lt;module&gt;<br>\n    subprocess.check_call([\"supervisorctl\", \"stop\", *services])<br>\n  File \"/usr/lib/python3.8/subprocess.py\", line 364, in check_call<br>\n    raise CalledProcessError(retcode, cmd)<br>\nsubprocess.CalledProcessError: Command '['supervisorctl', 'stop', 'process-fts-updates', 'zulip-django', 'zulip-tornado', 'zulip-tornado:<em>', 'zulip-workers:</em>', 'zulip_deliver_scheduled_emails', 'zulip_deliver_scheduled_messages']' returned non-zero exit status 1.<br>\nTraceback (most recent call last):<br>\n  File \"/home/zulip/deployments/2021-07-03-21-11-13/scripts/lib/upgrade-zulip-stage-2\", line 265, in &lt;module&gt;<br>\n    shutdown_server()<br>\n  File \"/home/zulip/deployments/2021-07-03-21-11-13/scripts/lib/upgrade-zulip-stage-2\", line 109, in shutdown_server<br>\n    subprocess.check_call([\"./scripts/stop-server\"], preexec_fn=su_to_zulip)<br>\n  File \"/usr/lib/python3.8/subprocess.py\", line 364, in check_call<br>\n    raise CalledProcessError(retcode, cmd)<br>\nsubprocess.CalledProcessError: Command '['./scripts/stop-server']' returned non-zero exit status 1.</li>\n</ul>\n<p>Zulip upgrade failed (exit code 1)!</p>\n<p>The upgrade process is designed to be idempotent, so you can retry after resolving whatever issue caused the failure (there should be a traceback above). A log of this installation is available in /var/log/zulip/upgrade.log</p>",
        "id": 1224713,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625346792
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"root\"><pre><span></span><code>Traceback (most recent call last):\n  File \"./manage.py\", line 15, in &lt;module&gt;\n    setup_path()\n  File \"/home/zulip/deployments/2021-06-09-16-41-55/scripts/lib/setup_path.py\", line 14, in setup_path\n    with open(activate_this) as f:\nFileNotFoundError: [Errno 2] No such file or directory: '/home/zulip/deployments/2021-06-09-16-41-55/zulip-py3-venv/bin/activate_this.py'\nTraceback (most recent call last):\n  File \"/home/zulip/deployments/last/scripts/restart-server\", line 50, in &lt;module&gt;\n    subprocess.check_call(\n  File \"/usr/lib/python3.8/subprocess.py\", line 364, in check_call\n    raise CalledProcessError(retcode, cmd)\nsubprocess.CalledProcessError: Command '['./manage.py', 'send_stats', 'incr', 'events.server_restart', '1625347189']' returned non-zero exit status 1.\nroot@chat:/home/zulip/deployments/current#\n</code></pre></div>",
        "id": 1224717,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625347253
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"12178\">@Alex Vandiver</span> do you think this could be the issue we were discussing the other day with not having a correct check for whether <code>zulip_deliver_scheduled_emails</code> should be running on the present system?</p>",
        "id": 1225222,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1625512442
    },
    {
        "content": "<p>If so, maybe we haven't merged the fix to master yet?</p>",
        "id": 1225223,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1625512456
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20576\">@Cosmic Sound</span>, what's the <code>/etc/zulip/zulip.conf</code> for that host?</p>",
        "id": 1225225,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1625512534
    },
    {
        "content": "<p>Will paste it here first thing <del>tomorrow</del> now :D</p>",
        "id": 1225232,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625512809
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash Session\"><pre><span></span><code><span class=\"gp\">ubuntu@chat:~$ </span>cat /etc/zulip/zulip.conf\n<span class=\"go\">[machine]</span>\n<span class=\"go\">puppet_classes = zulip::profile::standalone</span>\n<span class=\"go\">deploy_type = production</span>\n\n<span class=\"go\">[postgresql]</span>\n<span class=\"go\">version = 13</span>\n\n\n<span class=\"go\">[certbot]</span>\n<span class=\"go\">auto_renew = yes</span>\n\n<span class=\"go\">[rabbitmq]</span>\n<span class=\"go\">nodename = zulip@localhost</span>\n</code></pre></div>",
        "id": 1225234,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625512827
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span>: standalone means it's not the problem from staging</p>",
        "id": 1225239,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1625513045
    },
    {
        "content": "<p>I can look more tomorrow</p>",
        "id": 1225240,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1625513051
    },
    {
        "content": "<p>OK.</p>",
        "id": 1225241,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1625513057
    },
    {
        "content": "<p>Guys meanwhile any idea how I return to normality with the server?</p>",
        "id": 1225243,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625513160
    },
    {
        "content": "<p>As of last. intervention were on this beautiful screen that could be usefull to have a small debug trace option to have in place for admins and devs. <a href=\"/user_uploads/2/27/69OzPRChSsZP03BYTM4lI-0d/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/27/69OzPRChSsZP03BYTM4lI-0d/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/27/69OzPRChSsZP03BYTM4lI-0d/image.png\"></a></div>",
        "id": 1225244,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625513199
    },
    {
        "content": "<p>Is there some safe rollback?</p>",
        "id": 1225245,
        "sender_full_name": "Cosmic Sound",
        "timestamp": 1625513219
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20576\">@Cosmic Sound</span> I'd expect <code>supervisorctl start all</code> to restart the server happily; the bug here is literally just in the step to start the server back up after the upgrade completed.</p>",
        "id": 1225285,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1625519521
    },
    {
        "content": "<p>Sorry we didn't mention this earlier; I hadn't noted that the state was the server down, as opposed to refusing to upgrade.</p>",
        "id": 1225286,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1625519576
    }
]