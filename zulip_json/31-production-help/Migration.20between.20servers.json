[
    {
        "content": "<p>Hi!<br>\nI'm having issues migrating from one server to another. Both servers are exactly the same version. However, once I've exported the tarball from the first server, the second server fails to import it. Specifically, I get this error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>ValueError:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>assign<span class=\"w\"> </span><span class=\"s2\">\"2999\"</span>:<span class=\"w\"> </span><span class=\"s2\">\"UserProfile.recipient\"</span><span class=\"w\"> </span>must<span class=\"w\"> </span>be<span class=\"w\"> </span>a<span class=\"w\"> </span><span class=\"s2\">\"Recipient\"</span><span class=\"w\"> </span>instance.\n</code></pre></div>",
        "id": 1529630,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679431402
    },
    {
        "content": "<p>I did a test run of the migration the other day, which went fine, but stupidly, after the test run, I deleted some users with the <code>./manage.py delete_user</code> command <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span></p>",
        "id": 1529632,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679431450
    },
    {
        "content": "<p>I've trued a number of things to resolve this. The users that were deleted appear in realm.json under the <code>zerver_userprofile_mirrordummy</code> key. I tried to move them back to <code>zerver_userprofile</code> which didn't work.</p>",
        "id": 1529636,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679431506
    },
    {
        "content": "<p>I even tried restoring our server from a tape backup (its been about a week since my test run and subsequent deleting of users), re-exported the old server, and then went through the old realm.json and tried to copy across each of the deleted users to the newly exported realm.json; which then gives this error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>django.db.utils.IntegrityError:<span class=\"w\"> </span>duplicate<span class=\"w\"> </span>key<span class=\"w\"> </span>value<span class=\"w\"> </span>violates<span class=\"w\"> </span>unique<span class=\"w\"> </span>constraint<span class=\"w\"> </span><span class=\"s2\">\"zerver_huddle_huddle_hash_key\"</span>\nDETAIL:<span class=\"w\">  </span>Key<span class=\"w\"> </span><span class=\"o\">(</span>huddle_hash<span class=\"o\">)=(</span>c8e88913e0eae335f418f3778d606350ee81627a<span class=\"o\">)</span><span class=\"w\"> </span>already<span class=\"w\"> </span>exists.\n</code></pre></div>",
        "id": 1529638,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679431591
    },
    {
        "content": "<p>Any help would be very much appreciated. I've spent nearly 20 hours straight working on this issue... and was hoping to have this server back up and running in the next 2 hours, which is starting to feel very unlikely.</p>",
        "id": 1529651,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679432022
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"26556\">@Matthew Strachan</span> the full tracebacks would be helpful. I kinda suspect the issue might have to do with the server you're importing into not having an empty database. (Though to be clear, that should not be an impediment to doing an import).</p>",
        "id": 1529690,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679433802
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> </p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@34d969bd7a0e:/home/zulip/deployments/current#<span class=\"w\"> </span>su<span class=\"w\"> </span>-c<span class=\"w\"> </span><span class=\"s2\">\"./manage.py import '' /transfer/zulip\"</span><span class=\"w\"> </span>zulip\nProcessing<span class=\"w\"> </span>dump:<span class=\"w\"> </span>/transfer/zulip<span class=\"w\"> </span>...\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.103<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Importing<span class=\"w\"> </span>realm<span class=\"w\"> </span>dump<span class=\"w\"> </span>/transfer/zulip\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.104<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Importing<span class=\"w\"> </span>realm<span class=\"w\"> </span>data<span class=\"w\"> </span>from<span class=\"w\"> </span>/transfer/zulip/realm.json\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.403<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.UserGroup'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_usergroup.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.508<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.Stream'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_stream.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.517<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"m\">1</span>\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.520<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">7</span><span class=\"w\"> </span><span class=\"m\">6</span>\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:15.522<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"w\"> </span><span class=\"m\">7</span>\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.115<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.DefaultStream'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_defaultstream.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.128<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.RealmEmoji'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_realmemoji.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.132<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.RealmDomain'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_realmdomain.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.135<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.RealmFilter'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_realmfilter.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.136<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.RealmPlayground'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_realmplayground.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:20.341<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.Recipient'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_recipient.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:23.000<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.Subscription'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_subscription.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:05:24.626<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.RealmAuditLog'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_realmauditlog.\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">89</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_execute\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>self.cursor.execute<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">34</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span>wrapper_execute<span class=\"o\">(</span>self,<span class=\"w\"> </span>super<span class=\"o\">()</span>.execute,<span class=\"w\"> </span>query,<span class=\"w\"> </span>vars<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">19</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>wrapper_execute\n<span class=\"w\">    </span>action<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\npsycopg2.errors.UniqueViolation:<span class=\"w\"> </span>duplicate<span class=\"w\"> </span>key<span class=\"w\"> </span>value<span class=\"w\"> </span>violates<span class=\"w\"> </span>unique<span class=\"w\"> </span>constraint<span class=\"w\"> </span><span class=\"s2\">\"zerver_huddle_huddle_hash_key\"</span>\nDETAIL:<span class=\"w\">  </span>Key<span class=\"w\"> </span><span class=\"o\">(</span>huddle_hash<span class=\"o\">)=(</span>2fba7615d64f80e43e162acab6645abe065e6a30<span class=\"o\">)</span><span class=\"w\"> </span>already<span class=\"w\"> </span>exists.\n\n\nThe<span class=\"w\"> </span>above<span class=\"w\"> </span>exception<span class=\"w\"> </span>was<span class=\"w\"> </span>the<span class=\"w\"> </span>direct<span class=\"w\"> </span>cause<span class=\"w\"> </span>of<span class=\"w\"> </span>the<span class=\"w\"> </span>following<span class=\"w\"> </span>exception:\n\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"./manage.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">151</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>execute_from_command_line<span class=\"o\">(</span>sys.argv<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"./manage.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">116</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute_from_command_line\n<span class=\"w\">    </span>utility.execute<span class=\"o\">()</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">440</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span>self.fetch_command<span class=\"o\">(</span>subcommand<span class=\"o\">)</span>.run_from_argv<span class=\"o\">(</span>self.argv<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">402</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>run_from_argv\n<span class=\"w\">    </span>self.execute<span class=\"o\">(</span>*args,<span class=\"w\"> </span>**cmd_options<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">448</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span><span class=\"nv\">output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>self.handle<span class=\"o\">(</span>*args,<span class=\"w\"> </span>**options<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/management/commands/import.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">99</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>handle\n<span class=\"w\">    </span>do_import_realm<span class=\"o\">(</span>path,<span class=\"w\"> </span>subdomain,<span class=\"w\"> </span>num_processes<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1160</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>do_import_realm\n<span class=\"w\">    </span>bulk_import_model<span class=\"o\">(</span>data,<span class=\"w\"> </span>Huddle<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">686</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>bulk_import_model\n<span class=\"w\">    </span>model.objects.bulk_create<span class=\"o\">(</span>model<span class=\"o\">(</span>**item<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>item<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>data<span class=\"o\">[</span>table<span class=\"o\">])</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/manager.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">85</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>manager_method\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>getattr<span class=\"o\">(</span>self.get_queryset<span class=\"o\">()</span>,<span class=\"w\"> </span>name<span class=\"o\">)(</span>*args,<span class=\"w\"> </span>**kwargs<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">798</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>bulk_create\n<span class=\"w\">    </span><span class=\"nv\">returned_columns</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>self._batched_insert<span class=\"o\">(</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1816</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_batched_insert\n<span class=\"w\">    </span>self._insert<span class=\"o\">(</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1790</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_insert\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>query.get_compiler<span class=\"o\">(</span><span class=\"nv\">using</span><span class=\"o\">=</span>using<span class=\"o\">)</span>.execute_sql<span class=\"o\">(</span>returning_fields<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/sql/compiler.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1660</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute_sql\n<span class=\"w\">    </span>cursor.execute<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">67</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>self._execute_with_wrappers<span class=\"o\">(</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">80</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_execute_with_wrappers\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>executor<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params,<span class=\"w\"> </span>many,<span class=\"w\"> </span>context<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">89</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_execute\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>self.cursor.execute<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">91</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>__exit__\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>dj_exc_value.with_traceback<span class=\"o\">(</span>traceback<span class=\"o\">)</span><span class=\"w\"> </span>from<span class=\"w\"> </span>exc_value\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">89</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_execute\n<span class=\"w\">    </span><span class=\"k\">return</span><span class=\"w\"> </span>self.cursor.execute<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">34</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span>wrapper_execute<span class=\"o\">(</span>self,<span class=\"w\"> </span>super<span class=\"o\">()</span>.execute,<span class=\"w\"> </span>query,<span class=\"w\"> </span>vars<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">19</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>wrapper_execute\n<span class=\"w\">    </span>action<span class=\"o\">(</span>sql,<span class=\"w\"> </span>params<span class=\"o\">)</span>\ndjango.db.utils.IntegrityError:<span class=\"w\"> </span>duplicate<span class=\"w\"> </span>key<span class=\"w\"> </span>value<span class=\"w\"> </span>violates<span class=\"w\"> </span>unique<span class=\"w\"> </span>constraint<span class=\"w\"> </span><span class=\"s2\">\"zerver_huddle_huddle_hash_key\"</span>\nDETAIL:<span class=\"w\">  </span>Key<span class=\"w\"> </span><span class=\"o\">(</span>huddle_hash<span class=\"o\">)=(</span>2fba7615d64f80e43e162acab6645abe065e6a30<span class=\"o\">)</span><span class=\"w\"> </span>already<span class=\"w\"> </span>exists.\n</code></pre></div>",
        "id": 1529691,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679433848
    },
    {
        "content": "<p>(I've never seen this class of issue when doing an import before).</p>",
        "id": 1529692,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679433854
    },
    {
        "content": "<p>That is a full dump from importing with my modified <code>realm.json</code>... Where I have moved the deleted users back in....</p>",
        "id": 1529693,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679433896
    },
    {
        "content": "<p>There's two possible explanations for that last exception. One is that you have multiple <code>zerver_huddle</code> objects with the same set of user IDs in them in your <code>realm.json</code>; can you try checking that theory?</p>",
        "id": 1529694,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679433970
    },
    {
        "content": "<p>Actually I'm not sure I have another theory that would manifest like that.</p>",
        "id": 1529695,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434024
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/9-issues/topic/Migration.20between.20servers/near/1529694\">said</a>:</p>\n<blockquote>\n<p>There's two possible explanations for that last exception. One is that you have multiple <code>zerver_huddle</code> objects with the same set of user IDs in them in your <code>realm.json</code>; can you try checking that theory?</p>\n</blockquote>\n<p><a href=\"/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png\">image.png</a> user ID would be this key pair?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png\"></a></div>",
        "id": 1529697,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434049
    },
    {
        "content": "<p>OK I think actually my theory is that the issue is that your new server doesn't have an empty database.</p>",
        "id": 1529700,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434140
    },
    {
        "content": "<p>BTW, is there a reason you're not using the backup tool for this migration?</p>",
        "id": 1529702,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434159
    },
    {
        "content": "<p>The new server is a fresh docker...</p>",
        "id": 1529703,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434205
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/9-issues/topic/Migration.20between.20servers/near/1529702\">said</a>:</p>\n<blockquote>\n<p>BTW, is there a reason you're not using the backup tool for this migration?</p>\n</blockquote>\n<p>The backup tool? I am using this command from the docs<br>\n<code>./manage.py export -r ''</code></p>",
        "id": 1529704,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434229
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"26556\">@Matthew Strachan</span> this is the backup tool: <a href=\"https://zulip.readthedocs.io/en/latest/production/export-and-import.html#backups\">https://zulip.readthedocs.io/en/latest/production/export-and-import.html#backups</a></p>",
        "id": 1529705,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434250
    },
    {
        "content": "<p>You only need to do this logical export if you're adjusting the set of realms being hosted together (E.g. moving a realm to or from Zulip Cloud).</p>",
        "id": 1529706,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434278
    },
    {
        "content": "<p>Ah.... Should I be using that instead of <code>./manage.py export</code>?</p>",
        "id": 1529707,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434301
    },
    {
        "content": "<p>If you're just switching the hardware for your Zulip server, you want the backup tool.</p>",
        "id": 1529708,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434301
    },
    {
        "content": "<p>I'm moving from directly installed on a ubuntu VM to using zulip-docker....</p>",
        "id": 1529710,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434352
    },
    {
        "content": "<p>(We should debug why you're getting duplicate huddles in your export object, since the export tool should Just Work too)</p>",
        "id": 1529712,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434355
    },
    {
        "content": "<p>Yeah, for that you want to use the backup tool -- it has many fewer moving parts since it's doing a fundamentally much simpler thing.</p>",
        "id": 1529713,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434382
    },
    {
        "content": "<p>I can show you the error received without any modifications to <code>realm.json</code>too....</p>",
        "id": 1529714,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434399
    },
    {
        "content": "<p>This is directly using export -&gt; import.... No changes to anything</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@34d969bd7a0e:/home/zulip/deployments/current#<span class=\"w\"> </span>su<span class=\"w\"> </span>-c<span class=\"w\"> </span><span class=\"s2\">\"./manage.py import '' /transfer/zulip\"</span><span class=\"w\"> </span>zulip\nProcessing<span class=\"w\"> </span>dump:<span class=\"w\"> </span>/transfer/zulip<span class=\"w\"> </span>...\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:11.987<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Importing<span class=\"w\"> </span>realm<span class=\"w\"> </span>dump<span class=\"w\"> </span>/transfer/zulip\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:11.988<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Importing<span class=\"w\"> </span>realm<span class=\"w\"> </span>data<span class=\"w\"> </span>from<span class=\"w\"> </span>/transfer/zulip/realm.json\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:12.288<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.UserGroup'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_usergroup.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:12.393<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Successfully<span class=\"w\"> </span>imported<span class=\"w\"> </span>&lt;class<span class=\"w\"> </span><span class=\"s1\">'zerver.models.Stream'</span>&gt;<span class=\"w\"> </span>from<span class=\"w\"> </span>zerver_stream.\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:12.403<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">2</span><span class=\"w\"> </span><span class=\"m\">1</span>\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:12.406<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">7</span><span class=\"w\"> </span><span class=\"m\">6</span>\n<span class=\"m\">2023</span>-03-21<span class=\"w\"> </span><span class=\"m\">21</span>:26:12.408<span class=\"w\"> </span>INFO<span class=\"w\"> </span><span class=\"o\">[]</span><span class=\"w\"> </span>Adding<span class=\"w\"> </span>to<span class=\"w\"> </span>ID<span class=\"w\"> </span>map:<span class=\"w\"> </span><span class=\"m\">8</span><span class=\"w\"> </span><span class=\"m\">7</span>\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"./manage.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">151</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>execute_from_command_line<span class=\"o\">(</span>sys.argv<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"./manage.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">116</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute_from_command_line\n<span class=\"w\">    </span>utility.execute<span class=\"o\">()</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">440</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span>self.fetch_command<span class=\"o\">(</span>subcommand<span class=\"o\">)</span>.run_from_argv<span class=\"o\">(</span>self.argv<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">402</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>run_from_argv\n<span class=\"w\">    </span>self.execute<span class=\"o\">(</span>*args,<span class=\"w\"> </span>**cmd_options<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">448</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>execute\n<span class=\"w\">    </span><span class=\"nv\">output</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span>self.handle<span class=\"o\">(</span>*args,<span class=\"w\"> </span>**options<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/management/commands/import.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">99</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>handle\n<span class=\"w\">    </span>do_import_realm<span class=\"o\">(</span>path,<span class=\"w\"> </span>subdomain,<span class=\"w\"> </span>num_processes<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1049</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>do_import_realm\n<span class=\"w\">    </span><span class=\"nv\">user_profiles</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span>UserProfile<span class=\"o\">(</span>**item<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>item<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>data<span class=\"o\">[</span><span class=\"s2\">\"zerver_userprofile\"</span><span class=\"o\">]]</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">1049</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;listcomp&gt;\n<span class=\"w\">    </span><span class=\"nv\">user_profiles</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span>UserProfile<span class=\"o\">(</span>**item<span class=\"o\">)</span><span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>item<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>data<span class=\"o\">[</span><span class=\"s2\">\"zerver_userprofile\"</span><span class=\"o\">]]</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">541</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>__init__\n<span class=\"w\">    </span>_setattr<span class=\"o\">(</span>self,<span class=\"w\"> </span>field.name,<span class=\"w\"> </span>rel_obj<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/fields/related_descriptors.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">235</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>__set__\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>ValueError<span class=\"o\">(</span>\nValueError:<span class=\"w\"> </span>Cannot<span class=\"w\"> </span>assign<span class=\"w\"> </span><span class=\"s2\">\"2999\"</span>:<span class=\"w\"> </span><span class=\"s2\">\"UserProfile.recipient\"</span><span class=\"w\"> </span>must<span class=\"w\"> </span>be<span class=\"w\"> </span>a<span class=\"w\"> </span><span class=\"s2\">\"Recipient\"</span><span class=\"w\"> </span>instance.\n</code></pre></div>",
        "id": 1529715,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434428
    },
    {
        "content": "<p>I had started messing around with <code>realm.json</code> after I found this post... <a href=\"https://github.com/zulip/zulip/issues/19912\">https://github.com/zulip/zulip/issues/19912</a></p>",
        "id": 1529717,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434464
    },
    {
        "content": "<p>which lead to the issue with duplicate huddles</p>",
        "id": 1529719,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434476
    },
    {
        "content": "<p>I don't recommend modifying <code>realm.json</code> manually at all; it has a very complex set of invariants that it expects and being impossible to import is a quite likely failure mode from doing so.</p>",
        "id": 1529730,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434731
    },
    {
        "content": "<p>Understandable! In that case, what ever happened when the <code>./manage.py delete_user</code> command was run, it caused the error: <code>ValueError: Cannot assign \"2999\": \"UserProfile.recipient\" must be a \"Recipient\" instance.</code> and prevents the import.</p>",
        "id": 1529733,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434827
    },
    {
        "content": "<p>I've just started a backup using the backup command too... Hopefully this will work vs the export command!</p>",
        "id": 1529734,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679434846
    },
    {
        "content": "<p>What version are you on? A previous version of the <code>delete_user</code> management command didn't handle cleaning up <code>Recipient</code> objects properly.</p>",
        "id": 1529740,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679434904
    },
    {
        "content": "<p>6.1</p>",
        "id": 1529744,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679435006
    },
    {
        "content": "<p>Updated last saturday (just hours before I did the export)</p>",
        "id": 1529745,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679435038
    },
    {
        "content": "<p>(sorry I can't be more specific about the version. I've stopped the server to do this backup)</p>",
        "id": 1529746,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679435095
    },
    {
        "content": "<p>6.1 is a precise version, so that's all there is to know.</p>",
        "id": 1529750,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679435142
    },
    {
        "content": "<p>OK maybe as a follow-up, <span class=\"user-mention\" data-user-id=\"10349\">@Mateusz Mandera</span> can look at whether we can reproduce an issue doing an export/import sequence after deleting a user with <code>manage.py delete_user</code> -- that seems like something we should be able to reproduce in a development environment if it's broken.</p>",
        "id": 1529751,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679435197
    },
    {
        "content": "<p>Ok. Do you think the backup command will work versus the export?</p>",
        "id": 1529752,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679435230
    },
    {
        "content": "<p>..... or an undelete command :P :D</p>",
        "id": 1529756,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679435421
    },
    {
        "content": "<p>The backup command transfers a SQL database dump, so yes it will work if the original server works.</p>",
        "id": 1529819,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679438097
    },
    {
        "content": "<p>Just waiting on the final step now......... fingers crossed!!!</p>",
        "id": 1529850,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679439677
    },
    {
        "content": "<p><a href=\"/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png\"></a></div>",
        "id": 1529851,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679439679
    },
    {
        "content": "<p>Not sure if I did something wrong or if the restore-backup script just isn't compatible with a dockerised version of Zulip</p>",
        "id": 1529954,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679443122
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@a1a408393315:/home/zulip/deployments/current#<span class=\"w\"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup<span class=\"w\"> </span>--keep-settings<span class=\"w\"> </span>/transfer/backup.tar.gz\n+<span class=\"w\"> </span>tar<span class=\"w\"> </span>--directory<span class=\"o\">=</span>/etc/zulip<span class=\"w\"> </span>--exclude<span class=\"o\">=</span>settings.py<span class=\"w\"> </span>--strip-components<span class=\"o\">=</span><span class=\"m\">2</span><span class=\"w\"> </span>-xz<span class=\"w\"> </span>zulip-backup/settings\n+<span class=\"w\"> </span>tar<span class=\"w\"> </span>-C<span class=\"w\"> </span>/tmp/zulip-restore-backup-h4__7d79<span class=\"w\"> </span><span class=\"s1\">'--transform=s|^zulip-backup/zproject(/.*)?$|/home/zulip/deployments/2023-01-23-18-51-59/zproject\\1|x'</span><span class=\"w\"> </span><span class=\"s1\">'--transform=s|^zulip-backup/uploads(/.*)?$|/home/zulip/uploads\\1|x'</span><span class=\"w\"> </span>-xPz\n+<span class=\"w\"> </span>chown<span class=\"w\"> </span>-R<span class=\"w\"> </span>zulip<span class=\"w\"> </span>--<span class=\"w\"> </span>/tmp/zulip-restore-backup-h4__7d79\n+<span class=\"w\"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/setup/terminate-psql-sessions<span class=\"w\"> </span>zulip\nPassword<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>user<span class=\"w\"> </span>zulip:\n<span class=\"w\"> </span>pg_terminate_backend\n----------------------\n<span class=\"o\">(</span><span class=\"m\">0</span><span class=\"w\"> </span>rows<span class=\"o\">)</span>\n\n+<span class=\"w\"> </span>dropdb<span class=\"w\"> </span>--if-exists<span class=\"w\"> </span>--<span class=\"w\"> </span>zulip\nPassword:\n+<span class=\"w\"> </span>createdb<span class=\"w\"> </span>--owner<span class=\"o\">=</span>zulip<span class=\"w\"> </span>--template<span class=\"o\">=</span>template0<span class=\"w\"> </span>--<span class=\"w\"> </span>zulip\nPassword:\n+<span class=\"w\"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/setup/generate_secrets.py<span class=\"w\"> </span>--production\ngenerate_secrets:<span class=\"w\"> </span>No<span class=\"w\"> </span>new<span class=\"w\"> </span>secrets<span class=\"w\"> </span>to<span class=\"w\"> </span>generate.\n+<span class=\"w\"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/zulip-puppet-apply<span class=\"w\"> </span>-f\nNotice:<span class=\"w\"> </span>Compiled<span class=\"w\"> </span>catalog<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>a1a408393315.ap-southeast-2.compute.internal<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>environment<span class=\"w\"> </span>production<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">2</span>.38<span class=\"w\"> </span>seconds\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Supervisor/File<span class=\"o\">[</span>/etc/supervisor/conf.d/zulip/cron.conf<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>removed\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Supervisor/File<span class=\"o\">[</span>/etc/supervisor/conf.d/zulip/nginx.conf<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>removed\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Tornado_sharding/File<span class=\"o\">[</span>/etc/zulip/nginx_sharding_map.conf<span class=\"o\">]</span>/owner:<span class=\"w\"> </span>owner<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'zulip'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'root'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Tornado_sharding/File<span class=\"o\">[</span>/etc/zulip/nginx_sharding_map.conf<span class=\"o\">]</span>/group:<span class=\"w\"> </span>group<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'zulip'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'root'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::App_frontend_base/File<span class=\"o\">[</span>/etc/supervisor/conf.d/zulip/zulip.conf<span class=\"o\">]</span>/content:<span class=\"w\"> </span>content<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'{md5}8e41b39279b57e6632a2770bab4a4146'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'{md5}c7e9a57790ae9fa768c3c3cfa389c226'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::App_frontend_base/File<span class=\"o\">[</span>/etc/zulip/uwsgi.ini<span class=\"o\">]</span>/owner:<span class=\"w\"> </span>owner<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'zulip'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'root'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::App_frontend_base/File<span class=\"o\">[</span>/etc/zulip/uwsgi.ini<span class=\"o\">]</span>/group:<span class=\"w\"> </span>group<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'zulip'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'root'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::App_frontend/File<span class=\"o\">[</span>/etc/nginx/sites-available/zulip-enterprise<span class=\"o\">]</span>/content:<span class=\"w\"> </span>content<span class=\"w\"> </span>changed<span class=\"w\"> </span><span class=\"s1\">'{md5}900cbcd59f54369f384db7529dd08383'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'{md5}43727fea292bfbeac7bab6a419ad7d95'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Exec<span class=\"o\">[</span>disable_logrotate<span class=\"o\">]</span>/returns:<span class=\"w\"> </span>executed<span class=\"w\"> </span>successfully\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_base/File<span class=\"o\">[</span>/usr/lib/nagios/plugins/zulip_postgresql<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>created\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_base/File<span class=\"o\">[</span>/usr/lib/nagios/plugins/zulip_postgresql/check_postgresql_replication_lag<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}8ec134e6719bd7d6248e591a31a38241'</span>\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install redis-server'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>redis-server\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/Package<span class=\"o\">[</span>redis-server<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install redis-server'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>redis-server\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/File<span class=\"o\">[</span>/etc/redis/zulip-redis.conf<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>redis-server<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/File<span class=\"o\">[</span>/etc/redis/zulip-redis.conf<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/Exec<span class=\"o\">[</span>redis<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/File<span class=\"o\">[</span>/run/redis<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Redis/Service<span class=\"o\">[</span>redis-server<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install memcached'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>memcached\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Package<span class=\"o\">[</span>memcached<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install memcached'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>memcached\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install sasl2-bin'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>sasl2-bin\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Package<span class=\"o\">[</span>sasl2-bin<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install sasl2-bin'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>sasl2-bin\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/etc/sasl2<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>created\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/etc/sasl2/memcached-zulip-password<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}b20cf040abea69dbb0d0cd2cdb5a1aed'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/var/lib/zulip/memcached-sasldb2.stamp<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}c4ca4238a0b923820dcc509a6f75849b'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Exec<span class=\"o\">[</span>generate_memcached_sasldb2<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>memcached<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Exec<span class=\"o\">[</span>generate_memcached_sasldb2<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>sasl2-bin<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Exec<span class=\"o\">[</span>generate_memcached_sasldb2<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/etc/sasl2/memcached-sasldb2<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/etc/sasl2/memcached.conf<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}a7ef879b65cf344ca84245ca49173a7f'</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/etc/memcached.conf<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/File<span class=\"o\">[</span>/run/memcached<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Memcached/Service<span class=\"o\">[</span>memcached<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/File<span class=\"o\">[</span>/etc/rabbitmq<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>created\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/File<span class=\"o\">[</span>/etc/rabbitmq/rabbitmq.config<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}78b67e45b7a3518c4c3956473edcfaa2'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/File<span class=\"o\">[</span>/etc/rabbitmq/rabbitmq-env.conf<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}93682ee251846935ce4d49e2cadda3f3'</span>\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install erlang-base'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>erlang-base\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Package<span class=\"o\">[</span>erlang-base<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install erlang-base'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>erlang-base\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install rabbitmq-server'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>rabbitmq-server\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Package<span class=\"o\">[</span>rabbitmq-server<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install rabbitmq-server'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>rabbitmq-server\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Exec<span class=\"o\">[</span>epmd<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>erlang-base<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Exec<span class=\"o\">[</span>epmd<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Service<span class=\"o\">[</span>rabbitmq-server<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>rabbitmq-server<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Service<span class=\"o\">[</span>rabbitmq-server<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Rabbitmq/Exec<span class=\"o\">[</span>configure-rabbitmq<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Localhost_sso/File<span class=\"o\">[</span>/etc/nginx/zulip-include/app.d/external-sso.conf<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>defined<span class=\"w\"> </span>content<span class=\"w\"> </span>as<span class=\"w\"> </span><span class=\"s1\">'{md5}35316c9a5bcad7fd7b24fd9c14760567'</span>\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Nginx/Service<span class=\"o\">[</span>nginx<span class=\"o\">]</span>:<span class=\"w\"> </span>Triggered<span class=\"w\"> </span><span class=\"s1\">'refresh'</span><span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>events\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install apache2'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nPackage<span class=\"w\"> </span>apache2<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>available,<span class=\"w\"> </span>but<span class=\"w\"> </span>is<span class=\"w\"> </span>referred<span class=\"w\"> </span>to<span class=\"w\"> </span>by<span class=\"w\"> </span>another<span class=\"w\"> </span>package.\nThis<span class=\"w\"> </span>may<span class=\"w\"> </span>mean<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>package<span class=\"w\"> </span>is<span class=\"w\"> </span>missing,<span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>obsoleted,<span class=\"w\"> </span>or\nis<span class=\"w\"> </span>only<span class=\"w\"> </span>available<span class=\"w\"> </span>from<span class=\"w\"> </span>another<span class=\"w\"> </span><span class=\"nb\">source</span>\n\nE:<span class=\"w\"> </span>Package<span class=\"w\"> </span><span class=\"s1\">'apache2'</span><span class=\"w\"> </span>has<span class=\"w\"> </span>no<span class=\"w\"> </span>installation<span class=\"w\"> </span>candidate\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Package<span class=\"o\">[</span>apache2<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install apache2'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nPackage<span class=\"w\"> </span>apache2<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>available,<span class=\"w\"> </span>but<span class=\"w\"> </span>is<span class=\"w\"> </span>referred<span class=\"w\"> </span>to<span class=\"w\"> </span>by<span class=\"w\"> </span>another<span class=\"w\"> </span>package.\nThis<span class=\"w\"> </span>may<span class=\"w\"> </span>mean<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>package<span class=\"w\"> </span>is<span class=\"w\"> </span>missing,<span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>obsoleted,<span class=\"w\"> </span>or\nis<span class=\"w\"> </span>only<span class=\"w\"> </span>available<span class=\"w\"> </span>from<span class=\"w\"> </span>another<span class=\"w\"> </span><span class=\"nb\">source</span>\n</code></pre></div>",
        "id": 1529955,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679443159
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>E:<span class=\"w\"> </span>Package<span class=\"w\"> </span><span class=\"s1\">'apache2'</span><span class=\"w\"> </span>has<span class=\"w\"> </span>no<span class=\"w\"> </span>installation<span class=\"w\"> </span>candidate\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install libapache2-mod-wsgi-py3'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>libapache2-mod-wsgi-py3\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Package<span class=\"o\">[</span>libapache2-mod-wsgi-py3<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install libapache2-mod-wsgi-py3'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>libapache2-mod-wsgi-py3\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>headers<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>apache2<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>headers<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>proxy<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>proxy_http<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>rewrite<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>ssl<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/Apache2mod<span class=\"o\">[</span>wsgi<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/File<span class=\"o\">[</span>/etc/apache2/ports.conf<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/File<span class=\"o\">[</span>/etc/apache2/sites-available/<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Apache_sso/File<span class=\"o\">[</span>/etc/apache2/sites-available/zulip-sso.example<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install ssl-cert'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nPackage<span class=\"w\"> </span>ssl-cert<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>available,<span class=\"w\"> </span>but<span class=\"w\"> </span>is<span class=\"w\"> </span>referred<span class=\"w\"> </span>to<span class=\"w\"> </span>by<span class=\"w\"> </span>another<span class=\"w\"> </span>package.\nThis<span class=\"w\"> </span>may<span class=\"w\"> </span>mean<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>package<span class=\"w\"> </span>is<span class=\"w\"> </span>missing,<span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>obsoleted,<span class=\"w\"> </span>or\nis<span class=\"w\"> </span>only<span class=\"w\"> </span>available<span class=\"w\"> </span>from<span class=\"w\"> </span>another<span class=\"w\"> </span><span class=\"nb\">source</span>\n\nE:<span class=\"w\"> </span>Package<span class=\"w\"> </span><span class=\"s1\">'ssl-cert'</span><span class=\"w\"> </span>has<span class=\"w\"> </span>no<span class=\"w\"> </span>installation<span class=\"w\"> </span>candidate\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Snakeoil/Zulip::Safepackage<span class=\"o\">[</span>ssl-cert<span class=\"o\">]</span>/Package<span class=\"o\">[</span>ssl-cert<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install ssl-cert'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nPackage<span class=\"w\"> </span>ssl-cert<span class=\"w\"> </span>is<span class=\"w\"> </span>not<span class=\"w\"> </span>available,<span class=\"w\"> </span>but<span class=\"w\"> </span>is<span class=\"w\"> </span>referred<span class=\"w\"> </span>to<span class=\"w\"> </span>by<span class=\"w\"> </span>another<span class=\"w\"> </span>package.\nThis<span class=\"w\"> </span>may<span class=\"w\"> </span>mean<span class=\"w\"> </span>that<span class=\"w\"> </span>the<span class=\"w\"> </span>package<span class=\"w\"> </span>is<span class=\"w\"> </span>missing,<span class=\"w\"> </span>has<span class=\"w\"> </span>been<span class=\"w\"> </span>obsoleted,<span class=\"w\"> </span>or\nis<span class=\"w\"> </span>only<span class=\"w\"> </span>available<span class=\"w\"> </span>from<span class=\"w\"> </span>another<span class=\"w\"> </span><span class=\"nb\">source</span>\n\nE:<span class=\"w\"> </span>Package<span class=\"w\"> </span><span class=\"s1\">'ssl-cert'</span><span class=\"w\"> </span>has<span class=\"w\"> </span>no<span class=\"w\"> </span>installation<span class=\"w\"> </span>candidate\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Snakeoil/Exec<span class=\"o\">[</span>generate-default-snakeoil<span class=\"o\">]</span>:<span class=\"w\"> </span>Dependency<span class=\"w\"> </span>Package<span class=\"o\">[</span>ssl-cert<span class=\"o\">]</span><span class=\"w\"> </span>has<span class=\"w\"> </span>failures:<span class=\"w\"> </span><span class=\"nb\">true</span>\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Snakeoil/Exec<span class=\"o\">[</span>generate-default-snakeoil<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>postgresql-14<span class=\"o\">]</span>/Package<span class=\"o\">[</span>postgresql-14<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/User<span class=\"o\">[</span>postgres<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_base/File<span class=\"o\">[</span>/usr/share/postgresql/14/tsearch_data/en_us.dict<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_base/File<span class=\"o\">[</span>/usr/share/postgresql/14/tsearch_data/en_us.affix<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_base/File<span class=\"o\">[</span>/usr/share/postgresql/14/tsearch_data/zulip_english.stop<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Postgresql/File<span class=\"o\">[</span>/etc/postgresql/14<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Postgresql/File<span class=\"o\">[</span>/etc/postgresql/14/main<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Postgresql/File<span class=\"o\">[</span>/etc/postgresql/14/main/postgresql.conf<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Profile::Postgresql/Exec<span class=\"o\">[</span>pg_ctlcluster<span class=\"w\"> </span><span class=\"m\">14</span><span class=\"w\"> </span>main<span class=\"w\"> </span>restart<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>pgtop<span class=\"o\">]</span>/Package<span class=\"o\">[</span>pgtop<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>hunspell-en-us<span class=\"o\">]</span>/Package<span class=\"o\">[</span>hunspell-en-us<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>check-postgres<span class=\"o\">]</span>/Package<span class=\"o\">[</span>check-postgres<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nWarning:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>python3-dateutil<span class=\"o\">]</span>/Package<span class=\"o\">[</span>python3-dateutil<span class=\"o\">]</span>:<span class=\"w\"> </span>Skipping<span class=\"w\"> </span>because<span class=\"w\"> </span>of<span class=\"w\"> </span>failed<span class=\"w\"> </span>dependencies\nError:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install gettext'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>gettext\nError:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Static_asset_compiler/Zulip::Safepackage<span class=\"o\">[</span>gettext<span class=\"o\">]</span>/Package<span class=\"o\">[</span>gettext<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>change<span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"s1\">'purged'</span><span class=\"w\"> </span>to<span class=\"w\"> </span><span class=\"s1\">'present'</span><span class=\"w\"> </span>failed:<span class=\"w\"> </span>Execution<span class=\"w\"> </span>of<span class=\"w\"> </span><span class=\"s1\">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install gettext'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span><span class=\"m\">100</span>:<span class=\"w\"> </span>Reading<span class=\"w\"> </span>package<span class=\"w\"> </span>lists...\nBuilding<span class=\"w\"> </span>dependency<span class=\"w\"> </span>tree...\nReading<span class=\"w\"> </span>state<span class=\"w\"> </span>information...\nE:<span class=\"w\"> </span>Unable<span class=\"w\"> </span>to<span class=\"w\"> </span>locate<span class=\"w\"> </span>package<span class=\"w\"> </span>gettext\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Supervisor/Service<span class=\"o\">[</span>supervisor<span class=\"o\">]</span>:<span class=\"w\"> </span>Triggered<span class=\"w\"> </span><span class=\"s1\">'refresh'</span><span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>events\nNotice:<span class=\"w\"> </span>Applied<span class=\"w\"> </span>catalog<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">2</span>.66<span class=\"w\"> </span>seconds\n\nError<span class=\"w\"> </span>running<span class=\"w\"> </span>a<span class=\"w\"> </span>subcommand<span class=\"w\"> </span>of<span class=\"w\"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup:<span class=\"w\"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/zulip-puppet-apply<span class=\"w\"> </span>-f\nActual<span class=\"w\"> </span>error<span class=\"w\"> </span>output<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>the<span class=\"w\"> </span>subcommand<span class=\"w\"> </span>is<span class=\"w\"> </span>just<span class=\"w\"> </span>above<span class=\"w\"> </span>this.\n</code></pre></div>",
        "id": 1529956,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679443163
    },
    {
        "content": "<p>Run <code>apt-get update</code> and try again.</p>",
        "id": 1529962,
        "sender_full_name": "Anders Kaseorg",
        "timestamp": 1679443229
    },
    {
        "content": "<p>is there a way to \"resume\" the restore without needing to completely restart the backup? It takes over half a hour to untar and move the uploads directory (I think that's what the bulk of the work is)</p>",
        "id": 1529971,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679443518
    },
    {
        "content": "<p>ah, never mind. Something caused the container to restart, and now the container wont stay up. So I think I will need to rebuild the stack.</p>",
        "id": 1529975,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679443689
    },
    {
        "content": "<p>Nope. Still no dice. This time the script failed to restore the database backup using the pg_restore command.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>Notice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class=\"o\">[</span>python3-dateutil<span class=\"o\">]</span>/Package<span class=\"o\">[</span>python3-dateutil<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>created\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Static_asset_compiler/Zulip::Safepackage<span class=\"o\">[</span>gettext<span class=\"o\">]</span>/Package<span class=\"o\">[</span>gettext<span class=\"o\">]</span>/ensure:<span class=\"w\"> </span>created\nNotice:<span class=\"w\"> </span>/Stage<span class=\"o\">[</span>main<span class=\"o\">]</span>/Zulip::Supervisor/Service<span class=\"o\">[</span>supervisor<span class=\"o\">]</span>:<span class=\"w\"> </span>Triggered<span class=\"w\"> </span><span class=\"s1\">'refresh'</span><span class=\"w\"> </span>from<span class=\"w\"> </span><span class=\"m\">4</span><span class=\"w\"> </span>events\nNotice:<span class=\"w\"> </span>Applied<span class=\"w\"> </span>catalog<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span><span class=\"m\">224</span>.08<span class=\"w\"> </span>seconds\n+<span class=\"w\"> </span>pg_restore<span class=\"w\"> </span>--dbname<span class=\"o\">=</span>zulip<span class=\"w\"> </span>--<span class=\"w\"> </span>/tmp/zulip-restore-backup-iev1kb_u/zulip-backup/database\nPassword:\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"postgres\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>ALTER<span class=\"w\"> </span>SCHEMA<span class=\"w\"> </span>public<span class=\"w\"> </span>OWNER<span class=\"w\"> </span>TO<span class=\"w\"> </span>postgres<span class=\"p\">;</span>\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>USAGE<span class=\"w\"> </span>ON<span class=\"w\"> </span>SCHEMA<span class=\"w\"> </span>zulip<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.analytics_fillstate<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.analytics_installationcount<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.analytics_realmcount<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.analytics_streamcount<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.analytics_usercount<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.auth_group<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.auth_group_permissions<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.auth_permission<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.confirmation_confirmation<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.confirmation_realmcreationkey<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.django_content_type<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.django_migrations<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.django_session<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.django_site<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.fts_update_log<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.otp_static_staticdevice<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.otp_static_statictoken<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.otp_totp_totpdevice<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.social_auth_association<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.social_auth_code<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.social_auth_nonce<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.social_auth_partial<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.social_auth_usersocialauth<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.third_party_api_results<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.two_factor_phonedevice<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_archivedattachment<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_archivedattachment_messages<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_archivedmessage<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_archivedusermessage<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_attachment<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_attachment_messages<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_botconfigdata<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_botstoragedata<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_client<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_customprofilefield<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_customprofilefieldvalue<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_defaultstream<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_defaultstreamgroup<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_defaultstreamgroup_streams<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_emailchangestatus<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_huddle<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_message<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_multiuseinvite<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_multiuseinvite_streams<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_usertopic<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_preregistrationuser<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_preregistrationuser_streams<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_pushdevicetoken<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_reaction<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_realm<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_realmdomain<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_realmauditlog<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_realmemoji<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_realmfilter<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_recipient<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_scheduledemail<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_scheduledmessage<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_service<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_stream<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n\n\npg_restore:<span class=\"w\"> </span>error:<span class=\"w\"> </span>could<span class=\"w\"> </span>not<span class=\"w\"> </span>execute<span class=\"w\"> </span>query:<span class=\"w\"> </span>ERROR:<span class=\"w\">  </span>role<span class=\"w\"> </span><span class=\"s2\">\"zdata\"</span><span class=\"w\"> </span>does<span class=\"w\"> </span>not<span class=\"w\"> </span>exist\nCommand<span class=\"w\"> </span>was:<span class=\"w\"> </span>GRANT<span class=\"w\"> </span>ALL<span class=\"w\"> </span>ON<span class=\"w\"> </span>TABLE<span class=\"w\"> </span>zulip.zerver_submessage<span class=\"w\"> </span>TO<span class=\"w\"> </span>zdata<span class=\"p\">;</span>\n</code></pre></div>",
        "id": 1529995,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679445471
    },
    {
        "content": "<p>Should the script create <code>postgres</code> and <code>zdata</code> roles? Perhaps I can create them manually prior to running the backup restore script?</p>",
        "id": 1530014,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679446893
    },
    {
        "content": "<p>OK. so, manually creating the postgres and zdata role seems to prevent the pg_restore from failing.</p>\n<p>But now the last step of the restart script crashes.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>zulip-workers:zulip_events_user_presence:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:16,166<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip_deliver_scheduled_emails\nzulip_deliver_scheduled_emails:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:17,974<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip_deliver_scheduled_messages\nzulip_deliver_scheduled_messages:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:19,564<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>process-fts-updates\nprocess-fts-updates:<span class=\"w\"> </span>ERROR<span class=\"w\"> </span><span class=\"o\">(</span>spawn<span class=\"w\"> </span>error<span class=\"o\">)</span>\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">140</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>restart_or_start<span class=\"o\">(</span>worker<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">124</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>restart_or_start\n<span class=\"w\">    </span>subprocess.check_call<span class=\"o\">([</span><span class=\"s2\">\"supervisorctl\"</span>,<span class=\"w\"> </span>our_verb,<span class=\"w\"> </span>service<span class=\"o\">])</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3.8/subprocess.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">364</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>check_call\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>CalledProcessError<span class=\"o\">(</span>retcode,<span class=\"w\"> </span>cmd<span class=\"o\">)</span>\nsubprocess.CalledProcessError:<span class=\"w\"> </span>Command<span class=\"w\"> </span><span class=\"s1\">'['</span>supervisorctl<span class=\"s1\">', '</span>start<span class=\"s1\">', '</span>process-fts-updates<span class=\"s1\">']'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span>non-zero<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>status<span class=\"w\"> </span><span class=\"m\">7</span>.\n\nError<span class=\"w\"> </span>running<span class=\"w\"> </span>a<span class=\"w\"> </span>subcommand<span class=\"w\"> </span>of<span class=\"w\"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup:<span class=\"w\"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server\nActual<span class=\"w\"> </span>error<span class=\"w\"> </span>output<span class=\"w\"> </span><span class=\"k\">for</span><span class=\"w\"> </span>the<span class=\"w\"> </span>subcommand<span class=\"w\"> </span>is<span class=\"w\"> </span>just<span class=\"w\"> </span>above<span class=\"w\"> </span>this.\n</code></pre></div>",
        "id": 1530054,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453538
    },
    {
        "content": "<p>Manually triggering the script gives the same result</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@04dd98b7274b:/#<span class=\"w\"> </span>su<span class=\"w\"> </span>-c<span class=\"w\"> </span><span class=\"s1\">'/home/zulip/deployments/current/scripts/restart-server'</span><span class=\"w\"> </span>zulip\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:52,841<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Running<span class=\"w\"> </span>syntax<span class=\"w\"> </span>and<span class=\"w\"> </span>database<span class=\"w\"> </span>checks\nSystem<span class=\"w\"> </span>check<span class=\"w\"> </span>identified<span class=\"w\"> </span>no<span class=\"w\"> </span>issues<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"m\">15</span><span class=\"w\"> </span>silenced<span class=\"o\">)</span>.\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:55,982<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_deferred_work\nzulip-workers:zulip_events_deferred_work:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_deferred_work:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:57,735<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_digest_emails\nzulip-workers:zulip_events_digest_emails:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_digest_emails:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:48:59,549<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_email_mirror\nzulip-workers:zulip_events_email_mirror:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_email_mirror:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:01,341<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_email_senders\nzulip-workers:zulip_events_email_senders:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_email_senders:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:03,627<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_embed_links\nzulip-workers:zulip_events_embed_links:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_embed_links:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:05,046<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_embedded_bots\nzulip-workers:zulip_events_embedded_bots:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_embedded_bots:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:06,483<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_error_reports\nzulip-workers:zulip_events_error_reports:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_error_reports:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:08,597<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_invites\nzulip-workers:zulip_events_invites:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_invites:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:10,017<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_missedmessage_emails\nzulip-workers:zulip_events_missedmessage_emails:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_missedmessage_emails:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:11,459<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_missedmessage_mobile_notifications\nzulip-workers:zulip_events_missedmessage_mobile_notifications:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_missedmessage_mobile_notifications:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:12,863<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_outgoing_webhooks\nzulip-workers:zulip_events_outgoing_webhooks:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_outgoing_webhooks:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:14,267<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_user_activity\nzulip-workers:zulip_events_user_activity:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_user_activity:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:16,222<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_user_activity_interval\nzulip-workers:zulip_events_user_activity_interval:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_user_activity_interval:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:18,420<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip-workers:zulip_events_user_presence\nzulip-workers:zulip_events_user_presence:<span class=\"w\"> </span>stopped\nzulip-workers:zulip_events_user_presence:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:20,584<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip_deliver_scheduled_emails\nzulip_deliver_scheduled_emails:<span class=\"w\"> </span>stopped\nzulip_deliver_scheduled_emails:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:22,570<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>zulip_deliver_scheduled_messages\nzulip_deliver_scheduled_messages:<span class=\"w\"> </span>stopped\nzulip_deliver_scheduled_messages:<span class=\"w\"> </span>started\n<span class=\"m\">2023</span>-03-22<span class=\"w\"> </span><span class=\"m\">02</span>:49:24,352<span class=\"w\"> </span>restart-server:<span class=\"w\"> </span>Restarting<span class=\"w\"> </span>process-fts-updates\nprocess-fts-updates:<span class=\"w\"> </span>ERROR<span class=\"w\"> </span><span class=\"o\">(</span>spawn<span class=\"w\"> </span>error<span class=\"o\">)</span>\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/current/scripts/restart-server\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">140</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>restart_or_start<span class=\"o\">(</span>worker<span class=\"o\">)</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/current/scripts/restart-server\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">124</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>restart_or_start\n<span class=\"w\">    </span>subprocess.check_call<span class=\"o\">([</span><span class=\"s2\">\"supervisorctl\"</span>,<span class=\"w\"> </span>our_verb,<span class=\"w\"> </span>service<span class=\"o\">])</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/usr/lib/python3.8/subprocess.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">364</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>check_call\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>CalledProcessError<span class=\"o\">(</span>retcode,<span class=\"w\"> </span>cmd<span class=\"o\">)</span>\nsubprocess.CalledProcessError:<span class=\"w\"> </span>Command<span class=\"w\"> </span><span class=\"s1\">'['</span>supervisorctl<span class=\"s1\">', '</span>start<span class=\"s1\">', '</span>process-fts-updates<span class=\"s1\">']'</span><span class=\"w\"> </span>returned<span class=\"w\"> </span>non-zero<span class=\"w\"> </span><span class=\"nb\">exit</span><span class=\"w\"> </span>status<span class=\"w\"> </span><span class=\"m\">7</span>.\n</code></pre></div>",
        "id": 1530057,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453573
    },
    {
        "content": "<p>And the last step of the restore-backup script, the flush memcached also seems to fail (run manually. would need to rerun whole script otherise). Looks like an auth failure, which is likely due to the way I am calling the command, but haven't looked too much into it yet.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>root@04dd98b7274b:/#<span class=\"w\"> </span>/home/zulip/deployments/current/scripts/setup/flush-memcached\nTraceback<span class=\"w\"> </span><span class=\"o\">(</span>most<span class=\"w\"> </span>recent<span class=\"w\"> </span>call<span class=\"w\"> </span>last<span class=\"o\">)</span>:\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/home/zulip/deployments/current/scripts/setup/flush-memcached\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">18</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>&lt;module&gt;\n<span class=\"w\">    </span>bmemcached.Client<span class=\"o\">((</span>cache<span class=\"o\">[</span><span class=\"s2\">\"LOCATION\"</span><span class=\"o\">]</span>,<span class=\"o\">)</span>,<span class=\"w\"> </span>**cache<span class=\"o\">[</span><span class=\"s2\">\"OPTIONS\"</span><span class=\"o\">])</span>.flush_all<span class=\"o\">()</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/client/mixin.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">95</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>flush_all\n<span class=\"w\">    </span>returns.append<span class=\"o\">(</span>server.flush_all<span class=\"o\">(</span><span class=\"nb\">time</span><span class=\"o\">))</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">894</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>flush_all\n<span class=\"w\">    </span>self._send<span class=\"o\">(</span>struct.pack<span class=\"o\">(</span>self.HEADER_STRUCT<span class=\"w\"> </span>+\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">247</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_send\n<span class=\"w\">    </span>self._open_connection<span class=\"o\">()</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">161</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_open_connection\n<span class=\"w\">    </span>self._send_authentication<span class=\"o\">()</span>\n<span class=\"w\">  </span>File<span class=\"w\"> </span><span class=\"s2\">\"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py\"</span>,<span class=\"w\"> </span>line<span class=\"w\"> </span><span class=\"m\">322</span>,<span class=\"w\"> </span><span class=\"k\">in</span><span class=\"w\"> </span>_send_authentication\n<span class=\"w\">    </span>raise<span class=\"w\"> </span>MemcachedException<span class=\"o\">(</span><span class=\"s1\">'Code: %d Message: %s'</span><span class=\"w\"> </span>%<span class=\"w\"> </span><span class=\"o\">(</span>status,<span class=\"w\"> </span>extra_content<span class=\"o\">)</span>,<span class=\"w\"> </span>status<span class=\"o\">)</span>\nbmemcached.exceptions.MemcachedException:<span class=\"w\"> </span><span class=\"o\">(</span><span class=\"s2\">\"Code: 32 Message: b'Auth failure.'\"</span>,<span class=\"w\"> </span><span class=\"m\">32</span><span class=\"o\">)</span>\n</code></pre></div>",
        "id": 1530058,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453652
    },
    {
        "content": "<p>(did try that last one with both the root and the zulip user. same result...)</p>",
        "id": 1530059,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453680
    },
    {
        "content": "<p>But the server does actually come up and can be navigated to. But it seems to be a bit glitchy. Off the bat, one of the most obvious issues is that no attachments or images (like the site logo) are loading</p>",
        "id": 1530060,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453787
    },
    {
        "content": "<p>\"Opening\" a picture attachment results in a 404</p>",
        "id": 1530061,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453837
    },
    {
        "content": "<p>It appears the <code>/home/zulip/uploads</code> directory is empty</p>",
        "id": 1530062,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679453937
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"26556\">@Matthew Strachan</span> the memcached issue is most likely an issue with your Docker configuration -- likely an inconsisnent password given to the two containers for that service.</p>",
        "id": 1530084,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679458815
    },
    {
        "content": "<p>Between the memcached container and the zulip container? I've got it configured to use a password from an .env for those...</p>\n<p><a href=\"/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png\">image.png</a> <br>\n<a href=\"/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png\" title=\"image.png\"><img src=\"/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png\"></a></div><p>Or is there another location that I've missed?</p>",
        "id": 1530233,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679475373
    },
    {
        "content": "<p>Or does the backup-restore from the old server import a password that I need to change/bring accross?</p>",
        "id": 1530234,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679475411
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"26556\">@Matthew Strachan</span> it might, depending what options you specified to the restore tool; the password does appear in <code>zulip-secrets.conf</code> in the backup tarball.</p>",
        "id": 1530755,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679511066
    },
    {
        "content": "<p>Ok, I'll take a look at that. I had specified <code>--keep-settings</code> on the restore tool, as I had already configured settings.py on the new server. I'll take a look at the secrets.conf file incase its pulled in the old memcached creds</p>",
        "id": 1531152,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679535874
    },
    {
        "content": "<p>zulip-secrets.conf looked fine. I just restarted the docker stack, and was able to run the <code>./scripts/setup/flush-memcached</code> script fine.</p>",
        "id": 1531182,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679543508
    },
    {
        "content": "<p>Interestingly, the missing attachments and images seems to be related to the way the restore script extracts those from the tarball. It puts them into /home/zulip/uploads, but that doesn't persist with docker. I suspect <code>/home/zulip/uploads</code>might be a symlink of <code>/data/uploads</code> and maybe the tar tool doesn't honor the symlink?? That is purely a guess and I have no evidence to that.</p>",
        "id": 1531183,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679543685
    },
    {
        "content": "<p>From within the zulip container, if I manually create a file in /home/zulip/uploads, I can see if reflected in both the /data/uploads directory on the container, and within the zulip/uploads directory in the docker volume. However, when I run the tar tool, it only appears in /home/zulip/uploads in the container. Modifying the tar command seems to fix this:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>tar<span class=\"w\"> </span>-v<span class=\"w\"> </span>-C<span class=\"w\"> </span>/tmp/zulip-backup<span class=\"w\"> </span><span class=\"s1\">'--transform=s|^zulip-backup/uploads(/.*)?$|/data/uploads\\1|x'</span><span class=\"w\"> </span>-xPz<span class=\"w\"> </span>-f<span class=\"w\"> </span>/transfer/backup.tar.gz\n</code></pre></div>",
        "id": 1531184,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679543837
    },
    {
        "content": "<p>Long story short... I've now been able to manage half a dozen successful backups and restores in a staging environment, and have a process down pat that seems to work each time...</p>",
        "id": 1531185,
        "sender_full_name": "Matthew Strachan",
        "timestamp": 1679543891
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"9\" href=\"/#narrow/stream/9-issues/topic/Migration.20between.20servers\">#issues &gt; Migration between servers</a> by <span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span>.</p>",
        "id": 1532112,
        "sender_full_name": "Notification Bot",
        "timestamp": 1679615832
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"26556\">@Matthew Strachan</span> moved this here since that's where we usually track production issues, but that symlink issue sounds like a very plausible issue that might exist.</p>",
        "id": 1532115,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1679615880
    }
]