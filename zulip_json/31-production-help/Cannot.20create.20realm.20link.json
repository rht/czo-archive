[
    {
        "content": "<p>Could you help me please? I installed zulip on a fresh VM (Ubuntu 16.04) and everything works fine but I cant create a realm link</p>\n<p>Command:<br>\nsu zulip /home/zulip/deployments/current/manage.py generate_realm_creation_link</p>\n<p>Error message:<br>\nNo protocol specified<br>\nimport: unable to open X server <code>:0' @ error/import.c/ImportImageCommand/364.\nNo protocol specified\nimport: unable to open X server</code>:0' @ error/import.c/ImportImageCommand/364.<br>\n/home/zulip/deployments/current/manage.py: line 5: syntax error near unexpected token <code>('\n/home/zulip/deployments/current/manage.py: line 5:</code>BASE_DIR = os.path.dirname(os.path.abspath(__file__))'</p>",
        "id": 364869,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512475193
    },
    {
        "content": "<blockquote>\n<p>Could you help me please? I installed zulip on a fresh VM (Ubuntu 16.04) and everything works fine but I cant create a realm link</p>\n<p>Command:<br>\nsu zulip /home/zulip/deployments/current/manage.py generate_realm_creation_link</p>\n<p>Error message:<br>\nNo protocol specified<br>\nimport: unable to open X server <code>:0' @ error/import.c/ImportImageCommand/364.\nNo protocol specified\nimport: unable to open X server</code>:0' @ error/import.c/ImportImageCommand/364.<br>\n/home/zulip/deployments/current/manage.py: line 5: syntax error near unexpected token <code>('\n/home/zulip/deployments/current/manage.py: line 5:</code>BASE_DIR = os.path.dirname(os.path.abspath(__file__))'</p>\n</blockquote>\n<p>test</p>",
        "id": 366195,
        "sender_full_name": "Linas etc.",
        "timestamp": 1512507264
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>Could you help me please? I installed zulip on a fresh VM (Ubuntu 16.04) and everything works fine but I cant create a realm link</p>\n<p>Command:<br>\nsu zulip /home/zulip/deployments/current/manage.py generate_realm_creation_link</p>\n<p>Error message:<br>\nNo protocol specified<br>\nimport: unable to open X server <code>:0' @ error/import.c/ImportImageCommand/364.\nNo protocol specified\nimport: unable to open X server</code>:0' @ error/import.c/ImportImageCommand/364.<br>\n/home/zulip/deployments/current/manage.py: line 5: syntax error near unexpected token <code>('\n/home/zulip/deployments/current/manage.py: line 5:</code>BASE_DIR = os.path.dirname(os.path.abspath(__file__))'</p>\n</blockquote>\n<p>test</p>\n</blockquote>\n<p>test</p>",
        "id": 366196,
        "sender_full_name": "Linas etc.",
        "timestamp": 1512507274
    },
    {
        "content": "<p>What do you mean by that?</p>",
        "id": 366513,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512522908
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Never mind, I think he's just testing out Zulip <span class=\"emoji emoji-1f61b\" title=\"stuck out tongue\">:stuck_out_tongue:</span></p>",
        "id": 366774,
        "sender_full_name": "Sampriti Panda",
        "timestamp": 1512549161
    },
    {
        "content": "<p>Although he should be doing that in <a class=\"stream\" data-stream-id=\"7\" href=\"/#narrow/stream/test%20here\">#test here</a></p>",
        "id": 366775,
        "sender_full_name": "Sampriti Panda",
        "timestamp": 1512549177
    },
    {
        "content": "<p>Ah ok, thank you :-) Am I doing something wrong? Didn't get any support for 3 days</p>",
        "id": 367315,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512565922
    },
    {
        "content": "<p>Hey! It looks like no one s far has been able to figure this issue out and that is why it might be taking time.</p>",
        "id": 367362,
        "sender_full_name": "Rohitt Vashishtha",
        "timestamp": 1512566437
    },
    {
        "content": "<p>I'm not entirely sure here, but the manage.py script needs to be run with python.</p>",
        "id": 367364,
        "sender_full_name": "Rohitt Vashishtha",
        "timestamp": 1512566457
    },
    {
        "content": "<p>Can you try <code>python /home/zulip/deployments/current/manage.py generate_realm_creation_link</code> once <span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> ?</p>",
        "id": 367367,
        "sender_full_name": "Rohitt Vashishtha",
        "timestamp": 1512566489
    },
    {
        "content": "<p>Unfortunatelly, it didn't work</p>\n<p>Command:<br>\nsu zulip python  /home/zulip/deployments/current/manage.py generate_realm_creation_link</p>\n<p>Error:<br>\n/usr/bin/python: /usr/bin/python: cannot execute binary file</p>",
        "id": 367623,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512572395
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Can you do <code>which python</code> and <code>ls -l /usr/bin/python</code>?</p>",
        "id": 367632,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512572700
    },
    {
        "content": "<p>Command:<br>\nzulip@ubuntu:/home/dieter/zulip-server-1.7.1$ which python</p>\n<p>Output:<br>\n/usr/bin/python</p>\n<p>Command:<br>\nzulip@ubuntu:/home/dieter/zulip-server-1.7.1$ ls -l /usr/bin/python</p>\n<p>Output:<br>\nlrwxrwxrwx 1 root root 9 Dec  9  2015 /usr/bin/python -&gt; python2.7</p>",
        "id": 367637,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512572803
    },
    {
        "content": "<p>Should i update python to 3.6?</p>",
        "id": 367638,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512572852
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> If you are running a recent version of Zulip, we are now using python3.</p>",
        "id": 367639,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512572858
    },
    {
        "content": "<p>Ah ok, I will try it out ASAP</p>",
        "id": 367640,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512572876
    },
    {
        "content": "<p>Yeah, I'm kind of surprised that didn't happen automatically when you either installed or upgraded.</p>",
        "id": 367641,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512572889
    },
    {
        "content": "<p>Can you describe your install history?  (i.e. How long have you been running Zulip, have you ever upgraded, etc.?)</p>",
        "id": 367644,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512572924
    },
    {
        "content": "<p>I dit it after that tutorial:<a href=\"https://www.vultr.com/docs/how-to-install-zulip-on-ubuntu-16-04\" target=\"_blank\" title=\"https://www.vultr.com/docs/how-to-install-zulip-on-ubuntu-16-04\">https://www.vultr.com/docs/how-to-install-zulip-on-ubuntu-16-04</a></p>",
        "id": 367651,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512573258
    },
    {
        "content": "<p>Ah...we don't endorse that tutorial.  Here are our instructions:</p>\n<p><a href=\"https://zulip.readthedocs.io/en/latest/production/install.html\" target=\"_blank\" title=\"https://zulip.readthedocs.io/en/latest/production/install.html\">https://zulip.readthedocs.io/en/latest/production/install.html</a></p>",
        "id": 367672,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512573659
    },
    {
        "content": "<p>It doesnt work with python 3 too</p>\n<p>Command<br>\nsu zulip python3.5 /home/zulip/deployments/current/manage.py generate_realm_creation_link</p>\n<p>Error<br>\n/usr/bin/python3.5: /usr/bin/python3.5: cannot execute binary file</p>",
        "id": 367695,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512574052
    },
    {
        "content": "<p>Can you follow the instructions in our official documentation?</p>",
        "id": 367702,
        "sender_full_name": "Sampriti Panda",
        "timestamp": 1512574175
    },
    {
        "content": "<p>I think the ones in that article might be out-dated</p>",
        "id": 367703,
        "sender_full_name": "Sampriti Panda",
        "timestamp": 1512574182
    },
    {
        "content": "<p>Ok. It will take some time, have to redo the VM</p>",
        "id": 367708,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512574294
    },
    {
        "content": "<p>It's unfortunate that third party sites basically copy our install instructions without keeping them up to date or supporting them.</p>",
        "id": 367714,
        "sender_full_name": "Steve Howell",
        "timestamp": 1512574442
    },
    {
        "content": "<p>In your tutorial, you're missing the installation of curl</p>",
        "id": 367905,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512576996
    },
    {
        "content": "<p>I followed your tutorial but it didnt help. Still got the same error</p>",
        "id": 368216,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512582579
    },
    {
        "content": "<p>But I found a workaround:<br>\npasswd zulip<br>\nsu zulip <br>\ncd /home/zulip/deployments/current/<br>\npython3 manage.py generate_realm_creation_link</p>",
        "id": 368227,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512582978
    },
    {
        "content": "<p>I did that after initializing the database, before restarting the servers</p>",
        "id": 368228,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512583008
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> I think the issue is that the command \"su zulip some-program\" doesn't make sense -- that's not how the <code>su</code> command line works</p>",
        "id": 368567,
        "sender_full_name": "Greg Price",
        "timestamp": 1512590448
    },
    {
        "content": "<p>What we have in our instructions is</p>\n<div class=\"codehilite\"><pre><span></span>su zulip\n/home/zulip/deployments/current/manage.py generate_realm_creation_link\n</pre></div>\n\n\n<p>which is two commands</p>",
        "id": 368570,
        "sender_full_name": "Greg Price",
        "timestamp": 1512590507
    },
    {
        "content": "<p>Your original errors look like the result of something trying to have a shell interpret that Python script. Reading the <code>su</code> man page, that turns out to be exactly what it does with a command like that.</p>",
        "id": 368585,
        "sender_full_name": "Greg Price",
        "timestamp": 1512590718
    },
    {
        "content": "<p>(Similarly, with a command like <code>su zulip python3.5 ...</code>, it ends up running something like <code>bash python3.5 ...</code>... which results in <code>bash</code> trying to interpret <code>/usr/bin/python3.5</code> as a shell script, which naturally doesn't work.)</p>",
        "id": 368589,
        "sender_full_name": "Greg Price",
        "timestamp": 1512590918
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"showell@zulipchat.com\" data-user-id=\"58\">@Steve Howell</span> FYI we don't touch <code>/usr/bin/python</code> in our install process; we just install Python 3 through the system package manager, which results in a <code>/usr/bin/python3</code> but leaves plain <code>python</code> pointing to Python 2.7. Whether and when to someday make <code>/usr/bin/python</code> refer to Python 3 is a question we leave to the distro.</p>\n<p>Instead, we use virtualenvs to control what Python interpreter all our app code runs in, and we make that <code>/usr/bin/python3</code>.</p>",
        "id": 368600,
        "sender_full_name": "Greg Price",
        "timestamp": 1512591289
    },
    {
        "content": "<p>So that output for <code>ls -l /usr/bin/python</code> is normal.</p>",
        "id": 368603,
        "sender_full_name": "Greg Price",
        "timestamp": 1512591315
    },
    {
        "content": "<p>Now creating realms works, but if i try to connect to zulip from outside the VM, I get a 400 Bad Request Error on the client</p>",
        "id": 369051,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512609780
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Hmm. Do I understand right -- you get that when you connect from outside the VM, but it works when connecting from inside the VM?</p>",
        "id": 369058,
        "sender_full_name": "Greg Price",
        "timestamp": 1512610096
    },
    {
        "content": "<p>I suspect that what's happening is that you're accessing the site by a name in your browser that isn't in your ALLOWED_HOSTS setting. This is a Django security measure that's described in our default <code>/etc/zulip/settings.py</code> file.</p>",
        "id": 369073,
        "sender_full_name": "Greg Price",
        "timestamp": 1512610738
    },
    {
        "content": "<p>If you have just one hostname you use for your Zulip server, then you should be able to just set <code>EXTERNAL_HOST</code> to that name, always use that name in the URL, and everything will work -- Zulip takes care of setting <code>ALLOWED_HOSTS</code> to include the value of <code>EXTERNAL_HOST</code>.</p>\n<p>If you have some aliases for it, then you can put those in <code>ALLOWED_HOSTS</code>.</p>",
        "id": 369076,
        "sender_full_name": "Greg Price",
        "timestamp": 1512610828
    },
    {
        "content": "<p>You understood right. I have a ddns. Where do I have to enter the ddns name?</p>",
        "id": 369102,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512612788
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Put it in <code>EXTERNAL_HOST</code>, in your <code>/etc/zulip/settings.py</code></p>",
        "id": 369178,
        "sender_full_name": "Greg Price",
        "timestamp": 1512615382
    },
    {
        "content": "<p>(Then restart the Zulip server, to pick up the new setting: <code>/home/zulip/deployments/current/scripts/restart-zulip</code>)</p>",
        "id": 369180,
        "sender_full_name": "Greg Price",
        "timestamp": 1512615407
    },
    {
        "content": "<p>Oh I see, this is a place where that page on \"<a href=\"http://vultr.com\" target=\"_blank\" title=\"http://vultr.com\">vultr.com</a>\" got things completely wrong :-/ -- it tells you to put <code>localhost</code> there</p>",
        "id": 369186,
        "sender_full_name": "Greg Price",
        "timestamp": 1512615495
    },
    {
        "content": "<p>That will never work unless you only ever use Zulip by the name of <code>localhost</code> <span class=\"emoji emoji-1f61b\" title=\"stuck out tongue\">:stuck_out_tongue:</span></p>",
        "id": 369188,
        "sender_full_name": "Greg Price",
        "timestamp": 1512615530
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> I'd definitely urge you to read through the actual Zulip install instructions, at <a href=\"https://zulip.readthedocs.io/en/latest/production/install.html\" target=\"_blank\" title=\"https://zulip.readthedocs.io/en/latest/production/install.html\">https://zulip.readthedocs.io/en/latest/production/install.html</a> -- it prominently mentions this setting, and there may be more pitfalls yet in that <code>vultr.com</code> page</p>",
        "id": 369191,
        "sender_full_name": "Greg Price",
        "timestamp": 1512615615
    },
    {
        "content": "<p>It works :-D I was just confused by allowed hosts and external hosts. I thought you could block external IPs with that setting</p>",
        "id": 369228,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512617060
    },
    {
        "content": "<p>Unfortunatelly, the Android App doesnt work. It says Network request failed. It doesnt work with WLAN neither</p>",
        "id": 369250,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512617773
    },
    {
        "content": "<p>It works on the mobile only over browser</p>",
        "id": 369254,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512617844
    },
    {
        "content": "<p>Could it be that the Zulip App needs another port than 443? I just forwarded this one</p>",
        "id": 369258,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512617890
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Hmm, interesting! I don't think it should need any other port, so let's debug this.</p>\n<p>Can you post a screenshot of the error message you're seeing?</p>",
        "id": 369296,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618349
    },
    {
        "content": "<p>That may be a little annoying, unfortunately -- we have a nice upload-image feature in the mobile app once that's working <span class=\"emoji emoji-1f603\" title=\"smiley\">:smiley:</span> , but I don't think the web app can upload from the phone's images. But if you can get the screenshot here, it'll help a lot in debugging.</p>",
        "id": 369297,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618412
    },
    {
        "content": "<p>I am not an expert on the mobile app, btw -- pinging <span class=\"user-mention\" data-user-email=\"borisyankov@gmail.com\" data-user-id=\"284\">@Boris Yankov</span> who is (but he's probably asleep right now, and will see this in a few hours).</p>",
        "id": 369299,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618431
    },
    {
        "content": "<p>Well, the problem is, you won't be amused by the amount of information in the screenshot :-D</p>",
        "id": 369300,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618471
    },
    {
        "content": "<p>Oh, here's one idea: are you using something like a self-signed cert, or a real certificate issued by a CA that your phone will trust?</p>",
        "id": 369301,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618522
    },
    {
        "content": "<p>It's in the welcome screen, where you put in your server URL. After typing in that url (autocompletion, no typos) i get the error \"Network request failed</p>",
        "id": 369304,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618563
    },
    {
        "content": "<p>I just <a href=\"https://chat.zulip.org/#narrow/search/.22network.20request.20failed.22\" target=\"_blank\" title=\"https://chat.zulip.org/#narrow/search/.22network.20request.20failed.22\">searched</a> in this Zulip realm for your error message, and that's one thing that can cause this</p>",
        "id": 369306,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618575
    },
    {
        "content": "<p>Im using a self-signed cert</p>",
        "id": 369307,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618580
    },
    {
        "content": "<p>Cool, that description is helpful</p>",
        "id": 369308,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618584
    },
    {
        "content": "<p>OK, that's the issue then</p>",
        "id": 369309,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618587
    },
    {
        "content": "<p>We definitely need to make that give a better error message</p>",
        "id": 369310,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618596
    },
    {
        "content": "<p>How can I fix this? <br>\nIm more into coding than networking :-D</p>",
        "id": 369311,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618617
    },
    {
        "content": "<p>Yeah, me too :)</p>",
        "id": 369312,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618631
    },
    {
        "content": "<p><a href=\"https://zulip.readthedocs.io/en/latest/production/ssl-certificates.html\" target=\"_blank\" title=\"https://zulip.readthedocs.io/en/latest/production/ssl-certificates.html\">https://zulip.readthedocs.io/en/latest/production/ssl-certificates.html</a><br>\nis our docs on an easy way to do this</p>",
        "id": 369313,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618643
    },
    {
        "content": "<p>I'm already using the certbot</p>",
        "id": 369314,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618659
    },
    {
        "content": "<p>Hmm -- that should give you not a self-signed cert, then</p>",
        "id": 369315,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618679
    },
    {
        "content": "<p>Oh, I just realized I linked you to documentation from master, which includes an installer option that isn't in a release yet -- <a href=\"http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html\" target=\"_blank\" title=\"http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html\">http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html</a> is the version of that page for the latest release</p>",
        "id": 369316,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618749
    },
    {
        "content": "<p>What does <code>ls -l /etc/ssl/private/zulip.key /etc/ssl/certs/zulip.combined-chain.crt</code> say?</p>",
        "id": 369318,
        "sender_full_name": "Greg Price",
        "timestamp": 1512618777
    },
    {
        "content": "<p>-rw-r--r-- 1 root root 1793 Dec  6 08:08 /etc/ssl/certs/zulip.combined-chain.crt<br>\n-rw-r--r-- 1 root root 3243 Dec  6 08:07 /etc/ssl/private/zulip.key</p>",
        "id": 369324,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512618917
    },
    {
        "content": "<p>OK, so to use Certbot, those should end up being symlinks to the certs managed by Certbot</p>",
        "id": 369325,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619129
    },
    {
        "content": "<p>Try following the Certbot instructions on the page <a href=\"http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html\" target=\"_blank\" title=\"http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html\">http://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html</a></p>",
        "id": 369328,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619156
    },
    {
        "content": "<p>Maybe the problem is at that point when I configured certbot<br>\nWhen executing the command:<br>\nsudo certbot --nginx<br>\nIt asks me for a domain name</p>",
        "id": 369329,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619195
    },
    {
        "content": "<p>And i typed in my ddns name. Is that correct?</p>",
        "id": 369332,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619226
    },
    {
        "content": "<p>dieter@ubuntu:~$ sudo certbot --nginx<br>\nSaving debug log to /var/log/letsencrypt/letsencrypt.log<br>\nPlugins selected: Authenticator nginx, Installer nginx<br>\nNo names were found in your configuration files. Please enter in your domain<br>\nname(s) (comma and/or space separated)  (Enter 'c' to cancel): <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nObtaining a new certificate<br>\nPerforming the following challenges:<br>\ntls-sni-01 challenge for <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nCleaning up challenges<br>\nCannot find a VirtualHost matching domain <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a>. In order for Certbot to correctly perform the challenge please add a corresponding server_name directive to your nginx configuration: <a href=\"https://nginx.org/en/docs/http/server_names.html\" target=\"_blank\" title=\"https://nginx.org/en/docs/http/server_names.html\">https://nginx.org/en/docs/http/server_names.html</a></p>",
        "id": 369333,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619329
    },
    {
        "content": "<p>You'll want to give it the same name you use to connect to the server as a user (in the mobile app, and in the browser)</p>",
        "id": 369334,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619351
    },
    {
        "content": "<p>So it was right<br>\nBut there is still an error (above message)</p>",
        "id": 369335,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619399
    },
    {
        "content": "<p>Yeah, so that's a certbot error message at the end of that output</p>\n<p>You can follow its instructions if you want to use <code>certbot --nginx</code></p>",
        "id": 369336,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619410
    },
    {
        "content": "<p>Or our instructions suggest <code>certbot certonly --standalone</code></p>",
        "id": 369338,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619433
    },
    {
        "content": "<p>Oh sorry, I didn't read that...</p>",
        "id": 369339,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619465
    },
    {
        "content": "<p>:)</p>",
        "id": 369340,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619473
    },
    {
        "content": "<p>Now I get another error message: <br>\nsudo certbot certonly --standalone<br>\nSaving debug log to /var/log/letsencrypt/letsencrypt.log<br>\nPlugins selected: Authenticator standalone, Installer None<br>\nPlease enter in your domain name(s) (comma and/or space separated)  (Enter 'c'<br>\nto cancel): <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nObtaining a new certificate<br>\nPerforming the following challenges:<br>\ntls-sni-01 challenge for <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nCleaning up challenges<br>\nProblem binding to port 443: Could not bind to IPv4 or IPv6.</p>",
        "id": 369345,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619561
    },
    {
        "content": "<p>But thats not possible. I can connect to zulip from inside and outside the VM over https, which uses port 443</p>",
        "id": 369348,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619639
    },
    {
        "content": "<p>Do I have to stop the zulip server before certing?</p>",
        "id": 369349,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619661
    },
    {
        "content": "<p>Quick googling suggests it...</p>",
        "id": 369355,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512619734
    },
    {
        "content": "<p>Yeah. We have a note about that in the instructions page:</p>\n<blockquote>\n<p>Note: If you already had a webserver installed on this system (e.g. you previously installed Zulip and are now getting a cert), you will need to stop the webserver (e.g. service nginx stop) and start it again after (e.g. service nginx start) running the certbot command above.</p>\n</blockquote>",
        "id": 369359,
        "sender_full_name": "Greg Price",
        "timestamp": 1512619872
    },
    {
        "content": "<p>does service nginx stop work for zulip too? I think its based on nginx</p>",
        "id": 369361,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512620060
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Yes, the Zulip installer sets up nginx as Zulip's front end.</p>",
        "id": 369366,
        "sender_full_name": "Greg Price",
        "timestamp": 1512621773
    },
    {
        "content": "<p>I did as mentioned but after stoping the service and trying to start it, I get an error message</p>\n<p>dieter@ubuntu:~$ sudo rm /etc/ssl/certs/zulip.combined-chain.crt<br>\ndieter@ubuntu:~$ sudo rm /etc/ssl/private/zulip.key<br>\ndieter@ubuntu:~$ sudo ln -s /etc/letsencrypt/live/xxx.ddns.net/fullchain.pem /etc/ssl/certs/zulip.combined-chain.crt<br>\ndieter@ubuntu:~$ sudo ln -s /etc/letsencrypt/live/xxx.ddns.net/privkey.pem /etc/ssl/private/zulip.key<br>\ndieter@ubuntu:~$ service nginx startJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.</p>\n<p>dieter@ubuntu:~$ systemctl status nginx.service</p>\n<p>nginx.service - A high performance web server and a reverse proxy server<br>\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)<br>\n   Active: failed (Result: exit-code) since Wed 2017-12-06 20:51:38 PST; 1min 21s ago<br>\n  Process: 11293 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=1/FAILURE)</p>\n<p>Dec 06 20:51:38 ubuntu systemd[1]: Starting A high performance web server and a reverse proxy server...<br>\nDec 06 20:51:38 ubuntu nginx[11293]: nginx: [emerg] SSL_CTX_use_PrivateKey_file(\"/etc/ssl/private/zulip.key\") failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen('/etc/ssl/private/zulip.key','r') error:20074002:BIO routines:FILE_CTRL:system lib error:140B0002:SSL routines:SSL_CTX_use_PrivateKey_file:system lib)<br>\nDec 06 20:51:38 ubuntu nginx[11293]: nginx: configuration file /etc/nginx/nginx.conf test failed<br>\nDec 06 20:51:38 ubuntu systemd[1]: nginx.service: Control process exited, code=exited status=1<br>\nDec 06 20:51:38 ubuntu systemd[1]: Failed to start A high performance web server and a reverse proxy server.<br>\nDec 06 20:51:38 ubuntu systemd[1]: nginx.service: Unit entered failed state.<br>\nDec 06 20:51:38 ubuntu systemd[1]: nginx.service: Failed with result 'exit-code'.</p>",
        "id": 369373,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512622586
    },
    {
        "content": "<p>dieter@ubuntu:~$ sudo ls -l /etc/ssl/private/zulip.key<br>\nlrwxrwxrwx 1 root root 55 Dec  6 20:51 /etc/ssl/private/zulip.key -&gt; /etc/letsencrypt/live/xxx.ddns.net/privkey.pem</p>",
        "id": 369376,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512622729
    },
    {
        "content": "<p>Would it be easier to reinstall everything?</p>",
        "id": 369378,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512622778
    },
    {
        "content": "<p>Btw: Many thanks for your help <span class=\"user-mention\" data-user-email=\"greg@zulipchat.com\" data-user-id=\"2187\">@Greg Price</span> :-D</p>",
        "id": 369379,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512622828
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> No, I don't think a reinstall wouldn't help.</p>\n<p>Did you successfully run certbot? What does its output look like?</p>",
        "id": 369383,
        "sender_full_name": "Greg Price",
        "timestamp": 1512623240
    },
    {
        "content": "<p>The order of steps in the instructions is important -- you need to successfully acquire the certificates first, then point those two files at them. Otherwise when you try to start nginx, you get an error like that one, because it looks for the cert files mentioned in its configuration and tries to open them.</p>",
        "id": 369386,
        "sender_full_name": "Greg Price",
        "timestamp": 1512623289
    },
    {
        "content": "<p>(and those are in the nginx config set up by the Zulip installer)</p>",
        "id": 369387,
        "sender_full_name": "Greg Price",
        "timestamp": 1512623305
    },
    {
        "content": "<p>Specifically, you want to</p>\n<ul>\n<li>stop nginx</li>\n<li>run the certbot command in the instructions (with --standalone)</li>\n<li>start nginx</li>\n</ul>",
        "id": 369389,
        "sender_full_name": "Greg Price",
        "timestamp": 1512623354
    },
    {
        "content": "<p>dieter@ubuntu:~$ sudo certbot certonly --standaloneSaving debug log to /var/log/letsencrypt/letsencrypt.log<br>\nPlugins selected: Authenticator standalone, Installer None<br>\nPlease enter in your domain name(s) (comma and/or space separated)  (Enter 'c'<br>\nto cancel): <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nCert not yet due for renewal</p>\n<p>You have an existing certificate that has exactly the same domains or certificate name you requested and isn't close to expiry.<br>\n(ref: /etc/letsencrypt/renewal/xxx.ddns.net-0002.conf)</p>\n<p>What would you like to do?</p>\n<hr>\n<p>1: Keep the existing certificate for now<br>\n2: Renew &amp; replace the cert (limit ~5 per 7 days)</p>\n<hr>\n<p>Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2<br>\nRenewing an existing certificate<br>\nPerforming the following challenges:<br>\ntls-sni-01 challenge for <a href=\"http://xxx.ddns.net\" target=\"_blank\" title=\"http://xxx.ddns.net\">xxx.ddns.net</a><br>\nWaiting for verification...<br>\nCleaning up challenges</p>\n<p>IMPORTANT NOTES:<br>\n - Congratulations! Your certificate and chain have been saved at:<br>\n   /etc/letsencrypt/live/xxx.ddns.net-0002/fullchain.pem<br>\n   Your key file has been saved at:<br>\n   /etc/letsencrypt/live/xxx.ddns.net-0002/privkey.pem<br>\n   Your cert will expire on 2018-03-07. To obtain a new or tweaked<br>\n   version of this certificate in the future, simply run certbot<br>\n   again. To non-interactively renew <em>all</em> of your certificates, run<br>\n   \"certbot renew\"<br>\n - If you like Certbot, please consider supporting our work by:</p>\n<p>Donating to ISRG / Let's Encrypt:   <a href=\"https://letsencrypt.org/donate\" target=\"_blank\" title=\"https://letsencrypt.org/donate\">https://letsencrypt.org/donate</a><br>\n   Donating to EFF:                    <a href=\"https://eff.org/donate-le\" target=\"_blank\" title=\"https://eff.org/donate-le\">https://eff.org/donate-le</a></p>",
        "id": 369399,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512624053
    },
    {
        "content": "<p>sudo ln -s /etc/letsencrypt/live/xxx.ddns.net-0002/fullchain.pem /etc/ssl/certs/zulip.combined-chain.crt<br>\nln: failed to create symbolic link '/etc/ssl/certs/zulip.combined-chain.crt': File exists<br>\ndieter@ubuntu:~$ rm /etc/ssl/certs/zulip.combined-chain.crt<br>\nrm: cannot remove '/etc/ssl/certs/zulip.combined-chain.crt': Permission denied<br>\ndieter@ubuntu:~$ sudo rm /etc/ssl/certs/zulip.combined-chain.crt<br>\ndieter@ubuntu:~$ sudo ln -s /etc/letsencrypt/live/xxx.ddns.net-0002/privkey.pem /etc/ssl/private/zulip.key<br>\nln: failed to create symbolic link '/etc/ssl/private/zulip.key': File exists<br>\ndieter@ubuntu:~$ sudo rm /etc/ssl/private/zulip.key<br>\ndieter@ubuntu:~$ sudo ln -s /etc/letsencrypt/live/xxx.ddns.net-0002/privkey.pem /etc/ssl/private/zulip.key<br>\ndieter@ubuntu:~$ service nginx start<br>\nJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.</p>",
        "id": 369403,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512624127
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"greg@zulipchat.com\" data-user-id=\"2187\">@Greg Price</span> I cannot see any mistake in there</p>",
        "id": 369408,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512624175
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> From that Certbot output, it looks like your certificates are in <code>/etc/letsencrypt/live/xxx.ddns.net-0002/</code> , not <code>/etc/letsencrypt/live/xxx.ddns.net/</code></p>",
        "id": 369423,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625320
    },
    {
        "content": "<p>So in making those symlinks, you should replace <code>xxx.ddns.net</code> with <code>xxx.ddns.net-0002</code></p>",
        "id": 369424,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625357
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"greg@zulipchat.com\" data-user-id=\"2187\">@Greg Price</span> Thats why I changed the symlinks<br>\nsudo ln -s /etc/letsencrypt/live/xxx.ddns.net-0002/privkey.pem /etc/ssl/private/zulip.key</p>",
        "id": 369425,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512625361
    },
    {
        "content": "<p>Ah indeed</p>",
        "id": 369427,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625374
    },
    {
        "content": "<p>Did you create <code>/etc/ssl/certs/zulip.combined-chain.crt</code>? It looks like not, in that transcript</p>",
        "id": 369430,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625429
    },
    {
        "content": "<p>I suspect if you looked at the nginx log, it would tell you that ;-)</p>",
        "id": 369431,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625451
    },
    {
        "content": "<p>OmG I'm so stupid sometimes...<br>\nTo my defense, at my place it's 6.48 in the morning and I have to get up to work at 10 xD</p>",
        "id": 369436,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512625733
    },
    {
        "content": "<p>Ow :-O</p>",
        "id": 369438,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625852
    },
    {
        "content": "<p>Everything works like a charm now. I cannot tell how much you saved my life :-D</p>",
        "id": 369439,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512625857
    },
    {
        "content": "<p>Great! Glad to hear it :)</p>",
        "id": 369440,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625864
    },
    {
        "content": "<p>I have to go sleep now xD</p>",
        "id": 369441,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512625878
    },
    {
        "content": "<p>Good idea :-P -- sleep well!</p>",
        "id": 369442,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625898
    },
    {
        "content": "<p>See you! Have a good time pal! Many thanks for your help!</p>",
        "id": 369443,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512625902
    },
    {
        "content": "<p>We've been planning to replace all of the manual steps in this certbot process with our own automation in the install script -- so your experience is a good reminder of how helpful that will be</p>",
        "id": 369444,
        "sender_full_name": "Greg Price",
        "timestamp": 1512625969
    },
    {
        "content": "<p>(It'll be optional, naturally -- but we'll advertise the flag right in the main install instructions, because most people who don't have some institutional CA process in place will want to use it)</p>",
        "id": 369445,
        "sender_full_name": "Greg Price",
        "timestamp": 1512626025
    },
    {
        "content": "<p>Does anybody have experience with sub-sub-domains with no-ip?<br>\nI tried to create a second realm and it worked, but now i have the problem that i cant cert <a href=\"http://xyz.xxx.ddns.net\" target=\"_blank\" title=\"http://xyz.xxx.ddns.net\">xyz.xxx.ddns.net</a>. Using it without a cert would work, but then I cannot use the Android App</p>",
        "id": 371098,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512672179
    },
    {
        "content": "<p>Maybe my mesias <span class=\"user-mention\" data-user-email=\"greg@zulipchat.com\" data-user-id=\"2187\">@Greg Price</span> can save me again? :-D</p>",
        "id": 371099,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512672237
    },
    {
        "content": "<p>:)</p>\n<p>You'll need that domain in the cert too. The Certbot docs should tell you how to request multiple domains in a cert.</p>",
        "id": 371101,
        "sender_full_name": "Greg Price",
        "timestamp": 1512672314
    },
    {
        "content": "<p>They don't yet support wildcard certs, so if you want arbitrary subdomains you'll have to get the cert elsewhere -- or wait until January 2018, when Certbot supports it.</p>",
        "id": 371105,
        "sender_full_name": "Greg Price",
        "timestamp": 1512672346
    },
    {
        "content": "<p>Yes, but the problem is that I have to run nginx to have the sub-sub-domain working. In order to cert the sub-sub-domain, I have to stop nginx because otherwise, the 443 port is already in use</p>",
        "id": 371110,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512672409
    },
    {
        "content": "<p>Unfortunatelly, no-ip doesnt allow a second hostname with <a href=\"http://xyz.xxx.ddns.net\" target=\"_blank\" title=\"http://xyz.xxx.ddns.net\">xyz.xxx.ddns.net</a></p>",
        "id": 371113,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512672442
    },
    {
        "content": "<p>Is there any possibility to redirect the existing second realm to another hostname? Like <a href=\"http://abc.ddns.net\" target=\"_blank\" title=\"http://abc.ddns.net\">abc.ddns.net</a>?</p>",
        "id": 371118,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512672628
    },
    {
        "content": "<blockquote>\n<p>no-ip doesnt allow a second hostname with <a href=\"http://xyz.xxx.ddns.net\" target=\"_blank\" title=\"http://xyz.xxx.ddns.net\">xyz.xxx.ddns.net</a></p>\n</blockquote>\n<p>Meaning you can't get that name in DNS? In that case the cert issue doesn't matter, then. (I think the cert issue is solvable, but of course only if you have DNS.)</p>",
        "id": 371223,
        "sender_full_name": "Greg Price",
        "timestamp": 1512675881
    },
    {
        "content": "<p>For mapping a realm to an alternate domain -- like <code>abc.ddns.net</code>, or something completely different like <code>abc.example.io</code> if you like -- we actually have a new feature for this! The setting is called <code>REALM_HOSTS</code>.</p>",
        "id": 371224,
        "sender_full_name": "Greg Price",
        "timestamp": 1512675975
    },
    {
        "content": "<p>My DDNS provider does not allow sub-sub-domains in its free plan.</p>",
        "id": 371225,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512675990
    },
    {
        "content": "<p>It's newer than our latest release, though, so you'd need to deploy from Git.</p>",
        "id": 371226,
        "sender_full_name": "Greg Price",
        "timestamp": 1512676008
    },
    {
        "content": "<p>It might be easier to start with one realm now, and add the other after we release 1.8. :)</p>",
        "id": 371227,
        "sender_full_name": "Greg Price",
        "timestamp": 1512676043
    },
    {
        "content": "<p>The problem I am facing is that certbot throws an error if I try to cert <a href=\"http://xyz.xxx.ddns.net\" target=\"_blank\" title=\"http://xyz.xxx.ddns.net\">xyz.xxx.ddns.net</a></p>",
        "id": 371228,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512676075
    },
    {
        "content": "<p>DNS problem: NXDOMAIN looking up A for<br>\n<a href=\"http://xyz.xxx.ddns.net\" target=\"_blank\" title=\"http://xyz.xxx.ddns.net\">xyz.xxx.ddns.net</a></p>",
        "id": 371231,
        "sender_full_name": "Dieter Köberl",
        "timestamp": 1512676083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"dieter.koeberl@freenet.de\" data-user-id=\"4376\">@Dieter Köberl</span> Yeah, that's a DNS error -- certbot is telling you that you don't have DNS for that domain</p>",
        "id": 371356,
        "sender_full_name": "Greg Price",
        "timestamp": 1512683907
    }
]