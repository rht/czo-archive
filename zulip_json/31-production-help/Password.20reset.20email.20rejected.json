[
    {
        "content": "<p>One of my users tried to reset his password and it failed, giving him an Internal Server Error. I then got an email informing me \"[Django] zulip: (554, b'Message rejected: Email address is not verified...\"</p>",
        "id": 626573,
        "sender_full_name": "Steve Shank",
        "timestamp": 1533618198
    },
    {
        "content": "<p>I'm using Amazon Simple Email Service, and it must be working since I get all the notifications of messages I received while offline, plus the email notifying me of the error...This particular email tells me that my identities failed AWS verification. The email address Zulip sends from changes each time (noreply-&lt;some code&gt;@my.zulip.domain), so I added my domain to SES.</p>",
        "id": 626574,
        "sender_full_name": "Steve Shank",
        "timestamp": 1533618376
    },
    {
        "content": "<p>But still, the password reset email results in this error. Here's the traceback:</p>\n<div class=\"codehilite\"><pre><span></span>Logger django.request, from module django.core.handlers.exception line 135:\nError generated by Anonymous user (not logged in) on my.zulip.domain deployment\n\nTraceback (most recent call last):\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/handlers/exception.py&quot;, line 41, in inner\n    response = get_response(request)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response\n    response = self.process_exception_by_middleware(e, request)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File &quot;./zerver/views/auth.py&quot;, line 890, in password_reset\n    post_reset_redirect=&#39;/accounts/password/reset/done/&#39;)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/contrib/auth/views.py&quot;, line 54, in inner\n    return func(*args, **kwargs)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/utils/decorators.py&quot;, line 149, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/contrib/auth/views.py&quot;, line 306, in password_reset\n    form.save(**opts)\n  File &quot;./zerver/forms.py&quot;, line 249, in save\n    context=context)\n  File &quot;./zerver/lib/send_email.py&quot;, line 102, in send_email\n    if mail.send() == 0:\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/mail/message.py&quot;, line 348, in send\n    return self.get_connection(fail_silently).send_messages([self])\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/mail/backends/smtp.py&quot;, line 111, in send_messages\n    sent = self._send(message)\n  File &quot;/home/zulip/deployments/2018-08-04-06-44-17/zulip-py3-venv/lib/python3.5/site-packages/django/core/mail/backends/smtp.py&quot;, line 127, in _send\n    self.connection.sendmail(from_email, recipients, message.as_bytes(linesep=&#39;\\r\\n&#39;))\n  File &quot;/usr/lib/python3.5/smtplib.py&quot;, line 883, in sendmail\n    raise SMTPDataError(code, resp)\nsmtplib.SMTPDataError: (554, b&#39;Message rejected: Email address is not verified. The following identities failed the check in region US-WEST-2: noreply-grav2ofh2h0ccklq27glw024@my.zulip.domain...&#39;)\n\n\nDeployed code:\n- git: 1.8.0-2234-gcf813b4\n- ZULIP_VERSION: 1.8.1+git\n\n\nRequest info:\n- path: /accounts/password/reset/\n- POST: {&#39;csrfmiddlewaretoken&#39;: [&#39;**********&#39;], &#39;email&#39;: [&#39;my@email&#39;]}\n- REMOTE_ADDR: &quot;[&#39;x.x.x.x&#39;]&quot;\n- QUERY_STRING: &quot;[&#39;&#39;]&quot;\n- SERVER_NAME: &quot;[&#39;&#39;]&quot;\n</pre></div>",
        "id": 626575,
        "sender_full_name": "Steve Shank",
        "timestamp": 1533618509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"6605\">@Steve Shank</span> so, the email address that isn't verified is the outgoing email address.</p>",
        "id": 626989,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533676716
    },
    {
        "content": "<p>(And we by default use randomized outgoing email addresses for noreply emails)</p>",
        "id": 626991,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533676812
    },
    {
        "content": "<p>You can set:<br>\n<code>ADD_TOKENS_TO_NOREPLY_ADDRESS = False</code><br>\nin your settings if you need to turn that off.</p>",
        "id": 626992,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533676837
    },
    {
        "content": "<p>(It's a security protection against a bad-for-security interaction between support ticket systems that let you create online accounts without verifying you control the email address you register with, and software like Zulip that supports letting anyone create an account in a private organization if they have an email address in the organization)</p>",
        "id": 626994,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533676913
    },
    {
        "content": "<p>If you're not using that feature, you can just turn the setting off.  Otherwise, you need to figure out how to allow wildcards in your SES configuration (I haven't used SES, so don't know if that's feasible)</p>",
        "id": 626995,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533676944
    },
    {
        "content": "<p>Thanks Tim, that makes sense. I wonder why it's not working on a domain basis, though. You can also add send-from domains to SES and then any email should validate.</p>",
        "id": 627029,
        "sender_full_name": "Steve Shank",
        "timestamp": 1533679574
    },
    {
        "content": "<p>What would be the risk of disabling that feature? I'm not quite sure I understood the rationale. Is there a page that explains it? Thanks</p>",
        "id": 627031,
        "sender_full_name": "Steve Shank",
        "timestamp": 1533679620
    },
    {
        "content": "<p>It's a bit complicated, but here's the main article on it:<br>\n<a href=\"https://medium.com/intigriti/how-i-hacked-hundreds-of-companies-through-their-helpdesk-b7680ddc2d4c\" target=\"_blank\" title=\"https://medium.com/intigriti/how-i-hacked-hundreds-of-companies-through-their-helpdesk-b7680ddc2d4c\">https://medium.com/intigriti/how-i-hacked-hundreds-of-companies-through-their-helpdesk-b7680ddc2d4c</a></p>",
        "id": 627042,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533679950
    },
    {
        "content": "<p>(Basically relies on the helpdesk software letting you get access sent to emails sent by <code>feedback@slack.com</code>)</p>",
        "id": 627044,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1533679975
    }
]