[
    {
        "content": "<p>I get the following error when trying to login with a new user who is in my LDAP directory:</p>\n<div class=\"codehilite\"><pre><span></span>Error generated by Anonymous user (not logged in) on chat.adbtechltd.co.uk deployment\n\nTraceback (most recent call last):\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 42, in inner\n    response = get_response(request)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 249, in _legacy_get_response\n    response = self._get_response(request)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response\n    response = self.process_exception_by_middleware(e, request)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File &quot;./zerver/views/auth.py&quot;, line 445, in login_page\n    extra_context=extra_context, **kwargs)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/contrib/auth/views.py&quot;, line 47, in inner\n    return func(*args, **kwargs)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/views/decorators/debug.py&quot;, line 76, in sensitive_post_parameters_wrapper\n    return view(request, *args, **kwargs)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/utils/decorators.py&quot;, line 149, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/views/decorators/cache.py&quot;, line 57, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/contrib/auth/views.py&quot;, line 81, in login\n    if form.is_valid():\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/forms/forms.py&quot;, line 169, in is_valid\n    return self.is_bound and not self.errors\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/forms/forms.py&quot;, line 161, in errors\n    self.full_clean()\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/forms/forms.py&quot;, line 371, in full_clean\n    self._clean_form()\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/forms/forms.py&quot;, line 398, in _clean_form\n    cleaned_data = self.clean()\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/contrib/auth/forms.py&quot;, line 191, in clean\n    self.user_cache = authenticate(username=username, password=password)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django/contrib/auth/__init__.py&quot;, line 74, in authenticate\n    user = backend.authenticate(**credentials)\n  File &quot;./zproject/backends.py&quot;, line 422, in authenticate\n    user_profile = ZulipLDAPAuthBackendBase.authenticate(self, username, password)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django_auth_ldap/backend.py&quot;, line 169, in authenticate\n    user = ldap_user.authenticate(password)\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django_auth_ldap/backend.py&quot;, line 344, in authenticate\n    self._get_or_create_user()\n  File &quot;/home/zulip/deployments/2017-10-15-20-13-15/zulip-venv/lib/python2.7/site-packages/django_auth_ldap/backend.py&quot;, line 553, in _get_or_create_user\n    self._user, created = self.backend.get_or_create_user(username, self)\n  File &quot;./zproject/backends.py&quot;, line 444, in get_or_create_user\n    if self._realm.deactivated:\nAttributeError: &#39;NoneType&#39; object has no attribute &#39;deactivated&#39;\n\n\nRequest info:\n- path: /accounts/login/\n- POST: {u&#39;username&#39;: [u&#39;********************&#39;], u&#39;csrfmiddlewaretoken&#39;: [u&#39;**********&#39;], u&#39;password&#39;: [u&#39;**********&#39;], u&#39;button&#39;: [u&#39;********************&#39;]}\n- REMOTE_ADDR: &quot;[u&#39;92.233.93.8&#39;]&quot;\n- QUERY_STRING: &quot;[u&#39;next=&#39;]&quot;\n- SERVER_NAME: &quot;[u&#39;&#39;]&quot;\n</pre></div>\n\n\n<p><a href=\"https://github.com/zulip/zulip/pull/7017\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7017\">#7017</a></p>",
        "id": 298798,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508101468
    },
    {
        "content": "<p>What is the state of <a href=\"https://github.com/zulip/zulip/pull/7003\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7003\">#7003</a>, then?</p>",
        "id": 298809,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508111989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"rhtbot@protonmail.com\" data-user-id=\"2328\">@Rein Zustand</span> It was a duplicate of <a href=\"https://github.com/zulip/zulip/pull/6912\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/6912\">#6912</a> and <a href=\"https://github.com/zulip/zulip/pull/6399\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/6399\">#6399</a>. He got it resolved by disabling LDAP and recreating the server.</p>",
        "id": 298877,
        "sender_full_name": "Vishnu KS",
        "timestamp": 1508139194
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"adbirds@hotmail.co.uk\" data-user-id=\"3715\">@Adam Birds</span> Were you able to create an organisation successfully ?</p>",
        "id": 298886,
        "sender_full_name": "Vishnu KS",
        "timestamp": 1508148930
    },
    {
        "content": "<p>Yes, an organisation could be created successfully after reinstalling without LDAP, and then enabling LDAP after the organisation was created.</p>",
        "id": 298888,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508149017
    },
    {
        "content": "<p>Not sure about this but did you restart the server after enabling LDAP?</p>",
        "id": 298890,
        "sender_full_name": "Vishnu KS",
        "timestamp": 1508149239
    },
    {
        "content": "<p>Yes, turns out that <a href=\"https://github.com/zulip/zulip/pull/7017\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7017\">#7017</a> was due to me having invites are needed ticket. But there is a bug there as it shouldn't error out if invite is ticketed, it should tell you that sign up is disabled. Was discussing with <span class=\"user-mention\" data-user-email=\"rhtbot@protonmail.com\" data-user-id=\"2328\">@Rein Zustand</span> last night and I think it is already patched in <a href=\"https://github.com/zulip/zulip/pull/6624\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/6624\">#6624</a></p>",
        "id": 298892,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508149541
    },
    {
        "content": "<p>Users have reported this error previously <a href=\"https://chat.zulip.org/#narrow/search/attributeerror.3A.20'nonetype'.20object.20has.20no.20attribute.20'deactivated\" target=\"_blank\" title=\"https://chat.zulip.org/#narrow/search/attributeerror.3A.20'nonetype'.20object.20has.20no.20attribute.20'deactivated\">https://chat.zulip.org/#narrow/search/attributeerror.3A.20'nonetype'.20object.20has.20no.20attribute.20'deactivated</a>'</p>",
        "id": 298893,
        "sender_full_name": "Vishnu KS",
        "timestamp": 1508149543
    },
    {
        "content": "<p>Cool :)</p>",
        "id": 298894,
        "sender_full_name": "Vishnu KS",
        "timestamp": 1508149676
    },
    {
        "content": "<p>Yeah, This is fixed in master, we just need to get the release out with the fix :)</p>",
        "id": 299057,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508173474
    },
    {
        "content": "<p>Sorry for the trouble <span class=\"user-mention\" data-user-email=\"adbirds@hotmail.co.uk\" data-user-id=\"3715\">@Adam Birds</span>!</p>",
        "id": 299058,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508173560
    },
    {
        "content": "<p>No probs <span class=\"user-mention\" data-user-email=\"tabbott@zulipchat.com\" data-user-id=\"7\">@Tim Abbott</span> , not fun unless you get a few issues.</p>",
        "id": 299158,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508180856
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"tabbott@zulipchat.com\" data-user-id=\"7\">@Tim Abbott</span> dropped a reply on <a href=\"https://github.com/zulip/zulip/pull/7017\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7017\">#7017</a>, issues when upgrading from git as suggested.</p>",
        "id": 299515,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508226730
    },
    {
        "content": "<p>The <code>upgrade-zulip-from-git</code> has to be run with sudo, IIRC.</p>",
        "id": 299517,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508227056
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"adbirds@hotmail.co.uk\" data-user-id=\"3715\">@Adam Birds</span> what did the logfiles say?</p>",
        "id": 299519,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508227245
    },
    {
        "content": "<p>Can't seem to see anything in the upgrade.log or install.log. Will try with sudo now but was running directly as root.</p>",
        "id": 299520,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508227381
    },
    {
        "content": "<p>Still fails running with sudo, same error as posted on issue.</p>",
        "id": 299521,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508227530
    },
    {
        "content": "<p>I see. I have another way to track the detail of the err.</p>",
        "id": 299524,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508228364
    },
    {
        "content": "<p>So the <code>./tools/minify-js</code> failed to run, all we need to do is if you could change it in your branch to be more verbose.</p>",
        "id": 299525,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508228479
    },
    {
        "content": "<p>You have to set in zulip.conf <code>git_repo_url = https://github.com/adambirds/zulip.git</code> as well.</p>",
        "id": 299526,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508228530
    },
    {
        "content": "<p>Ahh okay, so I create a fork and then set the repo-url to the repo-url of my fork? <span class=\"user-mention\" data-user-email=\"rhtbot@protonmail.com\" data-user-id=\"2328\">@Rein Zustand</span></p>",
        "id": 299625,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508246283
    },
    {
        "content": "<p>Yes. That way you can add loggers as you please at the relevant places.</p>",
        "id": 299626,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508246469
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"adbirds@hotmail.co.uk\" data-user-id=\"3715\">@Adam Birds</span> can you post the output from <code>upgrade-zulip-from-git</code>?  If I had to guess, you skipped the instructions for installing the tooling needed for it.</p>",
        "id": 299742,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508258945
    },
    {
        "content": "<p><a href=\"http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older\" target=\"_blank\" title=\"http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older\">http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older</a></p>",
        "id": 299743,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508258959
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"tabbott@zulipchat.com\" data-user-id=\"7\">@Tim Abbott</span> yes I missed the <code>scripts/zulip-puppet-apply</code> bit first. Upgrade completed successfully. But I can now confirm that <a href=\"https://github.com/zulip/zulip/pull/7017\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7017\">#7017</a> is working as expected now in the new version.</p>",
        "id": 299793,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508270983
    },
    {
        "content": "<p>Logging in with a user who hasn't had an invite now takes you to the page - <a href=\"https://chat.adbtechltd.co.uk/config-error/ldap\" target=\"_blank\" title=\"https://chat.adbtechltd.co.uk/config-error/ldap\">https://chat.adbtechltd.co.uk/config-error/ldap</a>, although an error is stil emailed to admin email address. (not sure if thats meant to happen)<br>\nLogging in with a user has had an invite lets them straight in with LDAP creds.</p>",
        "id": 299795,
        "sender_full_name": "Adam Birds",
        "timestamp": 1508271788
    },
    {
        "content": "<p>I think the <code>puppet-apply</code> part should have been automated within <code>upgrade-zulip-from-git</code>, <span class=\"user-mention\" data-user-email=\"tabbott@zulipchat.com\" data-user-id=\"7\">@Tim Abbott</span> ?</p>",
        "id": 299955,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508286086
    },
    {
        "content": "<p>I meant, <code>upgrade-zulip</code>.</p>",
        "id": 299968,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508292361
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-email=\"rhtbot@protonmail.com\" data-user-id=\"2328\">@Rein Zustand</span> we actually already removed that step for doing <code>upgrade-zulip-from-git</code>, just 1.7 isn't out yet.</p>",
        "id": 299973,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508293361
    },
    {
        "content": "<p>I see. Is this line outdated? <a href=\"https://github.com/zulip/zulip/blob/5a77a4d1226509c72a12b13bc9d87d7a9e5b0fa2/scripts/upgrade-zulip-from-git#L40\" target=\"_blank\" title=\"https://github.com/zulip/zulip/blob/5a77a4d1226509c72a12b13bc9d87d7a9e5b0fa2/scripts/upgrade-zulip-from-git#L40\">https://github.com/zulip/zulip/blob/5a77a4d1226509c72a12b13bc9d87d7a9e5b0fa2/scripts/upgrade-zulip-from-git#L40</a></p>",
        "id": 299974,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508293637
    },
    {
        "content": "<p>I updated the lines at <a href=\"https://github.com/zulip/zulip/pull/7054\" target=\"_blank\" title=\"https://github.com/zulip/zulip/pull/7054\">#7054</a></p>",
        "id": 299975,
        "sender_full_name": "Rein Zustand",
        "timestamp": 1508294360
    },
    {
        "content": "<p>Yep, thanks for catching that :)</p>",
        "id": 299981,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1508298078
    }
]