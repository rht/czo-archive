[
    {
        "content": "<p>Hello,<br>\nI am not sure if anyone of you have encountered an error that you couldn't started a zulip docker container.<br>\nThe error I got is <br>\n ImportError: cannot import name 'EXTERNAL_HOST' from 'zproject.prod_settings' (/home/zulip/deployments/2022-03-30-01-27-07/zproject/prod_settings.py)<br>\nZulip migration failed with exit code 1. Exiting. </p>\n<p>When I went to the directory, I noticed that I didn't have the following directory at all \"2022-03-30-01-27-07/zproject/prod_settings.py\"<br>\nDoes anyone have any suggestion that I can bring back my zulip docker?</p>\n<p>Thank you so much. :)</p>",
        "id": 1355755,
        "sender_full_name": "jcheng",
        "timestamp": 1648604100
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"22988\">@jcheng</span> can you provide more detail on what you did to get your Docker container into that state?</p>",
        "id": 1356343,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1648666003
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1356343\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> can you provide more detail on what you did to get your Docker container into that state?</p>\n</blockquote>\n<p>Hi Tim,<br>\nThank you so much for replying to me the message. I really appreciate. <br>\nThe reason my zulip container stopped running was after I modified one line on  docker-compose.yml file. <br>\nWe wanted to use local postfix to deliver message from Zulip streams. <br>\nTherefore, I changed SETTING_EMAIL_HOST: \"<a href=\"http://abc.gmail.com\">abc.gmail.com</a>\" to SETTING_EMAIL_HOST: \"localhost\". <br>\nHowever, Zulip container never came back online after I made that change. <br>\nI got the following message when I issued docker-compose ps command.<br>\ndocker-zulip_zulip_1       /sbin/entrypoint.sh app:run      Exit 1</p>\n<p>Then, I tried to comment out some extra lines that I added to docker-compose.yml. </p>\n<p>volumes:</p>\n<div class=\"codehilite\"><pre><span></span><code>  - &quot;/opt/docker/zulip/zulip:/data:rw&quot;\n    # - &quot;/opt/docker/zulip/zuliplogs:/var/log/nginx&quot;\n    # - &quot;/opt/docker/zulip/zuliplogs2:/var/log/zulip&quot;\n</code></pre></div>\n\n<p>Those two lines (commented out) were there before I changed our SETTING_EMAIL_HOST. <br>\nI never encountered any issues before until yesterday after I tried to change setting_email_host parameter. </p>\n<p>Actually, when those two lines were on the configuration file, zulip did run for few minutes and then it crashed. <br>\nI had to comment them out in order to make zulip to run. <br>\nI don't know why this is the case, but commenting out those two lines is the solution for us to bring back zulip. </p>\n<p>Please let me know if you have any explanations or any suggestions for us.<br>\nThank you so much again for all your help. <br>\nJohn</p>",
        "id": 1356669,
        "sender_full_name": "jcheng",
        "timestamp": 1648684275
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1356669\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1356343\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> can you provide more detail on what you did to get your Docker container into that state?</p>\n</blockquote>\n<p>Hi Tim,<br>\nThank you so much for replying to me the message. I really appreciate. <br>\nThe reason my zulip container stopped running was after I modified one line on  docker-compose.yml file. <br>\nWe wanted to use local postfix to deliver message from Zulip streams. <br>\nTherefore, I changed SETTING_EMAIL_HOST: \"<a href=\"http://abc.gmail.com\">abc.gmail.com</a>\" to SETTING_EMAIL_HOST: \"localhost\". <br>\nHowever, Zulip container never came back online after I made that change. <br>\nI got the following message when I issued docker-compose ps command.<br>\ndocker-zulip_zulip_1       /sbin/entrypoint.sh app:run      Exit 1</p>\n<p>Then, I tried to comment out some extra lines that I added to docker-compose.yml. </p>\n<p>volumes:</p>\n<div class=\"codehilite\"><pre><span></span><code>  - &quot;/opt/docker/zulip/zulip:/data:rw&quot;\n    # - &quot;/opt/docker/zulip/zuliplogs:/var/log/nginx&quot;\n    # - &quot;/opt/docker/zulip/zuliplogs2:/var/log/zulip&quot;\n</code></pre></div>\n\n<p>Those two lines (commented out) were there before I changed our SETTING_EMAIL_HOST. <br>\nI never encountered any issues before until yesterday after I tried to change setting_email_host parameter. </p>\n<p>Actually, when those two lines were on the configuration file, zulip did run for few minutes and then it crashed. <br>\nI had to comment them out in order to make zulip to run. <br>\nI don't know why this is the case, but commenting out those two lines is the solution for us to bring back zulip. </p>\n<p>Please let me know if you have any explanations or any suggestions for us.<br>\nThank you so much again for all your help. <br>\nJohn</p>\n</blockquote>\n<p>Actually, it crashed again not long after I posted my message. </p>\n<div class=\"codehilite\"><pre><span></span><code>      Name                        Command                State     Ports\n</code></pre></div>\n\n<hr>\n<p>docker-zulip_database_1    <a href=\"http://docker-entrypoint.sh\">docker-entrypoint.sh</a> postgres    Exit 0<br>\ndocker-zulip_memcached_1   <a href=\"http://docker-entrypoint.sh\">docker-entrypoint.sh</a> sh -e ...   Exit 0<br>\ndocker-zulip_rabbitmq_1    <a href=\"http://docker-entrypoint.sh\">docker-entrypoint.sh</a> rabbi ...   Exit 137<br>\ndocker-zulip_redis_1       <a href=\"http://docker-entrypoint.sh\">docker-entrypoint.sh</a> sh -e ...   Exit 0<br>\ndocker-zulip_zulip_1       /sbin/entrypoint.sh app:run      Exit 137</p>\n<p>According to what I learned Exit 137 is memory issue, is there a way that I can restrict the max memory for both docker-zulip_rabbitmq_1 and docker-zulip_zulip_1?</p>\n<p>Thank you so much,<br>\nJohn</p>",
        "id": 1357136,
        "sender_full_name": "jcheng",
        "timestamp": 1648736132
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"22988\">@jcheng</span> you should be able to consult standard Docker documentation for how to configure memory allocation for your containers. <a href=\"https://github.com/zulip/docker-zulip#configuration\">https://github.com/zulip/docker-zulip#configuration</a> discusses how much memory is required.</p>",
        "id": 1357448,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1648753490
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1357448\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> you should be able to consult standard Docker documentation for how to configure memory allocation for your containers. <a href=\"https://github.com/zulip/docker-zulip#configuration\">https://github.com/zulip/docker-zulip#configuration</a> discusses how much memory is required.</p>\n</blockquote>\n<p>Hi Tim,<br>\nI thought that memory usages was the issue, but it turned out it is not. <br>\nThe container complaints about  following error. <br>\n/sbin/entrypoint.sh app:run,  Exit 1</p>\n<p>When I ran by using docker-compose up, I got the following error. <br>\nError accessing Zulip secrets; manage.py in production must be run as the zulip user.<br>\nI found a post on this subject, but there was no solution about this issue. <br>\n<a href=\"https://github.com/zulip/docker-zulip/issues/151\">https://github.com/zulip/docker-zulip/issues/151</a></p>\n<p>Do you have any suggestions on this?<br>\nThank you so much, <br>\nJohn</p>",
        "id": 1358628,
        "sender_full_name": "jcheng",
        "timestamp": 1648863843
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1358628\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span> <a href=\"#narrow/stream/31-production-help/topic/Couldn't.20start.20zulip.20docker.20container/near/1357448\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"22988\">jcheng</span> you should be able to consult standard Docker documentation for how to configure memory allocation for your containers. <a href=\"https://github.com/zulip/docker-zulip#configuration\">https://github.com/zulip/docker-zulip#configuration</a> discusses how much memory is required.</p>\n</blockquote>\n<p>Hi Tim,<br>\nI thought that memory usages was the issue, but it turned out it is not. <br>\nThe container complaints about  following error. <br>\n/sbin/entrypoint.sh app:run,  Exit 1</p>\n<p>When I ran by using docker-compose up, I got the following error. <br>\nError accessing Zulip secrets; manage.py in production must be run as the zulip user.<br>\nI found a post on this subject, but there was no solution about this issue. <br>\n<a href=\"https://github.com/zulip/docker-zulip/issues/151\">https://github.com/zulip/docker-zulip/issues/151</a></p>\n<p>Do you have any suggestions on this?<br>\nThank you so much, <br>\nJohn</p>\n</blockquote>\n<p>Just in case, anyone encounters the same issue as I did a couple days ago. <br>\nI was able to resolve the issue by changing zulip-secrets.conf file permission from 640 to 644. <br>\n/opt/docker/zulip/zulip/zulip-secrets.conf</p>\n<p>After the change, I was able to start zulip container.  :)</p>",
        "id": 1359648,
        "sender_full_name": "jcheng",
        "timestamp": 1649091147
    }
]