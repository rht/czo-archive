[
    {
        "content": "<p>Hi, I just tried to upgrade to 5.7 and suddenly I get an internal server error. I tried to downgrade again to 5.6 and the error now persists. The error appears when I try to view zulip in desktop app, and also on web as soon as I click on the button to login via SAML. Sadly, the django error does not help me to solve the problem myself :( </p>\n<div class=\"codehilite\"><pre><span></span><code>Logger django.request, from module django.utils.log line 224:\nError generated by MyName &lt;user9@chat.example.com&gt; (Organization administrator) on chat.example.com deployment\n\nTraceback (most recent call last):\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/exception.py&quot;, line 47, in inner\n   response = get_response(request)\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/base.py&quot;, line 181, in _get_response\n   response = wrapped_callback(request, *callback_args, **callback_kwargs)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/views/home.py&quot;, line 129, in home\n   return zulip_login_required(home_real)(request)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 433, in _wrapped_view\n   return view_func(request, *args, **kwargs)\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/contrib/auth/decorators.py&quot;, line 21, in _wrapped_view\n   return view_func(request, *args, **kwargs)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 482, in _wrapped_view_func\n   return rate_limit()(view_func)(request, *args, **kwargs)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 982, in wrapped_func\n   rate_limit_user(request, user, domain=&quot;api_by_user&quot;)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 887, in rate_limit_user\n   RateLimitedUser(user, domain=domain).rate_limit_request(request)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 47, in rate_limit_request\n   ratelimited, time = self.rate_limit()\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 40, in rate_limit\n   return self.backend.rate_limit_entity(\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 492, in rate_limit_entity\n   ratelimited, time = cls.is_ratelimited(entity_key, rules)\n File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 404, in is_ratelimited\n   rule_timestamps: List[Optional[bytes]] = pipe.execute()\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/client.py&quot;, line 2072, in execute\n   conn = self.connection_pool.get_connection(&quot;MULTI&quot;, self.shard_hint)\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 1387, in get_connection\n   connection.connect()\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 623, in connect\n   self.on_connect()\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 713, in on_connect\n   auth_response = self.read_response()\n File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 839, in read_response\n   raise response\nredis.exceptions.ResponseError: AUTH &lt;password&gt; called without any password configured for the default user. Are you sure your configuration is correct?\n\n\nDeployed code:\n- git: None\n- ZULIP_VERSION: 5.7\n</code></pre></div>",
        "id": 1466715,
        "sender_full_name": "Lumrenion",
        "timestamp": 1668712140
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20570\">@Lumrenion</span> it looks like your <code>redis</code> server is busted; I would try restarting <code>redis</code> as a first thing, but also is it possible you made some changes to its configuration while doing the upgrade?</p>",
        "id": 1466719,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1668712216
    },
    {
        "content": "<p>I would be quite surprised if the 5.6 to 5.7 upgrade itself has anything to do with that exception, though it's possible that, for example, an <code>apt upgrade</code> caused Redis to restart, or something like that.</p>",
        "id": 1466720,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1668712275
    },
    {
        "content": "<p>wow, thanks for the quick reply and hinting me towards redis. I did not change anything in the docker-compose.yml except the zulip version. But I also upgraded the redis container as the service is configured using the latest version. I will check that</p>",
        "id": 1466725,
        "sender_full_name": "Lumrenion",
        "timestamp": 1668712391
    },
    {
        "content": "<p>ok, so for some reason, suddenly another redis container is conflicting although they have different container_names and are not connected via network. If I start the zulip_redis_1 container first and then the other one, both zulip and the other service requiring redis are running fine. But if I start the zulip_redis_1 container when the other one is already running, zulip won't work.</p>",
        "id": 1466778,
        "sender_full_name": "Lumrenion",
        "timestamp": 1668714362
    },
    {
        "content": "<p>oh wait, Zulip is indeed connected with both redis containers via two different networks. And because both have the same hostname in their respective networks (<code>redis</code>), zulip takes the wrong one <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>",
        "id": 1466786,
        "sender_full_name": "Lumrenion",
        "timestamp": 1668714537
    }
]