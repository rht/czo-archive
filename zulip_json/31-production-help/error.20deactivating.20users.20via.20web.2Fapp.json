[
    {
        "content": "<p>Hi!<br>\nGot this error when I tried to deactivate a user</p>\n<div class=\"codehilite\"><pre><span></span><code>Logger zerver.middleware.json_error_handler, from module zerver.middleware line 488:\nError generated by Fabian Tribrunner &lt;tribrunner@regiowert.at&gt; (Organization owner) on chat.regiowert.at deployment\n\nTraceback (most recent call last):\n  File &quot;/srv/zulip-venv-cache/ae602e62cacf375c8e9c95291fbb2cfd2b63bed3/zulip-py3-venv/lib/python3.9/site-packages/django/core/handlers/base.py&quot;, line 197, in _get_response\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\n  File &quot;./zerver/lib/rest.py&quot;, line 39, in _wrapped_view_func\n    response = view_func(request, *args, **kwargs)\n  File &quot;/srv/zulip-venv-cache/ae602e62cacf375c8e9c95291fbb2cfd2b63bed3/zulip-py3-venv/lib/python3.9/site-packages/django/views/decorators/csrf.py&quot;, line 54, in wrapped_view\n    return view_func(*args, **kwargs)\n  File &quot;./zerver/lib/rest.py&quot;, line 203, in rest_dispatch\n    return target_function(request, **kwargs)\n  File &quot;/srv/zulip-venv-cache/ae602e62cacf375c8e9c95291fbb2cfd2b63bed3/zulip-py3-venv/lib/python3.9/site-packages/django/utils/decorators.py&quot;, line 133, in _wrapped_view\n    response = view_func(request, *args, **kwargs)\n  File &quot;./zerver/decorator.py&quot;, line 881, in _wrapped_view_func\n    return view_func(request, user_profile, *args, **kwargs)\n  File &quot;./zerver/decorator.py&quot;, line 641, in _wrapped_view_func\n    return view_func(request, user_profile, *args, **kwargs)\n  File &quot;./zerver/views/invite.py&quot;, line 108, in get_user_invites\n    all_users = do_get_invites_controlled_by_user(user_profile)\n  File &quot;./zerver/actions/invites.py&quot;, line 282, in do_get_invites_controlled_by_user\n    expiry_date=get_invitation_expiry_date(invitee.confirmation.get()),\n  File &quot;/srv/zulip-venv-cache/ae602e62cacf375c8e9c95291fbb2cfd2b63bed3/zulip-py3-venv/lib/python3.9/site-packages/django/db/models/manager.py&quot;, line 85, in manager_method\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\n  File &quot;/srv/zulip-venv-cache/ae602e62cacf375c8e9c95291fbb2cfd2b63bed3/zulip-py3-venv/lib/python3.9/site-packages/django/db/models/query.py&quot;, line 650, in get\n    raise self.model.DoesNotExist(\nconfirmation.models.Confirmation.DoesNotExist: Confirmation matching query does not exist.\n\n\nDeployed code:\n- git: 6.0-dev-2165-g925fa4ca50\n- ZULIP_VERSION: 6.0-dev-2165-g925fa4ca50\n\n\nRequest info:\n- path: /json/invites\n- GET: {}\n- REMOTE_ADDR: &quot;94.16.41.105&quot;\n- QUERY_STRING: &quot;&quot;\n- SERVER_NAME: &quot;&quot;\n</code></pre></div>\n<p>any ideas?</p>",
        "id": 1457021,
        "sender_full_name": "Fabian Tribrunner",
        "timestamp": 1667136257
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>su zulip -c &#39;/home/zulip/deployments/current/manage.py deactivate_user #USER@regiowert.at -f&#39;\n</code></pre></div>\n<p>works fine</p>",
        "id": 1457022,
        "sender_full_name": "Fabian Tribrunner",
        "timestamp": 1667136552
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"8768\">@Fabian Tribrunner</span> It seems you have some invitations in the database with a bugged state - I'm not sure about the most likely cause of that, perhaps due to some old bugs that may have caused this <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> I also opened <a href=\"https://github.com/zulip/zulip/pull/23394\">#23394</a> with a quick fix for a possible, though unlikely, source of such a situation.</p>\n<p>The best thing to do is probably to just delete these malformed objects. Can you run this in <code>manage.py shell</code> first so that we can have an idea how many such objects we're dealing with and to confirm it looks reasonable to delete them?</p>\n<div class=\"codehilite\"><pre><span></span><code>for prereg_user in PreregistrationUser.objects.filter(referred_by__isnull=False):\n    try:\n        prereg_user.confirmation.get()\n    except Confirmation.DoesNotExist:\n        print(f&quot;PreregistrationUser {prereg_user} missing the confirmation object&quot;)\n</code></pre></div>",
        "id": 1457378,
        "sender_full_name": "Mateusz Mandera",
        "timestamp": 1667250105
    }
]