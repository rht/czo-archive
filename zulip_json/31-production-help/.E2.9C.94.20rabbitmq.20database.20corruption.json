[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> Reverting back to old Python is just two symlinks.  Easy.  (Learning that Zulip doesn't support Ubuntu 18.04's default version of python was the PITA)</p>",
        "id": 727882,
        "sender_full_name": "SSD",
        "timestamp": 1554353893
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> </p>\n<blockquote>\n<p>I think given that you're on 2.0.x and have upgraded your database, what you should do is a fresh installation on Ubuntu 18.04, and then use our documented backup + restore procedure to migrate your data over to the newly installed system in a known-good state:</p>\n</blockquote>\n<p>Okay I did not see this before I responded earlier.  Okay I'll try this.</p>",
        "id": 727887,
        "sender_full_name": "SSD",
        "timestamp": 1554356938
    },
    {
        "content": "<p>It was going to be my backup plan if you didn't have suggestions to start with.</p>",
        "id": 727888,
        "sender_full_name": "SSD",
        "timestamp": 1554356955
    },
    {
        "content": "<p>But can you at least tell me how I can get some attention to the issues I post to GitHub?  Like this one: <a href=\"https://github.com/zulip/zulip/issues/11905\" target=\"_blank\" title=\"https://github.com/zulip/zulip/issues/11905\">https://github.com/zulip/zulip/issues/11905</a></p>",
        "id": 727889,
        "sender_full_name": "SSD",
        "timestamp": 1554356992
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> But please explain how a fresh install of Ubuntu 18.04 will prevent manual python install of 3.5 being necessary, since Zulip does not work with 3.6 and that is the default that comes with Ubuntu 18.04?</p>",
        "id": 727892,
        "sender_full_name": "SSD",
        "timestamp": 1554357595
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"5955\">@SSD</span> the answer is that Zulip does work with Python 3.6, it works with whatever version of Python the install/upgrade tool byte-compiled it against.</p>",
        "id": 728131,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554400831
    },
    {
        "content": "<p>So when you did a <code>do-release-upgrade</code>, you upgraded the system Python version from 3.5 to 3.6, but didn't rebuild the Zulip virtualenv, so you had a bunch of Python modules built against Python 3.5 trying to run on 3.6.</p>",
        "id": 728132,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554400866
    },
    {
        "content": "<p>We fully support 18.04; it's just that you need to do some extra extra stuff when doing an OS upgrade to update the Zulip installation.</p>",
        "id": 728133,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554400898
    },
    {
        "content": "<p>(Similarly, with full-text search, upgrading to a new version of Ubuntu upgraded the postgres version, and there's things you need to do to update the database as well as install the appropriate Zulip full-text search extension)</p>",
        "id": 728134,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554400942
    },
    {
        "content": "<p>(And sorry I've been slow about responding this week; I've been quite sick)</p>",
        "id": 728143,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554402039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> </p>\n<blockquote>\n<p>We fully support 18.04; it's just that you need to do some extra extra stuff when doing an OS upgrade to update the Zulip installation.</p>\n</blockquote>\n<p>Okay <em>what extra stuff</em> and where do I find this?  Maybe I can re-store the symlinks to Python 3.6, run these upgrades, and be back to normal.</p>\n<blockquote>\n<p>and there's things you need to do to update the database as well as install the appropriate Zulip full-text search extension</p>\n</blockquote>\n<p>Okay.  Where is this stuff mentioned?   (I did update the PostGres database to 10)</p>\n<p>Thank you for replying despite being sick.</p>",
        "id": 728407,
        "sender_full_name": "SSD",
        "timestamp": 1554442355
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> Okay I have worked on several things and I think I am close.  This is the current status.  Hopefull a simple question (\"How to upgrade virtualenv from python3.5 to python3.6\")</p>\n<p><a href=\"https://github.com/zulip/zulip/issues/12065\" target=\"_blank\" title=\"https://github.com/zulip/zulip/issues/12065\">https://github.com/zulip/zulip/issues/12065</a></p>",
        "id": 728451,
        "sender_full_name": "SSD",
        "timestamp": 1554449337
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"5955\">@SSD</span> cool, I believe for upgrading the virtualenv you roughly want to run <br>\n<code>/home/zulip/deployments/current/scripts/setup/create-production-venv /home/zulip/deployments/current</code>.</p>",
        "id": 728740,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554494047
    },
    {
        "content": "<p>It's possible there's a caching issue to work around manually, though; posted details on the issue thread.</p>",
        "id": 728743,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554494173
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> Many successes and a path between tickets leading back here: <a href=\"https://github.com/zulip/zulip/issues/12009\" target=\"_blank\" title=\"https://github.com/zulip/zulip/issues/12009\">https://github.com/zulip/zulip/issues/12009</a>.  I think maybe everything is upgraded (ubuntu, python, zulip) but search still does not work.  We are not in \"internal server error\" territory now of course.</p>",
        "id": 728982,
        "sender_full_name": "SSD",
        "timestamp": 1554526497
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"5955\">@SSD</span> posted a comment that I think should resolve your issue.</p>",
        "id": 729252,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1554580007
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> replying there.  Thank you.</p>",
        "id": 729478,
        "sender_full_name": "SSD",
        "timestamp": 1554612795
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> You saw my reply I hope.  We still can not use search and it is becoming a major problem.  We're talking migration and I want to avoid that.</p>",
        "id": 732445,
        "sender_full_name": "SSD",
        "timestamp": 1555144430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"5955\">@SSD</span> if you're available to chat/debug interactively sometime today, that might accelerate things; otherwise, I am definitely going to do my own test of the OS upgrade workflow for our documentation today in any case.</p>",
        "id": 732531,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1555178223
    },
    {
        "content": "<p>Hi, I installed Zulip on Ubuntu 20.04 then I configured the outgoing SMTP mail server setting and restarted the server. Now I face an Internal Server Error Message. I checked the error log file and here are the details. Would you please help me resolve this?</p>\n<p>2021-06-09 09:15:21.862 WARN [zerver.lib.push_notifications] Mobile push notifications are not configured.<br>\n  See <a href=\"https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html\">https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html</a><br>\n2021-06-09 06:18:02,087 ERROR zproject.wsgi get_wsgi_application() failed:<br>\nTraceback (most recent call last):<br>\n  File \"./zproject/wsgi.py\", line 34, in &lt;module&gt;<br>\n    application = get_wsgi_application()<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py\", line 12, in get_wsgi_application<br>\n    django.setup(set_prefix=False)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py\", line 19, in setup<br>\n    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 82, in __getattr__<br>\n    self._setup(name)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 69, in _setup<br>\n    self._wrapped = Settings(settings_module)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 170, in __init__<br>\n    mod = importlib.import_module(self.SETTINGS_MODULE)<br>\n  File \"/usr/lib/python3.8/importlib/__init__.py\", line 127, in import_module<br>\n    return _bootstrap._gcd_import(name[level:], package, level)<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 1014, in _gcd_import<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 991, in _find_and_load<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 975, in _find_and_load_unlocked<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 671, in _load_unlocked<br>\n  File \"&lt;frozen importlib._bootstrap_external&gt;\", line 783, in exec_module<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 219, in _call_with_frames_removed<br>\n  File \"./zproject/settings.py\", line 19, in &lt;module&gt;<br>\n    from .configured_settings import *  # noqa: F401,F403 isort: skip<br>\n  File \"./zproject/configured_settings.py\", line 8, in &lt;module&gt;<br>\n    from .default_settings import *  # noqa: F401,F403 isort: skip<br>\n  File \"./zproject/default_settings.py\", line 13, in &lt;module&gt;<br>\n    from .prod_settings import EXTERNAL_HOST, ZULIP_ADMINISTRATOR<br>\n  File \"./zproject/prod_settings.py\", line 61<br>\n    Outgoing email (SMTP) settings.<br>\n             ^<br>\nSyntaxError: invalid syntax<br>\n2021-06-09 06:21:15,364 ERROR zproject.wsgi get_wsgi_application() failed:<br>\nTraceback (most recent call last):<br>\n  File \"./zproject/wsgi.py\", line 34, in &lt;module&gt;<br>\n    application = get_wsgi_application()<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py\", line 12, in get_wsgi_application<br>\n    django.setup(set_prefix=False)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py\", line 19, in setup<br>\n    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 82, in __getattr__<br>\n    self._setup(name)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 69, in _setup<br>\n    self._wrapped = Settings(settings_module)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 170, in __init__<br>\n    mod = importlib.import_module(self.SETTINGS_MODULE)<br>\n  File \"/usr/lib/python3.8/importlib/__init__.py\", line 127, in import_module<br>\n    return _bootstrap._gcd_import(name[level:], package, level)<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 1014, in _gcd_import<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 991, in _find_and_load<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 975, in _find_and_load_unlocked<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 671, in _load_unlocked<br>\n  File \"&lt;frozen importlib._bootstrap_external&gt;\", line 783, in exec_module<br>\n  File \"&lt;frozen importlib._bootstrap&gt;\", line 219, in _call_with_frames_removed<br>\n  File \"./zproject/settings.py\", line 19, in &lt;module&gt;<br>\n    from .configured_settings import *  # noqa: F401,F403 isort: skip<br>\n  File \"./zproject/configured_settings.py\", line 8, in &lt;module&gt;<br>\n    from .default_settings import *  # noqa: F401,F403 isort: skip<br>\n  File \"./zproject/default_settings.py\", line 13, in &lt;module&gt;<br>\n    from .prod_settings import EXTERNAL_HOST, ZULIP_ADMINISTRATOR<br>\n  File \"./zproject/prod_settings.py\", line 61<br>\n    Outgoing email (SMTP) settings.<br>\n             ^<br>\nSyntaxError: invalid syntax<br>\n2021-06-09 06:36:05,387 ERROR zproject.wsgi get_wsgi_application() failed:<br>\nTraceback (most recent call last):<br>\n  File \"./zproject/wsgi.py\", line 34, in &lt;module&gt;<br>\n    application = get_wsgi_application()<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py\", line 12, in get_wsgi_application<br>\n    django.setup(set_prefix=False)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py\", line 19, in setup<br>\n    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 82, in __getattr__<br>\n    self._setup(name)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 69, in _setup<br>\n    self._wrapped = Settings(settings_module)<br>\n  File \"/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py\", line 170, in __init__<br>\n    mod = importlib.import_module(self.SETTINGS_MODULE)</p>",
        "id": 1204887,
        "sender_full_name": "amirreza ansari",
        "timestamp": 1623235724
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"9\" href=\"/#narrow/stream/9-issues/topic/Internal.20Server.20error\">#issues &gt; Internal Server error</a> by <span class=\"user-mention silent\" data-user-id=\"7\">Tim Abbott</span></p>",
        "id": 1205657,
        "sender_full_name": "Notification Bot",
        "timestamp": 1623283237
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20664\">@amirreza ansari</span> the problem is you seem to have removed the <code>#</code> comments before some of the documentation in the settings file, resulting in the format being invalid.</p>",
        "id": 1205658,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1623283273
    },
    {
        "content": "<p>Hello,<br>\nWe had just shutdown the server for a few minutes and then rebooted, the login screen shows, but when you press the login button it returns you to a page asking you to contact someone.</p>\n<p>The Page says \"<br>\nInternal server error<br>\n\"</p>\n<p>I ssh'ed into the server, and opened the log file, unfortunately it looks like there are alot of errors.</p>",
        "id": 1367967,
        "sender_full_name": "Josiah R",
        "timestamp": 1650061676
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"10349\">@Mateusz Mandera</span></p>",
        "id": 1367968,
        "sender_full_name": "Josiah R",
        "timestamp": 1650061714
    },
    {
        "content": "<p>Can you show the last ~50 lines of <code>/var/log/zulip/errors.log</code>?</p>",
        "id": 1367969,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650061822
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1367969\">said</a>:</p>\n<blockquote>\n<p>Can you show the last ~50 lines of <code>/var/log/zulip/errors.log</code>?</p>\n</blockquote>\n<p>sure, hold on..</p>",
        "id": 1367971,
        "sender_full_name": "Josiah R",
        "timestamp": 1650061835
    },
    {
        "content": "<blockquote>\n<blockquote>\n<blockquote>\n<p>Read 2648372 lines</p>\n</blockquote>\n</blockquote>\n</blockquote>",
        "id": 1367973,
        "sender_full_name": "Josiah R",
        "timestamp": 1650061893
    },
    {
        "content": "<p>You can show the last 50 lines of the file with:</p>\n<div class=\"codehilite\"><pre><span></span><code>tail -n50 /var/log/zulip/errors.log\n</code></pre></div>",
        "id": 1367978,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062009
    },
    {
        "content": "<p>oh! thanks, here it is:<br>\n2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>\n2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>\n2022-04-15 22:33:42.955 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...<br>\n2022-04-15 22:33:43.250 ERR  [pika.adapters.utils.io_services_utils] Socket failed to connect: &lt;socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 35832)&gt;; error=111 (Connection refused)<br>\n2022-04-15 22:33:43.251 ERR  [pika.adapters.utils.connection_workflow] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>\n2022-04-15 22:33:43.253 ERR  [pika.adapters.utils.connection_workflow] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>\n2022-04-15 22:33:43.257 ERR  [pika.adapters.utils.connection_workflow] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>\n2022-04-15 22:33:43.259 ERR  [pika.adapters.utils.connection_workflow] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-04-15 22:33:43.261 ERR  [pika.adapters.blocking_connection] Connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-04-15 22:33:43.265 ERR  [pika.adapters.blocking_connection] Error in _create_connection().<br>\nTraceback (most recent call last):<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py\", line 451, in _create_connection<br>\n    raise self._reap_last_connection_workflow_error(error)<br>\npika.exceptions.AMQPConnectionError<br>\n2022-04-15 22:33:43.284 ERR  [process_queue] Unhandled exception from queue: invites<br>\nTraceback (most recent call last):<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py\", line 24, in log_and_exit_if_exception<br>\n    yield<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py\", line 106, in handle<br>\n    worker.setup()<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/worker/queue_processors.py\", line 400, in setup<br>\n    self.q = SimpleQueueClient(prefetch=self.PREFETCH)<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py\", line 44, in __init__<br>\n    self._connect()<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py\", line 142, in _connect<br>\n    self.connection = pika.BlockingConnection(self._get_parameters())<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py\", line 360, in __init__<br>\n    self._impl = self._create_connection(parameters, _impl_class)<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py\", line 451, in _create_connection<br>\n    raise self._reap_last_connection_workflow_error(error)<br>\npika.exceptions.AMQPConnectionError<br>\nStack (most recent call last):<br>\n  File \"/home/zulip/deployments/current/manage.py\", line 157, in &lt;module&gt;<br>\n    execute_from_command_line(sys.argv)<br>\n  File \"/home/zulip/deployments/current/manage.py\", line 122, in execute_from_command_line<br>\n    utility.execute()<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py\", line 413, in execute<br>\n    self.fetch_command(subcommand).run_from_argv(self.argv)<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\", line 354, in run_from_argv<br>\n    self.execute(*args, **cmd_options)<br>\n  File \"/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py\", line 398, in execute<br>\n    output = self.handle(*args, **options)<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py\", line 111, in handle<br>\n    worker.start()<br>\n  File \"/usr/lib/python3.8/contextlib.py\", line 131, in __exit__<br>\n    self.gen.throw(type, value, traceback)<br>\n  File \"/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py\", line 26, in log_and_exit_if_exception<br>\n    logger.exception(\"Unhandled exception from queue: %s\", queue_name, stack_info=True)</p>",
        "id": 1367982,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062070
    },
    {
        "content": "<p>You can make that more readable by using code blocks:</p>\n<div class=\"codehilite\"><pre><span></span><code>```\nput the log lines here\n```\n</code></pre></div>",
        "id": 1367984,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062109
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None.\n2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None\n2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None\n2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None,)\n2022-04-15 22:33:42.955 CRIT [zulip.queue:9800] TornadoQueueClient couldn&#39;t connect to RabbitMQ, retrying in 2 secs...\n2022-04-15 22:33:43.250 ERR  [pika.adapters.utils.io_services_utils] Socket failed to connect: &lt;socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=(&#39;127.0.0.1&#39;, 35832)&gt;; error=111 (Connection refused)\n2022-04-15 22:33:43.251 ERR  [pika.adapters.utils.connection_workflow] TCP Connection attempt failed: ConnectionRefusedError(111, &#39;Connection refused&#39;); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, &#39;&#39;, (&#39;127.0.0.1&#39;, 5672))\n2022-04-15 22:33:43.253 ERR  [pika.adapters.utils.connection_workflow] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;)\n2022-04-15 22:33:43.257 ERR  [pika.adapters.utils.connection_workflow] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None.\n2022-04-15 22:33:43.259 ERR  [pika.adapters.utils.connection_workflow] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None\n2022-04-15 22:33:43.261 ERR  [pika.adapters.blocking_connection] Connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None\n2022-04-15 22:33:43.265 ERR  [pika.adapters.blocking_connection] Error in _create_connection().\nTraceback (most recent call last):\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 451, in _create_connection\n    raise self._reap_last_connection_workflow_error(error)\npika.exceptions.AMQPConnectionError\n2022-04-15 22:33:43.284 ERR  [process_queue] Unhandled exception from queue: invites\nTraceback (most recent call last):\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 24, in log_and_exit_if_exception\n    yield\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 106, in handle\n    worker.setup()\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/worker/queue_processors.py&quot;, line 400, in setup\n    self.q = SimpleQueueClient(prefetch=self.PREFETCH)\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py&quot;, line 44, in __init__\n    self._connect()\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py&quot;, line 142, in _connect\n    self.connection = pika.BlockingConnection(self._get_parameters())\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 360, in __init__\n    self._impl = self._create_connection(parameters, _impl_class)\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 451, in _create_connection\n    raise self._reap_last_connection_workflow_error(error)\npika.exceptions.AMQPConnectionError\nStack (most recent call last):\n  File &quot;/home/zulip/deployments/current/manage.py&quot;, line 157, in &lt;module&gt;\n    execute_from_command_line(sys.argv)\n  File &quot;/home/zulip/deployments/current/manage.py&quot;, line 122, in execute_from_command_line\n    utility.execute()\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py&quot;, line 413, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 354, in run_from_argv\n    self.execute(*args, **cmd_options)\n  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 398, in execute\n    output = self.handle(*args, **options)\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 111, in handle\n    worker.start()\n  File &quot;/usr/lib/python3.8/contextlib.py&quot;, line 131, in __exit__\n    self.gen.throw(type, value, traceback)\n  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 26, in log_and_exit_if_exception\n    logger.exception(&quot;Unhandled exception from queue: %s&quot;, queue_name, stack_info=True)\n</code></pre></div>",
        "id": 1367986,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062154
    },
    {
        "content": "<p>But it looks like the RabbitMQ server didn't come up cleanly.</p>\n<p>What version of Zulip are you running?  Did the hostname of the server change when you rebooted (i.e. is this in a VPS or similar situation where you get allocated a random hostname each time you reboot?)</p>",
        "id": 1367987,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062176
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1367987\">said</a>:</p>\n<blockquote>\n<p>But it looks like the RabbitMQ server didn't come up cleanly.</p>\n<p>What version of Zulip are you running?  Did the hostname of the server change when you rebooted (i.e. is this in a VPS or similar situation where you get allocated a random hostname each time you reboot?)</p>\n</blockquote>\n<p>Is there a command to pull up the version? No, it is a dedicated server, static ip and domain.. You can see here: <a href=\"http://chat.ehvengate.com\">chat.ehvengate.com</a>, that it runs, just when you go to login, it returns the error</p>",
        "id": 1367991,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062312
    },
    {
        "content": "<p>You can get the version from:</p>\n<div class=\"codehilite\"><pre><span></span><code>head -n5 /home/zulip/deployments/current/version.py\n</code></pre></div>",
        "id": 1367994,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062415
    },
    {
        "content": "<p>ZULIP_VERSION = \"5.1\"</p>",
        "id": 1367995,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062444
    },
    {
        "content": "<p>OK, great.</p>\n<p>What does this show:</p>\n<div class=\"codehilite\"><pre><span></span><code>service rabbitmq-server status\n</code></pre></div>",
        "id": 1367997,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062458
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>root@chat:~# service rabbitmq-server status\n● rabbitmq-server.service - RabbitMQ Messaging Server\n     Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)\n     Active: activating (start) since Fri 2022-04-15 22:41:04 UTC; 3s ago\n   Main PID: 1626535 (rabbitmq-server)\n      Tasks: 89 (limit: 4599)\n     Memory: 39.8M\n     CGroup: /system.slice/rabbitmq-server.service\n             ├─1626535 /bin/sh /usr/sbin/rabbitmq-server\n             ├─1626548 /usr/lib/erlang/erts-10.6.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -MBlmbcs 512 -&gt;\n             └─1626832 erl_child_setup 65536\n\nApr 15 22:41:04 chat systemd[1]: rabbitmq-server.service: Scheduled restart job, restart counter is at 3930.\nApr 15 22:41:04 chat systemd[1]: Stopped RabbitMQ Messaging Server.\nApr 15 22:41:04 chat systemd[1]: Starting RabbitMQ Messaging Server...\nlines 1-14/14 (END)\n</code></pre></div>",
        "id": 1367998,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062509
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"12178\">@Alex Vandiver</span></p>",
        "id": 1368001,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062619
    },
    {
        "content": "<p>No need to @ me, I'm following along.</p>",
        "id": 1368002,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062632
    },
    {
        "content": "<p>Let's see if rabbitmq will tell us more about why it's rebooting:</p>\n<div class=\"codehilite\"><pre><span></span><code>rabbitmqctl status\n</code></pre></div>",
        "id": 1368003,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062657
    },
    {
        "content": "<p>Thanks, I am kind of nervous, I've got some people waiting on  me... I really appreciate your time:</p>\n<div class=\"codehilite\"><pre><span></span><code>Error: unable to perform an operation on node &#39;zulip@localhost&#39;. Please see diagnostics information and suggestions below.\n\nMost common reasons for this are:\n\n * Target node is unreachable (e.g. due to hostname resolution, TCP connection or firewall issues)\n * CLI tool fails to authenticate with the server (e.g. due to CLI tool&#39;s Erlang cookie not matching that of the server)\n * Target node is not running\n\nIn addition to the diagnostics info below:\n\n * See the CLI, clustering and networking guides on https://rabbitmq.com/documentation.html to learn more\n * Consult server logs on node zulip@localhost\n * If target node is configured to use long node names, don&#39;t forget to use --longnames with CLI tools\n\nDIAGNOSTICS\n===========\n\nattempted to contact: [zulip@localhost]\n\nzulip@localhost:\n  * connected to epmd (port 4369) on localhost\n  * epmd reports: node &#39;zulip&#39; not running at all\n                  no other nodes on localhost\n  * suggestion: start the node\n\nCurrent node details:\n * node name: &#39;rabbitmqcli-1630253-zulip@localhost&#39;\n * effective user&#39;s home directory: /var/lib/rabbitmq\n * Erlang cookie hash: LvrGBZIuQRyeeKxBDuFavw==\n</code></pre></div>",
        "id": 1368007,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062736
    },
    {
        "content": "<p>Let's check the rabbitmq logs:</p>\n<div class=\"codehilite\"><pre><span></span><code>tail -n50 /var/log/rabbitmq/zulip@localhost.log\n</code></pre></div>",
        "id": 1368009,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062830
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>2022-04-15 22:47:08.055 [info] &lt;0.43.0&gt; Application ranch exited with reason: stopped\n2022-04-15 22:47:08.057 [info] &lt;0.43.0&gt; Application observer_cli exited with reason: stopped\n2022-04-15 22:47:08.058 [info] &lt;0.43.0&gt; Application sysmon_handler exited with reason: stopped\n2022-04-15 22:47:08.062 [info] &lt;0.43.0&gt; Application os_mon exited with reason: stopped\n2022-04-15 22:47:08.065 [info] &lt;0.43.0&gt; Application credentials_obfuscation exited with reason: stopped\n2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application ssl exited with reason: stopped\n2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application public_key exited with reason: stopped\n2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application asn1 exited with reason: stopped\n2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application recon exited with reason: stopped\n2022-04-15 22:47:08.123 [info] &lt;0.43.0&gt; Application mnesia exited with reason: stopped\n2022-04-15 22:47:08.127 [info] &lt;0.43.0&gt; Application inets exited with reason: stopped\n2022-04-15 22:47:08.127 [info] &lt;0.43.0&gt; Application stdout_formatter exited with reason: stopped\n2022-04-15 22:47:08.128 [info] &lt;0.43.0&gt; Application crypto exited with reason: stopped\n2022-04-15 22:47:08.128 [info] &lt;0.43.0&gt; Application jsx exited with reason: stopped\n2022-04-15 22:47:08.128 [error] &lt;0.8.0&gt;\nError description:\n    init:do_boot/3\n    init:start_em/1\n    rabbit:start_it/1 line 474\n    rabbit:broker_start/1 line 350\n    rabbit:start_loaded_apps/2 line 600\n    app_utils:manage_applications/6 line 126\n    lists:foldl/3 line 1263\n    rabbit:&#39;-handle_app_error/1-fun-0-&#39;/3 line 723\nthrow:{could_not_start,ra,\n       {ra,\n        {{shutdown,\n          {failed_to_start_child,ra_system_sup,\n           {shutdown,\n            {failed_to_start_child,ra_log_sup,\n             {shutdown,\n              {failed_to_start_child,ra_log_wal_sup,\n               {shutdown,\n                {failed_to_start_child,ra_log_wal,\n                 {{case_clause,{ok,&lt;&lt;&gt;&gt;}},\n                  [{ra_log_wal,open_existing,1,\n                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,646}]},\n                   {ra_log_wal,&#39;-recover_wal/2-lc$^0/1-0-&#39;,1,\n                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,265}]},\n                   {ra_log_wal,recover_wal,2,\n                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,268}]},\n                   {ra_log_wal,init,1,\n                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,214}]},\n                   {gen_batch_server,init_it,6,\n                    [{file,&quot;src/gen_batch_server.erl&quot;},{line,133}]},\n                   {proc_lib,init_p_do_apply,3,\n                    [{file,&quot;proc_lib.erl&quot;},{line,249}]}]}}}}...\nLog file(s) (may contain more information):\n   /var/log/rabbitmq/zulip@localhost.log\n   /var/log/rabbitmq/zulip@localhost_upgrade.log\n</code></pre></div>",
        "id": 1368010,
        "sender_full_name": "Josiah R",
        "timestamp": 1650062876
    },
    {
        "content": "<p>You may need to try a large value to <code>-n</code> to see if you can see something that looks more like the <em>reason</em> it's restarting.</p>",
        "id": 1368011,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062922
    },
    {
        "content": "<p>One possibility -- do you have free disk space:</p>\n<div class=\"codehilite\"><pre><span></span><code>df -h\n</code></pre></div>",
        "id": 1368013,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650062968
    },
    {
        "content": "<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>\n<div class=\"codehilite\"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on\nudev                               1.9G     0  1.9G   0% /dev\ntmpfs                              393M  1.4M  391M   1% /run\n/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /\ntmpfs                              2.0G  204K  2.0G   1% /dev/shm\ntmpfs                              5.0M     0  5.0M   0% /run/lock\ntmpfs                              2.0G     0  2.0G   0% /sys/fs/cgroup\n/dev/loop2                          62M   62M     0 100% /snap/core20/1405\n/dev/loop0                          62M   62M     0 100% /snap/core20/1328\n/dev/loop1                          68M   68M     0 100% /snap/lxd/22753\n/dev/loop3                          44M   44M     0 100% /snap/snapd/14978\n/dev/loop4                          44M   44M     0 100% /snap/snapd/15177\n/dev/loop5                          68M   68M     0 100% /snap/lxd/21835\n/dev/sda2                          1.5G  209M  1.2G  16% /boot\ntmpfs                              393M     0  393M   0% /run/user/1000\n</code></pre></div>",
        "id": 1368015,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063055
    },
    {
        "content": "<p>Yup, that's fine.</p>",
        "id": 1368017,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063111
    },
    {
        "content": "<p>Was this a sudden reboot, or a graceful one?  It's possible that the rabbitmq database got corrupted.</p>",
        "id": 1368019,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063129
    },
    {
        "content": "<p>We run a once a year graceful reboot on all of our machines, as a way to, clean, repair parts, clear extra cache, ect</p>",
        "id": 1368026,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063243
    },
    {
        "content": "<p>it worked just fine last year</p>",
        "id": 1368027,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063252
    },
    {
        "content": "<p>how would we check if the database was corrupted?</p>",
        "id": 1368031,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063305
    },
    {
        "content": "<p>and if it was, does that mean that we cannot transfer anything to a different server? is that the database that stores the messages, ect?</p>",
        "id": 1368035,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063369
    },
    {
        "content": "<p>I'm making assumptions based on the <code>/var/log/rabbitmq/zulip@localhost.log</code> output you pasted above.</p>",
        "id": 1368036,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063369
    },
    {
        "content": "<p>No, the rabbitmq database isn't the main database for Zulip.  If we have to recreate it, you won't lose any messages or anything.</p>",
        "id": 1368037,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063394
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368037\">said</a>:</p>\n<blockquote>\n<p>No, the rabbitmq database isn't the main database for Zulip.  If we have to recreate it, you won't lose any messages or anything.</p>\n</blockquote>\n<p>would it hurt the system to try and recreate it?</p>",
        "id": 1368039,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063422
    },
    {
        "content": "<p>Shouldn't, but it won't necessarily solve the problem.  Let's give it a try:</p>\n<div class=\"codehilite\"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server\nservice rabbitmq-server stop\nrm -rf /var/lib/rabbitmq/mnesia/\nservice rabbitmq-server start\n~zulip/deployments/current/scripts/setup/configure-rabbitmq\nsudo -u zulip ~zulip/deployments/current/scripts/start-server\n</code></pre></div>",
        "id": 1368043,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063492
    },
    {
        "content": "<p>It Worked!</p>",
        "id": 1368047,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063642
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"23556\">Josiah R</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368015\">said</a>:</p>\n<blockquote>\n<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>\n</blockquote>\n<p>For reference, it looks like it only has 100G in its main disk:</p>\n<div class=\"codehilite\"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on\n/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /\n</code></pre></div>\n<p>Which is fine, as 82G of it is unused, just correcting this statement.</p>",
        "id": 1368048,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063654
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"23556\">@Josiah R</span>: OK, that means that the server wasn't actually cleanly shut down.</p>",
        "id": 1368049,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063668
    },
    {
        "content": "<p>its back up and running, thanks for your time.</p>",
        "id": 1368050,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063669
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368049\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"23556\">Josiah R</span>: OK, that means that the server wasn't actually cleanly shut down.</p>\n</blockquote>\n<p>it was shutdown by a technician, so could it have been something else?</p>",
        "id": 1368052,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063715
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368048\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"23556\">Josiah R</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368015\">said</a>:</p>\n<blockquote>\n<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>\n</blockquote>\n<p>For reference, it looks like it only has 100G in its main disk:</p>\n<div class=\"codehilite\"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on\n/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /\n</code></pre></div>\n<p>Which is fine, as 82G of it is unused, just correcting this statement.</p>\n</blockquote>\n<p>that is intresting, I wounder where the other 400 GB's went?</p>",
        "id": 1368055,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063759
    },
    {
        "content": "<p>It can always be stray cosmic rays, but I suspect you can scroll back through the <code>/var/log/rabbitmq/zulip@localhost.log</code> and see where the trouble started.  It's likely it won't have orderly shutdown messages before the errors start.</p>",
        "id": 1368057,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063770
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368057\">said</a>:</p>\n<blockquote>\n<p>It can always be stray cosmic rays, but I suspect you can scroll back through the <code>/var/log/rabbitmq/zulip@localhost.log</code> and see where the trouble started.  It's likely it won't have orderly shutdown messages before the errors start.</p>\n</blockquote>\n<p>ok, thanks</p>",
        "id": 1368059,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063801
    },
    {
        "content": "<p>But it'd be good to know if you can see anything in that area.  This is the second report we've gotten of rabbitmq database corruption recently, so digging a little deeper into the logs would be appreciated.</p>",
        "id": 1368060,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650063810
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368060\">said</a>:</p>\n<blockquote>\n<p>But it'd be good to know if you can see anything in that area.  This is the second report we've gotten of rabbitmq database corruption recently, so digging a little deeper into the logs would be appreciated.</p>\n</blockquote>\n<p>ok, how could I do that without holding the down button for about 15 minutes?</p>",
        "id": 1368074,
        "sender_full_name": "Josiah R",
        "timestamp": 1650063874
    },
    {
        "content": "<p>You can run:</p>\n<div class=\"codehilite\"><pre><span></span><code>less /var/log/rabbitmq/zulip@localhost.log\n</code></pre></div>\n<p>Then, you can use pageup / pagedown.  Though what I'd suggest is typing <code>/</code>, which lets you search in the file.  Then type the date that the trouble started (<code>2022-04-15</code>, or earlier if it didn't start today), and press enter; that will jump to the first line that matches that.  You should be able to scroll around that more easily.</p>",
        "id": 1368076,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064012
    },
    {
        "content": "<p>looking through the file, it seems that it would keep restarting, and clossing connections unexpectedly</p>",
        "id": 1368084,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064277
    },
    {
        "content": "<p>just that part of the file is too big to put into one message, so if you want, I can slit it up into multiple messages.</p>",
        "id": 1368086,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064328
    },
    {
        "content": "<p>Yup.  What we want to know is what the logs say right at the cusp of when it <em>started</em> doing that.</p>",
        "id": 1368088,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064374
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>2022-04-11 15:41:20.378 [info] &lt;0.662.0&gt; connection &lt;0.662.0&gt; (127.0.0.1:39684 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-11 15:41:23.717 [info] &lt;0.674.0&gt; accepting AMQP connection &lt;0.674.0&gt; (127.0.0.1:39692 -&gt; 127.0.0.1:5672)\n2022-04-11 15:41:23.720 [info] &lt;0.674.0&gt; connection &lt;0.674.0&gt; (127.0.0.1:39692 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-11 15:41:38.889 [info] &lt;0.698.0&gt; accepting AMQP connection &lt;0.698.0&gt; (127.0.0.1:39706 -&gt; 127.0.0.1:5672)\n2022-04-11 15:41:38.892 [info] &lt;0.698.0&gt; connection &lt;0.698.0&gt; (127.0.0.1:39706 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-11 15:41:39.190 [info] &lt;0.708.0&gt; accepting AMQP connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672)\n2022-04-11 15:41:39.192 [info] &lt;0.708.0&gt; connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-11 15:42:19.862 [warning] &lt;0.611.0&gt; closing AMQP connection &lt;0.611.0&gt; (127.0.0.1:39666 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):\nclient unexpectedly closed TCP connection\n2022-04-11 15:42:20.222 [warning] &lt;0.562.0&gt; closing AMQP connection &lt;0.562.0&gt; (127.0.0.1:39642 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):\nclient unexpectedly closed TCP connection\n2022-04-11 15:42:20.354 [warning] &lt;0.544.0&gt; closing AMQP connection &lt;0.544.0&gt; (127.0.0.1:39632 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):\nclient unexpectedly closed TCP connection\n2022-04-11 15:42:20.379 [warning] &lt;0.589.0&gt; closing AMQP connection &lt;0.589.0&gt; (127.0.0.1:39652 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):\nclient unexpectedly closed TCP connection\n2022-04-11 15:42:20.418 [warning] &lt;0.662.0&gt; closing AMQP connection &lt;0.662.0&gt; (127.0.0.1:39684 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):\nclient unexpectedly closed TCP connection\n</code></pre></div>",
        "id": 1368089,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064395
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>2022-04-11 15:42:26.422 [info] &lt;0.64.0&gt; SIGTERM received - shutting down\n2022-04-11 15:42:26.422 [info] &lt;0.323.0&gt; Peer discovery backend rabbit_peer_discovery_classic_config does not support registration, skipping unregistration.\n2022-04-11 15:42:26.423 [info] &lt;0.513.0&gt; stopped TCP listener on 127.0.0.1:5672\n2022-04-11 15:42:26.428 [error] &lt;0.708.0&gt; Error on AMQP connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 15:42:26.429 [info] &lt;0.401.0&gt; Closing all connections in vhost &#39;/&#39; on node &#39;zulip@localhost&#39; because the vhost is stopping\n2022-04-11 15:42:26.678 [info] &lt;0.416.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39;\n2022-04-11 15:42:26.735 [info] &lt;0.416.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39; is stopped\n2022-04-11 15:42:26.735 [info] &lt;0.413.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39;\n2022-04-11 15:42:26.852 [info] &lt;0.413.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39; is stopped\n2022-04-11 15:45:25.777 [info] &lt;0.8.0&gt; Log file opened with Lager\n2022-04-11 15:45:37.820 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:\n2022-04-11 15:45:37.820 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings\n2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue\n2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata\n2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes\n2022-04-11 15:45:38.314 [info] &lt;0.298.0&gt; ra: meta data store initialised. 0 record(s) recovered\n2022-04-11 15:45:38.315 [info] &lt;0.313.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000004.wal&quot;]\n2022-04-11 15:45:38.405 [info] &lt;0.317.0&gt;\n</code></pre></div>",
        "id": 1368090,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064434
    },
    {
        "content": "<p>That's pretty normal.  What we care about is what happens between then and the first line which has <code>error</code> on it.</p>",
        "id": 1368091,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064438
    },
    {
        "content": "<p>this is when it shut down</p>",
        "id": 1368092,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064446
    },
    {
        "content": "<p>Yeah, that's not an orderly shutdown</p>",
        "id": 1368093,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064487
    },
    {
        "content": "<p>ok, here you are:</p>\n<div class=\"codehilite\"><pre><span></span><code>2022-04-11 19:05:01.771 [info] &lt;0.64.0&gt; SIGTERM received - shutting down\n2022-04-11 19:05:01.870 [info] &lt;0.330.0&gt; Peer discovery backend rabbit_peer_discovery_classic_config does not support registration, skipping unregistration.\n2022-04-11 19:05:01.936 [info] &lt;0.503.0&gt; stopped TCP listener on 127.0.0.1:5672\n2022-04-11 19:05:01.964 [error] &lt;0.620.0&gt; Error on AMQP connection &lt;0.620.0&gt; (127.0.0.1:35760 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.964 [error] &lt;0.528.0&gt; Error on AMQP connection &lt;0.528.0&gt; (127.0.0.1:35718 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.964 [error] &lt;0.663.0&gt; Error on AMQP connection &lt;0.663.0&gt; (127.0.0.1:35780 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.964 [error] &lt;0.538.0&gt; Error on AMQP connection &lt;0.538.0&gt; (127.0.0.1:35722 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.964 [error] &lt;0.799.0&gt; Error on AMQP connection &lt;0.799.0&gt; (127.0.0.1:35804 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.964 [error] &lt;0.557.0&gt; Error on AMQP connection &lt;0.557.0&gt; (127.0.0.1:35732 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.548.0&gt; Error on AMQP connection &lt;0.548.0&gt; (127.0.0.1:35728 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.575.0&gt; Error on AMQP connection &lt;0.575.0&gt; (127.0.0.1:35740 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.611.0&gt; Error on AMQP connection &lt;0.611.0&gt; (127.0.0.1:35756 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.1685.0&gt; Error on AMQP connection &lt;0.1685.0&gt; (127.0.0.1:35820 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.2188.0&gt; Error on AMQP connection &lt;0.2188.0&gt; (127.0.0.1:35828 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.966 [error] &lt;0.638.0&gt; Error on AMQP connection &lt;0.638.0&gt; (127.0.0.1:35768 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.966 [error] &lt;0.629.0&gt; Error on AMQP connection &lt;0.629.0&gt; (127.0.0.1:35764 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.566.0&gt; Error on AMQP connection &lt;0.566.0&gt; (127.0.0.1:35736 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.513.0&gt; Error on AMQP connection &lt;0.513.0&gt; (127.0.0.1:35710 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:01.965 [error] &lt;0.2769.0&gt; Error on AMQP connection &lt;0.2769.0&gt; (127.0.0.1:35854 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:\n operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n</code></pre></div>\n<p>little farther down in the file</p>",
        "id": 1368094,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064519
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;\n2022-04-11 19:05:06.965 [error] &lt;0.592.0&gt; ** Generic server &lt;0.592.0&gt; terminating\n** Last message in was {&#39;EXIT&#39;,&lt;0.591.0&gt;,killed}\n** When Server state == {state,{&lt;0.592.0&gt;,rabbit_connection_helper_sup},one_for_one,[{child,&lt;0.599.0&gt;,channel_sup_sup,{rabbit_channel_sup_sup,start_link,[]},intrinsic,infinity,supervisor,[rabbit_channel_sup_sup]},{child,&lt;0.597.0&gt;,collec&gt;** Reason for termination ==\n** killed\n2022-04-11 19:05:06.965 [error] &lt;0.592.0&gt; CRASH REPORT Process &lt;0.592.0&gt; with 0 neighbours exited with reason: killed in gen_server:decode_msg/9 line 432\n2022-04-11 19:05:07.018 [info] &lt;0.391.0&gt; Closing all connections in vhost &#39;/&#39; on node &#39;zulip@localhost&#39; because the vhost is stopping\n2022-04-11 19:05:07.509 [error] &lt;0.593.0&gt; Error on AMQP connection &lt;0.593.0&gt; (127.0.0.1:35750 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 1:error while terminating:\nshutdown\n2022-04-11 19:05:07.509 [warning] &lt;0.391.0&gt; Could not close connection &lt;0.593.0&gt;: {{noproc,{gen_server,call,[&lt;0.597.0&gt;,delete_all,infinity]}},{gen_server,call,[&lt;0.593.0&gt;,{shutdown,&quot;vhost &#39;/&#39; is down&quot;},infinity]}}\n2022-04-11 19:05:07.509 [error] &lt;0.593.0&gt; CRASH REPORT Process &lt;0.593.0&gt; with 0 neighbours exited with reason: no such process or port in call to gen_server:call(&lt;0.597.0&gt;, delete_all, infinity) in gen_server:call/3 line 223\n2022-04-11 19:05:07.538 [info] &lt;0.406.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39;\n2022-04-11 19:05:08.171 [info] &lt;0.406.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39; is stopped\n2022-04-11 19:05:08.171 [info] &lt;0.403.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39;\n2022-04-11 19:05:09.355 [info] &lt;0.403.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39; is stopped\n2022-04-11 19:06:38.117 [info] &lt;0.8.0&gt; Log file opened with Lager\n2022-04-11 19:06:50.265 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:\n2022-04-11 19:06:50.265 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings\n2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue\n2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata\n2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes\n2022-04-11 19:06:50.888 [info] &lt;0.299.0&gt; ra: meta data store initialised. 0 record(s) recovered\n2022-04-11 19:06:50.889 [info] &lt;0.313.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000006.wal&quot;]\n2022-04-11 19:06:50.946 [info] &lt;0.323.0&gt;\n</code></pre></div>",
        "id": 1368096,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064570
    },
    {
        "content": "<p>Let me digest that a little.</p>\n<p>When you say \"it was shutdown by a technician\" what technique did they use to shut it down?</p>",
        "id": 1368100,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064721
    },
    {
        "content": "<p>And does <code>2022-04-11 19:05:06</code> match when you think the host was shut down (in UTC)?</p>",
        "id": 1368101,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064741
    },
    {
        "content": "<p>used the zulip shutdown command you gave me, then shutdown ubuntu</p>",
        "id": 1368102,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064764
    },
    {
        "content": "<p>OK, and when you shutdown ubuntu, how did that happen?</p>",
        "id": 1368103,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650064788
    },
    {
        "content": "<p>systemctl shutdown</p>",
        "id": 1368108,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064918
    },
    {
        "content": "<p>it ran through its normal process of shutting down all the packages and other things</p>",
        "id": 1368109,
        "sender_full_name": "Josiah R",
        "timestamp": 1650064952
    },
    {
        "content": "<p>as to your later message.. not sure what you mean</p>",
        "id": 1368113,
        "sender_full_name": "Josiah R",
        "timestamp": 1650065119
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368101\">said</a>:</p>\n<blockquote>\n<p>And does <code>2022-04-11 19:05:06</code> match when you think the host was shut down (in UTC)?</p>\n</blockquote>\n<p>I think so</p>",
        "id": 1368114,
        "sender_full_name": "Josiah R",
        "timestamp": 1650065221
    },
    {
        "content": "<p>The timestamps for the section of the rabbitmq log we're looking at are <code>2022-04-11 19:05:06</code>.   That time is given in UTC (the time in Greenwich, England, roughly -- pedants, don't @ me).</p>\n<p>The question is if these error messages line up with the time that you shut the machine off, or if they're from some other event.   So I was asking you if <code>2022-04-11 19:05:06 UTC</code> matches when you believe the host was restarted.</p>",
        "id": 1368115,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065271
    },
    {
        "content": "<p>Ah, OK.</p>",
        "id": 1368116,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065276
    },
    {
        "content": "<p>how can I download the log file to my local machine using ssh? then I can just send it to you</p>",
        "id": 1368118,
        "sender_full_name": "Josiah R",
        "timestamp": 1650065337
    },
    {
        "content": "<p><a href=\"https://linux.die.net/man/1/scp\">scp</a>:</p>\n<div class=\"codehilite\"><pre><span></span><code>scp username@hostname:/path/to/file /path/to/local/file\n</code></pre></div>",
        "id": 1368121,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065456
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>scp: /var/log/rabbitmq/zulip@localhost.log: Permission denied\n</code></pre></div>",
        "id": 1368126,
        "sender_full_name": "Josiah R",
        "timestamp": 1650065745
    },
    {
        "content": "<p>do I need to be logged into the server?</p>",
        "id": 1368132,
        "sender_full_name": "Josiah R",
        "timestamp": 1650065792
    },
    {
        "content": "<p>No, it's likely that you're connecting as a non-<code>root</code> user, which doesn't have read access to the logfile.</p>",
        "id": 1368133,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065846
    },
    {
        "content": "<p>I do <em>not</em> suggest fixing this by adjusting the file's permissions.</p>",
        "id": 1368136,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065861
    },
    {
        "content": "<p>As root, you can make a copy which you make readable by your user:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>sudo -i\ncp /var/log/rabbitmq/zulip@localhost.log ~username/rabbitmq.log\nchown username ~username/rabbitmq.log\n</code></pre></div>",
        "id": 1368139,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650065935
    },
    {
        "content": "<p>I got it. I wonder why the other way didn't work, I am root...<br>\nits uploading...</p>",
        "id": 1368150,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066292
    },
    {
        "content": "<p><a href=\"/user_uploads/2/ba/4vTmBDEkbMvJk8nXE0Xj1Kvo/rabbitmq.zip\">rabbitmq.zip</a></p>",
        "id": 1368153,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066363
    },
    {
        "content": "<p>here it is</p>",
        "id": 1368154,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066367
    },
    {
        "content": "<p>If i wanted to become a zulip developer, on the team, what would I have to do?</p>",
        "id": 1368160,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066700
    },
    {
        "content": "<p>Thanks!</p>\n<p>OK, so this gap right here is when it was shut down so abruptly that it didn't log anything about the shutdown:</p>\n<div class=\"codehilite\"><pre><span></span><code>2022-04-13 23:35:14.881 [info] &lt;0.299.6&gt; accepting AMQP connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672)\n2022-04-13 23:35:14.884 [info] &lt;0.299.6&gt; connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-14 12:43:32.796 [info] &lt;0.17025.7&gt; accepting AMQP connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672)\n2022-04-14 12:43:32.908 [info] &lt;0.17025.7&gt; connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n2022-04-14 17:11:45.096 [info] &lt;0.1101.8&gt; accepting AMQP connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672)\n2022-04-14 17:11:45.106 [info] &lt;0.1101.8&gt; connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;\n---------------------------- here --------------------------\n2022-04-14 19:31:59.900 [info] &lt;0.8.0&gt; Log file opened with Lager\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes\n2022-04-14 19:32:12.724 [info] &lt;0.192.0&gt; disk_log: repairing &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/DECISION_TAB.LOG&quot; ...\n2022-04-14 19:32:12.953 [info] &lt;0.308.0&gt; ra: meta data store initialised. 0 record(s) recovered\n2022-04-14 19:32:12.955 [info] &lt;0.323.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000008.wal&quot;]\n2022-04-14 19:32:12.955 [error] &lt;0.322.0&gt; Supervisor ra_log_wal_sup had child ra_log_wal started with ra_log_wal:start_link(#{compute_checksums =&gt; true,dir =&gt; &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@local...&quot;,...}, [{max_batch_size,32768}]) at undefined exit with reason no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in context start_error\n2022-04-14 19:32:12.955 [error] &lt;0.323.0&gt; CRASH REPORT Process &lt;0.323.0&gt; with 0 neighbours exited with reason: no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in gen_batch_server:init_it/6 line 165\n</code></pre></div>",
        "id": 1368161,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650066701
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368161\">said</a>:</p>\n<blockquote>\n<p>Thanks!</p>\n<p>OK, so this gap right here is when it was shut down so abruptly that it didn't log anything about the shutdown:</p>\n<p><div class=\"codehilite\"><pre><span></span><code>2022-04-13 23:35:14.881 [info] &lt;0.299.6&gt; accepting AMQP connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672)\n2022-04-13 23:35:14.884 [info] &lt;0.299.6&gt; connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost\n&#39;/&#39;\n2022-04-14 12:43:32.796 [info] &lt;0.17025.7&gt; accepting AMQP connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672)\n2022-04-14 12:43:32.908 [info] &lt;0.17025.7&gt; connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vh\nost &#39;/&#39;\n2022-04-14 17:11:45.096 [info] &lt;0.1101.8&gt; accepting AMQP connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672)\n2022-04-14 17:11:45.106 [info] &lt;0.1101.8&gt; connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhos\nt &#39;/&#39;\n2022-04-14 19:31:59.900 [info] &lt;0.8.0&gt; Log file opened with Lager\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata\n2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes\n2022-04-14 19:32:12.724 [info] &lt;0.192.0&gt; disk_log: repairing &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/DECISION_TAB.LOG&quot; ...\n2022-04-14 19:32:12.953 [info] &lt;0.308.0&gt; ra: meta data store initialised. 0 record(s) recovered\n2022-04-14 19:32:12.955 [info] &lt;0.323.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000008.wal&quot;]\n2022-04-14 19:32:12.955 [error] &lt;0.322.0&gt; Supervisor ra_log_wal_sup had child ra_log_wal started with ra_log_wal:start_link(#{compute_checksums =&gt; true,di\nr =&gt; &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@local...&quot;,...}, [{max_batch_size,32768}]) at undefined exit with reason no case clause matchin\ng {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in context start_error\n2022-04-14 19:32:12.955 [error] &lt;0.323.0&gt; CRASH REPORT Process &lt;0.323.0&gt; with 0 neighbours exited with reason: no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log\n_wal:open_existing/1 line 646 in gen_batch_server:init_it/6 line 165\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>interesting, we'll have to be more careful about that in the future</p>",
        "id": 1368162,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066767
    },
    {
        "content": "<p>You can possibly go digging in the system logs (e.g. <code>/var/log/syslog</code>) at that same time to see if the whole system was shut down uncleanly, or if it somehow just killed rabbitmq uncleanly.</p>",
        "id": 1368163,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650066848
    },
    {
        "content": "<p>What would I have to know/do to become a part of the zulip team? I know some python, and nodejs have been working in html, css, js for over 4 years</p>",
        "id": 1368164,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066850
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368163\">said</a>:</p>\n<blockquote>\n<p>You can possibly go digging in the system logs (e.g. <code>/var/log/syslog</code>) at that same time to see if the whole system was shut down uncleanly, or if it somehow just killed rabbitmq uncleanly.</p>\n</blockquote>\n<p>ok</p>",
        "id": 1368165,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066883
    },
    {
        "content": "<p><a href=\"https://zulip.readthedocs.io/en/latest/overview/contributing.html\">https://zulip.readthedocs.io/en/latest/overview/contributing.html</a> is a great place to get started.</p>",
        "id": 1368166,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650066885
    },
    {
        "content": "<p>I'm going to mark this as resolved, but don't hesitate to start another topic if you run into other problems or have other questions.</p>",
        "id": 1368167,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1650066904
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368167\">said</a>:</p>\n<blockquote>\n<p>I'm going to mark this as resolved, but don't hesitate to start another topic if you run into other problems or have other questions.</p>\n</blockquote>\n<p>ok, Thanks</p>",
        "id": 1368169,
        "sender_full_name": "Josiah R",
        "timestamp": 1650066929
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> has marked this topic as resolved.</p>",
        "id": 1368171,
        "sender_full_name": "Notification Bot",
        "timestamp": 1650066967
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption/near/1368043\">said</a>:</p>\n<blockquote>\n<p>Shouldn't, but it won't necessarily solve the problem.  Let's give it a try:</p>\n<p><div class=\"codehilite\"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server\nservice rabbitmq-server stop\nrm -rf /var/lib/rabbitmq/mnesia/\nservice rabbitmq-server start\n~zulip/deployments/current/scripts/setup/configure-rabbitmq\nsudo -u zulip ~zulip/deployments/current/scripts/start-server\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>Out of curiosity, what was the reason for <code>rm -rf /var/lib/rabbitmq/mnesia/</code>? (the other steps are much more obvious, this one looks a bit mysterious <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span> )</p>",
        "id": 1368372,
        "sender_full_name": "Mateusz Mandera",
        "timestamp": 1650110746
    },
    {
        "content": "<p>That directory is the RabbitMQ database, so deleting it is a way to reset the RabbitMQ state fully.</p>",
        "id": 1368414,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1650126032
    },
    {
        "content": "<p>Ah, makes sense</p>",
        "id": 1368473,
        "sender_full_name": "Mateusz Mandera",
        "timestamp": 1650138023
    },
    {
        "content": "<p>hii</p>",
        "id": 1392395,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655205882
    },
    {
        "content": "<p>hii</p>",
        "id": 1392400,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655206070
    },
    {
        "content": "<p>i just restart the server than error is coming Internal server error</p>",
        "id": 1392401,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655206085
    },
    {
        "content": "<p>can any one help</p>",
        "id": 1392402,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655206204
    },
    {
        "content": "<p>hi</p>",
        "id": 1392403,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655206983
    },
    {
        "content": "<p>Internal server error</p>",
        "id": 1392404,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655206986
    },
    {
        "content": "<p>hi</p>",
        "id": 1392405,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655207262
    },
    {
        "content": "<p>hii</p>",
        "id": 1392406,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655207647
    },
    {
        "content": "<p>hii</p>",
        "id": 1392407,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655207672
    },
    {
        "content": "<p>Internal server error</p>",
        "id": 1392408,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655207679
    },
    {
        "content": "<p>hii</p>",
        "id": 1392415,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655212098
    },
    {
        "content": "<p>This Zulip server is currently experiencing some technical difficulties. Sorry about that!</p>",
        "id": 1392416,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655212100
    },
    {
        "content": "<p>can any one please help here</p>",
        "id": 1392417,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655212115
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"24295\">@Azure IT Support</span>: I have moved all of your messages here, to one stream and topic.</p>\n<p>Please read our <a href=\"https://zulip.com/development-community/\">community guidelines</a> -- posting to a bunch of random topic is not the right way to get help -- posting to a single topic with as many relevant details as you have, is.  And help may not be immediate -- folks are in different time zones (I only just woke up) and may not be around to help.</p>",
        "id": 1392510,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655228231
    },
    {
        "content": "<p>You should log in via SSH to your server, and look at the last lines from <code>/var/log/zulip/errors.log</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>tail -n 100 /var/log/zulip/errors.log\n</code></pre></div>",
        "id": 1392513,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655228300
    },
    {
        "content": "<p>2022-06-15 03:57:46.015 WARN [zulip.queue:9800] TornadoQueueClient attempting to reconnect to RabbitMQ<br>\n2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.io_services_utils:9800] Socket failed to connect: &lt;socket.socket fd=22, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 51386)&gt;; error=111 (Connection refused)<br>\n2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.connection_workflow:9800] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>\n2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>\n2022-06-15 03:57:46.021 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>\n2022-06-15 03:57:46.021 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-06-15 03:57:46.021 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-06-15 03:57:46.021 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>\n2022-06-15 03:57:46.021 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...</p>",
        "id": 1392628,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655265534
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"24295\">@Azure IT Support</span>: For future reference, it's good practice to put log out put and such things in <a href=\"https://zulip.com/help/format-your-message-using-markdown#code\">code blocks</a>.</p>\n<p>It looks like RabbitMQ isn't running.</p>\n<p>As root, try:</p>\n<div class=\"codehilite\"><pre><span></span><code>service rabbitmq-server start\n</code></pre></div>",
        "id": 1392629,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655266372
    },
    {
        "content": "<p>Job for rabbitmq-server.service failed because the control process exited with error code.<br>\nSee \"systemctl status rabbitmq-server.service\" and \"journalctl -xe\" for details.</p>",
        "id": 1392630,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655266700
    },
    {
        "content": "<p>when i do service rabbitmq-server start</p>",
        "id": 1392631,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655266735
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"24295\">@Azure IT Support</span>: OK, so time to look at the rabbitmq logs.</p>\n<p>Look at <code>/var/log/rabbitmq/startup_log</code> and the last page of <code>/var/log/rabbitmq/zulip@localhost.log</code></p>",
        "id": 1392653,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655275620
    },
    {
        "content": "<p>-bash: /var/log/rabbitmq/startup_log: Permission denied from both user (local &amp; root)</p>",
        "id": 1392654,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655275977
    },
    {
        "content": "<p>when i /var/log/rabbitmq/startup_log</p>",
        "id": 1392655,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655275987
    },
    {
        "content": "<p>Sorry, by \"look at\" I mean using something that shows the contents, like:</p>\n<div class=\"codehilite\"><pre><span></span><code>cat /var/log/rabbitmq/startup_log\n</code></pre></div>",
        "id": 1392656,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276013
    },
    {
        "content": "<p>{\"init terminating in do_boot\",{could_not_start,ra,{ra,{{shutdown,{failed_to_start_child,ra_system_sup,{shutdown,{failed_to_start_child,ra_log_sup,{shutdown,{failed_to_start_child,ra_log_wal_sup,{shutdown,{failed_to_start_child,ra_log_wal,{{case_clause,{ok,&lt;&lt;&gt;&gt;}},[{ra_log_wal,open_existing,1,[{file,\"src/ra_log_wal.erl\"},{line,646}]},{ra_log_wal,'-recover_wal/2-lc$^0/1-0-',1,[{file,\"src/ra_log_wal.erl\"},{line,265}]},{ra_log_wal,recover_wal,2,[{file,\"src/ra_log_wal.erl\"},{line,268}]},{ra_log_wal,init,1,[{file,\"src/ra_log_wal.erl\"},{line,214}]},{gen_batch_server,init_it,6,[{file,\"src/gen_batch_server.erl\"},{line,133}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,249}]}]}}}}}}}}},{ra_app,start,[normal,[]]}}}}}</p>",
        "id": 1392657,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276047
    },
    {
        "content": "<p>Did you shut this server down cleanly?  That looks like rabbitmq database corruption.</p>",
        "id": 1392658,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276085
    },
    {
        "content": "<p>no not shutdown properly</p>",
        "id": 1392659,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276115
    },
    {
        "content": "<p>some power issue in this server</p>",
        "id": 1392660,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276132
    },
    {
        "content": "<p>how ro repair  rabbitmq database corruption</p>",
        "id": 1392661,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276149
    },
    {
        "content": "<p>OK, that's likely the problem.</p>\n<p>Give this a shot:</p>\n<div class=\"codehilite\"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server\nservice rabbitmq-server stop\nrm -rf /var/lib/rabbitmq/mnesia/\nservice rabbitmq-server start\n~zulip/deployments/current/scripts/setup/configure-rabbitmq\nsudo -u zulip ~zulip/deployments/current/scripts/start-server\n</code></pre></div>",
        "id": 1392662,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276165
    },
    {
        "content": "<p>my data lost ?????????</p>",
        "id": 1392663,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276196
    },
    {
        "content": "<p>No.  Rabbitmq doesn't store any data that is necessary</p>",
        "id": 1392664,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276212
    },
    {
        "content": "<p>we have 100+ user configured</p>",
        "id": 1392665,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276224
    },
    {
        "content": "<p>The real message data is stored in PostgreSQL, which is much more resilient to this</p>",
        "id": 1392666,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276228
    },
    {
        "content": "<p>This will not lose any of your user data, or users.</p>",
        "id": 1392667,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276242
    },
    {
        "content": "<p>my all stream and private message not ifected</p>",
        "id": 1392668,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276269
    },
    {
        "content": "<p>Correct, they will not be affected.</p>",
        "id": 1392669,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276286
    },
    {
        "content": "<p>ok</p>",
        "id": 1392670,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276331
    },
    {
        "content": "<p>Think of RabbitMQ as being the pipes that Zulip uses to tell clients that they have new messages waiting.  We're recreating the pipes.  The real data is elsewhere.</p>",
        "id": 1392671,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276332
    },
    {
        "content": "<p>we will do and let you know...</p>",
        "id": 1392672,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276370
    },
    {
        "content": "<p>(this <em>will</em> throw away some information that was in the pipes, but that information (\"tell user A's browser there's a new message\") is very out of date and not relevant anymore)</p>",
        "id": 1392673,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276398
    },
    {
        "content": "<p>web page is not opening</p>",
        "id": 1392674,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276443
    },
    {
        "content": "<p>error : This Zulip server is currently experiencing some technical difficulties. Sorry about that!</p>",
        "id": 1392675,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276452
    },
    {
        "content": "<p>OK, so start from the top of the debugging process again.  What does <code>/var/log/zulip/errors.log</code> have in it?</p>",
        "id": 1392676,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276474
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>tail -n50 /var/log/zulip/errors.log\n</code></pre></div>",
        "id": 1392677,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276497
    },
    {
        "content": "<p>2022-06-15 07:02:19.325 WARN [zulip.queue:9800] TornadoQueueClient attempting to reconnect to RabbitMQ<br>\n2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.io_services_utils:9800] Socket failed to connect: &lt;socket.socket fd=22, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 33462)&gt;; error=111 (Connection refused)<br>\n2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.connection_workflow:9800] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>\n2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>\n2022-06-15 07:02:19.331 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>\n2022-06-15 07:02:19.331 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-06-15 07:02:19.331 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>\n2022-06-15 07:02:19.331 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>\n2022-06-15 07:02:19.332 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...</p>",
        "id": 1392678,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276554
    },
    {
        "content": "<p>OK, so rabbitmq still.  What does this say about rabbitmq being running:</p>\n<div class=\"codehilite\"><pre><span></span><code>service rabbitmq-server status\n</code></pre></div>",
        "id": 1392679,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276619
    },
    {
        "content": "<p>rabbitmq-server.service - RabbitMQ Messaging Server<br>\n     Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)<br>\n     Active: activating (auto-restart) (Result: exit-code) since Wed 2022-06-15 07:03:47 UTC; 2s ago<br>\n    Process: 332972 ExecStart=/usr/sbin/rabbitmq-server (code=exited, status=1/FAILURE)<br>\n   Main PID: 332972 (code=exited, status=1/FAILURE)</p>",
        "id": 1392680,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276640
    },
    {
        "content": "<p>sudo -u zulip ~zulip/deployments/current/scripts/stop-server<br>\nservice rabbitmq-server stop<br>\nrm -rf /var/lib/rabbitmq/mnesia/<br>\nservice rabbitmq-server start<br>\n~zulip/deployments/current/scripts/setup/configure-rabbitmq<br>\nsudo -u zulip ~zulip/deployments/current/scripts/start-server</p>",
        "id": 1392681,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276703
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code> we need to run those commands???????\n</code></pre></div>",
        "id": 1392682,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276718
    },
    {
        "content": "<p>You need to run all of those commands, yes.</p>",
        "id": 1392683,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276770
    },
    {
        "content": "<p>but my data and stream not affecated ???</p>",
        "id": 1392684,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276815
    },
    {
        "content": "<p>personal message and all</p>",
        "id": 1392685,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276848
    },
    {
        "content": "<p>becuase so many personal messages and stream messages in this server</p>",
        "id": 1392686,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276902
    },
    {
        "content": "<p>Again, those commands will not affect any of your data.</p>",
        "id": 1392687,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276930
    },
    {
        "content": "<p>Your data is not lost, and running those commands will not delete it.</p>",
        "id": 1392688,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655276969
    },
    {
        "content": "<p>ok...we will check and let you know..</p>",
        "id": 1392689,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276974
    },
    {
        "content": "<p>thank you so much for help</p>",
        "id": 1392690,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655276990
    },
    {
        "content": "<p>Much appreciated.</p>",
        "id": 1392691,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655277011
    },
    {
        "content": "<p>You're welcome.</p>\n<p>In the future, it's also helpful to think about, and tell folks, any potentially relevant facts.  Like \"the server was improperly shut down.\" <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 1392692,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1655277159
    },
    {
        "content": "<p>sure <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 1392693,
        "sender_full_name": "Azure IT Support",
        "timestamp": 1655277224
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> has marked this topic as resolved.</p>",
        "id": 1392694,
        "sender_full_name": "Notification Bot",
        "timestamp": 1655277491
    }
]