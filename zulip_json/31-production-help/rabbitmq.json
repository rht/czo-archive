[
    {
        "content": "<p>Hallo, I use: Strato V-Server, Ubuntu 18.04 LTS 64bit, CPU vCores 10, RAM 48 GB<br>\nAfter a server reboot, Zulip no longer starts. Rabbitmq refuses to work.</p>\n<div class=\"codehilite\"><pre><span></span><code>root@h2916764:/# service rabbitmq-server restart\nJob for rabbitmq-server.service failed because the control process exited with error code.\nSee &quot;systemctl status rabbitmq-server.service&quot; and &quot;journalctl -xe&quot; for details.\nroot@h2916764:/# supervisorctl status\nprocess-fts-updates                                             RUNNING   pid 8863, uptime 0:40:46\nzulip-django                                                    RUNNING   pid 8861, uptime 0:40:46\nzulip-tornado                                                   RUNNING   pid 8862, uptime 0:40:46\nzulip-workers:zulip_deliver_enqueued_emails                     RUNNING   pid 8879, uptime 0:40:46\nzulip-workers:zulip_deliver_scheduled_messages                  RUNNING   pid 8880, uptime 0:40:46\nzulip-workers:zulip_events_deferred_work                        RUNNING   pid 6768, uptime 0:00:03\nzulip-workers:zulip_events_digest_emails                        STARTING\nzulip-workers:zulip_events_email_mirror                         RUNNING   pid 6740, uptime 0:00:04\nzulip-workers:zulip_events_email_senders                        RUNNING   pid 6778, uptime 0:00:02\nzulip-workers:zulip_events_embed_links                          RUNNING   pid 6750, uptime 0:00:04\nzulip-workers:zulip_events_embedded_bots                        RUNNING   pid 6759, uptime 0:00:03\nzulip-workers:zulip_events_error_reports                        RUNNING   pid 6763, uptime 0:00:03\nzulip-workers:zulip_events_invites                              RUNNING   pid 6745, uptime 0:00:04\nzulip-workers:zulip_events_missedmessage_emails                 RUNNING   pid 6777, uptime 0:00:02\nzulip-workers:zulip_events_missedmessage_mobile_notifications   RUNNING   pid 6717, uptime 0:00:06\nzulip-workers:zulip_events_outgoing_webhooks                    STARTING\nzulip-workers:zulip_events_signups                              RUNNING   pid 6743, uptime 0:00:04\nzulip-workers:zulip_events_user_activity                        RUNNING   pid 6725, uptime 0:00:05\nzulip-workers:zulip_events_user_activity_interval               RUNNING   pid 6784, uptime 0:00:02\nzulip-workers:zulip_events_user_presence                        RUNNING   pid 6770, uptime 0:00:03\n</code></pre></div>\n<div class=\"codehilite\"><pre><span></span><code>root@h2916764:/# systemctl status rabbitmq-server.service\n● rabbitmq-server.service - RabbitMQ Messaging Server\n   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)\n   Active: activating (auto-restart) (Result: exit-code) since Thu 2021-06-10 21:59:25 CEST; 2s ago\n  Process: 30355 ExecStart=/usr/sbin/rabbitmq-server (code=exited, status=134)\n Main PID: 30355 (code=exited, status=134)\n\nJun 10 21:59:25 h2916764.stratoserver.net systemd[1]: rabbitmq-server.service: Failed with result &#39;exit-code&#39;.\nJun 10 21:59:25 h2916764.stratoserver.net systemd[1]: Failed to start RabbitMQ Messaging Server.\n</code></pre></div>\n<p>A restore to the last state before the backup does not make any changes.</p>\n<p>What can I do? Thank you for help!</p>",
        "id": 1206449,
        "sender_full_name": "Achim Maisl",
        "timestamp": 1623355618
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20245\">@Achim Maisl</span> my guess is that something about the way you rebooted or replaced the hardware messed up your networking configuration in a way that makes <code>rabbitmq-server</code> not start.</p>",
        "id": 1206487,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1623357933
    },
    {
        "content": "<p>What is in <code>/etc/rabbitmq/rabbitmq-env.conf</code>?</p>",
        "id": 1206491,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1623357961
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> </p>\n<div class=\"codehilite\"><pre><span></span><code># Defaults to rabbit. This can be useful if you want to run more than one node\n# per machine - RABBITMQ_NODENAME should be unique per erlang-node-and-machine\n# combination. See the clustering on a single machine guide for details:\n# http://www.rabbitmq.com/clustering.html#single-machine\n#\n# By default, we set nodename to rabbit@localhost so it will always resolve\nNODENAME=zulip@localhost\n\n# By default RabbitMQ will bind to all interfaces, on IPv4 and IPv6 if\n# available. Set this if you only want to bind to one network interface or#\n# address family.\n#NODE_IP_ADDRESS=127.0.0.1\n\n# Defaults to 5672.\n#NODE_PORT=5672\n</code></pre></div>",
        "id": 1206960,
        "sender_full_name": "Achim Maisl",
        "timestamp": 1623405678
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20245\">@Achim Maisl</span> I'd check your <code>/etc/hosts</code> configuration for how <code>localhost</code> resolves.</p>",
        "id": 1207102,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1623425879
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> </p>\n<div class=\"codehilite\"><pre><span></span><code>127.0.0.1   localhost\n::1     localhost ip6-localhost ip6-loopback\nff02::1     ip6-allnodes\nff02::2     ip6-allrouters\n\n# Auto-generated hostname. Please do not remove this comment.\n81.169.240.197 h2916764.stratoserver.net h2916764\n</code></pre></div>",
        "id": 1207267,
        "sender_full_name": "Achim Maisl",
        "timestamp": 1623435261
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"20245\">@Achim Maisl</span> you might want to try removing the <code>localhost</code> from the <code>::1</code> / IPv6 line of your configuration; I've seen that cause issues with RabbitMQ in the past.</p>",
        "id": 1207569,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1623458487
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span>  Unfortunately it doesn't work either. I tried:</p>\n<div class=\"codehilite\"><pre><span></span><code>root@h2916764:~# apt-get install rabbitmq-server\nPaketlisten werden gelesen... Fertig\nAbhängigkeitsbaum wird aufgebaut.\nStatusinformationen werden eingelesen.... Fertig\nDie folgenden zusätzlichen Pakete werden installiert:\n  erlang-asn1 erlang-corba erlang-diameter erlang-edoc erlang-eldap erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-public-key erlang-snmp erlang-ssh erlang-ssl erlang-xmerl socat\nVorgeschlagene Pakete:\n  erlang erlang-manpages erlang-doc xsltproc fop erlang-ic-java\nDie folgenden NEUEN Pakete werden installiert:\n  erlang-asn1 erlang-corba erlang-diameter erlang-edoc erlang-eldap erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-public-key erlang-snmp erlang-ssh erlang-ssl erlang-xmerl rabbitmq-server socat\n0 aktualisiert, 20 neu installiert, 0 zu entfernen und 0 nicht aktualisiert.\nEs müssen noch 0 B von 15,5 MB an Archiven heruntergeladen werden.\nNach dieser Operation werden 24,3 MB Plattenplatz zusätzlich benutzt.\nMöchten Sie fortfahren? [J/n] J\nVormals nicht ausgewähltes Paket erlang-asn1 wird gewählt.\n(Lese Datenbank ... 44067 Dateien und Verzeichnisse sind derzeit installiert.)\nVorbereitung zum Entpacken von .../00-erlang-asn1_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-asn1 (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-public-key wird gewählt.\nVorbereitung zum Entpacken von .../01-erlang-public-key_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-public-key (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-ssl wird gewählt.\nVorbereitung zum Entpacken von .../02-erlang-ssl_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-ssl (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-inets wird gewählt.\nVorbereitung zum Entpacken von .../03-erlang-inets_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-inets (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-corba wird gewählt.\nVorbereitung zum Entpacken von .../04-erlang-corba_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-corba (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-diameter wird gewählt.\nVorbereitung zum Entpacken von .../05-erlang-diameter_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-diameter (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-xmerl wird gewählt.\nVorbereitung zum Entpacken von .../06-erlang-xmerl_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-xmerl (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-edoc wird gewählt.\nVorbereitung zum Entpacken von .../07-erlang-edoc_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-edoc (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-eldap wird gewählt.\nVorbereitung zum Entpacken von .../08-erlang-eldap_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-eldap (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-erl-docgen wird gewählt.\nVorbereitung zum Entpacken von .../09-erlang-erl-docgen_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-erl-docgen (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-eunit wird gewählt.\nVorbereitung zum Entpacken von .../10-erlang-eunit_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-eunit (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-ic wird gewählt.\nVorbereitung zum Entpacken von .../11-erlang-ic_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-ic (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-odbc wird gewählt.\nVorbereitung zum Entpacken von .../12-erlang-odbc_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-odbc (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-snmp wird gewählt.\nVorbereitung zum Entpacken von .../13-erlang-snmp_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-snmp (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-os-mon wird gewählt.\nVorbereitung zum Entpacken von .../14-erlang-os-mon_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-os-mon (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-parsetools wird gewählt.\nVorbereitung zum Entpacken von .../15-erlang-parsetools_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-parsetools (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-ssh wird gewählt.\nVorbereitung zum Entpacken von .../16-erlang-ssh_1%3a20.2.2+dfsg-1ubuntu2_amd64.deb ...\nEntpacken von erlang-ssh (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket erlang-nox wird gewählt.\nVorbereitung zum Entpacken von .../17-erlang-nox_1%3a20.2.2+dfsg-1ubuntu2_all.deb ...\nEntpacken von erlang-nox (1:20.2.2+dfsg-1ubuntu2) ...\nVormals nicht ausgewähltes Paket socat wird gewählt.\nVorbereitung zum Entpacken von .../18-socat_1.7.3.2-2ubuntu2_amd64.deb ...\nEntpacken von socat (1.7.3.2-2ubuntu2) ...\nVormals nicht ausgewähltes Paket rabbitmq-server wird gewählt.\nVorbereitung zum Entpacken von .../19-rabbitmq-server_3.6.10-1ubuntu0.4_all.deb ...\nEntpacken von rabbitmq-server (3.6.10-1ubuntu0.4) ...\nerlang-parsetools (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-ic (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nsocat (1.7.3.2-2ubuntu2) wird eingerichtet ...\nerlang-xmerl (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-snmp (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-asn1 (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-eunit (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-odbc (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-os-mon (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-public-key (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-ssl (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-inets (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-diameter (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-ssh (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-eldap (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-edoc (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-corba (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-erl-docgen (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nerlang-nox (1:20.2.2+dfsg-1ubuntu2) wird eingerichtet ...\nrabbitmq-server (3.6.10-1ubuntu0.4) wird eingerichtet ...\nCreated symlink /etc/systemd/system/multi-user.target.wants/rabbitmq-server.service → /lib/systemd/system/rabbitmq-server.service.\nJob for rabbitmq-server.service failed because the control process exited with error code.\nSee &quot;systemctl status rabbitmq-server.service&quot; and &quot;journalctl -xe&quot; for details.\ninvoke-rc.d: initscript rabbitmq-server, action &quot;start&quot; failed.\n● rabbitmq-server.service - RabbitMQ Messaging Server\n   Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)\n   Active: activating (auto-restart) (Result: exit-code) since Sat 2021-06-12 07:13:45 CEST; 10ms ago\n  Process: 2373 ExecStart=/usr/sbin/rabbitmq-server (code=exited, status=134)\n Main PID: 2373 (code=exited, status=134)\n\nJun 12 07:09:29 h2916764.stratoserver.net systemd[1]: Failed to start RabbitMQ Messaging Server.\nJun 12 07:09:39 h2916764.stratoserver.net systemd[1]: rabbitmq-server.service: Service hold-off time over, scheduling restart.\nJun 12 07:09:39 h2916764.stratoserver.net systemd[1]: rabbitmq-server.service: Scheduled restart job, restart counter is at 3.\nJun 12 07:09:39 h2916764.stratoserver.net systemd[1]: Stopped RabbitMQ Messaging Server.\nJun 12 07:09:39 h2916764.stratoserver.net systemd[1]: Starting RabbitMQ Messaging Server...\nJun 12 07:10:39 h2916764.stratoserver.net systemd[1]: Stopped RabbitMQ Messaging Server.\ndpkg: Fehler beim Bearbeiten des Paketes rabbitmq-server (--configure):\n »installiertes rabbitmq-server-Skript des Paketes post-installation«-Unterprozess gab den Fehlerwert 1 zurück\nTrigger für man-db (2.8.3-2ubuntu0.1) werden verarbeitet ...\nTrigger für systemd (237-3ubuntu10.47) werden verarbeitet ...\nFehler traten auf beim Bearbeiten von:\n rabbitmq-server\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre></div>",
        "id": 1207626,
        "sender_full_name": "Achim Maisl",
        "timestamp": 1623475082
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> Hello Tim, I solved the problem. </p>\n<div class=\"codehilite\"><pre><span></span><code>sudo apt-get install curl gnupg debian-keyring debian-archive-keyring apt-transport-https -y\n\n## Team RabbitMQ&#39;s main signing key\nsudo apt-key adv --keyserver &quot;hkps://keys.openpgp.org&quot; --recv-keys &quot;0x0A9AF2115F4687BD29803A206B73A36E6026DFCA&quot;\n## Launchpad PPA that provides modern Erlang releases\nsudo apt-key adv --keyserver &quot;keyserver.ubuntu.com&quot; --recv-keys &quot;F77F1EDA57EBB1CC&quot;\n## PackageCloud RabbitMQ repository\ncurl -1sLf &#39;https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey&#39; | sudo apt-key add -\n\n## Add apt repositories maintained by Team RabbitMQ\nsudo tee /etc/apt/sources.list.d/rabbitmq.list &lt;&lt;EOF\n## Provides modern Erlang/OTP releases\n##\n## &quot;bionic&quot; as distribution name should work for any reasonably recent Ubuntu or Debian release.\n## See the release to distribution mapping table in RabbitMQ doc guides to learn more.\ndeb http://ppa.launchpad.net/rabbitmq/rabbitmq-erlang/ubuntu bionic main\ndeb-src http://ppa.launchpad.net/rabbitmq/rabbitmq-erlang/ubuntu bionic main\n\n## Provides RabbitMQ\n##\n## &quot;bionic&quot; as distribution name should work for any reasonably recent Ubuntu or Debian release.\n## See the release to distribution mapping table in RabbitMQ doc guides to learn more.\ndeb https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu/ bionic main\ndeb-src https://packagecloud.io/rabbitmq/rabbitmq-server/ubuntu/ bionic main\nEOF\n\n## Update package indices\nsudo apt-get update -y\n\n## Install Erlang packages\nsudo apt-get install -y erlang-base \\\n                        erlang-asn1 erlang-crypto erlang-eldap erlang-ftp erlang-inets \\\n                        erlang-mnesia erlang-os-mon erlang-parsetools erlang-public-key \\\n                        erlang-runtime-tools erlang-snmp erlang-ssl \\\n                        erlang-syntax-tools erlang-tftp erlang-tools erlang-xmerl\n\n## Install rabbitmq-server and its dependencies\nsudo apt-get install rabbitmq-server -y --fix-missing\n</code></pre></div>\n<p>Thank you for your help!</p>",
        "id": 1207687,
        "sender_full_name": "Achim Maisl",
        "timestamp": 1623491004
    },
    {
        "content": "<p>Hello guys,<br>\nI would like to ask for help. I installed new zulip (5.5) on Debian 11 and did backup on the same version of zulip but on Debian 10. <br>\nWhen I want to restore backup of \"old zulip\" from server where is Debain 10 to Debian 11 i get this message:</p>\n<div class=\"codehilite\"><pre><span></span><code>Waiting for RabbitMQ to start up...\n/home/zulip/deployments/2022-08-08-17-10-11/scripts/setup/configure-rabbitmq: line 29: rabbitmqctl: command not found\n\nError running a subcommand of /home/zulip/deployments/current/scripts/setup/restore-backup: /home/zulip/deployments/2022-08-08-17-10-11/scripts/setup/configure-rabbitmq\nActual error output for the subcommand is just above this.\n</code></pre></div>\n<p>Can you help me? Do I have to just install rabbitmq or I must do some configuration of rabbitmq?</p>\n<p>Thank a lot!<br>\nVojtech Brothanek</p>",
        "id": 1417291,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1660023777
    },
    {
        "content": "<p>And as I just discovered also zulip on Debian 11 just stop working. (internal server error) I dont know if its by failed restore of backup or otherwise..</p>",
        "id": 1417293,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1660024884
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"21379\">@Vojtech Brothanek</span> thanks for the report. A Zulip server will definitely throw 500s without RabbitMQ installed, so I think the question is why that's the case.</p>",
        "id": 1417476,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1660066482
    },
    {
        "content": "<p>Can you share the <code>/etc/zulip/zulip.conf</code> on your Debian 10 server?</p>",
        "id": 1417478,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1660066524
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> <br>\nHi Tim, thanks for response.<br>\nHere is zulip.conf</p>\n<div class=\"codehilite\"><pre><span></span><code>root@chat:~# cd /etc/zulip/\nroot@chat:/etc/zulip# cat zulip.conf\n[machine]\npuppet_classes = zulip::profile::standalone\ndeploy_type = production\n\n[postgresql]\nversion = 12\n\n\n[certbot]\nauto_renew = yes\n\n[rabbitmq]\nnodename = zulip@localhost\n</code></pre></div>",
        "id": 1417490,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1660067192
    },
    {
        "content": "<p>I think it's likely that you had some other error earlier in installing your server -- there should be an <code>apt install rabbitmq-server</code> that failed well before <code>rabbitmqctl</code> fails to appear.</p>",
        "id": 1417531,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1660069406
    },
    {
        "content": "<p>Can you upload the full output from <code>/var/log/zulip/install.log</code> and from <code>restore-backup</code> on the new server?</p>",
        "id": 1417532,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1660069452
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> <br>\nUnfortunately not, because I started a complete new installation including a new installation of Deabian 11.<br>\nI will give you feedback about result of another installation and restoring backup.. Thanks Tim</p>",
        "id": 1417877,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1660113378
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"7\">@Tim Abbott</span> <br>\nHello Tim!<br>\nSo today I finally get to install new Debian 11 (I was forced to do so by you with new Zulip version 6.0 <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span>)<br>\nBut after restoring backup from Zulip 5.7 to new server Zulip 6.0 I get the same error.</p>\n<p><strong>Here is install.log</strong><br>\n<a href=\"/user_uploads/2/b3/sCGfzDgBuHuGw_pTe1dkRYCZ/install.log\">install.log</a></p>\n<p><strong>Here is restore backup log</strong></p>\n<div class=\"codehilite\"><pre><span></span><code>root@zulip:/var/log/zulip# /home/zulip/deployments/current/scripts/setup/restore-backup /home/Install/zulip-backup-2022-11-23-14-26-56-4hncrvqn.tar.gz\n+ tar --directory=/etc/zulip --strip-components=2 -xz zulip-backup/settings\n+ tar -C /tmp/zulip-restore-backup-hpqvix_q &#39;--transform=s|^zulip-backup/zproject(/.*)?$|/home/zulip/deployments/2022-11-23-16-08-46/zproject\\1|x&#39; &#39;--transform=s|^zulip-backup/uploads(/.*)?$|/home/zulip/uploads\\1|x&#39; -xPz\n+ chown -R postgres -- /tmp/zulip-restore-backup-hpqvix_q\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/terminate-psql-sessions zulip\n pg_terminate_backend\n----------------------\n t\n t\n t\n t\n t\n(5 rows)\n\n+ dropdb --if-exists -- zulip\n+ createdb --owner=zulip --template=template0 -- zulip\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/generate_secrets.py --production\ngenerate_secrets: No new secrets to generate.\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/configure-rabbitmq\nWaiting for RabbitMQ to start up...\n/home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/configure-rabbitmq: line 23: rabbitmqctl: command not found\n\nError running a subcommand of /home/zulip/deployments/current/scripts/setup/restore-backup: /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/configure-rabbitmq\nActual error output for the subcommand is just above this.\n</code></pre></div>",
        "id": 1469143,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669218376
    },
    {
        "content": "<p>root@zulip:/home/Install# systemctl status rabbitmq-server<br>\n● rabbitmq-server.service - RabbitMQ Messaging Server<br>\n     Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)<br>\n     Active: active (running) since Wed 2022-11-23 16:18:23 CET; 50min ago<br>\n   Main PID: 462 (beam.smp)<br>\n     Status: \"Initialized\"<br>\n      Tasks: 86 (limit: 4678)<br>\n     Memory: 83.9M<br>\n        CPU: 30.940s<br>\n     CGroup: /system.slice/rabbitmq-server.service<br>\n             ├─462 /usr/lib/erlang/erts-11.1.8/bin/beam.smp -W w -K true -A 64 -MBas ageffcbf -MHas ageffcbf -MBlmbcs 512 -MHlmbcs 512 -MMmcs 30 -P 104857&gt;<br>\n             ├─594 erl_child_setup 65536<br>\n             ├─671 inet_gethost 4<br>\n             └─672 inet_gethost 4</p>\n<p>Nov 23 16:18:12 zulip systemd[1]: Starting RabbitMQ Messaging Server...<br>\nNov 23 16:18:23 zulip systemd[1]: Started RabbitMQ Messaging Server.</p>",
        "id": 1469145,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669219757
    },
    {
        "content": "<p>Can you show:</p>\n<div class=\"codehilite\"><pre><span></span><code>apt-cache policy rabbitmq-server\ndpkg -L rabbitmq-server\n</code></pre></div>",
        "id": 1469150,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669219860
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>root@zulip:/home/Install# apt-cache policy rabbitmq-server\nrabbitmq-server:\n  Installed: 3.8.9-3\n  Candidate: 3.8.9-3\n  Version table:\n *** 3.8.9-3 500\n        500 http://deb.debian.org/debian bullseye/main amd64 Packages\n        100 /var/lib/dpkg/status\n</code></pre></div>",
        "id": 1469153,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669219924
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>root@zulip:/home/Install# dpkg -L rabbitmq-server\n/.\n/etc\n/etc/default\n/etc/default/rabbitmq-server\n/etc/init.d\n/etc/init.d/rabbitmq-server\n/etc/logrotate.d\n/etc/logrotate.d/rabbitmq-server\n/lib\n/lib/systemd\n/lib/systemd/system\n/lib/systemd/system/rabbitmq-server.service\n/usr\n/usr/bin\n/usr/bin/rabbitmqadmin\n/usr/lib\n/usr/lib/erlang\n/usr/lib/erlang/lib\n/usr/lib/ocf\n/usr/lib/ocf/resource.d\n/usr/lib/ocf/resource.d/rabbitmq\n/usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server\n/usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server-ha\n/usr/lib/rabbitmq\n/usr/lib/rabbitmq/autocomplete\n/usr/lib/rabbitmq/autocomplete/bash_autocomplete.sh\n/usr/lib/rabbitmq/autocomplete/zsh_autocomplete.sh\n/usr/lib/rabbitmq/bin\n/usr/lib/rabbitmq/bin/rabbitmq-script-wrapper\n/usr/lib/rabbitmq/bin/rabbitmq-server-wait\n/usr/lib/rabbitmq/lib\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/INSTALL\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-APACHE2\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-APACHE2-ExplorerCanvas\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-APACHE2-excanvas\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-APL2-Stomp-Websocket\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-BSD-base64js\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-BSD-recon\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-ISC-cowboy\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-EJS\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-EJS10\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-Erlware-Commons\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-Flot\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-Mochi\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-Sammy\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-Sammy060\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-jQuery\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MIT-jQuery164\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MPL\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-MPL-RabbitMQ\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-erlcloud\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-httpc_aws\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/LICENSE-rabbitmq_aws\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript/rabbitmq-diagnostics\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript/rabbitmq-plugins\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript/rabbitmq-queues\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript/rabbitmq-upgrade\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/escript/rabbitmqctl\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/README\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/accept-0.3.5.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/amqp10_client-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/amqp10_common-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/amqp_client-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/aten-0.5.5.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/base64url-0.0.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/cowboy-2.6.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/cowlib-2.7.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/credentials_obfuscation-2.2.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/cuttlefish-2.4.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/eetcd-0.3.3.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/gen_batch_server-0.8.4.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/getopt-1.0.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/goldrush-0.1.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/gun-1.3.3.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/jose-1.10.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/jsx-2.11.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/lager-3.8.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/observer_cli-1.5.4.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/prometheus-4.6.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/ra-1.1.6.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbit-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbit_common-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_amqp1_0-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_auth_backend_cache-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_auth_backend_http-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_auth_backend_ldap-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_auth_backend_oauth2-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_auth_mechanism_ssl-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_aws-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_consistent_hash_exchange-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_event_exchange-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_federation-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_federation_management-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_jms_topic_exchange-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_management-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_management_agent-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_mqtt-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_peer_discovery_aws-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_peer_discovery_common-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_peer_discovery_consul-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_peer_discovery_etcd-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_peer_discovery_k8s-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_prelaunch-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_prometheus-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_random_exchange-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_recent_history_exchange-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_sharding-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_shovel-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_shovel_management-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_stomp-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_top-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_tracing-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_trust_store-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_web_dispatch-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_web_mqtt-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_web_mqtt_examples-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_web_stomp-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/rabbitmq_web_stomp_examples-3.8.9.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/ranch-1.7.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/recon-2.5.1.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/stdout_formatter-0.2.4.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/syslog-3.4.5.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/plugins/sysmon_handler-1.3.0.ez\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-defaults\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-diagnostics\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-env\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-plugins\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-queues\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-server\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmq-upgrade\n/usr/lib/rabbitmq/lib/rabbitmq_server-3.8.9/sbin/rabbitmqctl\n/usr/sbin\n/usr/sbin/rabbitmq-diagnostics\n/usr/sbin/rabbitmq-queues\n/usr/sbin/rabbitmq-upgrade\n/usr/share\n/usr/share/doc\n/usr/share/doc/rabbitmq-server\n/usr/share/doc/rabbitmq-server/changelog.Debian.gz\n/usr/share/doc/rabbitmq-server/copyright\n/usr/share/man\n/usr/share/man/man5\n/usr/share/man/man5/rabbitmq-env.conf.5.gz\n/usr/share/man/man8\n/usr/share/man/man8/rabbitmq-plugins.8.gz\n/usr/share/man/man8/rabbitmq-server.8.gz\n/usr/share/man/man8/rabbitmqctl.8.gz\n/usr/share/rabbitmq\n/usr/share/rabbitmq/rabbitmq-env.conf\n/var\n/var/lib\n/var/lib/rabbitmq\n/var/lib/rabbitmq/mnesia\n/var/log\n/var/log/rabbitmq\n/usr/lib/rabbitmq/bin/rabbitmq-defaults\n/usr/lib/rabbitmq/bin/rabbitmq-diagnostics\n/usr/lib/rabbitmq/bin/rabbitmq-env\n/usr/lib/rabbitmq/bin/rabbitmq-plugins\n/usr/lib/rabbitmq/bin/rabbitmq-queues\n/usr/lib/rabbitmq/bin/rabbitmq-server\n/usr/lib/rabbitmq/bin/rabbitmq-upgrade\n/usr/lib/rabbitmq/bin/rabbitmqctl\n/usr/sbin/rabbitmq-plugins\n/usr/sbin/rabbitmq-server\n/usr/sbin/rabbitmqctl\n</code></pre></div>",
        "id": 1469154,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669219960
    },
    {
        "content": "<p>What's your $PATH?</p>",
        "id": 1469155,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669220088
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"12178\">Alex Vandiver</span> <a href=\"#narrow/stream/31-production-help/topic/rabbitmq/near/1469155\">said</a>:</p>\n<blockquote>\n<p>What's your $PATH?</p>\n</blockquote>\n<p>You mean where is zulip installed?</p>",
        "id": 1469156,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669220215
    },
    {
        "content": "<p>No, sorry:</p>\n<div class=\"codehilite\"><pre><span></span><code>echo $PATH\n</code></pre></div>",
        "id": 1469157,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669220240
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>root@zulip:/etc/zulip# echo $PATH\n/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\n</code></pre></div>",
        "id": 1469158,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669220352
    },
    {
        "content": "<p>Ok, the <code>root</code> user is supposed to have <code>/usr/sbin</code> in there.</p>\n<p>How did you become root?  Did you ssh in directly as root, or connect as some  other user and run a command?  If the latter, what command?</p>",
        "id": 1469161,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669220440
    },
    {
        "content": "<p>We can make the installer more durable to this, I just want to understand the contributing factors</p>",
        "id": 1469162,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669220480
    },
    {
        "content": "<p>Right now I did connect to the server via other user (in my case user <em>brotel</em>)and then with commad su I become root</p>",
        "id": 1469163,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669220560
    },
    {
        "content": "<p>So if I get it right the restore backup had to be run as root but directly as root (at the moment) I did that but unfortunately get another error :D </p>\n<div class=\"codehilite\"><pre><span></span><code>root@zulip:~# /home/zulip/deployments/current/scripts/setup/restore-backup /home/Install/zulip-backup-2022-11-23-14-26-56-4hncrvqn.tar.gz\n+ tar --directory=/etc/zulip --strip-components=2 -xz zulip-backup/settings\n+ tar -C /tmp/zulip-restore-backup-y2xwowzi &#39;--transform=s|^zulip-backup/zproject(/.*)?$|/home/zulip/deployments/2022-11-23-16-08-46/zproject\\1|x&#39; &#39;--transform=s|^zulip-backup/uploads(/.*)?$|/home/zulip/uploads\\1|x&#39; -xPz\n+ chown -R postgres -- /tmp/zulip-restore-backup-y2xwowzi\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/terminate-psql-sessions zulip\n pg_terminate_backend\n----------------------\n t\n t\n t\n t\n(4 rows)\n\n+ dropdb --if-exists -- zulip\n+ createdb --owner=zulip --template=template0 -- zulip\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/generate_secrets.py --production\ngenerate_secrets: No new secrets to generate.\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/setup/configure-rabbitmq\nDeleting user &quot;zulip&quot; ...\nDeleting user &quot;zulip&quot; ...\nError:\nUser &quot;zulip&quot; does not exist\nDeleting user &quot;guest&quot; ...\nError:\nUser &quot;guest&quot; does not exist\nAdding user &quot;zulip&quot; ...\nSetting tags for user &quot;zulip&quot; to [administrator] ...\nSetting permissions for user &quot;zulip&quot; in vhost &quot;/&quot; ...\n+ /home/zulip/deployments/2022-11-23-16-08-46/scripts/zulip-puppet-apply -f\nNotice: Compiled catalog for zulip.brotel.cz in environment production in 7.02 seconds\nNotice: /Stage[main]/Zulip::Tornado_sharding/File[/etc/zulip/nginx_sharding.conf]/ensure: removed\nNotice: /Stage[main]/Zulip::App_frontend_base/File[/etc/zulip/uwsgi.ini]/content: content changed &#39;{md5}4116f822da35d615d77ed7aef0a31acc&#39; to &#39;{md5}8cea0450e03460b9ad6c2f88adf30c80&#39;\nNotice: /Stage[main]/Zulip::App_frontend_base/File[/etc/zulip/uwsgi.ini]/owner: owner changed &#39;zulip&#39; to &#39;root&#39;\nNotice: /Stage[main]/Zulip::App_frontend_base/File[/etc/zulip/uwsgi.ini]/group: group changed &#39;zulip&#39; to &#39;root&#39;\nNotice: /Stage[main]/Zulip::Profile::Redis/File[/etc/redis/zulip-redis.conf]/content: content changed &#39;{md5}8fc4defed914d8995b6d5dd1d6bfb451&#39; to &#39;{md5}ac8ba117d2d7b9da83bc64cde4154099&#39;\nNotice: /Stage[main]/Zulip::Profile::Redis/File[/run/redis]/mode: mode changed &#39;2755&#39; to &#39;0755&#39;\nNotice: /Stage[main]/Zulip::Profile::Redis/Service[redis-server]: Triggered &#39;refresh&#39; from 1 event\nNotice: /Stage[main]/Zulip::Profile::Memcached/File[/etc/sasl2/memcached-zulip-password]/content: content changed &#39;{md5}25530810a3116f9d547e9d3cd4935ae6&#39; to &#39;{md5}8b348ecc319e505176f4efc98cacb267&#39;\nNotice: /Stage[main]/Zulip::Profile::Memcached/Exec[generate_memcached_sasldb2]: Triggered &#39;refresh&#39; from 1 event\nNotice: /Stage[main]/Zulip::Profile::Memcached/File[/etc/sasl2/memcached-sasldb2]/owner: owner changed &#39;root&#39; to &#39;memcache&#39;\nNotice: /Stage[main]/Zulip::Profile::Memcached/File[/etc/sasl2/memcached-sasldb2]/group: group changed &#39;zulip&#39; to &#39;memcache&#39;\nNotice: /Stage[main]/Zulip::Profile::Memcached/File[/etc/sasl2/memcached-sasldb2]/mode: mode changed &#39;0640&#39; to &#39;0600&#39;\nNotice: /Stage[main]/Zulip::Postgresql_common/Zulip::Safepackage[postgresql-12]/Package[postgresql-12]/ensure: created\nNotice: /Stage[main]/Zulip::Postgresql_base/File[/usr/share/postgresql/12/tsearch_data/zulip_english.stop]/ensure: defined content as &#39;{md5}34e771a8f53b4ae2e8b43affd3f820b2&#39;\nNotice: /Stage[main]/Zulip::Profile::Postgresql/File[/etc/postgresql/12/main/postgresql.conf]/content: content changed &#39;{md5}c8e8ded79c681780e287487831bf6632&#39; to &#39;{md5}3ffb451e9bae981759e6f1acea5b20ca&#39;\nNotice: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]/returns: Job for postgresql@12-main.service failed because the service did not take the steps required by its unit configuration.\nNotice: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]/returns: See &quot;systemctl status postgresql@12-main.service&quot; and &quot;journalctl -xe&quot; for details.\nError: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]: Failed to call refresh: &#39;pg_ctlcluster 12 main restart&#39; returned 1 instead of one of [0]\nError: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]: &#39;pg_ctlcluster 12 main restart&#39; returned 1 instead of one of [0]\nNotice: /Stage[main]/Zulip::Supervisor/Service[supervisor]: Triggered &#39;refresh&#39; from 3 events\nNotice: Applied catalog in 77.37 seconds\n\nError running a subcommand of /home/zulip/deployments/current/scripts/setup/restore-backup: /home/zulip/deployments/2022-11-23-16-08-46/scripts/zulip-puppet-apply -f\nActual error output for the subcommand is just above this.\n</code></pre></div>\n<p>The thing right now is, that my original zulip is on domain <strong>chat.brotel.cz</strong> but my test zluip server where I want to restore backup is <strong>zulip-db.brotel.cz</strong> that might be a problem..</p>",
        "id": 1469169,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669221142
    },
    {
        "content": "<p>Reading the first post, are you trying to restore the backup on a different version? That is not supported.</p>",
        "id": 1469173,
        "sender_full_name": "Tim Abbott",
        "timestamp": 1669222070
    },
    {
        "content": "<p>Ahhh, yes I do. That will be a problem.. Okay my bad! <br>\nThanks for help guys, very appreciated.</p>\n<p>Btw. is there a way to do downgrade or complete uninstall zulip from server with all dependecies? I dont want to install my VMs from stone <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span></p>",
        "id": 1469174,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669222410
    },
    {
        "content": "<p>We don't have a downgrade or uninstallation script, no.  For cleanliness, I suggest starting with a clean VM.</p>",
        "id": 1469175,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669222618
    },
    {
        "content": "<p>And the <code>$PATH</code> issue looks to be <a href=\"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=918754\">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=918754</a></p>\n<p>Specifically, running <code>su</code> (with no arguments) is insecure since it is supposed to (and since Debian 10, now does) inherit all of the environment from the running user.  That means it doesn't adjust <code>$HOME</code>, <code>$PATH</code>, etc.</p>\n<p>To become root, the safe way (not just for zulip, but in general) is either <code>su -</code> or <code>sudo -i</code></p>",
        "id": 1469176,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669222686
    },
    {
        "content": "<p>We patched over this in <a href=\"https://github.com/zulip/zulip/commit/49144247ddd1889c3a45338345c87f7e63ae2963\">49144247ddd1889c3a45338345c87f7e63ae2963</a>.  But <code>restore-backup</code> may need something similar.</p>",
        "id": 1469177,
        "sender_full_name": "Alex Vandiver",
        "timestamp": 1669222780
    },
    {
        "content": "<p>Okay, thanks for advices. I'll do clean installaation of OS and Zulip one more time and if I get any problem I'll let you know. <br>\nThanks for now :)</p>",
        "id": 1469182,
        "sender_full_name": "Vojtech Brothanek",
        "timestamp": 1669224594
    }
]