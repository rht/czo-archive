<html>
<head><meta charset="utf-8"><title>Mark all messages as read. · design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/101-design/index.html">design</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html">Mark all messages as read.</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1143823"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143823" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143823">(Mar 26 2021 at 06:30)</a>:</h4>
<p>Currently, if you click on "Mark all messages as read" from the left sidebar, it will cause the browser tab to reload. This isn't needed in most cases, and in <a href="https://github.com/zulip/zulip/pull/16555">#16555</a>, I'm working on removing this reload.</p>



<a name="1143826"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143826" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143826">(Mar 26 2021 at 06:30)</a>:</h4>
<p>When the user clicks on "Mark all as read", we will want to show some visual indication that the app is working on it, because it can take a significant amount of time (upto even 5s sometimes) to complete the operation, if the number of unreads is high (~<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex"> 10^5</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>, which is very much possible if the user has muted high traffic streams and rarely reads them).</p>



<a name="1143827"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143827" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143827">(Mar 26 2021 at 06:32)</a>:</h4>
<p>Here's a GIF of what I tried -- basically a navbar alert, similar to the one used for the bankruptcy notice.<br>
<a href="/user_uploads/2/5/CLeQu1fFBda0v8L-Mz4yIS6S/mark_all_as_read_navbar_alert.gif">mark_all_as_read_navbar_alert.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/5/CLeQu1fFBda0v8L-Mz4yIS6S/mark_all_as_read_navbar_alert.gif" title="mark_all_as_read_navbar_alert.gif"><img src="/user_uploads/2/5/CLeQu1fFBda0v8L-Mz4yIS6S/mark_all_as_read_navbar_alert.gif"></a></div>



<a name="1143828"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143828" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143828">(Mar 26 2021 at 06:33)</a>:</h4>
<p>This looks pretty weird though, especially when there are only a few unreads, the alert appears and quickly disappears.</p>



<a name="1143830"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143830" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143830">(Mar 26 2021 at 06:34)</a>:</h4>
<p>I'd appreciate thoughts on what can be done to make this better.</p>



<a name="1143833"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143833" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143833">(Mar 26 2021 at 06:36)</a>:</h4>
<p>(See also <a class="stream-topic" data-stream-id="2" href="/#narrow/stream/2-general/topic/Bankruptcy.20improvements">#general &gt; Bankruptcy improvements</a> for the performance related discussion around this)</p>



<a name="1143840"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143840" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikhil Maske (nikhilmaske-2001) <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143840">(Mar 26 2021 at 06:46)</a>:</h4>
<p>What if we make <code>Mark all messages as read</code> like a popover(something like topic muted popover) , the current behaviour that the whole Zulip interface moves downward and then upward looks a little weird.</p>



<a name="1143842"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143842" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143842">(Mar 26 2021 at 06:48)</a>:</h4>
<p>You mean using the <code>feedback_widget</code>? That's an interesting idea. I'll try to experiment and post here.</p>



<a name="1143844"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143844" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nikhil Maske (nikhilmaske-2001) <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143844">(Mar 26 2021 at 06:48)</a>:</h4>
<p>Yes.</p>



<a name="1143912"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143912" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143912">(Mar 26 2021 at 07:46)</a>:</h4>
<p>I think this is certainly better than the navbar implementation, and I think we can also have a minimum time interval for which this will be shown, to handle cases when there are too few unreads.<br>
<a href="/user_uploads/2/48/f1lPV5J3Qk1EYk8a9-cwib2o/mark_all_as_read_feedback_widget.gif">mark_all_as_read_feedback_widget.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/48/f1lPV5J3Qk1EYk8a9-cwib2o/mark_all_as_read_feedback_widget.gif" title="mark_all_as_read_feedback_widget.gif"><img src="/user_uploads/2/48/f1lPV5J3Qk1EYk8a9-cwib2o/mark_all_as_read_feedback_widget.gif"></a></div>



<a name="1143913"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1143913" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1143913">(Mar 26 2021 at 07:47)</a>:</h4>
<p>(I did some tweaks to remove the undo button and the default timeout of 4s)</p>



<a name="1144564"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1144564" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1144564">(Mar 26 2021 at 21:42)</a>:</h4>
<p><span class="user-mention" data-user-id="16839">@Abhijeet Bodas</span> I think <code>feedback_widget</code> is probably OK for this -- but I'd consider adding a loading spinner on the widget (using our <code>loading.js</code> library, but perhaps because of the popup nature, we'll want to render it much larger than normal).</p>



<a name="1146593"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1146593" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1146593">(Mar 29 2021 at 11:51)</a>:</h4>
<p>Here's a version with a loading indicator. <br>
<a href="user_uploads/2/6f/1DI5As40eYI2GfFeJIeaXuwU/mark_all_as_read_feedback_widget_with_loading_indicator.gif">mark_all_as_read_feedback_widget_with_loading_indicator.gif</a></p>
<div class="message_inline_image"><a href="user_uploads/2/6f/1DI5As40eYI2GfFeJIeaXuwU/mark_all_as_read_feedback_widget_with_loading_indicator.gif" title="mark_all_as_read_feedback_widget_with_loading_indicator.gif"><img src="user_uploads/2/6f/1DI5As40eYI2GfFeJIeaXuwU/mark_all_as_read_feedback_widget_with_loading_indicator.gif"></a></div>



<a name="1146813"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1146813" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1146813">(Mar 29 2021 at 17:47)</a>:</h4>
<p>Yeah, that works.  It's the kind of widget we may want to do a designer pass on later, but certainly meets the bar for "flow that users don't do often being acceptable".</p>



<a name="1147447"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1147447" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1147447">(Mar 30 2021 at 03:50)</a>:</h4>
<p>Ok, let me do some polishing and I'll push this to the PR in a few days.</p>



<a name="1149503"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149503" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149503">(Apr 01 2021 at 11:53)</a>:</h4>
<p>The above mock GIF was generated artificially by using <code>time.sleep()</code> in the relevant backend functions. Today I did some testing with a few thousand unreads and ran into a problem.</p>



<a name="1149504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149504">(Apr 01 2021 at 11:54)</a>:</h4>
<p>The widget and loading indicator are setup correctly, but they freeze after recieving the <code>update_message_flags</code> -&gt; <code>read</code> event.</p>



<a name="1149505"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149505" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149505">(Apr 01 2021 at 11:57)</a>:</h4>
<p><a href="/user_uploads/2/b9/mptxqU5hCkYsZlVed7kqZ-as/mark_all_as_read_feedback_widget_with_loading_indicator_freeze.gif">mark_all_as_read_feedback_widget_with_loading_indicator_freeze.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/b9/mptxqU5hCkYsZlVed7kqZ-as/mark_all_as_read_feedback_widget_with_loading_indicator_freeze.gif" title="mark_all_as_read_feedback_widget_with_loading_indicator_freeze.gif"><img src="/user_uploads/2/b9/mptxqU5hCkYsZlVed7kqZ-as/mark_all_as_read_feedback_widget_with_loading_indicator_freeze.gif"></a></div>



<a name="1149506"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149506" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149506">(Apr 01 2021 at 12:00)</a>:</h4>
<p>Some investigation revealed it is this block in <code>unread_ops/process_read_messages_event()</code>, on reaching which the loader freezes-</p>
<div class="codehilite" data-code-language="JavaScript"><pre><span></span><code>    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">message_id</span> <span class="k">of</span> <span class="nx">message_ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message_lists</span><span class="p">.</span><span class="nx">current</span> <span class="o">===</span> <span class="nx">message_list</span><span class="p">.</span><span class="nx">narrowed</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// I'm not sure this entirely makes sense for all server</span>
            <span class="c1">// notifications.</span>
            <span class="nx">unread</span><span class="p">.</span><span class="nx">set_messages_read_in_narrow</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">unread</span><span class="p">.</span><span class="nx">mark_as_read</span><span class="p">(</span><span class="nx">message_id</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">message_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">message_id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">process_newly_read_message</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>



<a name="1149507"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149507" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149507">(Apr 01 2021 at 12:05)</a>:</h4>
<p>I'm not sure this is because my machine is slow or there's some problem with the code itself. I frequently encounter glitches/lags when the dev server is running, so it could be the first case, and I don't think any of the code above touches any loading indicators.</p>



<a name="1149508"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149508" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149508">(Apr 01 2021 at 12:06)</a>:</h4>
<p>It would be awesome if anyone reading this with a bit of time and powerful hardware could fetch <a href="https://github.com/zulip/zulip/pull/16555">#16555</a> and play around with it, to see if they can reproduce it or not.</p>



<a name="1149665"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149665" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aryan Shridhar <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149665">(Apr 01 2021 at 15:48)</a>:</h4>
<p>Awesome <span class="user-mention" data-user-id="16839">@Abhijeet Bodas</span>, I fetched the pr locally and wasn't able to reproduce the bug regarding loading spinner being stuck.<br>
Here's the GIF: <br>
<a href="/user_uploads/2/30/ruPDRRhQKb9sN472gRA7MrG9/mark-message-read.gif">mark-message-read.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/30/ruPDRRhQKb9sN472gRA7MrG9/mark-message-read.gif" title="mark-message-read.gif"><img src="/user_uploads/2/30/ruPDRRhQKb9sN472gRA7MrG9/mark-message-read.gif"></a></div>



<a name="1149677"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149677" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149677">(Apr 01 2021 at 16:01)</a>:</h4>
<p>Thanks a lot! If it isn't too much to ask, could you also try to run this with around <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10^4</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span> unreads?<br>
<code>populate_db -n 10000</code> and <code>manage.py mark_all_messages_unread</code> would do that for you.</p>



<a name="1149679"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149679" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149679">(Apr 01 2021 at 16:02)</a>:</h4>
<p>And just to make sure what I suspected was really the case, could you share what processor/how much RAM you are using?</p>



<a name="1149745"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149745" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aryan Shridhar <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149745">(Apr 01 2021 at 17:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="16839">Abhijeet Bodas</span> <a href="#narrow/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E/near/1149677">said</a>:</p>
<blockquote>
<p><code>populate_db -n 10000</code> and <code>manage.py mark_all_messages_unread</code> would do that for you.</p>
</blockquote>
<p>Ahh! I guess you were right about it. When tried with such amount ~ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10^4</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span>, the loading spinner freezes and Mozilla firefox throws a popup saying that the webpage is slowing down the browser.<br>
Here's the video replicating it:</p>
<p><a href="/user_uploads/2/42/JfKFl3mBQqaXuiBIvuLaeQTP/mark-msg-read.mp4">mark-msg-read.mp4</a></p>



<a name="1149854"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1149854" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Abhijeet Bodas <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1149854">(Apr 01 2021 at 18:26)</a>:</h4>
<p>Cool, thank you so much! Let me try to investigate a bit more.</p>



<a name="1150081"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1150081" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1150081">(Apr 01 2021 at 21:12)</a>:</h4>
<p>So, what I'd do to debug this is try with ~1K messages, and use the Chrome "Performance" tool to see what code is running.</p>



<a name="1150082"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1150082" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1150082">(Apr 01 2021 at 21:12)</a>:</h4>
<p>Given what you describe, <span class="user-mention" data-user-id="16839">@Abhijeet Bodas</span> , it's likely that we have some frontend code that is O(N^2) or worse when processing very large numbers of "newly read" messages.</p>



<a name="1150084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Mark%20all%20messages%20as%20read./near/1150084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Mark.20all.20messages.20as.20read.2E.html#1150084">(Apr 01 2021 at 21:14)</a>:</h4>
<p>And so we need to figure out what that code is and then optimize it, potentially in a separate preparatory PR, before we can do what we want.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>