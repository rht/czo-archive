<html>
<head><meta charset="utf-8"><title>Code playgrounds · design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/101-design/index.html">design</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html">Code playgrounds</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1177148"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1177148" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1177148">(May 08 2021 at 13:11)</a>:</h4>
<p>We now have the settings support for the Code playground feature (<a href="https://zulip.com/help/code-blocks#code-playgrounds">https://zulip.com/help/code-blocks#code-playgrounds</a>) deployed on CZO. One can go to <a href="#organization/playground-settings">https://chat.zulip.org/#organization/playground-settings</a> to see the list of playgrounds configured or configure some more (admins only). The option to view code in these playgrounds appears in any code block for that programming language (this behavior existed before, but without the configurable playground support we have now). Feel free to leave your thoughts/feedback regarding the feature!</p>



<a name="1177300"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1177300" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neil Pilgrim (neiljp) <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1177300">(May 09 2021 at 03:38)</a>:</h4>
<p><span class="user-mention" data-user-id="10457">@Sumanth Rao</span> Looks interesting! Can you file an issue for ZT for this with <code>missing feature: user</code> given you know the feature well?<br>
(does mobile have this?)</p>



<a name="1177309"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1177309" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1177309">(May 09 2021 at 04:04)</a>:</h4>
<p><span class="user-mention" data-user-id="2406">@Neil Pilgrim (neiljp)</span> I had opened <a href="https://github.com/zulip/zulip-terminal/pull/985">#T985</a> a while back for implementing the playground support on ZT. I added the tag you mentioned to it. Same goes for mobile (<a href="https://github.com/zulip/zulip-mobile/pull/4610">#M4610</a>)</p>



<a name="1177310"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1177310" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neil Pilgrim (neiljp) <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1177310">(May 09 2021 at 04:05)</a>:</h4>
<p>Thanks for looking into it <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="1179141"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179141" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Purushottam Tiwari <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179141">(May 12 2021 at 13:54)</a>:</h4>
<p>Tooltip text for show in playground is <code>view in &lt;language&gt; on &lt;playground&gt;</code>.<br>
I think it should be <code>view &lt;language&gt; on &lt;playground&gt;</code>, without <code>in</code> before language_name.<br>
Although this is very subtle.</p>



<a name="1179142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Purushottam Tiwari <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179142">(May 12 2021 at 13:56)</a>:</h4>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="k">def</span> <span class="nf">print_message</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"We love you, Product Hunt!"</span><span class="p">)</span>
</code></pre></div>



<a name="1179143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Purushottam Tiwari <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179143">(May 12 2021 at 13:58)</a>:</h4>
<p>above is a sample message with code block.</p>



<a name="1179171"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179171" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179171">(May 12 2021 at 14:37)</a>:</h4>
<p>Yeah, I guess that's actually just configuration for this organization, since I put "Python on <a href="http://repl.it">repl.it</a>" as the playground name.</p>



<a name="1179174"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179174" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179174">(May 12 2021 at 14:38)</a>:</h4>
<p>Changed, this though also made me notice a bug, which is that our unique constraint for these is on (realm, name), whereas it should be on (realm, language, name).</p>



<a name="1179728"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179728" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179728">(May 13 2021 at 00:20)</a>:</h4>
<p>Makes sense. <span class="user-mention" data-user-id="7">@Tim Abbott</span> Can we do this migration now without breaking things for users who may have configured such playgrounds already?</p>



<a name="1179733"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1179733" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1179733">(May 13 2021 at 00:23)</a>:</h4>
<p><span class="user-mention" data-user-id="10457">@Sumanth Rao</span> yes, definitely; since it's making a constraint less strict, it should have no risk.</p>



<a name="1182299"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182299" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182299">(May 17 2021 at 15:42)</a>:</h4>
<p><span class="user-mention" data-user-id="10457">@Sumanth Rao</span> Why do we validate <code>url_prefix</code> and <code>pygments_language</code> at two places?</p>
<ol>
<li>
<p><a href="https://github.com/zulip/zulip/blob/eee8ff40b41ec4e62da69792ff76cfc3582269c6/zerver/views/realm_playgrounds.py#L15-L43">https://github.com/zulip/zulip/blob/eee8ff40b41ec4e62da69792ff76cfc3582269c6/zerver/views/realm_playgrounds.py#L15-L43</a></p>
</li>
<li>
<p><a href="https://github.com/zulip/zulip/blob/eee8ff40b41ec4e62da69792ff76cfc3582269c6/zerver/models.py#L1021-L1038">https://github.com/zulip/zulip/blob/eee8ff40b41ec4e62da69792ff76cfc3582269c6/zerver/models.py#L1021-L1038</a></p>
</li>
</ol>
<p>I think we should remove the validation that we do in the first place and let the validators present in <code>models.py</code> do the job.</p>
<p>Also, the current UI doesn't support showing multiple errors for each field. We just show each field error in one place, making it difficult to understand that the shown error points to which field.<br>
It should support showing multiple errors like realm linkifiers.</p>



<a name="1182620"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182620" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182620">(May 18 2021 at 01:09)</a>:</h4>
<p><span class="user-mention" data-user-id="17026">@Akshat (akshatdalton)</span> having error checks in multiple levels is perfectly fine. I think this comment from Tim back when we added that feature, should address your very question - <a href="https://github.com/zulip/zulip/pull/16496#discussion_r502037089">https://github.com/zulip/zulip/pull/16496#discussion_r502037089</a></p>



<a name="1182621"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182621" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182621">(May 18 2021 at 01:14)</a>:</h4>
<p>Yeah, I think having multiple field status sections vs just one is pretty debatable. I personally think showing it in one place is much cleaner. We also prefix it with the field against which the error occurred. Also, the backend is designed to return the first error it finds - so one won't get multiple errors back from the server like "the playground URL is invalid &amp; the pygments language as well", but just one of those.</p>



<a name="1182686"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182686" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182686">(May 18 2021 at 05:49)</a>:</h4>
<p>Well, I don't see any field name in this case:<br>
<a href="/user_uploads/2/c4/J6QgQbXMh0acJEZQUKw5F8jb/Screenshot-from-2021-05-18-11-15-59.png">Code playground</a> </p>
<div class="message_inline_image"><a href="/user_uploads/2/c4/J6QgQbXMh0acJEZQUKw5F8jb/Screenshot-from-2021-05-18-11-15-59.png" title="Code playground"><img src="/user_uploads/2/c4/J6QgQbXMh0acJEZQUKw5F8jb/Screenshot-from-2021-05-18-11-15-59.png"></a></div><p>Backend does return multiple errors for realm linkifiers:<br>
<a href="/user_uploads/2/da/GkG9sAuq1TqGT32bQjySdZ3B/Screenshot-from-2021-05-18-11-14-45.png">Linkifier</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/da/GkG9sAuq1TqGT32bQjySdZ3B/Screenshot-from-2021-05-18-11-14-45.png" title="Linkifier"><img src="/user_uploads/2/da/GkG9sAuq1TqGT32bQjySdZ3B/Screenshot-from-2021-05-18-11-14-45.png"></a></div>



<a name="1182926"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182926" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182926">(May 18 2021 at 13:28)</a>:</h4>
<p>Good catch! I think we can tweak the message to return which field its talking about?</p>



<a name="1182942"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1182942" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1182942">(May 18 2021 at 15:05)</a>:</h4>
<p>Django returns a dictionary for multiple errors.<br>
Consider for the following case:<br>
<a href="/user_uploads/2/b5/0JkLvHme18ww3X5UJfQaAiqQ/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/2/b5/0JkLvHme18ww3X5UJfQaAiqQ/image.png" title="image.png"><img src="/user_uploads/2/b5/0JkLvHme18ww3X5UJfQaAiqQ/image.png"></a></div><p>it returns: <code>{'name': ['This field cannot be blank.'], 'pygments_language': ['This field cannot be blank.']}</code>.<br>
In this case, we need to modify that data before we return it.</p>



<a name="1183289"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1183289" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumanth Rao <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1183289">(May 19 2021 at 01:49)</a>:</h4>
<p><span class="user-mention" data-user-id="17026">@Akshat (akshatdalton)</span>  Makes sense. Do you want to take up the work to introduce these per-field labels into the playground's form?</p>



<a name="1183315"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1183315" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1183315">(May 19 2021 at 02:22)</a>:</h4>
<p>It's possible that we should try to move both this feature and linkifiers away from using Django's forms/validators system; I feel like that inconsistency from the rest of how our codebase does error handling results in these two pages having a bunch of messy unique complexity.</p>



<a name="1183316"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1183316" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1183316">(May 19 2021 at 02:23)</a>:</h4>
<p>Given that neither is an important widget, it might be better to just migrate their backends to do the normal <code>json_error</code> model and go from there.</p>



<a name="1183522"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1183522" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1183522">(May 19 2021 at 15:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/101-design/topic/Code.20playgrounds/near/1183316">said</a>:</p>
<blockquote>
<p>Given that neither is an important widget, it might be better to just migrate their backends to do the normal <code>json_error</code> model and go from there.</p>
</blockquote>
<p>I think we do this for realm playgrounds. I'll start doing this for Linkifiers.</p>



<a name="1183530"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1183530" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Akshat <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1183530">(May 19 2021 at 15:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="10457">Sumanth Rao</span> <a href="#narrow/stream/101-design/topic/Code.20playgrounds/near/1183289">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="17026">Akshat (akshatdalton)</span>  Makes sense. Do you want to take up the work to introduce these per-field labels into the playground's form?</p>
</blockquote>
<p>If we want to show the errors in one place with the error message prepended with the field name, then what should be its syntax? For the error message: <code>This field cannot be blank.</code>, should we tweak it as</p>
<ul>
<li><code>Language: This field cannot be blank.</code> or</li>
<li><code>Failed: Language - This field cannot be blank.</code><br>
or something else?</li>
</ul>
<p>I still think instead of customizing these error messages, it would be much better to show them right below their respective fields as we do for Linkifiers.</p>



<a name="1184094"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1184094" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1184094">(May 19 2021 at 19:41)</a>:</h4>
<p>I would prefer to move away from using the JSON <code>ValidationError</code> framework in the backend altogether, which would remove that constraint another way.</p>



<a name="1617567"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1617567" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zixuan James Li <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1617567">(Jul 28 2023 at 21:11)</a>:</h4>
<p>I think it would be reasonable to get rid of that and have a standard format for validation error messages.</p>



<a name="1617569"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Code%20playgrounds/near/1617569" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Zixuan James Li <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Code.20playgrounds.html#1617569">(Jul 28 2023 at 21:13)</a>:</h4>
<p>Starting a discussion at <a class="stream-topic" data-stream-id="101" href="/#narrow/stream/101-design/topic/Better.20API.20error.20responses">#design &gt; Better API error responses</a></p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>