<html>
<head><meta charset="utf-8"><title>Improving the way to ban users. 路 design 路 Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/101-design/index.html">design</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html">Improving the way to ban users.</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1538365"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1538365" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1538365">(Mar 31 2023 at 14:32)</a>:</h4>
<p>I am currently working on <a href="https://github.com/zulip/zulip/issues/16473#issue-714394849">Improving the way to ban users 路 Issue #16473</a> and have a few queries related to this:</p>
<ol>
<li>
<p>When we refer to "providing information to the admins," do we mean sending an email regarding the deactivation of a user along with the reason, or posting a message in the All Messages channel that says "xyz has deactivated abc due to spamming" (subject to change), which will only be visible to admins?</p>
</li>
<li>
<p>As suggested by <span class="user-mention silent" data-user-id="19257">Alya Abbott</span> <a href="https://github.com/zulip/zulip/issues/16473#issuecomment-1328798251">here</a>, I have come up with two possible approaches regarding whether to include a reason column or not:</p>
</li>
</ol>
<ul>
<li>Include a checkbox that asks "Notify admins?" when deactivating a user. This would enable a dropdown menu with options such as Unspecified, Spammer, User Request, or Other.</li>
<li>Add an option in the Organization settings called "Add reasons while deactivating users." </li>
</ul>
<p>FYI <span class="user-mention" data-user-id="19257">@Alya Abbott</span></p>



<a name="1538380"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1538380" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1538380">(Mar 31 2023 at 14:47)</a>:</h4>
<p>It appears that the second point in the issue suggests adding an extra column titled "Reason" to the Deactivated Users table in the organization settings.</p>



<a name="1538426"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1538426" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1538426">(Mar 31 2023 at 16:44)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="137" href="/#narrow/stream/137-feedback/topic/Improving.20the.20way.20to.20ban.20users.2E">#feedback &gt; Improving the way to ban users.</a> by <span class="user-mention silent" data-user-id="19257">Alya Abbott</span>.</p>



<a name="1538433"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1538433" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alya Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1538433">(Mar 31 2023 at 16:49)</a>:</h4>
<blockquote>
<p>It appears that the second point in the issue suggests adding an extra column titled "Reason" to the Deactivated Users table in the organization settings.</p>
</blockquote>
<p>Yeah, that's what I was thinking. So the Deactivated users table could have 2 new columns:</p>
<ul>
<li>Deactivated by</li>
<li>Reason</li>
</ul>



<a name="1538434"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1538434" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alya Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1538434">(Mar 31 2023 at 16:50)</a>:</h4>
<p>Maybe the best way to manage the "Reason" input field in the deactivation modal would be the same way we manage the pronouns custom profile field: there is typeahead for some common options, but the user can type whatever they want (up to a character limit).</p>



<a name="1539075"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1539075" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sascha Mann <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1539075">(Apr 01 2023 at 08:33)</a>:</h4>
<blockquote>
<p>When we refer to "providing information to the admins," do we mean sending an email regarding the deactivation of a user along with the reason, or posting a message in the All Messages channel that says "xyz has deactivated abc due to spamming" (subject to change), which will only be visible to admins?</p>
</blockquote>
<p>My original motivation behind that point in the issue was to keep track of deactivations in the long run, not about immediate notifications. For a notification like you're describing, I'd prefer it to go into a configurable stream (e.g. a private one used by the admins).</p>
<p>But the notification shouldn't replace the reason from being listed in the deactivated users list (or somewhere else) imo.</p>



<a name="1539176"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1539176" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1539176">(Apr 01 2023 at 13:23)</a>:</h4>
<p>In my opinion, it would be best to implement the "reason" column part first before adding the notification feature. Moreover, <a href="https://github.com/zulip/zulip/issues/20047">Make it possible to flag problematic messages 路 Issue #20047 </a> is closely aligned with the notification feature, as all reported messages will be directed to a stream that is only accessible by administrators. Therefore, it would be ideal to consider the notification feature as a follow-up to that issue.</p>



<a name="1540154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1540154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1540154">(Apr 03 2023 at 14:52)</a>:</h4>
<p>After some brainstorming, I came up with this technical approach for the "reason" column:</p>
<ol>
<li>Retrieve the user's input from the Reason text field and and submit it to the backend using the following code:</li>
</ol>
<div class="codehilite"><pre><span></span><code>data = { deactivation_reason: $(&quot;#deactivation_reason&quot;).val()}
dialog_widget.submit_api_request(channel.del, url, data);
</code></pre></div>
<ol start="2">
<li>Create a <code>deactivation_reason</code> field within <code>UserProfile</code>.</li>
</ol>
<div class="codehilite"><pre><span></span><code>    deactivate_reason = models.CharField(max_length=MAX_NAME_LENGTH,null=True)
</code></pre></div>
<ol start="3">
<li>Similar to how <code>deactivation_notification_comment</code> works, we can include an additional parameter <code>deactivation_reason</code> in the <code>deactivate_user_backend</code> function within <code>users.py</code> in the backend.<br>
If the value of <code>deactivation_reason</code> is not <code>None</code>, assign it to the <code>deactivation_reason</code> field in the <code>UserProfile</code> and the update the <code>UserProfile</code>.</li>
</ol>
<div class="codehilite"><pre><span></span><code>    user_profile.deactivation_reason = deactivation_reason
    user_profile.save(update_fields=[&quot;deactivation_reason&quot;])
</code></pre></div>
<ol start="4">
<li>If the user is reactivated, the <code>deactivation_reason</code> field will be reset to <code>NULL</code>.</li>
</ol>
<p>I would like to confirm whether my approach is correct or if there are any alternative methods that could be more effective.</p>



<a name="1541667"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1541667" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1541667">(Apr 05 2023 at 10:06)</a>:</h4>
<p>I have implemented the approach mentioned above, and I am currently writing tests for the backend.<br>
Meanwhile, here are few screenshots of the UI:<br>
<a href="/user_uploads/2/97/zROq5TRDrK6G3-H8DRJLUnk2/deactivation_reason.png">deactivation_reason.png</a> <a href="/user_uploads/2/b3/B4CzI0ajevvUw5MQVtY6Evch/deactivation_reason2.png">deactivation_reason2.png</a> <a href="/user_uploads/2/e9/IuPOSr34k8-JRryJo0VKqMZB/deactivated_users_table.png">deactivated_users_table.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/97/zROq5TRDrK6G3-H8DRJLUnk2/deactivation_reason.png" title="deactivation_reason.png"><img src="/user_uploads/2/97/zROq5TRDrK6G3-H8DRJLUnk2/deactivation_reason.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/b3/B4CzI0ajevvUw5MQVtY6Evch/deactivation_reason2.png" title="deactivation_reason2.png"><img src="/user_uploads/2/b3/B4CzI0ajevvUw5MQVtY6Evch/deactivation_reason2.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/e9/IuPOSr34k8-JRryJo0VKqMZB/deactivated_users_table.png" title="deactivated_users_table.png"><img src="/user_uploads/2/e9/IuPOSr34k8-JRryJo0VKqMZB/deactivated_users_table.png"></a></div><p>Does the current ui looks good or are any changes needed?</p>



<a name="1542123"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1542123" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1542123">(Apr 05 2023 at 20:37)</a>:</h4>
<p>I have raised a draft PR for this issue: <a href="https://github.com/zulip/zulip/pull/25001">#25001</a>.<br>
<span class="user-mention" data-user-id="7">@Tim Abbott</span>, Could you please review the approach mentioned above along with its code in the PR.</p>



<a name="1543223"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543223" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543223">(Apr 07 2023 at 18:04)</a>:</h4>
<p><span class="user-mention" data-user-id="25499">@Sahil Singh</span> I think that's a pretty reasonable design. I think we'll probably end up wanting to call that field something like <code>deactivation_comment</code>, if it's a comment by the administrator at the time that they deactivated the user, and not something machine-readable.</p>



<a name="1543225"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543225" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543225">(Apr 07 2023 at 18:07)</a>:</h4>
<p>I think probably before doing too much more we'll need to discuss with <span class="user-mention silent" data-user-id="19257">Alya Abbott</span> the precise design for how we want to store these -- the model that you have is that the reason is a short string we can display in a table; I think that's helpful, but what I don't know is whether it makes sense to have a longer comment as a separate field, in which case it might be that we want multiple fields.</p>



<a name="1543227"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543227" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543227">(Apr 07 2023 at 18:08)</a>:</h4>
<p>The other thing that I'm not sure about is whether we need these to be new fields on <code>UserProfile</code> or whether just storing them in the <code>RealmAuditLog</code> entry for the user being deactivated is a better model; that depends largely on whether we want to display them in the table like this.</p>



<a name="1543270"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543270" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543270">(Apr 07 2023 at 18:54)</a>:</h4>
<p>Adding another field for longer comments could be beneficial, but there is a concern that it may clutter the table further since we would also  add another field for "deactivated by". <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="1543290"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543290" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543290">(Apr 07 2023 at 19:06)</a>:</h4>
<p>Yeah, I don't think longer comments can go in the table, they'd need to be displayed elsewhere.</p>



<a name="1543292"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1543292" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1543292">(Apr 07 2023 at 19:06)</a>:</h4>
<p>So maybe this is a fine model, but I haven't thought about the UX design of this much so we should wait for Alya to comment.</p>



<a name="1544326"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1544326" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alya Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1544326">(Apr 10 2023 at 16:38)</a>:</h4>
<blockquote>
<p>Does the current ui looks good or are any changes needed?</p>
</blockquote>
<p><span class="user-mention" data-user-id="25499">@Sahil Singh</span>  Is there a reason you went with this approach, rather than the one suggested above?</p>
<p><span class="user-mention silent" data-user-id="19257">Alya Abbott</span> <a href="#narrow/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E/near/1538434">said</a>:</p>
<blockquote>
<p>Maybe the best way to manage the "Reason" input field in the deactivation modal would be the same way we manage the pronouns custom profile field: there is typeahead for some common options, but the user can type whatever they want (up to a character limit).</p>
</blockquote>



<a name="1544327"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1544327" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alya Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1544327">(Apr 10 2023 at 16:40)</a>:</h4>
<p>I like the typeahead approach because I feel like we don't have a great sense right now of what users will want to put for the reason (and it might vary by organization), and it feels like a softer suggestion than having a dropdown with an "other" option.</p>



<a name="1544544"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1544544" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sahil Singh <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1544544">(Apr 10 2023 at 20:30)</a>:</h4>
<p>Due to the presence of issues such as <a href="https://github.com/zulip/zulip/issues/18941">#18941</a>, which requires adding an option to label a user as a spammer, and <a href="https://github.com/zulip/zulip/issues/9172"> #9172</a>, where users must be marked as spammers, I decided to adopt the dropdown method. Instead of creating a separate checkbox for "mark user as spammer" in the future, I believed it would be more practical to include a dropdown menu with common deactivation reasons.</p>
<p>However, if we opt for the typeahead approach, I have a few questions:</p>
<ul>
<li>Is it necessary to fill in the reason field or can it be left blank?</li>
<li>If leaving the reason field blank is allowed, should we display "unspecified" in the deactivated user's table?</li>
</ul>



<a name="1544579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/Improving%20the%20way%20to%20ban%20users./near/1544579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alya Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/Improving.20the.20way.20to.20ban.20users.2E.html#1544579">(Apr 10 2023 at 20:41)</a>:</h4>
<p>Hm, thanks for bringing up <a href="https://github.com/zulip/zulip/pull/18941">#18941</a>. I think we can keep the two designs we discussed so far, and automatically fill in "Spammer" in the reason field when the spammer checkbox is checked (which the user could still edit if they like). But curious if folks have other suggestions.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>