<html>
<head><meta charset="utf-8"><title>resize.js · design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/101-design/index.html">design</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html">resize.js</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="657721"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657721" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657721">(Nov 02 2018 at 10:13)</a>:</h4>
<p>In the code  I see   <em>res.main_div_min_height = viewport_height - top_navbar_height;</em>   ,  but the height or min-height of  #main_div is never actually set .   or am I missing something ?</p>



<a name="657729"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657729" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657729">(Nov 02 2018 at 11:34)</a>:</h4>
<p>I think that's why we have to calculate it from <code>viewport_height</code> and <code>top_navbar_height</code>. <span class="emoji emoji-263a" title="smile">:smile:</span></p>



<a name="657732"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657732" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657732">(Nov 02 2018 at 11:53)</a>:</h4>
<p>I mean, it is calculated, but it isn't used anywhere  (afaik)</p>



<a name="657736"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657736" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657736">(Nov 02 2018 at 12:29)</a>:</h4>
<p>Huh, I think you're right.  Apparently it's been dead code since 2013, when  it was added in <a href="https://github.com/zulip/zulip/commit/5622e59b48841a7ca5326ecff8e42bdb61fd2ca8" target="_blank" title="https://github.com/zulip/zulip/commit/5622e59b48841a7ca5326ecff8e42bdb61fd2ca8">5622e59b48841a7ca5326ecff8e42bdb61fd2ca8</a>.</p>



<a name="657737"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657737" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657737">(Nov 02 2018 at 12:31)</a>:</h4>
<p>I'm guessing it snuck in because it was useful for debugging at some point (and probably still is, but I'd rather just eliminate it to avoid confusion).</p>



<a name="657839"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657839" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657839">(Nov 02 2018 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="9830">@Alex</span> you're working on sticky headers with this effort, right?  I think <span class="user-mention" data-user-id="699">@Anders Kaseorg</span> has a branch, <a href="https://github.com/zulip/zulip/pull/9910" target="_blank" title="https://github.com/zulip/zulip/pull/9910">https://github.com/zulip/zulip/pull/9910</a>, that attempts to implement that; you might want to collaborate with him on that.</p>



<a name="657874"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657874" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657874">(Nov 02 2018 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>  It is a bit different. I've made a version where the Compose box  uses position:sticky . This solves a few issues with resizing,  since it can take the width of its parent (the middle column).  It also eliminates the need for #bottom_whitespace .    position:sticky could also be applied to the nav-bar (header) ,  but that doesn't seem to make much difference.</p>



<a name="657881"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657881" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657881">(Nov 02 2018 at 19:41)</a>:</h4>
<p>OK, makes sense.</p>



<a name="657882"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/657882" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#657882">(Nov 02 2018 at 19:47)</a>:</h4>
<p>I think we still end up needing <code>#bottom_whitespace</code>; a big part of the purpose of it is to make it possible to have blank space (which is convenient for not having scrolling interrupt your reading on a busy thread)</p>



<a name="658033"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658033" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658033">(Nov 03 2018 at 12:38)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> I'm not sure I understand; what do you mean by 'scrolling interrupt' ?   is there a way I could simulate that ?</p>



<a name="658037"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658037" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658037">(Nov 03 2018 at 13:25)</a>:</h4>
<p><span class="user-mention" data-user-id="9830">@Alex</span> Let's say your composing a message, and you're looking at a message on the screen that you're basically replying to.  Maybe somebody asked you a three-part question or something.</p>
<p>If the feed is busy, new messages could scroll in while you're typing and push the message that you're reading offscreen, which is annoying.  We prevent that with code in <code>resize.js</code>.</p>
<p>You can simulate this in dev by having two users running (usually I do Cordelia in the main window and Hamlet in the incognito window).</p>



<a name="658038"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658038" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658038">(Nov 03 2018 at 13:26)</a>:</h4>
<p>I <strong>think</strong> the code is in <code>resize.js</code>.  There may also be scroll handlers elsewhere in the JS codebase that are part of making this experience nice.</p>



<a name="658039"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658039" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658039">(Nov 03 2018 at 13:29)</a>:</h4>
<p>I would start by doing a lot of testing on <code>master</code> to feel for all the use cases.  You want to try a bunch of things:</p>
<ul>
<li>have Hamlet bombard Cordelia with messages while she's trying to compose</li>
<li>do lots of mouse scrolling on Verona</li>
<li>do lots of Home, PgUp, PgDn on Verona</li>
<li>compose multi-line messages that cause the compose box to autosize</li>
</ul>



<a name="658040"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658040" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658040">(Nov 03 2018 at 13:30)</a>:</h4>
<p>ok thanks. I'll give it a try.</p>



<a name="658128"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658128" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658128">(Nov 04 2018 at 13:16)</a>:</h4>
<p>got it all working now, except for one weird  thing, and I can't figure out what the issue is:  when the Compose has <code>position:sticky</code> and I click on some message, the page scrolls down to the end. ( But only when the message is not greyed-out). This only happens when using Brave browser (0.18.36).  Is there some JS event when clicking a message perhaps ?</p>



<a name="658141"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658141" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658141">(Nov 04 2018 at 15:16)</a>:</h4>
<p>Clicking a message should open the compose box, and then there's code that tries to nudge the feed up in  certain situations.  I don't really have a good theory on what you're seeing, though.</p>



<a name="658180"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658180" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658180">(Nov 05 2018 at 02:43)</a>:</h4>
<p>Yeah, seems likely to be some sort of interaction with the animation to scroll up the feed to show the message you clicked fully.</p>



<a name="658181"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658181" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658181">(Nov 05 2018 at 02:43)</a>:</h4>
<p>Probably via a call to <code>message_viewport.scrollTop</code></p>



<a name="658446"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658446" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658446">(Nov 06 2018 at 12:55)</a>:</h4>
<p>I've spend a lot of time to find it,but cant figure it out.  (it doe not seem to relate to <code>scrollTop</code>).  But I noticed it is easy to replicate:  using browser Dev tools,  from <code>#compose</code> disable <code>position:fixed</code> , then scroll up and click some message. it will immediately go to the bottom of the page (no animation).  (using FF) .   I would appreciate if someone could point me to where this comes from.</p>



<a name="658608"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658608" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658608">(Nov 06 2018 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="9830">@Alex</span> look at <code>select_message_function</code> in <code>click_handlers.js</code>.</p>



<a name="658618"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/resize.js/near/658618" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex-CL <a href="https://rht.github.io/czo-archive/stream/101-design/topic/resize.2Ejs.html#658618">(Nov 06 2018 at 20:44)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>  thanks!    That triggers <code>set focus</code> in <code>compose_actions.js</code> which seems to be the issue.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>