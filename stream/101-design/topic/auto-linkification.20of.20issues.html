<html>
<head><meta charset="utf-8"><title>auto-linkification of issues · design · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/101-design/index.html">design</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html">auto-linkification of issues</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="193068"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193068" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193068">(Apr 26 2017 at 07:09)</a>:</h4>
<p>I think we should probably talk about how to make e.g. <code>#1234</code> "do the right thing" when a project has multiple repos.</p>



<a name="193123"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193123" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193123">(Apr 26 2017 at 13:55)</a>:</h4>
<p>Yeah...it doesn't seem like our current regex-filter paradigm is gonna easily extend to multiple repos.  This seems like a popular enough feature that we might want to give it its own model support, so that the admin just configures a list of repos, and then we'd have typeahead support for specifying the repo when you are about to type an issue number.  I'm not sure how we'd want to change the representations (both raw and rendered).  For the raw side, I could see just inserting the actual github URL.</p>



<a name="193130"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193130" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193130">(Apr 26 2017 at 14:44)</a>:</h4>
<p>I was thinking that we could add another parameter "stream", beside regex and the link, to the auto-linkification parameters. This would partially solve the problem. The remaining problem would be that you cannot easily mention an issue of some other repo on a stream.</p>



<a name="193131"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193131" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193131">(Apr 26 2017 at 14:47)</a>:</h4>
<p>And I had problems setting up auto-linkification on my server. I could not find out what to do reading the error. Is there any limitations?</p>



<a name="193136"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193136" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193136">(Apr 26 2017 at 15:02)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> I like your idea, because I think scoping the filters to specific streams would largely solve this problem.  The only thing that's a bit tricky is for realms like this, we have lots of streams where linking to the main Zulip repo makes sense, and then there are only one or two streams where a different repo makes sense (<a class="stream" data-stream-id="105" href="/#narrow/stream/zulipbot">#zulipbot</a> comes to mind).  We could say that "stream" is optional, and if it's not specified, then the filter applies to all realms, but then we need to communicate somehow that more "specific" filters take precedence.</p>



<a name="193137"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193137" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193137">(Apr 26 2017 at 15:03)</a>:</h4>
<p>Regarding the problems you had setting up linkification on your own server, I think we need more details to help you debug it.</p>



<a name="193138"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193138" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193138">(Apr 26 2017 at 15:04)</a>:</h4>
<p>I agree. Seems very good.</p>



<a name="193140"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193140" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193140">(Apr 26 2017 at 15:07)</a>:</h4>
<p>Do you enforce the link to have a domain? I don't have a domain for my server, I use the IP address.</p>



<a name="193141"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193141" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193141">(Apr 26 2017 at 15:07)</a>:</h4>
<p>And is the regex case-sensitive?</p>



<a name="193142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193142">(Apr 26 2017 at 15:12)</a>:</h4>
<p>We use GitLab, and it uses <code>!</code> for merge requests (the numbers are not unique between MRs and issues there). The regex gives me errors when I use an exclamation mark in it, even with a backslash.</p>



<a name="193143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193143">(Apr 26 2017 at 15:12)</a>:</h4>
<p>I believe they're case-sensitive (although you can modify the regexes to capture stuff in a case-insensitive way).  Here some relevant JS code.  For use cases that are obviously going to be popular, such as the convenient GH links we're talking about now, I would love to move them away from being configured with regexes, so there's less work for admins and less danger of getting the regex wrong.</p>
<div class="codehilite"><pre><span></span> <span class="mi">978</span> <span class="nx">def</span> <span class="nx">prepare_realm_pattern</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span><span class="o">:</span>
 <span class="mi">979</span>     <span class="err">#</span> <span class="nx">type</span><span class="o">:</span> <span class="p">(</span><span class="nx">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">Text</span>
 <span class="mi">980</span>     <span class="s2">&quot;&quot;&quot; Augment a realm filter so it only matches after start-of-string,</span>
<span class="s2"> 981     whitespace, or opening delimiters, won&#39;t match if there are word</span>
<span class="s2"> 982     characters directly after, and saves what was matched as &quot;</span><span class="nx">name</span><span class="s2">&quot;. &quot;&quot;&quot;</span>
 <span class="mi">983</span>     <span class="k">return</span> <span class="nx">r</span><span class="s2">&quot;&quot;&quot;(?&lt;![^\s&#39;&quot;</span><span class="err">\</span><span class="p">(,</span><span class="o">:&lt;</span><span class="p">])(</span><span class="o">?</span><span class="nx">P</span><span class="o">&lt;</span><span class="nx">name</span><span class="o">&gt;</span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span> <span class="o">+</span> <span class="nx">source</span> <span class="o">+</span> <span class="s1">&#39;)(?!\w)&#39;</span>
</pre></div>



<a name="193144"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193144" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193144">(Apr 26 2017 at 15:14)</a>:</h4>
<p>You may want to try <code>\\!</code>, in case there are two levels of escaping.  But this kind of thing makes me want to move away from regexes! <img alt=":smile:" class="emoji" src="/static/generated/emoji/images/emoji/unicode/1f604.png" title=":smile:"></p>



<a name="193181"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193181" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193181">(Apr 26 2017 at 16:31)</a>:</h4>
<p>One strategy that we could use for multiple repos is different prefixes.  E.g. </p>
<ul>
<li>S123 = server <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a></li>
<li>M123 = RN app <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a></li>
<li>E123 = Electron <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a></li>
</ul>
<div class="message_embed"><a class="message_embed_image" href="https://github.com/zulip/zulip/pull/123" style="background-image: url(https://avatars0.githubusercontent.com/u/1858004?v=3&amp;s=400)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip">Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip</a></div><div class="message_embed_description">Proposed fix for issue #82, This will still print the full error message from line 7 if it fails. Line 6 shouldn't fail since it has checked root privelages at that point, but still could if there ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/zulip/zulip/pull/123" style="background-image: url(https://avatars0.githubusercontent.com/u/1858004?v=3&amp;s=400)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip">Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip</a></div><div class="message_embed_description">Proposed fix for issue #82, This will still print the full error message from line 7 if it fails. Line 6 shouldn't fail since it has checked root privelages at that point, but still could if there ...</div></div></div><div class="message_embed"><a class="message_embed_image" href="https://github.com/zulip/zulip/pull/123" style="background-image: url(https://avatars0.githubusercontent.com/u/1858004?v=3&amp;s=400)" target="_blank"></a><div class="data-container"><div class="message_embed_title"><a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip">Exit 1 for failed install by r0fls · Pull Request #123 · zulip/zulip</a></div><div class="message_embed_description">Proposed fix for issue #82, This will still print the full error message from line 7 if it fails. Line 6 shouldn't fail since it has checked root privelages at that point, but still could if there ...</div></div></div>



<a name="193182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193182">(Apr 26 2017 at 16:32)</a>:</h4>
<p>Hehe, I think we've gotten what we're going to learn from an initial phase of using inline URL preview; I'm going to turn it off for now.</p>



<a name="193185"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193185" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193185">(Apr 26 2017 at 16:40)</a>:</h4>
<p>I like the custom prefix idea.  I'll also reiterate my thought that we might want some special UI for these types of links, and maybe we can figure out a scheme for these links that is less regex-driven.</p>



<a name="193187"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193187" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193187">(Apr 26 2017 at 16:40)</a>:</h4>
<p>(at least from the user's perspective)</p>



<a name="193338"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193338" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Dehnert <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193338">(Apr 26 2017 at 19:42)</a>:</h4>
<p>I'm reasonably happy with the <a href="https://github.com/sipb/chiron/" target="_blank" title="https://github.com/sipb/chiron/">Chiron</a> approach for these things. That's got some code for by default supporting things like "Debathena <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a>", but just "<a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a>" for -c debathena, which I think mostly works pretty well on MIT zephyr. I don't think chiron has a current story for "most classes, use <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a> for debathena, but on -c scripts, use that for scripts" or whatever. Also, "config" is currently <a href="https://github.com/sipb/chiron/blob/master/main.py#L23" target="_blank" title="https://github.com/sipb/chiron/blob/master/main.py#L23">"write some python code"</a>, though the API could probably become a web interface without a ton of pain.</p>
<p>I also appreciate that, unlike the current zulip support, it shows the issue title.</p>



<a name="193341"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193341" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193341">(Apr 26 2017 at 19:43)</a>:</h4>
<p>Yeah, the current support is convenient in that we don't need to do a round-trip to GitHub (or whatever service it is; people use it with their support ticket trackers too!) in order to render</p>



<a name="193342"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193342" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193342">(Apr 26 2017 at 19:43)</a>:</h4>
<p>Which of course you can't do if you want to show titles</p>



<a name="193344"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193344" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193344">(Apr 26 2017 at 19:45)</a>:</h4>
<p>One possible vision is to have the linkification filters support including a list of streams in the config; if you have a stream set on a filter, it supercedes other filters with the same regex.  But you can still make a filter that's global.  So in this realm, we'd have a global filter for the server project, and then stream-specific filters for a few of the smaller projects</p>



<a name="193349"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193349" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Dehnert <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193349">(Apr 26 2017 at 20:03)</a>:</h4>
<p>The chiron approach is to make the title async by the simple virtue of "it's a bot that replies to things". I don't think I generally run into much of an issue with waiting for the reply to come in?</p>



<a name="193350"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193350" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193350">(Apr 26 2017 at 20:07)</a>:</h4>
<p>It's actually more of a problem with message rendering, since if we have to wait for an RTT, sending will feel laggy.  Right now, we can actually render the linkified versions immediately using the frontend markdown processor.</p>



<a name="193362"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193362" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193362">(Apr 26 2017 at 20:26)</a>:</h4>
<p>I'll write up a ticket for the per-stream proposal, just to have it on the record.  I'm worried the more-specific-wins rule may be hard to document and understand, but maybe not.</p>



<a name="193364"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193364" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193364">(Apr 26 2017 at 20:30)</a>:</h4>
<p>yeah, agreed, I'm not confident about that one.  I guess we support an "all streams but X list" thing instead</p>



<a name="193365"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193365" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Dehnert <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193365">(Apr 26 2017 at 20:31)</a>:</h4>
<p>Right, chiron just doesn't link inline (the title wouldn't fit easily anyway, I think).</p>



<a name="193366"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193366" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193366">(Apr 26 2017 at 20:33)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/pull/4627" target="_blank" title="https://github.com/zulip/zulip/pull/4627">#4627</a></p>



<a name="193371"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193371" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193371">(Apr 26 2017 at 20:36)</a>:</h4>
<p>For the most-specific-rule, you can still have some edge cases where the list of streams overlap:</p>
<p>M9999 -&gt; map to iphone repo for streams iphone and mobile<br>
M9999 -&gt; map to android repo for streams android and mobile</p>
<p>Which one wins for mobile?  Or do we prevent dups still to some degree?</p>



<a name="193372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193372">(Apr 26 2017 at 20:47)</a>:</h4>
<p>Can the realm filters be ordered, and it matches the first one it can (regardless of specificity)?</p>



<a name="193373"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193373" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193373">(Apr 26 2017 at 20:51)</a>:</h4>
<p>Yeah, that might make the most sense from the user's perspective.  Implementing that could be a minor challenge, as user-defined orders are surprisingly tricky to persist in a multi-user environment.</p>



<a name="193374"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193374" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193374">(Apr 26 2017 at 20:54)</a>:</h4>
<p>It will also lead to situations where you demote a filter to the point that it's not ever going to be used, which can create tricky UI problems.  (Do we warn the user their filter will now never take precedence?  Do we auto-delete it?  Do we gray it out?)</p>



<a name="193375"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193375" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193375">(Apr 26 2017 at 20:59)</a>:</h4>
<p>The ordering race condition is this:</p>
<ul>
<li>Steve likes D, so says ABCDE -&gt; DABCE</li>
<li>Rishi likes E, so say ABCDE -&gt; EABCD</li>
</ul>
<p>If Rishi loses the race, we need to apply his intention that EABCD is better than ABCDE to the value DABCE, which could result in either EDABC or DEABC.  And then, on top of that, we need a way to represent the ranks of each element.  A naive approach will lead to O(n) operations for every move.  Another approach is to have a topological order, but that's O(n) on reads.</p>



<a name="193376"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193376" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193376">(Apr 26 2017 at 21:00)</a>:</h4>
<p>This is an admin setting, so I think doing a very simple conflict resolution ("someone else edited the list at the same time, discarding your changes") is probably fine?</p>



<a name="193377"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193377" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193377">(Apr 26 2017 at 21:02)</a>:</h4>
<p>Yeah, if we go that approach, then we want to have some kind of "generation" concept or have the client sending the patch send a representation of what they though the original ordering scheme was.</p>



<a name="193381"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193381" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193381">(Apr 26 2017 at 21:03)</a>:</h4>
<p>It's not an unsolvable problem, of course, but there is a little bit of implementation complexity.</p>



<a name="193382"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193382" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193382">(Apr 26 2017 at 21:03)</a>:</h4>
<p>I similarly think we don't have to worry about auto-detecting whether a filter will never be used. I think it'll be clear to the admin (after a few messages) if their filters are not doing what they thought it would do</p>



<a name="193385"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193385" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193385">(Apr 26 2017 at 21:06)</a>:</h4>
<p>Or maybe just always send the entire set of realm filters (on any realm filter change), and delete old + add new in a single transaction?</p>



<a name="193387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193387">(Apr 26 2017 at 21:07)</a>:</h4>
<p>For sending over the whole-shebang, you need to be careful about clobbering the other admin's work, and for that, I think a "generation" field is the most robust thing.</p>



<a name="193389"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193389" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193389">(Apr 26 2017 at 21:08)</a>:</h4>
<p>If Rishi and I both load our browsers with generation 99 of the filters, but Rishi wins the race, he'll send generation 99 back to the server, and the server will allow it.  But by the time I send it, the server's on generation 100, and it will reject my 99-based changes.</p>



<a name="193390"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193390" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193390">(Apr 26 2017 at 21:11)</a>:</h4>
<p>If, on the other hand, Alice is the sole admin of the realm, she'll never lose the race with herself, so she can let generation N stay in her browser for days at a time before she gets around to submitting changes.</p>



<a name="193391"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193391" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193391">(Apr 26 2017 at 21:15)</a>:</h4>
<p>agreed, but that's true for all our admin settings, e.g. if two admins try to change the realm name at the same time (though admittedly it would be a little more frustrating if it happened after you spent 20 minutes trying to construct a regexp :)). I feel like this is going to be a pretty rare situation?</p>



<a name="193392"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193392" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193392">(Apr 26 2017 at 21:16)</a>:</h4>
<p>Stepping out of the weeds for a second, the two big-picture options here are:</p>
<ul>
<li>Solve this problem by scoping regexes to streams.</li>
<li>Solve this problem by adding a prefix to the regex for smaller repos.</li>
</ul>
<p>I think the latter is the better solution for the problem at hand.</p>



<a name="193393"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193393" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193393">(Apr 26 2017 at 21:18)</a>:</h4>
<p>Yeah, the race scenario for ordering-changes is mostly analogous to name-changes, but the differences are:</p>
<ul>
<li>You're passing more complicated data over the wire for ordering changes, so everything is a bit more implemenation work (the initial request, the error handling, the live updates, etc.).</li>
<li>The admins have a larger race window in terms of constructing the regex.</li>
</ul>



<a name="193394"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193394" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193394">(Apr 26 2017 at 21:19)</a>:</h4>
<p>The downfall of the per-stream solution here is that for a stream like "general," we'd only be able to linkify server issues, not android issues.  Whereas schemes with Snnnn and Annnn would be flexible.</p>



<a name="193395"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193395" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Dehnert <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193395">(Apr 26 2017 at 21:23)</a>:</h4>
<p>What's the issue with linkinfying android issues on #general with, say, "Android <a href="https://github.com/zulip/zulip/pull/123" target="_blank" title="https://github.com/zulip/zulip/pull/123">#123</a>"?</p>



<a name="193396"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193396" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193396">(Apr 26 2017 at 21:29)</a>:</h4>
<p>It's just more for the user to type.  But I think <code>#A123</code> is easy enough, and I believe we could set that rule up now with no code changes.  But we eventually want autocomplete.</p>



<a name="193397"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193397" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193397">(Apr 26 2017 at 21:33)</a>:</h4>
<p>Earlier in this topic this basic ideas was discussed:</p>
<ul>
<li>A realm admin configures all the repos of interest and gives each of them a handy prefix (probably one character suffices for most realms, but we'd allow it to be as long as the admin wants).</li>
<li>All link-to-repo shortcuts would start with "#".  (Set aside for the moment that we also use "#" for stream links.)</li>
<li>The typeahead would help users figure out which prefix to type, showing the prefix -&gt; repo-name mappings.</li>
</ul>



<a name="193398"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193398" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193398">(Apr 26 2017 at 21:35)</a>:</h4>
<p>On this realm the typeahead would look like this conceptually:</p>
<div class="codehilite"><pre><span></span>S - server (github.com/zulip/zulip)
A - andorid(github.com/zulip/android)
Z - zulibpot (github.com/zulipbot/zulipbot)
</pre></div>



<a name="193399"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193399" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193399">(Apr 26 2017 at 21:35)</a>:</h4>
<p>(And I would be able to link to any repo from any stream.)</p>



<a name="193483"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193483" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193483">(Apr 27 2017 at 04:04)</a>:</h4>
<p>I found out that there is a very restricted check on the regex for auto-linkification. <code>zerver/models.py</code>, line 435. Will you take a look at it <span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span>?</p>



<a name="193484"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193484" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193484">(Apr 27 2017 at 04:08)</a>:</h4>
<p>And I think that getting a regex for linkification is a very powerful feature. It can be used in many ways (if it is not restricted by that check, though).</p>



<a name="193496"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193496" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193496">(Apr 27 2017 at 05:46)</a>:</h4>
<p>That check is a bit less restricted in master.  The reason it's restricted is to avoid accidental DoS issues</p>



<a name="193497"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193497" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193497">(Apr 27 2017 at 05:47)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> if you have example expressions you'd like to see supported, we can look at that</p>



<a name="193592"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193592" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193592">(Apr 27 2017 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> I need something like <code>[aA][bB][cC]!(?P&lt;id&gt;[0-9]+)</code>.<br>
Why do you restrict it to a small set of characters? I think a better approach would be to exclude some characters (for example <code>()*?+</code> and other ones).</p>



<a name="193593"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193593" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193593">(Apr 27 2017 at 14:43)</a>:</h4>
<p>I think we were just concerned about security/speed, since these regexes are used every time we render a message.</p>



<a name="193594"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193594" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193594">(Apr 27 2017 at 14:55)</a>:</h4>
<p>The approach I proposed is no different in that manner.</p>



<a name="193596"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193596" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193596">(Apr 27 2017 at 15:06)</a>:</h4>
<p>We also need to play nice with our markdown processor, so we don't want special characters like <code>~</code>, <code>*</code>, etc.  It's easier to whitelist than blacklist.  I think we can add "!" to solve your problem.</p>



<a name="193692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/193692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#193692">(Apr 27 2017 at 18:21)</a>:</h4>
<p>yeah, sounds good.  <span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> can you open an issue with that example?  I imagine <span class="user-mention" data-user-email="premsinwar4@gmail.com" data-user-id="200">@sinwar</span> may be interested in adding this since he did the last extensions to the allowed syntax</p>



<a name="194312"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/194312" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#194312">(Apr 29 2017 at 09:07)</a>:</h4>
<p>I opened the issue (<a href="https://github.com/zulip/zulip/pull/4653" target="_blank" title="https://github.com/zulip/zulip/pull/4653">#4653</a>).</p>



<a name="194313"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/101-design/topic/auto-linkification%20of%20issues/near/194313" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/101-design/topic/auto-linkification.20of.20issues.html#194313">(Apr 29 2017 at 09:14)</a>:</h4>
<p>And looking at <a href="https://github.com/zulip/zulip/blob/78f2df56492d076d644f1fbbabb777e13a97c5bd/zerver/models.py#L450" target="_blank" title="https://github.com/zulip/zulip/blob/78f2df56492d076d644f1fbbabb777e13a97c5bd/zerver/models.py#L450"><code>zerver/models.py #L450</code></a>, the characters that are allowed after the <code>%(id)s</code> is very restricted as well. Is there a good reason?</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>