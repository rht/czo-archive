<html>
<head><meta charset="utf-8"><title>Trouble with certbot after upgrade · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Trouble.20with.20certbot.20after.20upgrade.html">Trouble with certbot after upgrade</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="809139"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Trouble%20with%20certbot%20after%20upgrade/near/809139" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andreas Karsten <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Trouble.20with.20certbot.20after.20upgrade.html#809139">(Jan 14 2020 at 23:22)</a>:</h4>
<p>I have just successfully upgraded Zulip and the underlying Debian system (from 9/Stretch to 10/Buster) - will share the steps on how to do that on Thursday/Friday. The only problem I have run into is that when I try to add certificates for another organisation using the subdomain approach with command</p>
<p><code>/home/zulip/deployments/current/scripts/setup/setup-certbot --email=email@domain.org subdomain.domain.org</code></p>
<p>I get the error message below:</p>
<div class="codehilite"><pre><span></span>Upgrading certbot-auto 1.0.0 to 1.1.0...
Replacing certbot-auto...
Error: couldn&#39;t get currently installed version for /opt/eff.org/certbot/venv/bin/letsencrypt:
Traceback (most recent call last):
  File &quot;/opt/eff.org/certbot/venv/bin/letsencrypt&quot;, line 7, in &lt;module&gt;
    from certbot.main import main
  File &quot;/opt/eff.org/certbot/venv/local/lib/python2.7/site-packages/certbot/main.py&quot;, line 2, in &lt;module&gt;
    from certbot._internal import main as internal_main
  File &quot;/opt/eff.org/certbot/venv/local/lib/python2.7/site-packages/certbot/_internal/main.py&quot;, line 6, in &lt;module&gt;
    import logging.handlers
  File &quot;/usr/lib/python2.7/logging/__init__.py&quot;, line 26, in &lt;module&gt;
    import sys, os, time, cStringIO, traceback, warnings, weakref, collections
  File &quot;/usr/lib/python2.7/weakref.py&quot;, line 14, in &lt;module&gt;
    from _weakref import (
ImportError: cannot import name _remove_dead_weakref
</pre></div>


<p>Happy about any pointers!</p>



<a name="809237"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Trouble%20with%20certbot%20after%20upgrade/near/809237" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andreas Karsten <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Trouble.20with.20certbot.20after.20upgrade.html#809237">(Jan 15 2020 at 07:09)</a>:</h4>
<p>Crude self-help: renamed /opt/eff.org/certbot/venv/bin/letsencrypt to /opt/eff.org/certbot/venv/bin/letsencrypt.old and ran the script again: worked <span aria-label="sweat" class="emoji emoji-1f613" role="img" title="sweat">:sweat:</span></p>



<a name="809341"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Trouble%20with%20certbot%20after%20upgrade/near/809341" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Trouble.20with.20certbot.20after.20upgrade.html#809341">(Jan 15 2020 at 18:20)</a>:</h4>
<p>Searching for your <code>ImportError: cannot import name _remove_dead_weakref</code> message shows several Certbot users with the same problem. Perhaps someone should report it as a Certbot bug (and not immediately close it when a workaround is found like <a href="https://github.com/certbot/certbot/issues?q=_remove_dead_weakref" target="_blank" title="https://github.com/certbot/certbot/issues?q=_remove_dead_weakref">these reports</a>).</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>