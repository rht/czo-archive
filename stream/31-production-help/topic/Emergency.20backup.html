<html>
<head><meta charset="utf-8"><title>Emergency backup · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html">Emergency backup</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1279677"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279677" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279677">(Nov 11 2021 at 22:20)</a>:</h4>
<p>Hi all:-)<br>
We are supporting a client with a busy zulip server and needing to back it up, due to our client being unreachable and a platform payment being due </p>
<p>The digital ocean instance is a standard one-click install, however it doesn't respond to <br>
zulip -c '/home/zulip/deployments/current/manage.py backup' --output=/tmp/backup.tar.gz</p>
<p>Can anyone help with a backup command that will work on the DO instance?<br>
We haven't been able to locate the zulip executable </p>
<p>Thanks for any tips! <br>
Kind regards <br>
Mike</p>



<a name="1279678"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279678" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279678">(Nov 11 2021 at 22:23)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/Emergency.20backup">#issues &gt; Emergency backup</a> by <span class="user-mention silent" data-user-id="12178">Alex Vandiver</span></p>



<a name="1279681"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279681" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279681">(Nov 11 2021 at 22:24)</a>:</h4>
<p><span class="user-mention" data-user-id="21343">@Mike MacDonald</span>: When you say "doesn't respond to" that command, do you mean that hangs, does nothing, or crashes?</p>



<a name="1279683"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279683" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279683">(Nov 11 2021 at 22:25)</a>:</h4>
<p>If the postgres server is on the same host, and you've not configured file uploads to be in S3, then a whole-disk snapshot (at the DO level) is also sufficient to get all of the Zulip data.</p>



<a name="1279684"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279684" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279684">(Nov 11 2021 at 22:29)</a>:</h4>
<p>Hi Alex! Wouldn't we love to do that! Our issue has come up because the account owner is not accessible at the moment, so we would like to preemptively backup if possible <br>
Thanks for your comment</p>



<a name="1279685"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279685" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279685">(Nov 11 2021 at 22:31)</a>:</h4>
<p>Oof, got it.</p>



<a name="1279686"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279686" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279686">(Nov 11 2021 at 22:32)</a>:</h4>
<p>Did you see my question about what happens when you run the backup command?</p>



<a name="1279687"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279687" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279687">(Nov 11 2021 at 22:32)</a>:</h4>
<p>We're new to zulip but it seems there should be an executable somewhere.  It's hiding.</p>



<a name="1279690"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279690" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279690">(Nov 11 2021 at 22:36)</a>:</h4>
<p>Sorry missed this. When we try to run the backup we get command not found. It seems like there is something missing from this build</p>



<a name="1279692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279692">(Nov 11 2021 at 22:45)</a>:</h4>
<p>I think you have misread a command <code>zulip -c '…'</code> that’s supposed to be <code>su zulip -c '…'</code>.</p>



<a name="1279693"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279693" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rein Zustand <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279693">(Nov 11 2021 at 22:47)</a>:</h4>
<p>The end of the quotation also seems to be misplaced.</p>



<a name="1279694"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279694" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279694">(Nov 11 2021 at 22:50)</a>:</h4>
<p><span class="user-mention" data-user-id="21343">@Mike MacDonald</span>: Fixing all of those, the copy/paste string to try (as root) is:</p>
<div class="codehilite"><pre><span></span><code>su zulip -c &#39;/home/zulip/deployments/current/manage.py backup --output=/tmp/backup.tar.gz&#39;
</code></pre></div>



<a name="1279697"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279697" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279697">(Nov 11 2021 at 23:06)</a>:</h4>
<p>Thanks Alex and everyone - will try and let you know</p>



<a name="1279698"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279698" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279698">(Nov 11 2021 at 23:08)</a>:</h4>
<p>Alex - this is the response <br>
Command 'zulip' not found, but can be installed with:</p>
<p>snap install zulip<br>
Please ask your administrator.</p>



<a name="1279699"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279699" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279699">(Nov 11 2021 at 23:08)</a>:</h4>
<p>Did you forget to type the <code>su</code> part of the command? You need to type the <code>su</code> part. It is not optional or just there for decoration.</p>



<a name="1279700"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279700" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279700">(Nov 11 2021 at 23:12)</a>:</h4>
<p>If you did type the <code>su</code> and it still fails that way, perhaps you have a custom shell alias that’s interfering with <code>su</code>—what does <code>type su</code> say?</p>



<a name="1279701"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279701" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279701">(Nov 11 2021 at 23:18)</a>:</h4>
<p>Think that's it - made a bad assumption! Trying that again ...</p>



<a name="1279704"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279704" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279704">(Nov 12 2021 at 00:02)</a>:</h4>
<p>Getting very close. Sudoers set up but still can't find zulip executable. Confirmed this by ##which zulip## as root</p>



<a name="1279706"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279706" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mike MacDonald <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279706">(Nov 12 2021 at 00:03)</a>:</h4>
<p>type su:    su is /bin/su</p>



<a name="1279707"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279707" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279707">(Nov 12 2021 at 00:19)</a>:</h4>
<p>We're not using <code>sudo</code>, so the sudoers file should be irrelevant.  What user are you running these commands as -- that is, what does <code>whoami</code> say?</p>



<a name="1279708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279708">(Nov 12 2021 at 00:20)</a>:</h4>
<p>And there still is not expected to be any <code>zulip</code> executable.  The <code>zulip</code> which shows up in that command is the name of the user we're trying to get the command to run as.</p>



<a name="1279709"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279709" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279709">(Nov 12 2021 at 00:21)</a>:</h4>
<p>It may also be helpful in diagnosing if you can copy/paste from the terminal to show exactly what you're typing and exactly what the output is, instead of paraphrasing.</p>



<a name="1279710"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279710" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> prema770 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279710">(Nov 12 2021 at 00:26)</a>:</h4>
<p>Hi Alex - Thanks very much with your help  we have found a solution.  It's mainly unfamiliarity with this arrangement - not yet familiar with python on ubuntu.</p>
<ul>
<li>Understand about the zulip executable that became obvious with your explanation</li>
<li>Noted the point about sudoers </li>
<li>Missed the point there are two versions of the backup command - one as user zulip; one as root. </li>
<li>And yes if I had provided a bit more information this could have got sorted much more quickly</li>
</ul>
<p>Grateful for your help :-)</p>



<a name="1279711"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Emergency%20backup/near/1279711" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Emergency.20backup.html#1279711">(Nov 12 2021 at 00:36)</a>:</h4>
<p>Glad you got it settled!</p>
<blockquote>
<p>Missed the point there are two versions of the backup command - one as user zulip; one as root.</p>
</blockquote>
<p>The version run as root uses <code>su</code> to switch to the <code>zulip</code> user, and run the same command.  Another option, for future reference is if you're more familiar with <code>sudo</code>, you could have run that as root to become the <code>zulip</code> user, and then proceeded from there:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code><span class="c1"># I am root right now</span>

sudo -i -u zulip

<span class="c1"># Now I'm the zulip user!</span>

/home/zulip/deployments/current/manage.py backup --output<span class="o">=</span>/tmp/backup.tar.gz
<span class="c1"># ... etc</span>
</code></pre></div>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>