<html>
<head><meta charset="utf-8"><title>Upgrade Failure · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html">Upgrade Failure</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1222347"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1222347" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1222347">(Jun 29 2021 at 15:50)</a>:</h4>
<p>Hello everyone, I'm hoping i might get some advice. I had a zulip server running from master git 5.x. (08.06.21). Then today i went to upgrade zulip forgetting that it was a zulip git deployment. I did a upgrade to zulip 4.3. Yeah i know. really dumb. I did not make a backup before the upgrade. is there any way i might be able to retrieve my chat/topic data? I tried to roll back to my old deployment but I am now getting database column missing error. Any advice would be great</p>



<a name="1223908"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223908" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223908">(Jul 01 2021 at 23:44)</a>:</h4>
<p><span class="user-mention" data-user-id="20934">@Sean</span> howdy!  Sorry for the slow reply; <a class="stream" data-stream-id="31" href="/#narrow/stream/31-production-help">#production help</a> is the best place for questions about self-hosting as it gets read with priority over here.</p>



<a name="1223909"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223909" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223909">(Jul 01 2021 at 23:44)</a>:</h4>
<p>Let me move this conversation there.</p>



<a name="1223910"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223910" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223910">(Jul 01 2021 at 23:44)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/Upgrade.20Failure">#issues &gt; Upgrade Failure</a> by <span class="user-mention silent" data-user-id="7">Tim Abbott</span></p>



<a name="1223912"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223912" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223912">(Jul 01 2021 at 23:45)</a>:</h4>
<p>You should be able to fix this without incident by just doing an <code>upgrade-zulip-from-git master</code> again. (OR going to the specific commit ID you were on, if you prefer)</p>



<a name="1223913"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223913" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223913">(Jul 01 2021 at 23:45)</a>:</h4>
<p>Or usually it's even just <code>/home/zulip/deployments/last/scripts/restart-server</code>.</p>



<a name="1223915"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223915" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223915">(Jul 01 2021 at 23:46)</a>:</h4>
<p>Trying to install an older release should not result in any database corruption; it'll just fail to run.</p>



<a name="1223917"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223917" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223917">(Jul 01 2021 at 23:47)</a>:</h4>
<p>Did you come across this documentation when you ran into this problem? </p>
<p><a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#troubleshooting-and-rollback">https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#troubleshooting-and-rollback</a></p>



<a name="1223919"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223919" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223919">(Jul 01 2021 at 23:47)</a>:</h4>
<p>We recently did a small reorganization of that page where I worried a bit that the troubleshooting and rollback section might be missed, so any ideas that might have helped you find that documentation (or if you found it, make it clear what you needed to do) would be appreciated.</p>



<a name="1223921"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1223921" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1223921">(Jul 01 2021 at 23:48)</a>:</h4>
<p>Aside from that documentation thing, we may want to modify <code>upgrade-zulip-from-git</code> to refuse to proceed, at least without a <code>--force</code> flag, if it appears that the previous version had migrations that the new version does not, which might be relatively cheap to check?  That would result in a much happier failure mode for anyone making this specific mistake.</p>



<a name="1233127"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20Failure/near/1233127" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20Failure.html#1233127">(Jul 16 2021 at 19:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/31-production-help/topic/Upgrade.20Failure/near/1223921">said</a>:</p>
<blockquote>
<p>Aside from that documentation thing, we may want to modify <code>upgrade-zulip-from-git</code> to refuse to proceed, at least without a <code>--force</code> flag, if it appears that the previous version had migrations that the new version does not, which might be relatively cheap to check?  That would result in a much happier failure mode for anyone making this specific mistake.</p>
</blockquote>
<p>Filed <a href="https://github.com/zulip/zulip/pull/19284">#19284</a>.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>