<html>
<head><meta charset="utf-8"><title>upgrade from master · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html">upgrade from master</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="709828"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709828" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709828">(Feb 28 2019 at 21:59)</a>:</h4>
<p>Hi, just running an upgrade from master. the last upgrade I did was on 22nd January. <br>
I run into multiple errors but it all led back to </p>
<div class="codehilite"><pre><span></span>deb https://packagecloud.io/zulip/server/debian/ stretch main
deb https://packages.groonga.org/debian/ stretch main
deb-src https://packages.groonga.org/debian/ stretch main
</pre></div>


<p>existing in both <code>/etc/apt/sources.list</code> and <code>/etc/apt/sources.list.d/zulip.list</code></p>
<p>I commented out the former.</p>



<a name="709829"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709829" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709829">(Feb 28 2019 at 22:01)</a>:</h4>
<p>now I run  into a new problem.</p>
<div class="codehilite"><pre><span></span><span class="n">Operations</span> <span class="n">to</span> <span class="n">perform</span><span class="p">:</span>
  <span class="n">Apply</span> <span class="nb">all</span> <span class="n">migrations</span><span class="p">:</span> <span class="n">analytics</span><span class="p">,</span> <span class="n">auth</span><span class="p">,</span> <span class="n">confirmation</span><span class="p">,</span> <span class="n">contenttypes</span><span class="p">,</span> <span class="n">otp_static</span><span class="p">,</span> <span class="n">otp_totp</span><span class="p">,</span> <span class="n">sessions</span><span class="p">,</span> <span class="n">social_django</span><span class="p">,</span> <span class="n">two_factor</span><span class="p">,</span> <span class="n">zerver</span>
<span class="n">Running</span> <span class="n">migrations</span><span class="p">:</span>
  <span class="n">Applying</span> <span class="n">zerver</span><span class="o">.</span><span class="mo">0206</span><span class="n">_stream_rendered_description</span><span class="o">...</span><span class="mi">2019</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">21</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mf">17.972</span> <span class="n">ERR</span>  <span class="p">[]</span> <span class="ne">Exception</span> <span class="ow">in</span> <span class="n">Markdown</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1012</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">extracted_data</span> <span class="o">=</span> <span class="n">link_preview</span><span class="o">.</span><span class="n">link_embed_data_from_cache</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/cache.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">126</span><span class="p">,</span> <span class="ow">in</span> <span class="n">func_with_caching</span>
    <span class="k">raise</span> <span class="n">NotFoundInCache</span><span class="p">()</span>
<span class="n">zerver</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">NotFoundInCache</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2213</span><span class="p">,</span> <span class="ow">in</span> <span class="n">do_convert</span>
    <span class="n">rendered_content</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">_md_engine</span><span class="o">.</span><span class="n">convert</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">88</span><span class="p">,</span> <span class="ow">in</span> <span class="n">timeout</span>
    <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/six.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">693</span><span class="p">,</span> <span class="ow">in</span> <span class="n">reraise</span>
    <span class="k">raise</span> <span class="n">value</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">48</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/markdown/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">272</span><span class="p">,</span> <span class="ow">in</span> <span class="n">convert</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">treeprocessor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1014</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span><span class="o">.</span><span class="n">zulip_message</span><span class="o">.</span><span class="n">links_for_preview</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;links_for_preview&#39;</span>
<span class="n">Input</span> <span class="p">(</span><span class="n">sanitized</span><span class="p">)</span> <span class="n">was</span><span class="p">:</span> <span class="s1">&#39;xxxxx xxxxxxxx xx xxxxxxxx xxx xxxxx xxxxxx xx xxx xxxxx: xxxx://xxx.xxxxxxxx.xx/xx/xxxx/xxxxxxx-xxxxxxxx/xxxxxxxxxxxxxxx/xx-xxxxx-xxxxxxx-xxx-xxxx/&#39;</span>
 <span class="p">(</span><span class="n">message</span> <span class="n">unknown</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1012</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">extracted_data</span> <span class="o">=</span> <span class="n">link_preview</span><span class="o">.</span><span class="n">link_embed_data_from_cache</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/cache.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">126</span><span class="p">,</span> <span class="ow">in</span> <span class="n">func_with_caching</span>
    <span class="k">raise</span> <span class="n">NotFoundInCache</span><span class="p">()</span>
<span class="n">zerver</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">NotFoundInCache</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2213</span><span class="p">,</span> <span class="ow">in</span> <span class="n">do_convert</span>
    <span class="n">rendered_content</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">_md_engine</span><span class="o">.</span><span class="n">convert</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">88</span><span class="p">,</span> <span class="ow">in</span> <span class="n">timeout</span>
    <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/six.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">693</span><span class="p">,</span> <span class="ow">in</span> <span class="n">reraise</span>
    <span class="k">raise</span> <span class="n">value</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">48</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/markdown/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">272</span><span class="p">,</span> <span class="ow">in</span> <span class="n">convert</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">treeprocessor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1014</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span><span class="o">.</span><span class="n">zulip_message</span><span class="o">.</span><span class="n">links_for_preview</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;links_for_preview&#39;</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1012</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">extracted_data</span> <span class="o">=</span> <span class="n">link_preview</span><span class="o">.</span><span class="n">link_embed_data_from_cache</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/cache.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">126</span><span class="p">,</span> <span class="ow">in</span> <span class="n">func_with_caching</span>
    <span class="k">raise</span> <span class="n">NotFoundInCache</span><span class="p">()</span>
<span class="n">zerver</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">NotFoundInCache</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2213</span><span class="p">,</span> <span class="ow">in</span> <span class="n">do_convert</span>
    <span class="n">rendered_content</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">_md_engine</span><span class="o">.</span><span class="n">convert</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">88</span><span class="p">,</span> <span class="ow">in</span> <span class="n">timeout</span>
    <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">thread</span><span class="o">.</span><span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/six.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">693</span><span class="p">,</span> <span class="ow">in</span> <span class="n">reraise</span>
    <span class="k">raise</span> <span class="n">value</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/timeout.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">48</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/markdown/core.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">272</span><span class="p">,</span> <span class="ow">in</span> <span class="n">convert</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">treeprocessor</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1014</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span><span class="o">.</span><span class="n">zulip_message</span><span class="o">.</span><span class="n">links_for_preview</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;links_for_preview&#39;</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;./manage.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">46</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">364</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute_from_command_line</span>
    <span class="n">utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">356</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fetch_command</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span><span class="o">.</span><span class="n">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">283</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_from_argv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">cmd_options</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">330</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/commands/migrate.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">204</span><span class="p">,</span> <span class="ow">in</span> <span class="n">handle</span>
    <span class="n">fake_initial</span><span class="o">=</span><span class="n">fake_initial</span><span class="p">,</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/db/migrations/executor.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">115</span><span class="p">,</span> <span class="ow">in</span> <span class="n">migrate</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_migrate_all_forwards</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">plan</span><span class="p">,</span> <span class="n">full_plan</span><span class="p">,</span> <span class="n">fake</span><span class="o">=</span><span class="n">fake</span><span class="p">,</span> <span class="n">fake_initial</span><span class="o">=</span><span class="n">fake_initial</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/db/migrations/executor.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">145</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_migrate_all_forwards</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_migration</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">migration</span><span class="p">,</span> <span class="n">fake</span><span class="o">=</span><span class="n">fake</span><span class="p">,</span> <span class="n">fake_initial</span><span class="o">=</span><span class="n">fake_initial</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/db/migrations/executor.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">244</span><span class="p">,</span> <span class="ow">in</span> <span class="n">apply_migration</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">migration</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/db/migrations/migration.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">129</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">apply</span>
    <span class="n">operation</span><span class="o">.</span><span class="n">database_forwards</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">,</span> <span class="n">old_state</span><span class="p">,</span> <span class="n">project_state</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zulip-py3-venv/lib/python3.5/site-packages/django/db/migrations/operations/special.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">193</span><span class="p">,</span> <span class="ow">in</span> <span class="n">database_forwards</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">from_state</span><span class="o">.</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/migrations/0206_stream_rendered_description.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">15</span><span class="p">,</span> <span class="ow">in</span> <span class="n">render_all_stream_descriptions</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">rendered_description</span> <span class="o">=</span> <span class="n">bugdown_convert</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2272</span><span class="p">,</span> <span class="ow">in</span> <span class="n">convert</span>
    <span class="n">mention_data</span><span class="p">,</span> <span class="n">email_gateway</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/zerver/lib/bugdown/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2231</span><span class="p">,</span> <span class="ow">in</span> <span class="n">do_convert</span>
    <span class="k">raise</span> <span class="n">BugdownRenderingException</span><span class="p">()</span>
<span class="n">zerver</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BugdownRenderingException</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2019-02-28-21-55-06/scripts/lib/upgrade-zulip-stage-2&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">175</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">([</span><span class="s2">&quot;./manage.py&quot;</span><span class="p">,</span> <span class="s2">&quot;migrate&quot;</span><span class="p">,</span> <span class="s2">&quot;--noinput&quot;</span><span class="p">],</span> <span class="n">preexec_fn</span><span class="o">=</span><span class="n">su_to_zulip</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/usr/lib/python3.5/subprocess.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">271</span><span class="p">,</span> <span class="ow">in</span> <span class="n">check_call</span>
    <span class="k">raise</span> <span class="n">CalledProcessError</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span> <span class="n">Command</span> <span class="s1">&#39;[&#39;</span><span class="o">./</span><span class="n">manage</span><span class="o">.</span><span class="n">py</span><span class="s1">&#39;, &#39;</span><span class="n">migrate</span><span class="s1">&#39;, &#39;</span><span class="o">--</span><span class="n">noinput</span><span class="s1">&#39;]&#39;</span> <span class="n">returned</span> <span class="n">non</span><span class="o">-</span><span class="n">zero</span> <span class="nb">exit</span> <span class="n">status</span> <span class="mi">1</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip-from-git&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">70</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">deploy_path</span><span class="p">,</span> <span class="s2">&quot;--from-git&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">deploy_options</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/usr/lib/python3.5/subprocess.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">271</span><span class="p">,</span> <span class="ow">in</span> <span class="n">check_call</span>
    <span class="k">raise</span> <span class="n">CalledProcessError</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span> <span class="n">Command</span> <span class="s1">&#39;[&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">zulip</span><span class="o">/</span><span class="n">deployments</span><span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="mo">06</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">upgrade</span><span class="o">-</span><span class="n">zulip</span><span class="o">-</span><span class="n">stage</span><span class="o">-</span><span class="mi">2</span><span class="s1">&#39;, &#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">zulip</span><span class="o">/</span><span class="n">deployments</span><span class="o">/</span><span class="mi">2019</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="mo">06</span><span class="s1">&#39;, &#39;</span><span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">git</span><span class="s1">&#39;]&#39;</span> <span class="n">returned</span> <span class="n">non</span><span class="o">-</span><span class="n">zero</span> <span class="nb">exit</span> <span class="n">status</span> <span class="mi">1</span>
</pre></div>



<a name="709830"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709830" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709830">(Feb 28 2019 at 22:03)</a>:</h4>
<p>any idea what's going on?<br>
Might be good to fix this before release 2.0 ;-)</p>



<a name="709833"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709833" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709833">(Feb 28 2019 at 22:08)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> If you can help that would be great. Currently Zulip server is dead</p>



<a name="709834"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709834" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709834">(Feb 28 2019 at 22:14)</a>:</h4>
<p>looks like something relating to the links preview feature?</p>



<a name="709835"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709835" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709835">(Feb 28 2019 at 22:14)</a>:</h4>
<p>is that something we can fix so that the upgrade goes through?</p>



<a name="709836"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709836" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709836">(Feb 28 2019 at 22:14)</a>:</h4>
<p>maybe try turning it off?</p>



<a name="709837"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709837" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709837">(Feb 28 2019 at 22:15)</a>:</h4>
<p>otherwise I see myself forced to restore the container from a backup but Id rather not</p>



<a name="709838"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709838" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709838">(Feb 28 2019 at 22:15)</a>:</h4>
<p>how do I do that?</p>



<a name="709839"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709839" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709839">(Feb 28 2019 at 22:15)</a>:</h4>
<p>(these are just guesses, feel free to ignore)</p>



<a name="709840"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709840" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709840">(Feb 28 2019 at 22:15)</a>:</h4>
<p>I think it's probably in settings.py. But it's off by default, so would only be turned on if you had turned it on int the past</p>



<a name="709842"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709842" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709842">(Feb 28 2019 at 22:17)</a>:</h4>
<p>ok, done. Will that already take apply when I rerun the update script?</p>



<a name="709843"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709843" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709843">(Feb 28 2019 at 22:22)</a>:</h4>
<p>good question. I am not sure. <br>
Note that you can always rollback to a previous version, when upgrades fail: <br>
<a href="https://zulip.readthedocs.io/en/stable/production/maintain-secure-upgrade.html#rolling-back-to-a-prior-version" target="_blank" title="https://zulip.readthedocs.io/en/stable/production/maintain-secure-upgrade.html#rolling-back-to-a-prior-version">https://zulip.readthedocs.io/en/stable/production/maintain-secure-upgrade.html#rolling-back-to-a-prior-version</a></p>



<a name="709844"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709844" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709844">(Feb 28 2019 at 22:22)</a>:</h4>
<p>(though I'm not sure how that works with database migrations)</p>



<a name="709845"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709845" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709845">(Feb 28 2019 at 22:23)</a>:</h4>
<p>I tried that and it's not working</p>



<a name="709846"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709846" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709846">(Feb 28 2019 at 22:29)</a>:</h4>
<p><span class="user-mention" data-user-id="131">@Rishi Gupta</span> I just tried rerunning the upgrade and now it went through. Your guess was spot on after all.</p>



<a name="709847"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709847" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709847">(Feb 28 2019 at 22:29)</a>:</h4>
<p>so maybe that's something to look into then when URL_PREVIEW is turned on that it might mess with the upgrade process</p>



<a name="709848"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709848" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709848">(Feb 28 2019 at 22:30)</a>:</h4>
<p>yeah, definitely. Thanks for the report!</p>



<a name="709849"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709849" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709849">(Feb 28 2019 at 22:32)</a>:</h4>
<p>I turned the setting on again and restarted Zulip and that seems to work as well.</p>



<a name="709850"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709850" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709850">(Feb 28 2019 at 22:33)</a>:</h4>
<p>What  I noticed though is that the organisation logo top left has defaulted back to the Zulip  logo although in the settings our orga logo is still set</p>



<a name="709851"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709851" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709851">(Feb 28 2019 at 22:34)</a>:</h4>
<p>after reuploading it was back (using night mode if that might be of any relevance)</p>



<a name="709852"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709852" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709852">(Feb 28 2019 at 22:35)</a>:</h4>
<p><span class="user-mention" data-user-id="131">@Rishi Gupta</span> Thanks again for your help!</p>



<a name="709863"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709863" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709863">(Feb 28 2019 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="1646">@Matthias</span> thanks for the reports!  Definitely the migration interaction with inline line previews I'll want to fix and know how to.</p>



<a name="709865"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709865" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709865">(Feb 28 2019 at 22:56)</a>:</h4>
<p>For this issue:</p>
<blockquote>
<p>Hi, just running an upgrade from master. the last upgrade I did was on 22nd January. <br>
I run into multiple errors but it all led back to </p>
<div class="codehilite"><pre><span></span>deb https://packagecloud.io/zulip/server/debian/ stretch main
deb https://packages.groonga.org/debian/ stretch main
deb-src https://packages.groonga.org/debian/ stretch main
</pre></div>


<p>existing in both <code>/etc/apt/sources.list</code> and <code>/etc/apt/sources.list.d/zulip.list</code></p>
<p>I commented out the former.</p>
</blockquote>
<p>I'm a bit puzzled; I'm not aware of our ever having a version that would have put those lines in <code>/etc/apt/sources.list</code> rather than in <code>zulip.list</code>.</p>



<a name="709867"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709867" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709867">(Feb 28 2019 at 22:57)</a>:</h4>
<blockquote>
<p>What  I noticed though is that the organisation logo top left has defaulted back to the Zulip  logo although in the settings our orga logo is still set</p>
</blockquote>
<p><span class="user-mention" data-user-id="1646">@Matthias</span> can you provide more details on the exact sequence of events here?</p>



<a name="709875"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709875" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709875">(Feb 28 2019 at 23:02)</a>:</h4>
<p>logo: After the last upgrade on 22nd of January I uploaded the company logo and it worked fine. After the upgrade today I saw again the Zulip logo and when I checked the settings the menu was still showing the uploaded image for both themes (normal and night mode).<br>
I didn't check for the logo before the upgrade though and can't remember whether it might have been missing before. <br>
That's all I can  tell.</p>



<a name="709877"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709877" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709877">(Feb 28 2019 at 23:07)</a>:</h4>
<p>Hmm, OK</p>



<a name="709879"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709879" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709879">(Feb 28 2019 at 23:07)</a>:</h4>
<p>The main logo-related thing we changed was adding support for a separate night-mode logo (for logos that need to be changed to look good on a dark background)</p>



<a name="709880"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709880" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709880">(Feb 28 2019 at 23:09)</a>:</h4>
<p>yes, that might be it. When I uploaded the night mode image (although the preview was already showing) the delete button appeared   below it and it wasn't there before.</p>



<a name="709910"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/709910" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#709910">(Mar 01 2019 at 01:03)</a>:</h4>
<p><span class="user-mention" data-user-id="1646">@Matthias</span> I just fixed that upgrade issue in <a href="https://github.com/zulip/zulip/commit/de65a04ae08826e9a6b21c86d208706b77292da1" target="_blank" title="https://github.com/zulip/zulip/commit/de65a04ae08826e9a6b21c86d208706b77292da1">de65a04ae08826e9a6b21c86d208706b77292da1</a>, thanks for the report!  <span class="user-mention" data-user-id="9895">@Hemanth V. Alluri</span> FYI, since this was an issue we didn't think of.  There is also probably some useful follow-up to do of making a <code>render_stream_description</code> function wrapping <code>bugdown_convert</code> so that we don't have to worry about updating 5 call points in future changes -- it'd be great if you can take the refactor.</p>



<a name="710096"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/710096" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Hemanth V. Alluri <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#710096">(Mar 01 2019 at 11:42)</a>:</h4>
<blockquote>
<p>There is also probably some useful follow-up to do of making a render_stream_description function wrapping bugdown_convert so that we don't have to worry about updating 5 call points in future changes</p>
</blockquote>
<p>Totally agree. I opened PR <a href="https://github.com/zulip/zulip/pull/11728" target="_blank" title="https://github.com/zulip/zulip/pull/11728">#11728</a> for this, and would like some feedback about a design decision I made.</p>



<a name="711453"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711453" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711453">(Mar 02 2019 at 14:09)</a>:</h4>
<p>after this troublesome upgrade I have 3 redundant versions in the deployment folder. Is there a safe way to delete those that are not used?</p>



<a name="711454"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711454" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711454">(Mar 02 2019 at 14:09)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> ping</p>



<a name="711566"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711566" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711566">(Mar 02 2019 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="1646">@Matthias</span> old ones get automatically garbage-collected during later upgrades</p>



<a name="711567"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711567" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711567">(Mar 02 2019 at 17:01)</a>:</h4>
<p><code>scripts/purge-old-deployments</code> is the manual tool for doing that, though by default it keeps them from the last week or so.</p>



<a name="711568"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711568" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711568">(Mar 02 2019 at 17:01)</a>:</h4>
<p>So there's no action required here unless you're nearly out of disk</p>



<a name="711978"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711978" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711978">(Mar 03 2019 at 02:07)</a>:</h4>
<p><span class="user-mention" data-user-id="1646">@Matthias</span> I believe I fixed the logo issue in master today as well, thanks to another report that made me realize what the bug was.</p>



<a name="711979"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/711979" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#711979">(Mar 03 2019 at 02:08)</a>:</h4>
<p>We'll be doing a 2.0.1 release with that fix soon.</p>



<a name="712405"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%20master/near/712405" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.20master.html#712405">(Mar 03 2019 at 20:09)</a>:</h4>
<p>thanks, so next weekend I could run that purge script and get back some space. It's not so much disk space but the container backups (with compression) take a lot longer. Further 3 of those folders are basically failed upgrades, the content is identical.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>