<html>
<head><meta charset="utf-8"><title>Zulip Slack Alike webhook fails · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html">Zulip Slack Alike webhook fails</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1625601"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625601" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625601">(Aug 15 2023 at 17:46)</a>:</h4>
<p>I do not know why this one fails yet makes nasty logs: </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Internal<span class="w"> </span>Server<span class="w"> </span>Error:<span class="w"> </span>/api/v1/external/slack_incoming

Report<span class="w"> </span>at<span class="w"> </span>/api/v1/external/slack_incoming
Internal<span class="w"> </span>Server<span class="w"> </span>Error:<span class="w"> </span>/api/v1/external/slack_incoming

Request<span class="w"> </span>Method:<span class="w"> </span>POST
Request<span class="w"> </span>URL:<span class="w"> </span>https://chat.uhlhosting.ch/api/v1/external/slack_incoming?api_key<span class="o">=</span>Ft6y46GtD8BwsdRvy1SN5bnu8Tgs7xMx<span class="p">&amp;</span>amp<span class="p">;</span><span class="nv">stream</span><span class="o">=</span>Reports
Django<span class="w"> </span>Version:<span class="w"> </span><span class="m">4</span>.2.3
Python<span class="w"> </span>Executable:<span class="w"> </span>/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/bin/uwsgi
Python<span class="w"> </span>Version:<span class="w"> </span><span class="m">3</span>.8.10
Python<span class="w"> </span>Path:<span class="w"> </span><span class="o">[</span><span class="s1">'.'</span>,<span class="w"> </span><span class="s1">''</span>,<span class="w"> </span><span class="s1">'/usr/lib/python38.zip'</span>,<span class="w"> </span><span class="s1">'/usr/lib/python3.8'</span>,<span class="w"> </span><span class="s1">'/usr/lib/python3.8/lib-dynload'</span>,<span class="w"> </span><span class="s1">'/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages'</span>,<span class="w"> </span><span class="s1">'/home/zulip/deployments/2023-08-13-09-53-23'</span>,<span class="w"> </span><span class="s1">'/home/zulip/deployments/2023-08-13-09-53-23'</span><span class="o">]</span>
Server<span class="w"> </span>time:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">15</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">17</span>:33:17<span class="w"> </span>+0000
Installed<span class="w"> </span>Applications:
<span class="o">[</span><span class="s1">'django.contrib.auth'</span>,
<span class="s1">'django.contrib.contenttypes'</span>,
<span class="s1">'django.contrib.sessions'</span>,
<span class="s1">'django.contrib.staticfiles'</span>,
<span class="s1">'confirmation'</span>,
<span class="s1">'zerver'</span>,
<span class="s1">'social_django'</span>,
<span class="s1">'django_scim'</span>,
<span class="s1">'django_otp'</span>,
<span class="s1">'django_otp.plugins.otp_static'</span>,
<span class="s1">'django_otp.plugins.otp_totp'</span>,
<span class="s1">'two_factor'</span>,
<span class="s1">'two_factor.plugins.phonenumber'</span>,
<span class="s1">'pgroonga'</span>,
<span class="s1">'analytics'</span><span class="o">]</span>
Installed<span class="w"> </span>Middleware:
<span class="o">[</span><span class="s1">'zerver.middleware.TagRequests'</span>,
<span class="s1">'zerver.middleware.SetRemoteAddrFromRealIpHeader'</span>,
<span class="s1">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
<span class="s1">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
<span class="s1">'zerver.middleware.LogRequests'</span>,
<span class="s1">'zerver.middleware.JsonErrorHandler'</span>,
<span class="s1">'zerver.middleware.RateLimitMiddleware'</span>,
<span class="s1">'zerver.middleware.FlushDisplayRecipientCache'</span>,
<span class="s1">'django.middleware.common.CommonMiddleware'</span>,
<span class="s1">'zerver.middleware.LocaleMiddleware'</span>,
<span class="s1">'zerver.middleware.HostDomainMiddleware'</span>,
<span class="s1">'zerver.middleware.DetectProxyMisconfiguration'</span>,
<span class="s1">'django.middleware.csrf.CsrfViewMiddleware'</span>,
<span class="s1">'django_otp.middleware.OTPMiddleware'</span>,
<span class="s1">'two_factor.middleware.threadlocals.ThreadLocals'</span>,
<span class="s1">'zerver.middleware.FinalizeOpenGraphDescription'</span><span class="o">]</span>
</code></pre></div>



<a name="1625605"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625605" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625605">(Aug 15 2023 at 17:47)</a>:</h4>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/base.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">197</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_response</span>
   <span class="n">response</span> <span class="o">=</span> <span class="n">wrapped_callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">callback_args</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/sentry_sdk/integrations/django/views.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">84</span><span class="p">,</span> <span class="ow">in</span> <span class="n">sentry_wrapped_callback</span>
   <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/django/views/decorators/csrf.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">56</span><span class="p">,</span> <span class="ow">in</span> <span class="n">wrapper_view</span>
   <span class="k">return</span> <span class="n">view_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/request.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">460</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_req_func</span>
   <span class="n">return_value</span> <span class="o">=</span> <span class="n">req_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/decorator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">375</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_func_arguments</span>
   <span class="k">raise</span> <span class="n">err</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/decorator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">358</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_func_arguments</span>
   <span class="k">return</span> <span class="n">view_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/request.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">460</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_req_func</span>
   <span class="n">return_value</span> <span class="o">=</span> <span class="n">req_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/webhooks/slack_incoming/view.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">66</span><span class="p">,</span> <span class="ow">in</span> <span class="n">api_slack_incoming_webhook</span>
   <span class="n">pieces</span> <span class="o">+=</span> <span class="nb">map</span><span class="p">(</span><span class="n">render_attachment</span><span class="p">,</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"attachments"</span><span class="p">])</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/webhooks/slack_incoming/view.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">225</span><span class="p">,</span> <span class="ow">in</span> <span class="n">render_attachment</span>
   <span class="n">time</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s2">"ts"</span><span class="p">]</span><span class="o">.</span><span class="n">tame</span><span class="p">(</span><span class="n">check_int</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/validator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">682</span><span class="p">,</span> <span class="ow">in</span> <span class="n">tame</span>
   <span class="k">return</span> <span class="n">validator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/validator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">163</span><span class="p">,</span> <span class="ow">in</span> <span class="n">check_int</span>
   <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">"</span><span class="si">{var_name}</span><span class="s2"> is not an integer"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">))</span>
<span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span> <span class="p">[</span><span class="s2">"payload['attachments'][0]['ts'] is not an integer"</span><span class="p">]</span>


<span class="n">Report</span> <span class="n">at</span> <span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">external</span><span class="o">/</span><span class="n">slack_incoming</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/base.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">197</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_response</span>
   <span class="n">response</span> <span class="o">=</span> <span class="n">wrapped_callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">callback_args</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/sentry_sdk/integrations/django/views.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">84</span><span class="p">,</span> <span class="ow">in</span> <span class="n">sentry_wrapped_callback</span>
   <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/srv/zulip-venv-cache/2400963d75777d349034bf6319b9c0e84f407961/zulip-py3-venv/lib/python3.8/site-packages/django/views/decorators/csrf.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">56</span><span class="p">,</span> <span class="ow">in</span> <span class="n">wrapper_view</span>
   <span class="k">return</span> <span class="n">view_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/request.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">460</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_req_func</span>
   <span class="n">return_value</span> <span class="o">=</span> <span class="n">req_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/decorator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">375</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_func_arguments</span>
   <span class="k">raise</span> <span class="n">err</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/decorator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">358</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_func_arguments</span>
   <span class="k">return</span> <span class="n">view_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/request.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">460</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_req_func</span>
   <span class="n">return_value</span> <span class="o">=</span> <span class="n">req_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/webhooks/slack_incoming/view.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">66</span><span class="p">,</span> <span class="ow">in</span> <span class="n">api_slack_incoming_webhook</span>
   <span class="n">pieces</span> <span class="o">+=</span> <span class="nb">map</span><span class="p">(</span><span class="n">render_attachment</span><span class="p">,</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"attachments"</span><span class="p">])</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/webhooks/slack_incoming/view.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">225</span><span class="p">,</span> <span class="ow">in</span> <span class="n">render_attachment</span>
   <span class="n">time</span> <span class="o">=</span> <span class="n">attachment</span><span class="p">[</span><span class="s2">"ts"</span><span class="p">]</span><span class="o">.</span><span class="n">tame</span><span class="p">(</span><span class="n">check_int</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/validator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">682</span><span class="p">,</span> <span class="ow">in</span> <span class="n">tame</span>
   <span class="k">return</span> <span class="n">validator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
 <span class="n">File</span> <span class="s2">"/home/zulip/deployments/2023-08-13-09-53-23/./zerver/lib/validator.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">163</span><span class="p">,</span> <span class="ow">in</span> <span class="n">check_int</span>
   <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">"</span><span class="si">{var_name}</span><span class="s2"> is not an integer"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="n">var_name</span><span class="p">))</span>
<span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span> <span class="p">[</span><span class="s2">"payload['attachments'][0]['ts'] is not an integer"</span><span class="p">]</span>
</code></pre></div>



<a name="1625607"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625607" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625607">(Aug 15 2023 at 17:48)</a>:</h4>
<p>The <code>ts</code> field of the <code>attachments</code> array of objects must be an integer: <a href="https://api.slack.com/reference/messaging/attachments#legacy_fields">https://api.slack.com/reference/messaging/attachments#legacy_fields</a></p>



<a name="1625609"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625609" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625609">(Aug 15 2023 at 17:49)</a>:</h4>
<p>You're probably passing a string.</p>



<a name="1625612"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625612" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625612">(Aug 15 2023 at 17:50)</a>:</h4>
<p>(You also just posted an API key, which you should probably now rotate)</p>



<a name="1625613"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20Slack%20Alike%20webhook%20fails/near/1625613" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20Slack.20Alike.20webhook.20fails.html#1625613">(Aug 15 2023 at 17:51)</a>:</h4>
<p><a href="/user_uploads/2/72/ZrwSZ2ypdoEVjc9RorCGNNoL/image.png">image.png</a><br>
quite a lot of them. How can I add normal incoming webhook? Is there a doc file with all possible incoming types of URL, slack, slack_compatible, there should be also default incoming, where can I find them, sorry the website needs a bit care. </p>
<div class="message_inline_image"><a href="/user_uploads/2/72/ZrwSZ2ypdoEVjc9RorCGNNoL/image.png" title="image.png"><img src="/user_uploads/2/72/ZrwSZ2ypdoEVjc9RorCGNNoL/image.png"></a></div><p>I checked there, when I want to deal with incoming webhooks sends me to area of development of webhooks, rather than simple step to create incoming / outgoing webhooks. </p>
<p>Even on whole integrations, if one writes webhooks finds nothing, did you guys made that intentionally? I could have sweared there was docs on incoming webhooks and the url structure required. </p>
<p>Why are they missing from the Main zulip integration site? Just do a simple search for webhooks, sorry not al webhooks can be under slack compatible...</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>