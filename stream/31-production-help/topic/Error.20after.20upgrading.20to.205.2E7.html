<html>
<head><meta charset="utf-8"><title>Error after upgrading to 5.7 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html">Error after upgrading to 5.7</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1466715"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466715" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lumrenion <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466715">(Nov 17 2022 at 19:09)</a>:</h4>
<p>Hi, I just tried to upgrade to 5.7 and suddenly I get an internal server error. I tried to downgrade again to 5.6 and the error now persists. The error appears when I try to view zulip in desktop app, and also on web as soon as I click on the button to login via SAML. Sadly, the django error does not help me to solve the problem myself :( </p>
<div class="codehilite"><pre><span></span><code>Logger django.request, from module django.utils.log line 224:
Error generated by MyName &lt;user9@chat.example.com&gt; (Organization administrator) on chat.example.com deployment

Traceback (most recent call last):
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/exception.py&quot;, line 47, in inner
   response = get_response(request)
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/base.py&quot;, line 181, in _get_response
   response = wrapped_callback(request, *callback_args, **callback_kwargs)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/views/home.py&quot;, line 129, in home
   return zulip_login_required(home_real)(request)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 433, in _wrapped_view
   return view_func(request, *args, **kwargs)
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/django/contrib/auth/decorators.py&quot;, line 21, in _wrapped_view
   return view_func(request, *args, **kwargs)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 482, in _wrapped_view_func
   return rate_limit()(view_func)(request, *args, **kwargs)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 982, in wrapped_func
   rate_limit_user(request, user, domain=&quot;api_by_user&quot;)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/decorator.py&quot;, line 887, in rate_limit_user
   RateLimitedUser(user, domain=domain).rate_limit_request(request)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 47, in rate_limit_request
   ratelimited, time = self.rate_limit()
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 40, in rate_limit
   return self.backend.rate_limit_entity(
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 492, in rate_limit_entity
   ratelimited, time = cls.is_ratelimited(entity_key, rules)
 File &quot;/home/zulip/deployments/2022-11-16-16-21-02/./zerver/lib/rate_limiter.py&quot;, line 404, in is_ratelimited
   rule_timestamps: List[Optional[bytes]] = pipe.execute()
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/client.py&quot;, line 2072, in execute
   conn = self.connection_pool.get_connection(&quot;MULTI&quot;, self.shard_hint)
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 1387, in get_connection
   connection.connect()
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 623, in connect
   self.on_connect()
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 713, in on_connect
   auth_response = self.read_response()
 File &quot;/srv/zulip-venv-cache/aec974d63b86e7862ff0e1a8ce127e9401e4a346/zulip-py3-venv/lib/python3.8/site-packages/redis/connection.py&quot;, line 839, in read_response
   raise response
redis.exceptions.ResponseError: AUTH &lt;password&gt; called without any password configured for the default user. Are you sure your configuration is correct?


Deployed code:
- git: None
- ZULIP_VERSION: 5.7
</code></pre></div>



<a name="1466719"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466719" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466719">(Nov 17 2022 at 19:10)</a>:</h4>
<p><span class="user-mention" data-user-id="20570">@Lumrenion</span> it looks like your <code>redis</code> server is busted; I would try restarting <code>redis</code> as a first thing, but also is it possible you made some changes to its configuration while doing the upgrade?</p>



<a name="1466720"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466720" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466720">(Nov 17 2022 at 19:11)</a>:</h4>
<p>I would be quite surprised if the 5.6 to 5.7 upgrade itself has anything to do with that exception, though it's possible that, for example, an <code>apt upgrade</code> caused Redis to restart, or something like that.</p>



<a name="1466725"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466725" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lumrenion <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466725">(Nov 17 2022 at 19:13)</a>:</h4>
<p>wow, thanks for the quick reply and hinting me towards redis. I did not change anything in the docker-compose.yml except the zulip version. But I also upgraded the redis container as the service is configured using the latest version. I will check that</p>



<a name="1466778"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466778" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lumrenion <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466778">(Nov 17 2022 at 19:46)</a>:</h4>
<p>ok, so for some reason, suddenly another redis container is conflicting although they have different container_names and are not connected via network. If I start the zulip_redis_1 container first and then the other one, both zulip and the other service requiring redis are running fine. But if I start the zulip_redis_1 container when the other one is already running, zulip won't work.</p>



<a name="1466786"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20after%20upgrading%20to%205.7/near/1466786" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lumrenion <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20after.20upgrading.20to.205.2E7.html#1466786">(Nov 17 2022 at 19:48)</a>:</h4>
<p>oh wait, Zulip is indeed connected with both redis containers via two different networks. And because both have the same hostname in their respective networks (<code>redis</code>), zulip takes the wrong one <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>