<html>
<head><meta charset="utf-8"><title>Setup issue: email relaying denied · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html">Setup issue: email relaying denied</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="20048"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20048" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20048">(Aug 27 2016 at 20:30)</a>:</h4>
<p>Hope this is the right place to ask. I'm trying to setup an instance of Zulip on a digital ocean droplet and getting a "Relaying denied" error when trying to run the send_test_email script. I imagine it may be something wrong with my e-mail settings (using Mailgun for this) but I'm not sure what. Anyone have advice on things to check for or up for taking a look at the config and seeing if it looks correct?</p>



<a name="20049"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20049" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20049">(Aug 27 2016 at 20:38)</a>:</h4>
<p>You can try checking in the Mailgun web UI for whether there's anything there</p>



<a name="20050"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20050" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20050">(Aug 27 2016 at 20:39)</a>:</h4>
<p>That could be an issue with your SPF record or your droplet's IP being blacklisted for sending spam or osmething</p>



<a name="20051"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20051" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20051">(Aug 27 2016 at 20:40)</a>:</h4>
<p>Also, <span class="user-mention" data-user-email="neurodynamicdev@gmail.com">@Mark Stewart</span> the full traceback might answer this, but it could be an issue with the machine's firewall</p>



<a name="20052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20052">(Aug 27 2016 at 20:40)</a>:</h4>
<p>gtg for now</p>



<a name="20053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20053">(Aug 27 2016 at 20:42)</a>:</h4>
<p>Thanks! Doesn't look like anything has hit mailgun.</p>



<a name="20054"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20054" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20054">(Aug 27 2016 at 20:43)</a>:</h4>
<p>Here's the output:</p>
<p>./manage.py send_test_email '<a href="mailto:mygmailaddress@gmail.com" title="mailto:mygmailaddress@gmail.com">mygmailaddress@gmail.com</a>'<br>
Traceback (most recent call last):<br>
  File "./manage.py", line 29, in &lt;module&gt;<br>
    execute_from_command_line(sys.argv)<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py", line 338, in execute_from_command_line<br>
    utility.execute()<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py", line 330, in execute<br>
    self.fetch_command(subcommand).run_from_argv(self.argv)<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py", line 390, in run_from_argv<br>
    self.execute(*args, **cmd_options)<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py", line 441, in execute<br>
    output = self.handle(*args, **options)<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zerver/management/commands/send_test_email.py", line 26, in handle<br>
    send_mail(subject, message, sender, [to])<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/mail/__init__.py", line 62, in send_mail<br>
    return mail.send()<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/mail/message.py", line 303, in send<br>
    return self.get_connection(fail_silently).send_messages([self])<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/mail/backends/smtp.py", line 107, in send_messages<br>
    sent = self._send(message)<br>
  File "/home/zulip/deployments/2016-08-26-11-02-26/zulip-venv/lib/python2.7/site-packages/django/core/mail/backends/smtp.py", line 123, in _send<br>
    self.connection.sendmail(from_email, recipients, message.as_bytes(linesep='\r\n'))<br>
  File "/usr/lib/python2.7/smtplib.py", line 747, in sendmail<br>
    raise SMTPRecipientsRefused(senderrs)<br>
smtplib.SMTPRecipientsRefused: {u'<a href="mailto:mygmailaddress@gmail.com" title="mailto:mygmailaddress@gmail.com">mygmailaddress@gmail.com</a>': (550, '5.7.1 Relaying denied')}</p>



<a name="20055"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20055" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20055">(Aug 27 2016 at 20:45)</a>:</h4>
<p>And email settings:</p>
<p>EMAIL_HOST = '<a href="http://smtp.mailgun.org" target="_blank" title="http://smtp.mailgun.org">smtp.mailgun.org</a>'<br>
EMAIL_HOST_USER = '<a href="mailto:postmaster@mg.mydomain.com" title="mailto:postmaster@mg.mydomain.com">postmaster@mg.mydomain.com</a>'<br>
EMAIL_PORT = 587<br>
EMAIL_USE_TLS = True<br>
# The email From address to be used for automatically generated emails<br>
DEFAULT_FROM_EMAIL = "Zulip &lt;<a href="mailto:zulip@mg.mydomain.com" title="mailto:zulip@mg.mydomain.com">zulip@mg.mydomain.com</a>&gt;"<br>
# The noreply address to be used as Reply-To for certain generated emails.<br>
# Messages sent to this address should not be delivered anywhere.<br>
NOREPLY_EMAIL_ADDRESS = "<a href="mailto:noreply@mg.mydomain.com" title="mailto:noreply@mg.mydomain.com">noreply@mg.mydomain.com</a>"</p>



<a name="20145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20145">(Aug 28 2016 at 00:18)</a>:</h4>
<p>This looks like a firewall issue to me as well.  Do you have any way to test outgoing emails on this host that doesn't involve the Zulip codebase?  Also, have you double-checked your host's outgoing email configuration?</p>



<a name="20156"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20156" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20156">(Aug 28 2016 at 17:53)</a>:</h4>
<p>So this is a little embarrassing...it's working now, either thanks to Digital Ocean's advice to run:</p>
<p>"sudo ufw allow 25" <br>
"sudo ufw allow 587" <br>
"sudo ufw allow 465" </p>
<p>...or the fact that I had forgotten to set the password in the secrets file. Or quite probably both.</p>



<a name="20157"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20157" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20157">(Aug 28 2016 at 17:54)</a>:</h4>
<p>Thanks everybody for the help, though, it was helpful in my tracking it down even if the result was partly my that I missed a crucial detail :)</p>



<a name="20158"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20158" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20158">(Aug 28 2016 at 17:55)</a>:</h4>
<p>No problem, glad you're back in business!  (I was just making wild guesses, but sometimes that's helpful, apparently, haha.)</p>



<a name="20159"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20159" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20159">(Aug 28 2016 at 18:22)</a>:</h4>
<p>Actually, quick note, though: putting the password in the secrets file is documented in the comments in the settings file, but I think it would help to add it as a "don't forget" parenthetical in the smtp setup bit here: <a href="https://zulip.readthedocs.io/en/latest/prod-install.html#step-3-configure-zulip" target="_blank" title="https://zulip.readthedocs.io/en/latest/prod-install.html#step-3-configure-zulip">https://zulip.readthedocs.io/en/latest/prod-install.html#step-3-configure-zulip</a></p>
<p>I think I missed the comment because I was following that page's instructions and just looking for the variables themselves in the file, rather than also following the comments in the file.</p>
<p>Created a pull request for this: <a href="https://github.com/zulip/zulip/pull/1728" target="_blank" title="https://github.com/zulip/zulip/pull/1728">https://github.com/zulip/zulip/pull/1728</a></p>



<a name="20160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20160">(Aug 28 2016 at 18:25)</a>:</h4>
<p>super minor wording nit: instead of saying (don't forget .... as well), maybe say (and don't forget...).</p>



<a name="20161"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20161" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20161">(Aug 28 2016 at 18:26)</a>:</h4>
<p>I can merge it tomorrow either way.  Pinging <span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> in case she thinks of any other places where it would be good to remind folks of the secrets stuff.</p>



<a name="20162"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20162" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20162">(Aug 28 2016 at 18:29)</a>:</h4>
<p>Sounds good to me. Should I make that change? I'm somewhat inexperienced at the social conventions of OS contributing</p>



<a name="20163"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20163" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20163">(Aug 28 2016 at 18:32)</a>:</h4>
<p>yes, please!  you can probably just force-push the same branch that you made the original PR on after you amend your commit</p>



<a name="20164"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20164" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20164">(Aug 28 2016 at 18:34)</a>:</h4>
<p>after you submit we do a Travis build, which for a doc change, checks a bunch of stuff you couldn't possibly have broken, haha.  The one thing it will check for is trailing whitespace.  Once the build passes, Tim or I can merge it.  Tim's on vacation, and I probably won't get to it until tomorrow.</p>



<a name="20165"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20165" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20165">(Aug 28 2016 at 18:36)</a>:</h4>
<p>And your PR is much appreciated!  When you're in the weeds of doing an install, it's kinda hard to even think about cleaning up docs for future people, so I appreciate your effort.</p>



<a name="20166"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20166" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20166">(Aug 28 2016 at 19:49)</a>:</h4>
<p>Done! And you're welcome, thanks for saying so :)</p>



<a name="20168"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20168" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20168">(Aug 28 2016 at 20:32)</a>:</h4>
<p>Ok, I just pushed your change.  I amended the commit to just have the first line, since it was pretty clear what you were doing, and I didn't feel like word-wrapping the explanation.</p>



<a name="20169"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/20169" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#20169">(Aug 28 2016 at 20:33)</a>:</h4>
<p>(just the first line in the commit message)</p>



<a name="21934"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setup%20issue%3A%20email%20relaying%20denied/near/21934" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setup.20issue.3A.20email.20relaying.20denied.html#21934">(Sep 06 2016 at 18:06)</a>:</h4>
<p>Awesome, thanks <span class="user-mention" data-user-email="neurodynamicdev@gmail.com">@Mark Stewart</span> for the feedback!  This is one of those small documentation tweaks that I expect will save a lot of people time over the coming months.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>