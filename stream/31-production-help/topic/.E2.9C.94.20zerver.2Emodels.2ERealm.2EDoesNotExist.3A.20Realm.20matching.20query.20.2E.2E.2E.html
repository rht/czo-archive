<html>
<head><meta charset="utf-8"><title>✔ zerver.models.Realm.DoesNotExist: Realm matching query ... · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html">✔ zerver.models.Realm.DoesNotExist: Realm matching query ...</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1259017"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259017" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259017">(Sep 24 2021 at 23:50)</a>:</h4>
<p>After failing attempts of making my existing zulip  to be stable , i tried to installing new zulip stable : 4.6  on a new , clean instance, and when  i create ogranization , it leads to blank page  after adding admin email,... i refreshed and then when i tried to login , I got greeted with Internal server error . <br>
Checking the log shows this :  </p>
<div class="codehilite"><pre><span></span><code>2021-09-24 23:39:40.300 ERR  [django.request] Internal Server Error: /accounts/login/
Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/exception.py&quot;, line 47, in inner
    response = get_response(request)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/core/handlers/base.py&quot;, line 181, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;/home/zulip/deployments/2021-09-24-22-47-25/./zerver/lib/request.py&quot;, line 390, in _wrapped_view_func
    return view_func(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2021-09-24-22-47-25/./zerver/views/auth.py&quot;, line 750, in login_page
    template_response = DjangoLoginView.as_view(
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/views/generic/base.py&quot;, line 70, in view
    return self.dispatch(request, *args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/utils/decorators.py&quot;, line 43, in _wrapper
    return bound_method(*args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/views/decorators/debug.py&quot;, line 89, in sensitive_post_parameters_wrapper
    return view(request, *args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/utils/decorators.py&quot;, line 43, in _wrapper
    return bound_method(*args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/utils/decorators.py&quot;, line 130, in _wrapped_view
    response = view_func(request, *args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/forms/forms.py&quot;, line 170, in errors
    self.full_clean()
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/forms/forms.py&quot;, line 373, in full_clean
    self._clean_form()
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/forms/forms.py&quot;, line 400, in _clean_form
    cleaned_data = self.clean()
  File &quot;/home/zulip/deployments/2021-09-24-22-47-25/./zerver/forms.py&quot;, line 388, in clean
    realm = get_realm(subdomain)
  File &quot;/home/zulip/deployments/2021-09-24-22-47-25/./zerver/models.py&quot;, line 762, in get_realm
    return Realm.objects.get(string_id=string_id)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/manager.py&quot;, line 85, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
  File &quot;/srv/zulip-venv-cache/cc77818846b328558cc9444c67cbbe0121ca80f4/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py&quot;, line 435, in get
    raise self.model.DoesNotExist(
zerver.models.Realm.DoesNotExist: Realm matching query does not exist.
2021-09-24 23:39:50.417 ERR  [django.request] Internal Server Error: /accounts/login/
Traceback (most recent call last):
</code></pre></div>



<a name="1259019"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259019" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259019">(Sep 24 2021 at 23:58)</a>:</h4>
<p>the command i used is :<br>
<code>./zulip-server-*/scripts/setup/install --email=email@example.com --hostname=chat.example.com --self-signed-cert</code></p>



<a name="1259020"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259020" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259020">(Sep 25 2021 at 00:01)</a>:</h4>
<p>Nobody had as much bug as me? LOL</p>



<a name="1259025"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259025" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259025">(Sep 25 2021 at 00:10)</a>:</h4>
<p><span class="user-mention" data-user-id="21466">@v3ss0n</span> that exception is not one I'm familiar with.  Are you sure you didn't see other errors earlier in the process?</p>



<a name="1259026"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259026" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259026">(Sep 25 2021 at 00:11)</a>:</h4>
<p>To me, that looks like what might happen if you try to visit the login page for an organization that doesn't exist but perhaps exists in <code>memcached</code> or something like that.  (Perhaps you ran the installer multiple times?)</p>



<a name="1259027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259027">(Sep 25 2021 at 00:12)</a>:</h4>
<p>There's certainly some detail about what you did here that you haven't mentioned and is necessary to understand what caused this surprising failure mode.</p>



<a name="1259029"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259029" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259029">(Sep 25 2021 at 00:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/31-production-help/topic/zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20do.2E.2E.2E/near/1259025">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="21466">v3ss0n</span> that exception is not one I'm familiar with.  Are you sure you didn't see other errors earlier in the process?</p>
</blockquote>
<p>i  just restored the instance from snapshop and tried again ,  same problem .</p>
<p>here is my bash history </p>
<div class="codehilite"><pre><span></span><code>    1  ls
    2  cd $(mktemp -d)
    3  wget https://download.zulip.com/server/zulip-server-latest.tar.gz
    4  tar -xf zulip-server-latest.tar.gz
    5  ./zulip-server-*/scripts/setup/install --email=aaa@aaa.tech --hostname=aaa.aaa.tech --self-signed-cert
    6  vim /etc/zulip/zulip-secrets.conf
    7  vim /etc/zulip/settings.py
    8  vim /etc/zulip/zulip-secrets.conf
    9  history | less
</code></pre></div>



<a name="1259031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259031">(Sep 25 2021 at 00:15)</a>:</h4>
<p>My guess is the instance you had before the snapshot was not clean in some way.  I also don't see the tool to generate the invite link there.</p>



<a name="1259032"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259032" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259032">(Sep 25 2021 at 00:16)</a>:</h4>
<p>the last output after installing :</p>
<div class="codehilite"><pre><span></span><code>zulip-workers:zulip_events_missedmessage_emails: started
zulip-workers:zulip_events_missedmessage_mobile_notifications: started
zulip-workers:zulip_events_outgoing_webhooks: started
zulip-workers:zulip_events_user_activity: started
zulip-workers:zulip_events_user_activity_interval: started
zulip-workers:zulip_events_user_presence: started
zulip-workers:zulip_deliver_scheduled_emails: started
zulip-workers:zulip_deliver_scheduled_messages: started
+ set +x
+ su zulip -c &#39;/home/zulip/deployments/current/manage.py generate_realm_creation_link&#39;
Please visit the following secure single-use link to register your
new Zulip organization:

    https://aaa.aaa.tech/new/k5tgstpkvhim6ti6s3wl553b
</code></pre></div>



<a name="1259034"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259034" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259034">(Sep 25 2021 at 00:16)</a>:</h4>
<p>after visiting that link and entered my email address i got a blank page</p>



<a name="1259035"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259035" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259035">(Sep 25 2021 at 00:23)</a>:</h4>
<p>i gonna try clean install again</p>



<a name="1259036"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259036" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259036">(Sep 25 2021 at 00:44)</a>:</h4>
<p>hahaha , its caching problem.<br>
It cause javascript error during Organization setup  due to cache.<br>
and then it leads it incomplete organization begin setup.<br>
CLearing cache make it works.</p>
<p>what interesting is : on this clean setup ,  i am using self sigend cert , and then same Nginx Proxying as before. and it dosen't cause "Reloading" problem so far.</p>



<a name="1259037"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20zerver.models.Realm.DoesNotExist%3A%20Realm%20matching%20query%20.../near/1259037" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> v3ss0n <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20zerver.2Emodels.2ERealm.2EDoesNotExist.3A.20Realm.20matching.20query.20.2E.2E.2E.html#1259037">(Sep 25 2021 at 00:45)</a>:</h4>
<p>SO it is not my custom Nginx reverse proxy's SSL causing  CSRF Token problem.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>