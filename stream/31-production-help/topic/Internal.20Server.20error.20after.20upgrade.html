<html>
<head><meta charset="utf-8"><title>Internal Server error after upgrade · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html">Internal Server error after upgrade</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="799346"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799346" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799346">(Nov 26 2019 at 16:58)</a>:</h4>
<p>I have upgraded zulip and whoever was logged into the client works fine but if you try to login again or from a webpage or the desktop app, or phone app, it says internal server error. Everyone currently logged into the app is still able to use Zulip normally and message everyone.</p>



<a name="799347"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799347" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799347">(Nov 26 2019 at 16:58)</a>:</h4>
<p>Any Ideas?</p>



<a name="799349"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799349" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799349">(Nov 26 2019 at 17:18)</a>:</h4>
<p><span class="user-mention" data-user-id="12396">@Branden Keating</span> have you upgraded to master from git? or to 2.0.7? or to 2.1 release candidate?</p>



<a name="799350"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799350" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799350">(Nov 26 2019 at 17:21)</a>:</h4>
<p>and can you post <code>/var/log/zulip/errors.log</code>?</p>



<a name="799351"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799351" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799351">(Nov 26 2019 at 18:03)</a>:</h4>
<p>Sorry, just saw this as I was in a meeting.<br>
Logs:</p>



<a name="799352"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799352" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799352">(Nov 26 2019 at 18:03)</a>:</h4>
<p>2019-11-26 15:05:08.465 WARN [] Invalid data.<br>
2019-11-26 15:23:16.272 WARN [zerver.lib.email_mirror] EMAIL_GATEWAY_PATTERN is an empty string, using NOREPLY_EMAIL_ADDRESS in the 'from' field.<br>
2019-11-26 16:05:07.488 WARN [] Invalid data.<br>
2019-11-26 16:47:17.067 ERR  [django.request] Internal Server Error: /accounts/login/<br>
Traceback (most recent call last):<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/exception.py", line 41, in inner<br>
    response = get_response(request)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py", line 187, in _get_response<br>
    response = self.process_exception_by_middleware(e, request)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py", line 185, in _get_response<br>
    response = wrapped_callback(request, *callback_args, **callback_kwargs)<br>
  File "./zerver/views/auth.py", line 646, in login_page<br>
    extra_context=extra_context, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py", line 54, in inner<br>
    return func(*args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py", line 150, in login<br>
    )(request)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/base.py", line 68, in view<br>
    return self.dispatch(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 67, in _wrapper<br>
    return bound_func(*args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/views/decorators/debug.py", line 76, in sensitive_post_parameters_wrapper<br>
    return view(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 63, in bound_func<br>
    return func.__get__(self, type(self))(*args2, **kwargs2)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 67, in _wrapper<br>
    return bound_func(*args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 149, in _wrapped_view<br>
    response = view_func(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 63, in bound_func<br>
    return func.__get__(self, type(self))(*args2, **kwargs2)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 67, in _wrapper<br>
    return bound_func(*args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/views/decorators/cache.py", line 57, in _wrapped_view_func<br>
    response = view_func(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py", line 63, in bound_func<br>
    return func.__get__(self, type(self))(*args2, **kwargs2)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py", line 90, in dispatch<br>
    return super(LoginView, self).dispatch(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/base.py", line 88, in dispatch<br>
    return handler(request, *args, **kwargs)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/edit.py", line 182, in post<br>
    if form.is_valid():<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py", line 183, in is_valid<br>
    return self.is_bound and not self.errors<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py", line 175, in errors<br>
    self.full_clean()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py", line 385, in full_clean<br>
    self._clean_form()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py", line 412, in _clean_form<br>
    cleaned_data = self.clean()<br>
  File "./zerver/forms.py", line 309, in clean<br>
    realm=realm, return_data=return_data)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/__init__.py", line 70, in authenticate<br>
    user = _authenticate_with_backend(backend, backend_path, request, credentials)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/__init__.py", line 116, in _authenticate_with_backend<br>
    return backend.authenticate(*args, **credentials)<br>
  File "./zproject/backends.py", line 562, in authenticate<br>
 return backend.authenticate(*args, **credentials)<br>
  File "./zproject/backends.py", line 562, in authenticate<br>
    username = self.django_to_ldap_username(username)<br>
  File "./zproject/backends.py", line 387, in django_to_ldap_username<br>
    if _LDAPUser(self, result).attrs is None:<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 557, in attrs<br>
    self._load_user_attrs()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 589, in _load_user_attrs<br>
    if self.dn is not None:<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 550, in dn<br>
    self._load_user_dn()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 618, in _load_user_dn<br>
    self._user_dn = self._search_for_user_dn()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 639, in _search_for_user_dn<br>
    results = search.execute(self.connection, {"user": self._username})<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 268, in connection<br>
    self._bind()<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 277, in _bind<br>
    self._bind_as(self.settings.BIND_DN, self.settings.BIND_PASSWORD, sticky=True)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py", line 288, in _bind_as<br>
    self._get_connection().simple_bind_s(bind_dn, bind_password)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/ldapobject.py", line 446, in simple_bind_s<br>
    resp_type, resp_data, resp_msgid, resp_ctrls = self.result3(msgid,all=1,timeout=self.timeout)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/ldapobject.py", line 751, in result3<br>
    resp_ctrl_classes=resp_ctrl_classes<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/ldapobject.py", line 758, in result4<br>
    ldap_result = self._ldap_call(self._l.result4,msgid,all,timeout,add_ctrls,add_intermediates,add_extop)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/ldapobject.py", line 331, in _ldap_call<br>
    reraise(exc_type, exc_value, exc_traceback)<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/compat.py", line 44, in reraise<br>
    raise exc_value<br>
  File "/srv/zulip-venv-cache/08c7c1e4fad499cee6dd00398c62f9908faed46f/zulip-py3-venv/lib/python3.6/site-packages/ldap/ldapobject.py", line 315, in _ldap_call<br>
    result = func(<em>args,</em>*kwargs)<br>
ldap.INVALID_CREDENTIALS: {'desc': 'Invalid credentials', 'info': '80090308: LdapErr: DSID-0C09042A, comment: AcceptSecurityContext error, data 52e, v3839'}<br>
2019-11-26 17:05:07.330 WARN [] Invalid data.<br>
2019-11-26 17:54:14.993 WARN [django.request] Not Found: /browserconfig.xml</p>



<a name="799353"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799353" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799353">(Nov 26 2019 at 18:04)</a>:</h4>
<p>THis is the upgrade command I ran:<br>
/home/zulip/deployments/current/scripts/upgrade-zulip-from-git master<br>
<span class="user-mention" data-user-id="10349">@Mateusz Mandera</span></p>



<a name="799354"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799354" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799354">(Nov 26 2019 at 18:09)</a>:</h4>
<p><span class="user-mention" data-user-id="12396">@Branden Keating</span> you're using LDAP, right? it seems like the bind_dn or bind_password for connecting to the directory are incorrect</p>



<a name="799355"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799355" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799355">(Nov 26 2019 at 18:13)</a>:</h4>
<p>Besides the connection credentials issue, because we added some more obligatory settings, you may need to configure <code>AUTH_LDAP_REVERSE_EMAIL_SEARCH</code> and <code>AUTH_LDAP_USERNAME_ATTR</code> - see  <a href="https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap-including-active-directory" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap-including-active-directory">https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap-including-active-directory</a></p>



<a name="799356"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799356" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799356">(Nov 26 2019 at 18:14)</a>:</h4>
<p>But the immediate issue seems to be with the connection.</p>



<a name="799359"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799359" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799359">(Nov 26 2019 at 18:18)</a>:</h4>
<p>would that cause the internal server error with the database?<br>
I was originally having an issue logging in with LDAP period</p>



<a name="799360"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799360" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799360">(Nov 26 2019 at 18:20)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> <br>
Also, my users that were still logged in are working fine, just people that are logged out cannot login as they get this internal server error message</p>



<a name="799363"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799363" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799363">(Nov 26 2019 at 18:21)</a>:</h4>
<p>yes, if the ldap backend is enabled, the server may make some queries to ldap whenever an attempt to log in is made - and that will cause this internal server error if ldap isn't configured to work</p>



<a name="799364"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799364" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799364">(Nov 26 2019 at 18:22)</a>:</h4>
<p>You have two options:</p>
<ol>
<li>Just disable the ldap backend in <code>AUTHENTICATION_METHODS</code> in <code>/etc/zulip/settings.py</code></li>
<li>Finish configuring ldap to make it work - so the connection credential and the two settings that I'm guessing you don't have configured if you're updating from an older version.</li>
</ol>



<a name="799365"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799365" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799365">(Nov 26 2019 at 18:25)</a>:</h4>
<p>So the odd thing is, this worked fine before the upgrade, could it have fallen back to default after the upgrade?<br>
My LDAO settings have stayed the same.<br>
<a href="/user_uploads/2/61/OEGCdO_zxnNMApNfqiuYDtva/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/61/OEGCdO_zxnNMApNfqiuYDtva/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/61/OEGCdO_zxnNMApNfqiuYDtva/pasted_image.png"></a></div>



<a name="799366"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799366" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799366">(Nov 26 2019 at 18:27)</a>:</h4>
<p>I just verified the zulip AD password in the secrets file</p>



<a name="799368"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799368" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799368">(Nov 26 2019 at 18:28)</a>:</h4>
<p>before the upgrade, was everything with ldap working fine? or as you mentioned, logging in with LDAP  wasn't working before the upgrade?</p>



<a name="799369"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799369" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799369">(Nov 26 2019 at 18:29)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> Looks like I am now just having issues logging in as it says "Invalid username or password" while trying to authenticate via LDAP. The internal server error is gon. would a new set of logs help you to determine what is happening?</p>



<a name="799370"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799370" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799370">(Nov 26 2019 at 18:29)</a>:</h4>
<p>sure, could be useful</p>



<a name="799371"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799371" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799371">(Nov 26 2019 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> <br>
Looks like the only difference is the bottom line</p>
<p>ldap.INVALID_CREDENTIALS: {'desc': 'Invalid credentials', 'info': '80090308: LdapErr: DSID-0C09042A, comment: AcceptSecurityContext error, data 52e, v3839'}<br>
2019-11-26 17:05:07.330 WARN [] Invalid data.<br>
2019-11-26 17:54:14.993 WARN [django.request] Not Found: /browserconfig.xml<br>
2019-11-26 18:05:09.305 WARN [] Invalid data.</p>



<a name="799372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799372">(Nov 26 2019 at 18:33)</a>:</h4>
<p>so no new error? <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> oh and back to the previous question - before the upgrade, was logging in via ldap working fine?</p>



<a name="799374"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799374" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799374">(Nov 26 2019 at 18:33)</a>:</h4>
<p>yes</p>



<a name="799375"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799375" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799375">(Nov 26 2019 at 18:36)</a>:</h4>
<p>Can you try using <code>query_ldap</code> to search yourself in ldap and see what that outputs?<br>
<code>/home/zulip/deployments/current/manage.py query_ldap your@email.com</code></p>



<a name="799377"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799377" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799377">(Nov 26 2019 at 18:37)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span>  I have looked at this line and it is fine, but maybe you will see something I missed.</p>



<a name="799378"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799378" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799378">(Nov 26 2019 at 18:37)</a>:</h4>
<p><a href="/user_uploads/2/38/RwqdChkxj0V8qa_yyxip-7-f/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/38/RwqdChkxj0V8qa_yyxip-7-f/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/38/RwqdChkxj0V8qa_yyxip-7-f/pasted_image.png"></a></div>



<a name="799379"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799379" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799379">(Nov 26 2019 at 18:38)</a>:</h4>
<p>Manage.py</p>
<p>#!/usr/bin/env python3<br>
from __future__ import (print_function)<br>
import os<br>
import sys<br>
import configparser<br>
if sys.version_info &lt;= (3, 0):<br>
    print("Error: Zulip is a Python 3 project, and cannot be run with Python 2.")<br>
    print("Use e.g. <code>/path/to/manage.py</code> not <code>python /path/to/manage.py</code>.")<br>
    sys.exit(1)</p>
<p>BASE_DIR = os.path.dirname(os.path.abspath(__file__))<br>
sys.path.append(BASE_DIR)<br>
import scripts.lib.setup_path_on_import<br>
from scripts.lib.zulip_tools import assert_not_running_as_root</p>
<p>if __name__ == "__main__":<br>
    assert_not_running_as_root()</p>
<div class="codehilite"><pre><span></span>config_file = configparser.RawConfigParser()
config_file.read(&quot;/etc/zulip/zulip.conf&quot;)
PRODUCTION = config_file.has_option(&#39;machine&#39;, &#39;deploy_type&#39;)
HAS_SECRETS = os.access(&#39;/etc/zulip/zulip-secrets.conf&#39;, os.R_OK)

if PRODUCTION and not HAS_SECRETS:
    # The best way to detect running manage.py as another user in
    # production before importing anything that would require that
    # access is to check for access to /etc/zulip/zulip.conf (in
    # which case it&#39;s a production server, not a dev environment)
    # and lack of access for /etc/zulip/zulip-secrets.conf (which
    # should be only readable by root and zulip)
    print(&quot;Error accessing Zulip secrets; manage.py in production must be run as the zulip user.&quot;)
    sys.exit(1)

os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;zproject.settings&quot;)
from django.conf import settings
from django.core.management import execute_from_command_line
from django.core.management.base import CommandError
from scripts.lib.zulip_tools import log_management_command

log_management_command(&quot; &quot;.join(sys.argv), settings.MANAGEMENT_LOG_PATH)

os.environ.setdefault(&quot;PYTHONSTARTUP&quot;, os.path.join(BASE_DIR, &quot;scripts/lib/pythonrc.py&quot;))
if &quot;--no-traceback&quot; not in sys.argv and len(sys.argv) &gt; 1:
    sys.argv.append(&quot;--traceback&quot;)
try:
    execute_from_command_line(sys.argv)
except CommandError as e:
    print(e, file=sys.stderr)
    sys.exit(1)
</pre></div>



<a name="799381"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799381" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799381">(Nov 26 2019 at 18:44)</a>:</h4>
<p><span class="user-mention" data-user-id="12396">@Branden Keating</span> oh, that's a confusing error, but if you switch to the zulip user with su first, and then run the command, it should work</p>



<a name="799382"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799382" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799382">(Nov 26 2019 at 18:45)</a>:</h4>
<p>I did, I included the command in the screenshot, unless you mean "su zulip" at the OS level, then run the command but I don't know if that will change anything</p>



<a name="799383"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799383" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799383">(Nov 26 2019 at 18:45)</a>:</h4>
<p>I will try it now</p>



<a name="799384"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799384" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799384">(Nov 26 2019 at 18:45)</a>:</h4>
<p><code>su zulip  -s  /home/zulip/deployments/current/manage.py query_ldap</code> this style should work too</p>



<a name="799385"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799385" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799385">(Nov 26 2019 at 18:46)</a>:</h4>
<p><a href="/user_uploads/2/56/ZjaQGZJPCoqREzmIb2XMWwin/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/56/ZjaQGZJPCoqREzmIb2XMWwin/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/56/ZjaQGZJPCoqREzmIb2XMWwin/pasted_image.png"></a></div>



<a name="799386"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799386" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799386">(Nov 26 2019 at 18:46)</a>:</h4>
<p>so it basically is not connecting to LDAP</p>



<a name="799387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799387">(Nov 26 2019 at 18:52)</a>:</h4>
<p>hmmm, and how is your <code>AUTH_LDAP_USER_SEARCH</code> configured?</p>



<a name="799388"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799388" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799388">(Nov 26 2019 at 18:53)</a>:</h4>
<p>in the settings.py correct?</p>



<a name="799389"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799389" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799389">(Nov 26 2019 at 18:54)</a>:</h4>
<p>yes</p>



<a name="799390"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799390" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799390">(Nov 26 2019 at 18:54)</a>:</h4>
<p><a href="/user_uploads/2/1a/yHX4-7Z2SmpIBxmcgUmwtynd/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/1a/yHX4-7Z2SmpIBxmcgUmwtynd/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/1a/yHX4-7Z2SmpIBxmcgUmwtynd/pasted_image.png"></a></div>



<a name="799391"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799391" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799391">(Nov 26 2019 at 18:54)</a>:</h4>
<p>has not changed, and it looks to still be formatted correctly</p>



<a name="799392"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799392" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799392">(Nov 26 2019 at 19:00)</a>:</h4>
<p>yeah, that looks okay. Hmm, what if you go into the django shell <code>manage.py shell</code> and there:<br>
<code>from zproject.backends import ZulipLDAPAuthBackend</code> and <code>ZulipLDAPAuthBackend().django_to_ldap_username('youremail')</code></p>



<a name="799394"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799394" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799394">(Nov 26 2019 at 19:03)</a>:</h4>
<p>Sorry, this is an end user question but how do I get to the python shell to run that?</p>



<a name="799395"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799395" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799395">(Nov 26 2019 at 19:04)</a>:</h4>
<p>Similar as before - <code>/home/zulip/deployments/current/manage.py shell</code> as the zulip user</p>



<a name="799396"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799396" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799396">(Nov 26 2019 at 19:05)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> <a href="/user_uploads/2/ea/8FcKegqVtg0aN1M8q04VRXt1/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/ea/8FcKegqVtg0aN1M8q04VRXt1/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/ea/8FcKegqVtg0aN1M8q04VRXt1/pasted_image.png"></a></div>



<a name="799397"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799397" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799397">(Nov 26 2019 at 19:07)</a>:</h4>
<p>oh, you just misspelled your domain here, can you try again with it fixed? you did <code>bkeating@sbmcoPR.com</code></p>



<a name="799398"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799398" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799398">(Nov 26 2019 at 19:08)</a>:</h4>
<p>Sorry about that, <a href="/user_uploads/2/96/MBD6Mc7yRAKp4eMdXBQ2gcE-/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/96/MBD6Mc7yRAKp4eMdXBQ2gcE-/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/96/MBD6Mc7yRAKp4eMdXBQ2gcE-/pasted_image.png"></a></div>



<a name="799399"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799399" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799399">(Nov 26 2019 at 19:11)</a>:</h4>
<p>hmm, I see - how about <code>from django_auth_ldap.backend import _LDAPUser</code> and then  <code>_LDAPUser(ZulipLDAPAuthBackend(), 'bkeating').attrs is None</code>?</p>



<a name="799400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799400">(Nov 26 2019 at 19:12)</a>:</h4>
<p><a href="/user_uploads/2/f4/_sPUb8Rb1SgBsCcQO0Va0iGw/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/f4/_sPUb8Rb1SgBsCcQO0Va0iGw/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/f4/_sPUb8Rb1SgBsCcQO0Va0iGw/pasted_image.png"></a></div>



<a name="799401"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799401" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799401">(Nov 26 2019 at 19:13)</a>:</h4>
<p>ah, if you exit the shell alreayd, you have to import <code>ZulipLdapAuthBackend</code> again (<code>from zproject.backends import ZulipLDAPAuthBackend</code>)</p>



<a name="799402"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799402" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799402">(Nov 26 2019 at 19:13)</a>:</h4>
<p>I presume that your <code>sAMAccountName</code> in AD should be <code>bkeating</code>, right?</p>



<a name="799403"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799403" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799403">(Nov 26 2019 at 19:14)</a>:</h4>
<p>yes</p>



<a name="799404"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799404" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799404">(Nov 26 2019 at 19:15)</a>:</h4>
<p><a href="/user_uploads/2/7e/054SA5Hm1TMrgM4WZarvjjXj/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/7e/054SA5Hm1TMrgM4WZarvjjXj/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/7e/054SA5Hm1TMrgM4WZarvjjXj/pasted_image.png"></a></div>



<a name="799406"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799406" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799406">(Nov 26 2019 at 19:31)</a>:</h4>
<p>hmm, I'm kind of at a loss here, since nothing is throwing any useful errors (it's weird that the INVALID_CREDENTIALS error has disappeared). Oh, unless some caching is causing the ldapsearch not to get executed...<br>
Can you try in the shell<br>
<code>from django.core.cache import cache</code> -&gt; <code>cache.clear()</code> and then the <code>_LDAPUser(ZulipLDAPAuthBackend(), 'bkeating').attrs is None</code> thing again? (with the objects imported too) <span class="user-mention" data-user-id="12396">@Branden Keating</span></p>



<a name="799407"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799407" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799407">(Nov 26 2019 at 19:36)</a>:</h4>
<p><a href="/user_uploads/2/6c/AqSbtxk3Aiyty_8PXoylRXRM/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/6c/AqSbtxk3Aiyty_8PXoylRXRM/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/6c/AqSbtxk3Aiyty_8PXoylRXRM/pasted_image.png"></a></div>



<a name="799408"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799408" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799408">(Nov 26 2019 at 19:38)</a>:</h4>
<p>New logs: <a href="/user_uploads/2/1/JNvog6LvKfbyhs9azMJe3ILs/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/1/JNvog6LvKfbyhs9azMJe3ILs/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/1/JNvog6LvKfbyhs9azMJe3ILs/pasted_image.png"></a></div>



<a name="799409"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799409" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799409">(Nov 26 2019 at 19:44)</a>:</h4>
<p>This is in the events log, if it means anything helpful <a href="/user_uploads/2/5c/8aKHsN0CGFlW_CBDzW0w_p6H/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/5c/8aKHsN0CGFlW_CBDzW0w_p6H/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/5c/8aKHsN0CGFlW_CBDzW0w_p6H/pasted_image.png"></a></div>



<a name="799410"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799410" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799410">(Nov 26 2019 at 19:46)</a>:</h4>
<p>These events log errors are from way earlier, right? Judging from the timestamps. Are they still occurring?</p>



<a name="799411"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799411" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799411">(Nov 26 2019 at 19:48)</a>:</h4>
<p>those error.log screens are new. For some reason, our timing of the logs has always been wrong</p>



<a name="799412"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799412" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799412">(Nov 26 2019 at 19:50)</a>:</h4>
<p>I meant the events log from the last screenshot (because the hour is way off compared to those errors.log entries that are current)</p>



<a name="799413"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799413" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799413">(Nov 26 2019 at 19:51)</a>:</h4>
<p>those are from earlier today before you asked for the python shell commands</p>



<a name="799414"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799414" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799414">(Nov 26 2019 at 19:52)</a>:</h4>
<p>from before or after the upgrade?</p>



<a name="799415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799415">(Nov 26 2019 at 19:52)</a>:</h4>
<p>after</p>



<a name="799416"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799416" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799416">(Nov 26 2019 at 19:58)</a>:</h4>
<p>Can you try to restart the zulip server and see if the invalid_credentials errors comes back? <code>su zulip -c '/home/zulip/deployments/current/scripts/restart-server'</code></p>



<a name="799417"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799417" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799417">(Nov 26 2019 at 19:59)</a>:</h4>
<p>as in the GUI error message?</p>



<a name="799418"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799418" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799418">(Nov 26 2019 at 19:59)</a>:</h4>
<p>one sec</p>



<a name="799419"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799419" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799419">(Nov 26 2019 at 20:00)</a>:</h4>
<p>same thing <a href="/user_uploads/2/ad/eHyYTCfRvnx_XFRnGmy_d9PO/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/ad/eHyYTCfRvnx_XFRnGmy_d9PO/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/ad/eHyYTCfRvnx_XFRnGmy_d9PO/pasted_image.png"></a></div>



<a name="799420"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799420" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799420">(Nov 26 2019 at 20:01)</a>:</h4>
<p>I'm guessing nothing in <code>errors.log</code> either? Curious that the <code>invalid_credentials</code> error (that was causing the internal server error) disappeared.</p>



<a name="799421"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799421" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799421">(Nov 26 2019 at 20:02)</a>:</h4>
<p>nothing new in there</p>



<a name="799422"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799422" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799422">(Nov 26 2019 at 20:02)</a>:</h4>
<p><a href="/user_uploads/2/46/_1BPKRBmyVEPSh-ccEoDBbbn/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/46/_1BPKRBmyVEPSh-ccEoDBbbn/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/46/_1BPKRBmyVEPSh-ccEoDBbbn/pasted_image.png"></a></div>



<a name="799423"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799423" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799423">(Nov 26 2019 at 20:07)</a>:</h4>
<p><code>_LDAPUser(ZulipLDAPAuthBackend(), 'bkeating')._search_for_user_dn()</code> in the python shell again? (with the needed imports)</p>



<a name="799424"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799424" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799424">(Nov 26 2019 at 20:08)</a>:</h4>
<p>it literally just dropped down to nothing lol</p>



<a name="799425"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799425" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799425">(Nov 26 2019 at 20:08)</a>:</h4>
<p><a href="/user_uploads/2/61/L3ifoOvGzD_dW-mf4hYYyekD/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a> v</p>
<div class="message_inline_image"><a href="/user_uploads/2/61/L3ifoOvGzD_dW-mf4hYYyekD/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/61/L3ifoOvGzD_dW-mf4hYYyekD/pasted_image.png"></a></div>



<a name="799426"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799426" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799426">(Nov 26 2019 at 20:12)</a>:</h4>
<p>Because it's not finding the dn. This seems like there has to be an issue with the configuration - though that's strange too, considering it was working fine before the upgrade.</p>
<p>What will <code>_LDAPUser(ZulipLDAPAuthBackend(), 'bkeating').connection</code> show?</p>



<a name="799427"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799427" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799427">(Nov 26 2019 at 20:13)</a>:</h4>
<p><a href="/user_uploads/2/81/OpMtmWNUZ01rG0_b4-o5I5-o/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/81/OpMtmWNUZ01rG0_b4-o5I5-o/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/81/OpMtmWNUZ01rG0_b4-o5I5-o/pasted_image.png"></a></div>



<a name="799428"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799428" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799428">(Nov 26 2019 at 20:13)</a>:</h4>
<p>So it does seem to be connecting fine, and having an issue with the search...</p>



<a name="799429"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799429" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799429">(Nov 26 2019 at 20:15)</a>:</h4>
<p>that seems to make sense</p>



<a name="799430"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799430" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799430">(Nov 26 2019 at 20:15)</a>:</h4>
<p>is there a way to re-establish the connection or initiate the search again?</p>



<a name="799431"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799431" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799431">(Nov 26 2019 at 20:17)</a>:</h4>
<p>it was the redoing connection and search every time we called these code snippets just now  I think</p>



<a name="799432"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799432" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799432">(Nov 26 2019 at 20:18)</a>:</h4>
<p>hmmm, ok.</p>



<a name="799433"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799433" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799433">(Nov 26 2019 at 20:18)</a>:</h4>
<p>can it be check in AD logs if connection are indeed being made and what search queries are being run?</p>



<a name="799434"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799434" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799434">(Nov 26 2019 at 20:18)</a>:</h4>
<p>let me look</p>



<a name="799435"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799435" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799435">(Nov 26 2019 at 20:27)</a>:</h4>
<p>worst case you could wireshark it or something, lol <a href="https://iamtechtips.com/capture-ldap-queries-wireshark/" target="_blank" title="https://iamtechtips.com/capture-ldap-queries-wireshark/">https://iamtechtips.com/capture-ldap-queries-wireshark/</a> <span aria-label="confounded" class="emoji emoji-1f616" role="img" title="confounded">:confounded:</span></p>



<a name="799436"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799436" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799436">(Nov 26 2019 at 20:27)</a>:</h4>
<p>I have 0 logs for that service account showing up in AD</p>



<a name="799439"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799439" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799439">(Nov 26 2019 at 20:29)</a>:</h4>
<p>Does that mean no bind is being done using the accoun configured in <code>AUTH_LDAP_BIND_DN</code>?</p>



<a name="799441"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799441" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799441">(Nov 26 2019 at 20:29)</a>:</h4>
<p>it should be but I would think not if I am not seeing any logs, successful or otherwise</p>



<a name="799443"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799443" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799443">(Nov 26 2019 at 20:31)</a>:</h4>
<p>and <code>AUTH_LDAP_SERVER_URI</code> is correct?</p>



<a name="799444"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799444" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799444">(Nov 26 2019 at 20:31)</a>:</h4>
<p>I am double checking now</p>



<a name="799449"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799449" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799449">(Nov 26 2019 at 20:33)</a>:</h4>
<p>yes those settings are correct</p>



<a name="799450"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799450" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799450">(Nov 26 2019 at 20:34)</a>:</h4>
<p>I am looking at the original file to see if a symbol is mistyped or there is a trailing space somewhere lol</p>



<a name="799456"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799456" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799456">(Nov 26 2019 at 20:41)</a>:</h4>
<p>Is there a service by chance that may not be running?</p>



<a name="799457"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799457" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799457">(Nov 26 2019 at 20:43)</a>:</h4>
<p>I don't think so. The connections and search queries should be happening when we call that code in the python shell regardless anyway. Can you use some network monitoring tool on the server to check what happens we do that <code>_LDAPUser(ZulipLDAPAuthBackend(), 'bkeating')._search_for_user_dn()</code>? It's really strange for no connection to the AD to even be attempted.</p>



<a name="799458"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799458" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799458">(Nov 26 2019 at 20:44)</a>:</h4>
<p>I will test that in a second, but I found this message in events and error logs<br>
<a href="/user_uploads/2/e2/NWuG-GYyylBvC8pQuA6ZRDLY/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/e2/NWuG-GYyylBvC8pQuA6ZRDLY/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/e2/NWuG-GYyylBvC8pQuA6ZRDLY/pasted_image.png"></a></div>



<a name="799459"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799459" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799459">(Nov 26 2019 at 20:46)</a>:</h4>
<p>That's unrelated, it's a harmless warning from a completely different feature - <a href="https://zulip.readthedocs.io/en/latest/production/email-gateway.html" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/email-gateway.html">https://zulip.readthedocs.io/en/latest/production/email-gateway.html</a></p>



<a name="799460"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799460" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799460">(Nov 26 2019 at 20:46)</a>:</h4>
<p>ok, sorry to bring it up then</p>



<a name="799462"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799462" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799462">(Nov 26 2019 at 21:00)</a>:</h4>
<p>Btw, depending on how urgent getting the login working is, you could enable the EmailAuthBackend, disable LDAP authentication for the realm (in organization settings) and have users Reset their password and they'll be able to login with the password they'll set for themselves that way - if that's acceptable for your company as a temporary measure until this AD stuff gets figured out.</p>



<a name="799466"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799466" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799466">(Nov 26 2019 at 21:04)</a>:</h4>
<p>ok, that is something to think about</p>



<a name="799467"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799467" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799467">(Nov 26 2019 at 21:05)</a>:</h4>
<p>I am not getting any traffic from wireshark so I am trying some things</p>



<a name="799485"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799485" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799485">(Nov 26 2019 at 21:13)</a>:</h4>
<p>We found the issue, it had to do with users not being in the correct OU so they were getting the login error</p>



<a name="799487"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799487" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799487">(Nov 26 2019 at 21:14)</a>:</h4>
<p>Ahhh, it's working now then?</p>



<a name="799488"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799488" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799488">(Nov 26 2019 at 21:15)</a>:</h4>
<p>yes</p>



<a name="799489"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799489" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799489">(Nov 26 2019 at 21:15)</a>:</h4>
<p>Thank you so much for all of your help</p>



<a name="799490"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799490" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799490">(Nov 26 2019 at 21:15)</a>:</h4>
<p>I really do appreciate it</p>



<a name="799491"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799491" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799491">(Nov 26 2019 at 21:16)</a>:</h4>
<p>Great news! <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="799498"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Internal%20Server%20error%20after%20upgrade/near/799498" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Branden Keating <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Internal.20Server.20error.20after.20upgrade.html#799498">(Nov 26 2019 at 21:22)</a>:</h4>
<p>Thanks again</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>