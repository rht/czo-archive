<html>
<head><meta charset="utf-8"><title>default bots · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html">default bots</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1596538"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596538" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596538">(Jun 21 2023 at 16:38)</a>:</h4>
<p>Is there a particular reason why the 3 default bots can't be disabled in Production</p>



<a name="1596542"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596542" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596542">(Jun 21 2023 at 16:45)</a>:</h4>
<p>They're used for internal purposes, like sending you notifications if you misconfigure a bot.  Is it causing problems to have them, somehow?</p>



<a name="1596546"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596546" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596546">(Jun 21 2023 at 17:07)</a>:</h4>
<p>It's not causing problems, just seems like a bit of clutter, thought I could do without all those extra notifications</p>



<a name="1596676"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596676" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596676">(Jun 21 2023 at 19:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/default.20bots/near/1596542">said</a>:</p>
<blockquote>
<p>They're used for internal purposes, like sending you notifications if you misconfigure a bot.  Is it causing problems to have them, somehow?</p>
</blockquote>
<p>how about changing the system's bot e-mails address ?</p>



<a name="1596679"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596679" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596679">(Jun 21 2023 at 19:03)</a>:</h4>
<p>They're looked up internally via their email addresses.  Can you tell me a bit more about why you want to change them?</p>



<a name="1596682"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596682" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596682">(Jun 21 2023 at 19:03)</a>:</h4>
<p>I've tried setting WELCOME_BOT = "<a href="mailto:welcome-bot@domain.com">welcome-bot@domain.com</a>" in /etc/zulip/settings.py</p>



<a name="1596683"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596683" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596683">(Jun 21 2023 at 19:04)</a>:</h4>
<p>and INTERNAL_BOT_DOMAIN = '<a href="http://domain.com">domain.com</a>' but that errors out</p>



<a name="1596684"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596684" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596684">(Jun 21 2023 at 19:04)</a>:</h4>
<p>I guess they are hardcoded somewhere else ?</p>



<a name="1596686"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596686" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596686">(Jun 21 2023 at 19:04)</a>:</h4>
<p>They're hardcoded in the database.  Can you tell me a bit more about why you're trying to change their email addresses?</p>



<a name="1596687"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596687" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596687">(Jun 21 2023 at 19:04)</a>:</h4>
<p>well, if I'm hosting this on my domain I'd rather have the bots look as if they exist on my domain, the bot's e-mail address is <a href="mailto:welcome-bot@zulip.com">welcome-bot@zulip.com</a></p>



<a name="1596690"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596690" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596690">(Jun 21 2023 at 19:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/default.20bots/near/1596686">said</a>:</p>
<blockquote>
<p>They're hardcoded in the database.  Can you tell me a bit more about why you're trying to change their email addresses?</p>
</blockquote>
<p>oh wow, ok, didn't realize that</p>



<a name="1596693"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596693" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596693">(Jun 21 2023 at 19:05)</a>:</h4>
<p>Bots are users, so they have a row in the database like every user, and that row has their email in it.</p>



<a name="1596695"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596695" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596695">(Jun 21 2023 at 19:05)</a>:</h4>
<p>I think it creates the impression that data can be shared with @zulip.com and I wanted to avoid that</p>



<a name="1596698"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596698" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596698">(Jun 21 2023 at 19:06)</a>:</h4>
<p>Yes, I can see that impression.</p>



<a name="1596699"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596699" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596699">(Jun 21 2023 at 19:06)</a>:</h4>
<p>but if I set that value in settings.py it's not enough ?</p>
<p>right now it errors out with</p>
<p>File "./zerver/lib/server_initialization.py", line 61, in create_internal_realm<br>
    email_gateway_bot = get_system_bot(settings.EMAIL_GATEWAY_BOT, <a href="http://realm.id">realm.id</a>)<br>
  File "./zerver/lib/cache.py", line 157, in func_with_caching<br>
    val = func(*args, **kwargs)<br>
  File "./zerver/models.py", line 3939, in get_system_bot<br>
    return UserProfile.objects.select_related().get(email__iexact=email.strip())<br>
  File "/srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv/lib/python3.9/site-packages/django/db/models/query.py", line 637, in get<br>
    raise self.model.DoesNotExist(<br>
zerver.models.UserProfile.DoesNotExist: UserProfile matching query does not exist.</p>



<a name="1596702"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596702" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596702">(Jun 21 2023 at 19:07)</a>:</h4>
<p>No, as I mentioned, there are rows in the database which have the standard email as a value.</p>



<a name="1596704"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596704" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596704">(Jun 21 2023 at 19:07)</a>:</h4>
<p>You can delete your existing data and I <em>believe</em> it will pick up the settings you have now for the system bots it makes.</p>



<a name="1596706"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596706" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596706">(Jun 21 2023 at 19:07)</a>:</h4>
<p>But this deletes <em>all of your data</em>, so make sure that's what you want before you do it.</p>



<a name="1596723"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596723" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596723">(Jun 21 2023 at 19:09)</a>:</h4>
<p>yes, that's actually what I'm doing</p>



<a name="1596724"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596724" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596724">(Jun 21 2023 at 19:09)</a>:</h4>
<p>this is a brand new setup</p>



<a name="1596726"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596726" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596726">(Jun 21 2023 at 19:10)</a>:</h4>
<p>so brand new setup, with those values in settings.py , after a fresh restart, and I get that error</p>



<a name="1596732"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596732" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596732">(Jun 21 2023 at 19:11)</a>:</h4>
<p>Untested, but you can try:</p>
<div class="codehilite"><pre><span></span><code>./manage.py delete_realm -r &#39;&#39;
./scripts/setup/initialize-database
./manage.py generate_realm_creation_link
</code></pre></div>



<a name="1596735"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596735" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596735">(Jun 21 2023 at 19:14)</a>:</h4>
<p>Actually, the bots are in the system internal realm - -that won't work.</p>



<a name="1596737"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596737" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596737">(Jun 21 2023 at 19:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>./manage.py delete_realm -r &#39;&#39;
./manage.py delete_realm -r zulipinternal
./manage.py generate_realm_creation_link
</code></pre></div>



<a name="1596738"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596738" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596738">(Jun 21 2023 at 19:16)</a>:</h4>
<p>Bear in mind that these are all ... not changes that are usually made, so you're a bit outside the realm of normal operation.</p>



<a name="1596750"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596750" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596750">(Jun 21 2023 at 19:32)</a>:</h4>
<p>yep, that's what I did except for the initialize-database part</p>



<a name="1596751"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596751" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596751">(Jun 21 2023 at 19:32)</a>:</h4>
<p>let me try that step too</p>



<a name="1596752"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596752" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596752">(Jun 21 2023 at 19:34)</a>:</h4>
<p>Deleting the <code>zulipinternal</code> realm is the key bit.  <code>initialize-database</code> is a no-op in this context.</p>



<a name="1596754"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596754" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596754">(Jun 21 2023 at 19:35)</a>:</h4>
<p>yes, I've always removed that one too</p>



<a name="1596755"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596755" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596755">(Jun 21 2023 at 19:35)</a>:</h4>
<p>starting from scratch now, ran the initialize-database too</p>
<p>su zulip -c '/home/zulip/deployments/current/manage.py list_realms'<br>
id    string_id            name                           domain<br>
--    ---------            ----                           ------</p>



<a name="1596756"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596756" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596756">(Jun 21 2023 at 19:36)</a>:</h4>
<p>(using <a href="https://zulip.com/help/code-blocks">code blocks</a> makes pasted output much more readable)</p>



<a name="1596757"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596757" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596757">(Jun 21 2023 at 19:37)</a>:</h4>
<p>oops, sorry</p>



<a name="1596758"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596758" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596758">(Jun 21 2023 at 19:37)</a>:</h4>
<p>Looks fine.  Making a new realm from that state I think will pick up your bot defaults.</p>



<a name="1596760"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596760" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596760">(Jun 21 2023 at 19:37)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2023-06-21 19:36:25.290 ERR  [django.request] Internal Server Error: /accounts/register/
Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv/lib/python3.9/site-packages/django/core/handlers/exception.py&quot;, line 55, in inner
    response = get_response(request)
  File &quot;/srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv/lib/python3.9/site-packages/django/core/handlers/base.py&quot;, line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;./zerver/decorator.py&quot;, line 125, in wrapper
    return func(request, *args, **kwargs)
  File &quot;./zerver/views/registration.py&quot;, line 203, in accounts_register
    return registration_helper(*args, **kwargs)
  File &quot;./zerver/lib/request.py&quot;, line 459, in _wrapped_req_func
    return_value = req_func(request, *args, **kwargs)
  File &quot;./zerver/views/registration.py&quot;, line 423, in registration_helper
    realm = do_create_realm(
  File &quot;./zerver/actions/create_realm.py&quot;, line 160, in do_create_realm
    create_internal_realm()
  File &quot;./zerver/lib/server_initialization.py&quot;, line 61, in create_internal_realm
    email_gateway_bot = get_system_bot(settings.EMAIL_GATEWAY_BOT, realm.id)
  File &quot;./zerver/lib/cache.py&quot;, line 157, in func_with_caching
    val = func(*args, **kwargs)
  File &quot;./zerver/models.py&quot;, line 3939, in get_system_bot
    return UserProfile.objects.select_related().get(email__iexact=email.strip())
  File &quot;/srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv/lib/python3.9/site-packages/django/db/models/query.py&quot;, line 637, in get
    raise self.model.DoesNotExist(
zerver.models.UserProfile.DoesNotExist: UserProfile matching query does not exist.
</code></pre></div>



<a name="1596762"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596762" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596762">(Jun 21 2023 at 19:37)</a>:</h4>
<p>maybe it's still tied down somewhere to @zulip.com</p>



<a name="1596765"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596765" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596765">(Jun 21 2023 at 19:38)</a>:</h4>
<p>Set:</p>
<div class="codehilite"><pre><span></span><code>EMAIL_GATEWAY_BOT = &#39;emailgateway@your-domain-here&#39;
</code></pre></div>



<a name="1596767"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596767" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596767">(Jun 21 2023 at 19:39)</a>:</h4>
<p>I do want to highlight this again:</p>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/default.20bots/near/1596738">said</a>:</p>
<blockquote>
<p>Bear in mind that these are all ... not changes that are usually made, so you're a bit outside the realm of normal operation.</p>
</blockquote>
<p>This is ... not strictly really supported.  Please be very explicit if you're asking for support here that you've done this thing, since it is very much not expected.</p>



<a name="1596768"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596768" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596768">(Jun 21 2023 at 19:40)</a>:</h4>
<p>thanks, that's what I have in /etc/zulip/settings.py , I understand it's not supported, but it seemed an easy enough change to make</p>



<a name="1596771"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596771" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596771">(Jun 21 2023 at 19:42)</a>:</h4>
<p>You can do surgery of the email addresses of the bots in the database, but that's <em>definitely</em> into unsupported hackery.</p>
<p>I think I suggest you just accept the standard values, and take our word that unless you're explicitly finding those email addresses and emailing them by hand, nothing goes to us.  And even then I believe those are bitbucketed.</p>



<a name="1596772"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596772" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596772">(Jun 21 2023 at 19:47)</a>:</h4>
<p>thank you Alex for your help</p>



<a name="1596773"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596773" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596773">(Jun 21 2023 at 19:47)</a>:</h4>
<p>I think I managed to destroy the installation completely :)</p>



<a name="1596774"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596774" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596774">(Jun 21 2023 at 19:47)</a>:</h4>
<p>That seemed like a possible outcome from this level of surgery. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1596775"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596775" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596775">(Jun 21 2023 at 19:48)</a>:</h4>
<p>no errors in the logs but front end throws JS error saying: Uncaught TypeError: Cannot read properties of undefined (reading 'is_bot')</p>



<a name="1596776"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596776" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596776">(Jun 21 2023 at 19:48)</a>:</h4>
<p>and interestingly enough, even though I reinitialized the db it still tried assigning an id of 67 to the bot user: <code>Unknown user ids: 67</code></p>



<a name="1596777"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596777" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596777">(Jun 21 2023 at 19:49)</a>:</h4>
<p>We should either be hiding those "settings" (actually constants) better, or actually make this supported.  I suspect the former is much easier.</p>



<a name="1596782"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596782" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596782">(Jun 21 2023 at 19:53)</a>:</h4>
<p>so the initialize database script doesn't recrate the tables ? it just empties them ? since I see the IDs don't start at 0</p>



<a name="1596783"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596783" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596783">(Jun 21 2023 at 19:55)</a>:</h4>
<p>is there a way to fully kill / recreate the db ?</p>



<a name="1596784"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596784" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596784">(Jun 21 2023 at 19:55)</a>:</h4>
<p><code>./scripts/setup/initialize-database</code> is in charge of making the <em>schemas</em> -- that is, the tables themselves.  If they're in place already, it's a no-op.  And since PostgreSQL uses sequences for its primary keys, even empty tables will pick up at 1 more than the last ever-inserted row, regardless of if they <em>currently</em> have any data in them.</p>



<a name="1596785"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596785" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596785">(Jun 21 2023 at 19:55)</a>:</h4>
<p>because now deleting realm / intialize-database isn't enough to repair this</p>



<a name="1596786"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596786" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596786">(Jun 21 2023 at 19:56)</a>:</h4>
<p>sounds about right, so how do I fully start fresh ?</p>



<a name="1596787"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596787" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596787">(Jun 21 2023 at 19:56)</a>:</h4>
<p><code>dropdb zulip</code> should let you <code>initialize-database</code> again.</p>



<a name="1596788"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596788" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596788">(Jun 21 2023 at 19:57)</a>:</h4>
<p>As <code>root</code>:</p>
<div class="codehilite"><pre><span></span><code>dropdb zulip
./scripts/setup/create-database
sudo -u zulip &#39;./scripts/setup/initialize-database&#39;
sudo -u zulip &#39;./manage.py generate_realm_creation_link&#39;
</code></pre></div>



<a name="1596789"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596789" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596789">(Jun 21 2023 at 19:59)</a>:</h4>
<div class="codehilite" data-code-language="dropdb"><pre><span></span><code>dropdb: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: FATAL:  role "root" does not exist
</code></pre></div>



<a name="1596790"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596790" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596790">(Jun 21 2023 at 20:00)</a>:</h4>
<p>Sure.</p>
<div class="codehilite"><pre><span></span><code>sudo -u postgres &#39;dropdb zulip&#39;
</code></pre></div>



<a name="1596791"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596791" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596791">(Jun 21 2023 at 20:00)</a>:</h4>
<p>was just about to post that it worked <code>su postgres -c 'dropdb zulip'</code></p>



<a name="1596794"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596794" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596794">(Jun 21 2023 at 20:01)</a>:</h4>
<p>needed this too before <code>su zulip -c '/home/zulip/deployments/current/scripts/stop-server'</code></p>



<a name="1596820"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596820" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596820">(Jun 21 2023 at 20:21)</a>:</h4>
<p>Thanks for your help, I did manage to get it working but it's not very elegant</p>



<a name="1596821"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596821" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596821">(Jun 21 2023 at 20:21)</a>:</h4>
<p>if I enter those values directly in</p>
<div class="codehilite"><pre><span></span><code>zproject/default_settings.py
zproject/computed_settings.py
</code></pre></div>
<p>then the bots get created with my changed domain</p>



<a name="1596862"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596862" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596862">(Jun 21 2023 at 20:47)</a>:</h4>
<p>Things in <code>default_settings.py</code> are overridden by <code>/etc/zulip/settings.py</code>, which is overridden by <code>computed_settings.py</code>.</p>
<p>Needless to say, changes to those two files will not propagate if you upgrade Zulip.  You should read <a href="https://zulip.readthedocs.io/en/latest/production/modify.html">https://zulip.readthedocs.io/en/latest/production/modify.html</a> if you ever intend to upgrade.</p>



<a name="1596868"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596868" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596868">(Jun 21 2023 at 20:53)</a>:</h4>
<p>I know</p>



<a name="1596869"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596869" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> George <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596869">(Jun 21 2023 at 20:53)</a>:</h4>
<p>but somehow it won't work without making the change there</p>



<a name="1596870"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/default%20bots/near/1596870" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/default.20bots.html#1596870">(Jun 21 2023 at 20:54)</a>:</h4>
<p>The changes in <code>default_settings.py</code> should be able to be moved to <code>/etc/zulip/settings.py</code>, is what I'm saying.  But it's likely that we have at least one of the settings which is, as noted above, meant to be a constant and not a setting, so is set in <code>computed_settings.py</code></p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>