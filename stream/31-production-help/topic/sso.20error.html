<html>
<head><meta charset="utf-8"><title>sso error · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html">sso error</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="303832"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303832" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303832">(Oct 24 2017 at 17:27)</a>:</h4>
<p>Strange thing, btw that I missed on the updated Trusty test-Server. Actually logging out and in through REMOTE_USER throws a 500 in Apache:</p>
<div class="codehilite"><pre><span></span>[Tue Oct 24 19:23:30.636154 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456] mod_wsgi (pid=6263): Target WSGI script &#39;/home/zulip/deployments/current/zproject/wsgi.py&#39; cannot be loaded as Python module.
[Tue Oct 24 19:23:30.636189 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456] mod_wsgi (pid=6263): Exception occurred processing WSGI script &#39;/home/zulip/deployments/current/zproject/wsgi.py&#39;.
[Tue Oct 24 19:23:30.636203 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456] Traceback (most recent call last):
[Tue Oct 24 19:23:30.636220 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/home/zulip/deployments/current/zproject/wsgi.py&quot;, line 25, in &lt;module&gt;
[Tue Oct 24 19:23:30.636240 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     django.setup()  # We need to call setup to load applications.
[Tue Oct 24 19:23:30.636247 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/usr/lib/python2.7/dist-packages/django/__init__.py&quot;, line 17, in setup
[Tue Oct 24 19:23:30.636255 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)
[Tue Oct 24 19:23:30.636259 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 48, in __getattr__
[Tue Oct 24 19:23:30.636266 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     self._setup(name)
[Tue Oct 24 19:23:30.636270 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 44, in _setup
[Tue Oct 24 19:23:30.636275 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     self._wrapped = Settings(settings_module)
[Tue Oct 24 19:23:30.636279 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/usr/lib/python2.7/dist-packages/django/conf/__init__.py&quot;, line 92, in __init__
[Tue Oct 24 19:23:30.636284 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     mod = importlib.import_module(self.SETTINGS_MODULE)
[Tue Oct 24 19:23:30.636288 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
[Tue Oct 24 19:23:30.636294 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     __import__(name)
[Tue Oct 24 19:23:30.636297 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/home/zulip/deployments/current/zproject/settings.py&quot;, line 20, in &lt;module&gt;
[Tue Oct 24 19:23:30.636303 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     from zerver.lib.db import TimeTrackingConnection
[Tue Oct 24 19:23:30.636307 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]   File &quot;/home/zulip/deployments/current/zerver/lib/db.py&quot;, line 5, in &lt;module&gt;
[Tue Oct 24 19:23:30.636313 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456]     from typing import Callable, Optional, Iterable, Any, Dict, List, Union, TypeVar, \\
[Tue Oct 24 19:23:30.636326 2017] [:error] [pid 6263:tid 140377769850624] [remote 127.0.0.1:48456] ImportError: No module named typing
</pre></div>


<p>Any idea where that <code>ImportError: No module named typing</code> might come from?</p>



<a name="303844"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303844" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303844">(Oct 24 2017 at 17:41)</a>:</h4>
<p><span class="user-mention" data-user-email="me@consol.de" data-user-id="1799">@Michael Elbel</span> thanks for the report!  I think that's probably an issue with the import path.  I'll take a look at the code in a couple minutes.</p>



<a name="303877"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303877" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303877">(Oct 24 2017 at 18:02)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> on Xenial it doesn't even find django:</p>
<div class="codehilite"><pre><span></span>[Tue Oct 24 19:49:12.589085 2017] [wsgi:error] [pid 1359:tid 140605304317696] [remote 127.0.0.1:60481] Traceback (most recent call last):
[Tue Oct 24 19:49:12.589095 2017] [wsgi:error] [pid 1359:tid 140605304317696] [remote 127.0.0.1:60481]   File &quot;/home/zulip/deployments/current/zproject/wsgi.py&quot;, line 24, in &lt;module&gt;
[Tue Oct 24 19:49:12.589127 2017] [wsgi:error] [pid 1359:tid 140605304317696] [remote 127.0.0.1:60481]     import django
[Tue Oct 24 19:49:12.589139 2017] [wsgi:error] [pid 1359:tid 140605304317696] [remote 127.0.0.1:60481] ImportError: No module named django
</pre></div>



<a name="303879"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303879" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303879">(Oct 24 2017 at 18:03)</a>:</h4>
<p>OK, looking now.</p>



<a name="303880"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303880" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303880">(Oct 24 2017 at 18:04)</a>:</h4>
<p>So, the script in question is <code>zproject/wsgi.py</code>, and this code here should result in it being put into the virtualenv that has all those dependencies:</p>
<div class="codehilite"><pre><span></span>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.append(BASE_DIR)
import scripts.lib.setup_path_on_import
</pre></div>



<a name="303881"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303881" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303881">(Oct 24 2017 at 18:04)</a>:</h4>
<p>So I think there are a few possibilities:</p>
<ul>
<li>You just need to restart Apache or something to start using the new version</li>
<li>Something is a bit off with that code for finding the virtualenv in the Apache context</li>
<li>Apache is using Python 2, not Python 3.</li>
</ul>



<a name="303882"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303882" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303882">(Oct 24 2017 at 18:05)</a>:</h4>
<p>I bet it's the third of those.</p>



<a name="303883"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303883" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303883">(Oct 24 2017 at 18:05)</a>:</h4>
<p>I rebooted the whole system :-| Even ran into the 'rabbitmq needs to be reinstalled' issue again.</p>



<a name="303884"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303884" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303884">(Oct 24 2017 at 18:06)</a>:</h4>
<p>But yes, python2 instead of 3 would explain it.</p>



<a name="303886"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303886" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303886">(Oct 24 2017 at 18:06)</a>:</h4>
<p>Now where to change that ...</p>



<a name="303888"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303888" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303888">(Oct 24 2017 at 18:08)</a>:</h4>
<p>The uwsgi configs in /etc/apache2 do not specify a python version. <strong>But</strong> I see <code>home/zulip/deployments/current/zulip-current-venv/bin/uwsgi --ini /etc/zulip/uwsgi.ini</code> processes running.</p>



<a name="303890"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303890" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303890">(Oct 24 2017 at 18:09)</a>:</h4>
<p>Try <code>apt-get install libapache2-mod-wsgi-py3; apt-get removelibapache2-mod-wsgi</code> and then restarting apache?</p>



<a name="303891"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303891" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303891">(Oct 24 2017 at 18:10)</a>:</h4>
<p>Forget that. Yes, you were faster. Hang on.</p>



<a name="303895"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303895" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303895">(Oct 24 2017 at 18:14)</a>:</h4>
<p><span class="user-mention" data-user-email="me@consol.de" data-user-id="1799">@Michael Elbel</span> I guess actually it would be good to know whether you need to restart apache or whether just the <code>apt</code> stuff is good enough.</p>



<a name="303896"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303896" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303896">(Oct 24 2017 at 18:14)</a>:</h4>
<p>(Just thinking about how we document this in the Changelog)</p>



<a name="303899"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303899" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303899">(Oct 24 2017 at 18:16)</a>:</h4>
<p>Drat. I checked against the Xenial server while I had patched the Trusty one. Just rebooted that box, now rabbitmq doesn't work again. Just a second.</p>



<a name="303904"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303904" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303904">(Oct 24 2017 at 18:23)</a>:</h4>
<p>Ok, Trusty works with the mod-wsgi-py3. Same for Xenial. Phew</p>



<a name="303909"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303909" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303909">(Oct 24 2017 at 18:27)</a>:</h4>
<p>OK, great, thanks for reporting and verifying!</p>



<a name="303910"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303910" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303910">(Oct 24 2017 at 18:28)</a>:</h4>
<p>Actually Ubuntu is intelligent enough to not let you have two wsgi modules at the same time. So <code>apt-get install libapache2-mod-wsgi-py3</code> is enough. It will remove the old one <strong>and</strong> restart apache2 for you.</p>



<a name="303912"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303912" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303912">(Oct 24 2017 at 18:30)</a>:</h4>
<p>Should have checked that before recommending the convoluted solution <span class="emoji emoji-1f644" title="face with rolling eyes">:face_with_rolling_eyes:</span></p>



<a name="303914"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303914" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303914">(Oct 24 2017 at 18:32)</a>:</h4>
<p>And at least for my setup here, whatever the upgrade process from 1.6.0 to 1.7.0 does with rabbitmq does not survive a reboot. I had to do the <code>service supervisor stop &amp;&amp; dpkg -P rabbitmq-server &amp;&amp; apt-get install rabbitmq-server &amp;&amp; /home/zulip/deployments/current/scripts/setup/configure-rabbitmq &amp;&amp; service supervisor start</code> dance both on Trusty and Xenial.</p>



<a name="303919"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303919" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303919">(Oct 24 2017 at 18:39)</a>:</h4>
<p>I don't believe 1.7.0 has any changes related to rabbitmq.  <span class="user-mention" data-user-email="me@consol.de" data-user-id="1799">@Michael Elbel</span> can you <code>cat /etc/zulip/zulip.conf</code> and post it?</p>



<a name="303920"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303920" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303920">(Oct 24 2017 at 18:40)</a>:</h4>
<p>I think it might be just that if you installed before 1.6.0, with some hosting providers, RabbitMQ never survives a reboot.</p>



<a name="303921"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303921" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303921">(Oct 24 2017 at 18:40)</a>:</h4>
<p>1.6.0 has some changes that fix this, but they just change defaults in the installer.</p>



<a name="303922"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303922" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303922">(Oct 24 2017 at 18:40)</a>:</h4>
<p>So older systems aren't changed.</p>



<a name="303923"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303923" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303923">(Oct 24 2017 at 18:40)</a>:</h4>
<p>rabbitmq needs babysitting on our install as well</p>



<a name="303924"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303924" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303924">(Oct 24 2017 at 18:41)</a>:</h4>
<p><span class="user-mention" data-user-email="shidarin@gmail.com" data-user-id="3733">@Sean Wallitsch</span> interesting, because you installed on 1.6.0?</p>



<a name="303925"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303925" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303925">(Oct 24 2017 at 18:41)</a>:</h4>
<p>We started with 1.6, but I've found it doesn't survive a reboot</p>



<a name="303926"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303926" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303926">(Oct 24 2017 at 18:41)</a>:</h4>
<p>Interesting.</p>



<a name="303927"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303927" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303927">(Oct 24 2017 at 18:41)</a>:</h4>
<p>or maybe it doesn't survive <em>correctly</em></p>



<a name="303928"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303928" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303928">(Oct 24 2017 at 18:42)</a>:</h4>
<p>Since I'm usually running <code>sudo service rabbitmq-server restart</code> and that fixes everything</p>



<a name="303931"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303931" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303931">(Oct 24 2017 at 18:44)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> the Xenial VM was a fresh install with 1.6.0 and data migration that I then updated to 1.7.0-rc2. Trusty goes way back. However both systems now survive reboots happily without me having to touch rabbitmq. So no complaints from me, I'm used to it <span class="emoji emoji-1f601" title="grin">:grin:</span></p>



<a name="303932"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303932" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303932">(Oct 24 2017 at 18:47)</a>:</h4>
<p><span class="user-mention" data-user-email="shidarin@gmail.com" data-user-id="3733">@Sean Wallitsch</span> Being so used to just reinstalling rabbitmq it never occurred to me to try restarting it <span class="emoji emoji-1f644" title="face with rolling eyes">:face_with_rolling_eyes:</span> Thanks for that info, will try if I ever run into it not working properly again.</p>



<a name="303936"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303936" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303936">(Oct 24 2017 at 18:54)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> Sorry again for not reading thoroughly enough. Of course did I copy over zulip.conf. It looks like this:</p>
<div class="codehilite"><pre><span></span>[machine]
puppet_classes = zulip::voyager, zulip::apache_sso
deploy_type = voyager

[rabbitmq]
nodename = zulip@localhost
</pre></div>


<p>the nodename line should be the right one, yes?</p>



<a name="303937"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303937" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303937">(Oct 24 2017 at 18:54)</a>:</h4>
<p>yeah, that nodename should be correct.</p>



<a name="303939"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303939" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303939">(Oct 24 2017 at 18:55)</a>:</h4>
<p>And you're still seeing issues connecting to rabbitmq after reboot?  </p>
<p>I've been wanting to test whether switching <code>nodename</code> to <code>zulip@127.0.0.1</code> as the default there is more reliable.</p>



<a name="303941"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303941" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303941">(Oct 24 2017 at 18:56)</a>:</h4>
<p>No, I do not see issues any more after I reinstalled rabbitmq once. <strong>And</strong> I notice that <code>nodename</code> is missing from the productive 1.6 server.</p>



<a name="303942"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303942" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303942">(Oct 24 2017 at 18:58)</a>:</h4>
<p>Looking at configure-rabbitmq, the line does not get put into the config from there.</p>



<a name="303943"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303943" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303943">(Oct 24 2017 at 19:02)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> changing it to 127.0.0.1 would prevent it from using IPv6 which might be desirable or not depending on your philosophy <span class="emoji emoji-1f610" title="neutral face">:neutral_face:</span></p>



<a name="303944"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303944" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303944">(Oct 24 2017 at 19:02)</a>:</h4>
<p>I haven't tested whether ipv6 even works with Erland (which is what RabbitMQ is written in)</p>



<a name="303945"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303945" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303945">(Oct 24 2017 at 19:03)</a>:</h4>
<p>So it's possible that would be a good thing.</p>



<a name="303946"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303946" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303946">(Oct 24 2017 at 19:03)</a>:</h4>
<p>I think for talking to localhost though, you probably don't super care whether it's ipv4 or ipv6 as long as it works.</p>



<a name="303947"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303947" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303947">(Oct 24 2017 at 19:05)</a>:</h4>
<p><code>lsof -i | grep rabbit</code> shows that <code>epmd</code> listens on both.</p>



<a name="303950"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303950" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Elbel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303950">(Oct 24 2017 at 19:08)</a>:</h4>
<p>Supposedly, Erlang has supported IPv6 for about 20 years now. They claim to even have had the first web server on the IPv6 test network.</p>



<a name="303951"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303951" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303951">(Oct 24 2017 at 19:11)</a>:</h4>
<p>Cool :)</p>



<a name="303952"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/sso%20error/near/303952" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/sso.20error.html#303952">(Oct 24 2017 at 19:12)</a>:</h4>
<p><span class="user-mention" data-user-email="me@consol.de" data-user-id="1799">@Michael Elbel</span>  OK I merged the fix for the package to be the python 3 version into master, so we should be all set on the Apache issue.  Thanks again for the report!</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>