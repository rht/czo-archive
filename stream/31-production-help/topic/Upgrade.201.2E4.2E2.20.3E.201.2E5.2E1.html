<html>
<head><meta charset="utf-8"><title>Upgrade 1.4.2 &gt; 1.5.1 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html">Upgrade 1.4.2 &gt; 1.5.1</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="163781"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163781" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163781">(Mar 07 2017 at 11:27)</a>:</h4>
<p>ok, I just created a Hyper-V export of the Zulip VM as a backup. Because it worked much faster than expected I also created a checkpoint and run the upgrade of zulip. But installing all those ubuntu updates takes a long time. Are those ubuntu updates done after the zulip upgrade or prior to it. <br>
in the home/deployment folder I can already see the new folder of 1.5.1</p>



<a name="163784"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163784" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163784">(Mar 07 2017 at 11:29)</a>:</h4>
<div class="codehilite"><pre><span></span>Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2017-03-07-12-09-51/scripts/lib/upgrade-zulip-stage-2&quot;, line 47, in &lt;module&gt;
    subprocess.check_call([&quot;apt-get&quot;, &quot;-y&quot;, &quot;upgrade&quot;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;apt-get&#39;, &#39;-y&#39;, &#39;upgrade&#39;]&#39; returned non-zero exit status 100
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip&quot;, line 53, in &lt;module&gt;
    subprocess.check_call([os.path.abspath(&quot;./scripts/lib/upgrade-zulip-stage-2&quot;), deploy_path])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/home/zulip/deployments/2017-03-07-12-09-51/scripts/lib/upgrade-zulip-stage-2&#39;, &#39;/home/zulip/deployments/2017-03-07-12-09-51&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="163785"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163785" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163785">(Mar 07 2017 at 11:29)</a>:</h4>
<p>this was just returned</p>



<a name="163787"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163787" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163787">(Mar 07 2017 at 11:31)</a>:</h4>
<p>zulip is running again but I can't see that it's upgraded... probably not</p>



<a name="163789"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163789" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163789">(Mar 07 2017 at 11:42)</a>:</h4>
<p>ok, the new version was unpacked, the tarball was archived but it's was probably not migrated. What now?</p>



<a name="163816"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163816" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163816">(Mar 07 2017 at 15:38)</a>:</h4>
<p>deployment/current/version still points to 1.4.2</p>



<a name="163825"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163825" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163825">(Mar 07 2017 at 16:33)</a>:</h4>
<p>I'm not entirely certain if the upgrade script can be freely restarted like the install script is (although I don't see anything indicating it can't, either.) Hopefully someone will be online soon who can clarify. Was there anything useful in <code>/var/log/zulip/upgrade.log</code>?</p>



<a name="163867"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163867" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163867">(Mar 07 2017 at 17:46)</a>:</h4>
<p>ah, I haven't checked the log. will do when back at work tomorrow.</p>



<a name="163932"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163932" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163932">(Mar 07 2017 at 19:00)</a>:</h4>
<p>The upgrade process starts with the <code>apt-get upgrade</code>, before it does anything, and like the install script is designed to be idempotent so you can run it again if it fails</p>



<a name="163934"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163934" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163934">(Mar 07 2017 at 19:01)</a>:</h4>
<p>It starts by doing an <code>apt-get upgrade</code>, then installs the new Python virtualenv needed, and only then does it shut down the old server version and startup the new one</p>



<a name="163936"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/163936" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#163936">(Mar 07 2017 at 19:02)</a>:</h4>
<p>It'd be a pretty small project to add support for an option to the upgrade script that just installs dependencies for the new version and then exits (which would make it a lot easier to know which minute the downtime is going to be in), we should probably do that</p>



<a name="164315"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164315" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164315">(Mar 08 2017 at 09:18)</a>:</h4>
<p><span class="user-mention" data-user-email="zulip@feorlen.org" data-user-id="397">@Andrea  Longo</span> most of the log is about the ubuntu upgrades. there is one line i forgot in the above quote out of the log. </p>
<div class="codehilite"><pre><span></span>E: Sub-process /usr/bin/dpkg returned an error code (1)
</pre></div>



<a name="164353"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164353" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164353">(Mar 08 2017 at 11:55)</a>:</h4>
<p>ok, something happen. After the updates yesterday I wanted to merge the checkpoint before the upgrade and create a new one before trying another zulip upgrade. <br>
merging the checkpoint completely broke the VM but furtunately I had a backup. <br>
problem now is this</p>
<div class="codehilite"><pre><span></span>zulip@zulip:~$ sudo /home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-1.5.1.tar.gz
2017-03-08 12:51:05,047 upgrade-zulip: Archiving the tarball under /home/zulip/archives
2017-03-08 12:51:05,945 upgrade-zulip: Unpacking the tarball
2017-03-08 12:51:08,131 upgrade-zulip-stage-2: Upgrading system packages...
Get:1 http://security.ubuntu.com/ubuntu xenial-security InRelease [102 kB]
Hit:2 http://ppa.launchpad.net/tabbott/zulip/ubuntu xenial InRelease
Hit:3 http://gb.archive.ubuntu.com/ubuntu xenial InRelease
Get:4 http://gb.archive.ubuntu.com/ubuntu xenial-updates InRelease [102 kB]
Get:5 http://gb.archive.ubuntu.com/ubuntu xenial-backports InRelease [102 kB]
Fetched 306 kB in 4s (67.5 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
You might want to run ‘apt-get -f install’ to correct these.
The following packages have unmet dependencies.
 linux-image-extra-4.4.0-66-generic : Depends: linux-image-4.4.0-66-generic but it is not installed
 linux-image-generic : Depends: linux-image-4.4.0-66-generic but it is not installed
                       Recommends: thermald but it is not installed
E: Unmet dependencies. Try using -f.
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2017-03-08-12-51-06/scripts/lib/upgrade-zulip-stage-2&quot;, line 47, in &lt;module&gt;
    subprocess.check_call([&quot;apt-get&quot;, &quot;-y&quot;, &quot;upgrade&quot;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;apt-get&#39;, &#39;-y&#39;, &#39;upgrade&#39;]&#39; returned non-zero exit status 100
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip&quot;, line 53, in &lt;module&gt;
    subprocess.check_call([os.path.abspath(&quot;./scripts/lib/upgrade-zulip-stage-2&quot;), deploy_path])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/home/zulip/deployments/2017-03-08-12-51-06/scripts/lib/upgrade-zulip-stage-2&#39;, &#39;/home/zulip/deployments/2017-03-08-12-51-06&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="164356"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164356" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164356">(Mar 08 2017 at 11:56)</a>:</h4>
<p>I can't seem to get this dependency installed but yesterday I had no such problem</p>



<a name="164358"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164358" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164358">(Mar 08 2017 at 11:58)</a>:</h4>
<p>that's not a dependency of Zulip</p>



<a name="164359"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164359" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164359">(Mar 08 2017 at 11:58)</a>:</h4>
<p>that's just your apt setup on the server being busted</p>



<a name="164360"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164360" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164360">(Mar 08 2017 at 11:58)</a>:</h4>
<p>We don't depend on the Linux kernel, at least not directly</p>



<a name="164361"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164361" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164361">(Mar 08 2017 at 11:59)</a>:</h4>
<p>all the sudden? ok. then I will have to find some help elsewhere about getting apt-get back again?</p>



<a name="164362"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164362" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164362">(Mar 08 2017 at 12:02)</a>:</h4>
<p>what is the command to shut down zulip?<br>
in the script folder there is only restart and upgrade</p>



<a name="164370"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164370" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164370">(Mar 08 2017 at 13:01)</a>:</h4>
<p>/boot was full... but I learnt a lot in the process of cleaning this up</p>



<a name="164372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%201.4.2%20%3E%201.5.1/near/164372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.201.2E4.2E2.20.3E.201.2E5.2E1.html#164372">(Mar 08 2017 at 13:42)</a>:</h4>
<p>ok, managed to clean things up and installed all upgrades etc. before running the zulip upgrade<br>
and tada: upgrade worked without a glitch<br>
sadly the msg box of the legacy app has shrunk. Is the legacy app still being maintained? <br>
<a href="/user_uploads/2/46/EMJZMK1djidWEqxNST1iIDSJ/pasted_image.png" target="_blank" title="pasted_image.png">shrunk message box in legacy desktop app</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/46/EMJZMK1djidWEqxNST1iIDSJ/pasted_image.png" target="_blank" title="shrunk message box in legacy desktop app"><img src="/user_uploads/2/46/EMJZMK1djidWEqxNST1iIDSJ/pasted_image.png"></a></div>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>