<html>
<head><meta charset="utf-8"><title>Problems upgrading to 7.3 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html">Problems upgrading to 7.3</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1633320"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Problems%20upgrading%20to%207.3/near/1633320" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RentGes_Soft <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html#1633320">(Aug 30 2023 at 08:14)</a>:</h4>
<p>Hi, I'm currently attempting to upgrade our installation to version 7.3, and here are the results:</p>
<p>root@im:~# /home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-latest.tar.gz <br>
2023-08-30 08:06:52,439 upgrade-zulip: Archiving the tarball under /home/zulip/archives<br>
2023-08-30 08:06:52,607 upgrade-zulip: Unpacking the tarball<br>
2023-08-30 08:06:54,759 upgrade-zulip-stage-2: Upgrading from 7.2 to 7.3, in /home/zulip/deployments/2023-08-30-10-06-52<br>
postgresql-10-pgdg-pgroonga was already set on hold.<br>
postgresql-13-pgdg-pgroonga was already set on hold.<br>
postgresql-14-pgdg-pgroonga was already set on hold.<br>
postgresql-15-pgdg-pgroonga was already set on hold.<br>
postgresql-11-pgdg-pgroonga set on hold.<br>
postgresql-12-pgdg-pgroonga set on hold.<br>
2023-08-30 08:06:55,032 upgrade-zulip-stage-2: Upgrading system packages...<br>
Hit:1 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal InRelease<br>
Hit:2 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal-updates InRelease<br>
Hit:3 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal-backports InRelease<br>
Hit:4 <a href="http://ppa.launchpad.net/groonga/ppa/ubuntu">http://ppa.launchpad.net/groonga/ppa/ubuntu</a> focal InRelease<br>
Hit:5 <a href="http://archive.ubuntu.com/ubuntu">http://archive.ubuntu.com/ubuntu</a> focal InRelease<br>
Hit:6 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> focal-security InRelease<br>
Hit:7 <a href="http://apt.postgresql.org/pub/repos/apt">http://apt.postgresql.org/pub/repos/apt</a> focal-pgdg InRelease<br>
Ign:8 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable InRelease<br>
Get:9 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release [16.0 kB]<br>
Get:10 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release.gpg [819 B]<br>
Ign:10 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release.gpg<br>
Hit:11 <a href="https://packages.groonga.org/ubuntu">https://packages.groonga.org/ubuntu</a> focal InRelease<br>
Reading package lists...<br>
W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-i386/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: GPG error: <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 2D223B918916F2A2<br>
E: The repository '<a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release' is not signed.<br>
W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-i386/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
Traceback (most recent call last):<br>
  File "/home/zulip/deployments/2023-08-30-10-06-52/scripts/lib/upgrade-zulip-stage-2", line 222, in &lt;module&gt;<br>
    subprocess.check_call(["apt-get", "update"])<br>
  File "/usr/lib/python3.8/subprocess.py", line 364, in check_call<br>
    raise CalledProcessError(retcode, cmd)<br>
subprocess.CalledProcessError: Command '['apt-get', 'update']' returned non-zero exit status 100.</p>
<p>Zulip upgrade failed (exit code 1)!</p>
<p>The upgrade process is designed to be idempotent, so you can retry after resolving whatever issue caused the failure (there should be a traceback above). A log of this installation is available in /var/log/zulip/upgrade.log</p>
<p>Just to clarify, our server is managed using Webmin and is regularly updated through it.</p>



<a name="1633322"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Problems%20upgrading%20to%207.3/near/1633322" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RentGes_Soft <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html#1633322">(Aug 30 2023 at 08:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27080">RentGes_Soft</span> <a href="#narrow/stream/9-issues/topic/Problems.20upgrading.20to.207.2E3/near/1633320">ha dicho</a>:</p>
<blockquote>
<p>Hi, I'm currently attempting to upgrade our installation to version 7.3, and here are the results:</p>
<p>root@im:~# /home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-latest.tar.gz <br>
2023-08-30 08:06:52,439 upgrade-zulip: Archiving the tarball under /home/zulip/archives<br>
2023-08-30 08:06:52,607 upgrade-zulip: Unpacking the tarball<br>
2023-08-30 08:06:54,759 upgrade-zulip-stage-2: Upgrading from 7.2 to 7.3, in /home/zulip/deployments/2023-08-30-10-06-52<br>
postgresql-10-pgdg-pgroonga was already set on hold.<br>
postgresql-13-pgdg-pgroonga was already set on hold.<br>
postgresql-14-pgdg-pgroonga was already set on hold.<br>
postgresql-15-pgdg-pgroonga was already set on hold.<br>
postgresql-11-pgdg-pgroonga set on hold.<br>
postgresql-12-pgdg-pgroonga set on hold.<br>
2023-08-30 08:06:55,032 upgrade-zulip-stage-2: Upgrading system packages...<br>
Hit:1 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal InRelease<br>
Hit:2 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal-updates InRelease<br>
Hit:3 <a href="http://asi-fs-d.contabo.net/ubuntu">http://asi-fs-d.contabo.net/ubuntu</a> focal-backports InRelease<br>
Hit:4 <a href="http://ppa.launchpad.net/groonga/ppa/ubuntu">http://ppa.launchpad.net/groonga/ppa/ubuntu</a> focal InRelease<br>
Hit:5 <a href="http://archive.ubuntu.com/ubuntu">http://archive.ubuntu.com/ubuntu</a> focal InRelease<br>
Hit:6 <a href="http://security.ubuntu.com/ubuntu">http://security.ubuntu.com/ubuntu</a> focal-security InRelease<br>
Hit:7 <a href="http://apt.postgresql.org/pub/repos/apt">http://apt.postgresql.org/pub/repos/apt</a> focal-pgdg InRelease<br>
Ign:8 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable InRelease<br>
Get:9 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release [16.0 kB]<br>
Get:10 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release.gpg [819 B]<br>
Ign:10 <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release.gpg<br>
Hit:11 <a href="https://packages.groonga.org/ubuntu">https://packages.groonga.org/ubuntu</a> focal InRelease<br>
Reading package lists...<br>
W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-i386/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: GPG error: <a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 2D223B918916F2A2<br>
E: The repository '<a href="https://download.webmin.com/download/newkey/repository">https://download.webmin.com/download/newkey/repository</a> stable Release' is not signed.<br>
W: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-i386/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
W: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/pgdg.list:1 and /etc/apt/sources.list.d/zulip.list:1<br>
Traceback (most recent call last):<br>
  File "/home/zulip/deployments/2023-08-30-10-06-52/scripts/lib/upgrade-zulip-stage-2", line 222, in &lt;module&gt;<br>
    subprocess.check_call(["apt-get", "update"])<br>
  File "/usr/lib/python3.8/subprocess.py", line 364, in check_call<br>
    raise CalledProcessError(retcode, cmd)<br>
subprocess.CalledProcessError: Command '['apt-get', 'update']' returned non-zero exit status 100.</p>
<p>Zulip upgrade failed (exit code 1)!</p>
<p>The upgrade process is designed to be idempotent, so you can retry after resolving whatever issue caused the failure (there should be a traceback above). A log of this installation is available in /var/log/zulip/upgrade.log</p>
<p>Just to clarify, our server is managed using Webmin and is regularly updated through it.</p>
</blockquote>
<p>Auto-fixed! <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> The issue was caused by the Webmin repository, specifically a GPG public key error. It was resolved by running a setup script based on the problem described in this repository (<a href="https://github.com/webmin/webmin/issues/1966#issuecomment-1653934423">https://github.com/webmin/webmin/issues/1966#issuecomment-1653934423</a>). Now, the update process is functioning properly!</p>



<a name="1634098"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Problems%20upgrading%20to%207.3/near/1634098" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html#1634098">(Aug 31 2023 at 22:56)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/Problems.20upgrading.20to.207.2E3">#issues &gt; Problems upgrading to 7.3</a> by <span class="user-mention silent" data-user-id="7">Tim Abbott</span>.</p>



<a name="1634099"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Problems%20upgrading%20to%207.3/near/1634099" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html#1634099">(Aug 31 2023 at 22:57)</a>:</h4>
<p><span class="user-mention" data-user-id="27080">@RentGes_Soft</span> moved this to the documented stream for help with self-hosting.</p>



<a name="1634100"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Problems%20upgrading%20to%207.3/near/1634100" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Problems.20upgrading.20to.207.2E3.html#1634100">(Aug 31 2023 at 22:57)</a>:</h4>
<p>And yeah, looks like you correctly diagnosed the problem with the <code>webmin</code> repository unrelated to Zulip.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>