<html>
<head><meta charset="utf-8"><title>file uploads not found · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html">file uploads not found</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="20170"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20170" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20170">(Aug 28 2016 at 20:55)</a>:</h4>
<p>Okay, everything on the new install seems to be working except that file uploads, while they appear to be happening (i.e. if I attach a file to a post, the uploaded file shows up in <code>/home/zulip/var/uploads/files/</code>), are 404'ing on the site. Any ideas?</p>



<a name="20171"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20171" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20171">(Aug 28 2016 at 21:11)</a>:</h4>
<p>Can you look into your settings.py to see how you are saving uploaded files?  We have an S3 option and a local option.</p>



<a name="20172"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20172" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20172">(Aug 28 2016 at 21:11)</a>:</h4>
<p>I guess you're saving locally, reading what you just sent more carefully.</p>



<a name="20173"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20173" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20173">(Aug 28 2016 at 21:14)</a>:</h4>
<p>What is the URL for the uploads?  Are you using DNS or serving up via IP?</p>



<a name="20175"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20175" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20175">(Aug 28 2016 at 21:16)</a>:</h4>
<p>just to get a quick data point, can you upload a file to test/uploads on this instance?</p>



<a name="20176"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20176" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20176">(Aug 28 2016 at 21:18)</a>:</h4>
<p>Once you do the upload, you can hover over the link to see that this Zulip instance is configured to use a "user_uploads" directory.</p>



<a name="20177"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20177" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20177">(Aug 28 2016 at 21:19)</a>:</h4>
<p>There is a setting in <code>settings.py</code> called <code>LOCAL_UPLOADS_DIR</code> that sets the upload path.</p>



<a name="20182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20182">(Aug 28 2016 at 21:20)</a>:</h4>
<p>In settings: <code>LOCAL_UPLOADS_DIR = "/home/zulip/var/uploads"</code></p>



<a name="20187"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20187" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20187">(Aug 28 2016 at 21:22)</a>:</h4>
<p>The link in the post where the file was attached is generated to be at, for example, <code>user_uploads/2/bd/iPXzacvbCUuVp84MsGxoSU7H/image.jpg</code></p>



<a name="20188"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20188" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20188">(Aug 28 2016 at 21:24)</a>:</h4>
<p>Can you try changing to relative paths as a troubleshooting experiment?</p>



<a name="20189"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20189" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20189">(Aug 28 2016 at 21:24)</a>:</h4>
<p>files definitely seem to be uploading. Like, there will be a corresponding <code>/home/zulip/var/uploads/files/2/bd/iPXzacvbCUuVp84MsGxoSU7H/image.jpg</code></p>



<a name="20190"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20190" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20190">(Aug 28 2016 at 21:24)</a>:</h4>
<p>In the post itself?</p>



<a name="20191"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20191" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20191">(Aug 28 2016 at 21:24)</a>:</h4>
<p>in settings.py</p>



<a name="20192"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20192" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20192">(Aug 28 2016 at 21:25)</a>:</h4>
<p>I'm thinking maybe we were assuming relative paths when we wrote this code, so that the "get" side of things is a relative path that the webserver knows it controls?  I don't know, I'm just guessing.</p>



<a name="20193"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20193" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20193">(Aug 28 2016 at 21:29)</a>:</h4>
<p>Hm...tried changing it to <code>LOCAL_UPLOADS_DIR = "/test/uploads"</code> but having a little trouble navigating around for directory structure to figure out what's going on, if that's uploading.</p>



<a name="20194"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20194" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20194">(Aug 28 2016 at 21:30)</a>:</h4>
<p>That's not a relative path. :)</p>



<a name="20195"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20195" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20195">(Aug 28 2016 at 21:32)</a>:</h4>
<p>Hmmmm. Just looked at the code, and we actually do want an absolute path.  There's a long comment in prod_settings_template.py that you should probably read.</p>



<a name="20196"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20196" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20196">(Aug 28 2016 at 21:32)</a>:</h4>
<p>looks like some kind of nginx thing</p>



<a name="20197"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20197" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20197">(Aug 28 2016 at 21:34)</a>:</h4>
<p>line?</p>



<a name="20198"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20198" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20198">(Aug 28 2016 at 21:34)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/blob/master/zproject/prod_settings_template.py#L153" target="_blank" title="https://github.com/zulip/zulip/blob/master/zproject/prod_settings_template.py#L153">https://github.com/zulip/zulip/blob/master/zproject/prod_settings_template.py#L153</a></p>



<a name="20199"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20199" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20199">(Aug 28 2016 at 21:38)</a>:</h4>
<p>I think that comment is for S3, though.  Hmmmm, kinda stumped here.</p>



<a name="20200"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20200" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20200">(Aug 28 2016 at 21:39)</a>:</h4>
<p>For these things I'm always inclined to look at permissions, but it sounds like the webserver can write to the directory, so it seem improbable to me that it couldn't read from the same directory.</p>



<a name="20201"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20201" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20201">(Aug 28 2016 at 21:41)</a>:</h4>
<p>I think this may be generally over my head. I've almost never tried setting up an app outside an environment like Heroku, so I don't have any instincts for how things work or where to look</p>



<a name="20202"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20202" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20202">(Aug 28 2016 at 21:42)</a>:</h4>
<p>Yeah, unfortunately, I'm not an expert on our prod installs.  But I think this may have something to do with the nginx configuration, if you can track that down somehow.  There's probably an nginx log somewhere.</p>



<a name="20203"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20203" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20203">(Aug 28 2016 at 21:43)</a>:</h4>
<p>/var/log/nginx/access.log may be interesting to look at</p>



<a name="20204"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20204" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20204">(Aug 28 2016 at 21:46)</a>:</h4>
<p>If you've never encountered nginx in your travels, it's basically a highly optimized web server/proxy that sits in front of web servers to do things like really quickly serve up static content like uploaded images and such.</p>



<a name="20205"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20205" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20205">(Aug 28 2016 at 21:55)</a>:</h4>
<p>waaaait...here's something maybe:</p>
<p>In <code>/etc/nginx/sites-available/zulip-enterprise</code> I see a line that says (if I'm reading it right) to alias the user_uploads path to the <code>/home/zulip/uploads/files</code> directory. That directory doesn't seem to exist, but LOCAL_UPLOADS_DIR is set to <code>/home/zulip/var/uploads</code>, which does.</p>



<a name="20206"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20206" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20206">(Aug 28 2016 at 21:57)</a>:</h4>
<p>How would I best restart the application after changing something like that?</p>



<a name="20207"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20207" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20207">(Aug 28 2016 at 22:14)</a>:</h4>
<p>Hm. Doesn't seem to make a different changing  <code>alias /home/zulip/uploads/files</code> to <code>alias /home/zulip/var/uploads/files</code> in <code>/etc/nginx/sites-available/zulip-enterprise</code></p>



<a name="20208"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20208" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20208">(Aug 28 2016 at 22:16)</a>:</h4>
<p>Using <code>su zulip -c /home/zulip/deployments/current/scripts/restart-server</code> to restart afterward.</p>



<a name="20209"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20209" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20209">(Aug 28 2016 at 22:29)</a>:</h4>
<p>You may need to restart nginx itself.</p>



<a name="20210"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20210" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20210">(Aug 28 2016 at 22:31)</a>:</h4>
<p>See the very bottom of this page: <a href="http://zulip.readthedocs.io/en/latest/prod-troubleshooting.html" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-troubleshooting.html">http://zulip.readthedocs.io/en/latest/prod-troubleshooting.html</a></p>



<a name="20211"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20211" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20211">(Aug 28 2016 at 22:32)</a>:</h4>
<p>The troubleshooting page is talking about restarting nginx in a different context than what you're encountering, but <code>service nginx restart</code> might be your answer?</p>



<a name="20212"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20212" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20212">(Aug 28 2016 at 22:32)</a>:</h4>
<p>You may need to sudo that command.</p>



<a name="20213"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20213" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20213">(Aug 28 2016 at 22:34)</a>:</h4>
<p>!!!</p>



<a name="20214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20214">(Aug 28 2016 at 22:34)</a>:</h4>
<p>The var thing worked!!</p>



<a name="20215"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20215" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20215">(Aug 28 2016 at 22:35)</a>:</h4>
<p>After your restart suggestion :)</p>



<a name="20216"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20216" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20216">(Aug 28 2016 at 22:35)</a>:</h4>
<p>Images seem to be all working fine, now.</p>



<a name="20217"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20217" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20217">(Aug 28 2016 at 22:37)</a>:</h4>
<p>Should I submit this change to the nginx config as a pull request or submit an issue? Not sure if my fix is actually where that change should be happening or if maybe the reverse where var is removed from <code>LOCAL_UPLOADS_DIR</code> is the desired solution? I'm not sure what things might be depending on either structure.</p>



<a name="20218"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20218" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20218">(Aug 28 2016 at 22:44)</a>:</h4>
<p>I think for this problem submitting an issue may be the thing to do.</p>



<a name="20219"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20219" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20219">(Aug 28 2016 at 22:45)</a>:</h4>
<p>Pinging <span class="user-mention" data-user-email="tabbott@gmail.com">@Tim Abbott</span> and <span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> who know more about the prod install than I do.</p>



<a name="20220"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20220" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20220">(Aug 28 2016 at 22:46)</a>:</h4>
<p>The more details you can put in the issue, the better, of course, but I also think a brief description and a link to this Zulip thread will suffice.</p>



<a name="20221"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20221" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20221">(Aug 28 2016 at 22:46)</a>:</h4>
<p>Link to convo: <a href="https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found" target="_blank" title="https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found">https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found</a></p>



<a name="20259"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20259" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Stewart <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20259">(Aug 29 2016 at 12:12)</a>:</h4>
<p>Issue created here: <a href="https://github.com/zulip/zulip/issues/1732" target="_blank" title="https://github.com/zulip/zulip/issues/1732">https://github.com/zulip/zulip/issues/1732</a></p>



<a name="20321"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/20321" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#20321">(Aug 29 2016 at 19:45)</a>:</h4>
<p>Thanks for working on this, <span class="user-mention" data-user-email="neurodynamicdev@gmail.com">@Mark Stewart</span>!</p>



<a name="21935"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/21935" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#21935">(Sep 06 2016 at 18:07)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> has this been resolved yet?</p>



<a name="21936"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/21936" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#21936">(Sep 06 2016 at 18:07)</a>:</h4>
<p>I noticed the issue is still open</p>



<a name="21940"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/21940" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#21940">(Sep 06 2016 at 18:08)</a>:</h4>
<p>in 1.4.1 the default LOCAL_UPLOADS_DIR is changed to /home/zulip/uploads</p>



<a name="21943"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/21943" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#21943">(Sep 06 2016 at 18:09)</a>:</h4>
<p>I think we weren't confident enough in that being the right thing to close the issue</p>



<a name="22001"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22001" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22001">(Sep 06 2016 at 18:31)</a>:</h4>
<p>I feel 99% confident now that we addressed the issue in code, but I dropped out of the process once it came time to put up the tarball and stuff.</p>



<a name="22002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22002">(Sep 06 2016 at 18:32)</a>:</h4>
<p>(I assume all that went fine; I just can't vouch first hand for it.)</p>



<a name="22011"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22011" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22011">(Sep 06 2016 at 18:53)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/pull/1757" target="_blank" title="https://github.com/zulip/zulip/pull/1757">#1757</a> is from a user who needs instructions on how to fix this.  <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span>, when you get a chance, can you post to Zulip what the communication should be to these kind of users?</p>



<a name="22012"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22012" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22012">(Sep 06 2016 at 18:55)</a>:</h4>
<p>I pointed them to here for now.</p>



<a name="22013"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22013" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22013">(Sep 06 2016 at 18:55)</a>:</h4>
<p>fyi I focused entirely on the prod_settings issue and didn't test the uploads thing at all. </p>



<a name="22014"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22014" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22014">(Sep 06 2016 at 18:55)</a>:</h4>
<p>I can if it would be helpful.</p>



<a name="22015"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22015" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22015">(Sep 06 2016 at 18:56)</a>:</h4>
<p>I think they're just running 1.4.0 and need to upgrade</p>



<a name="22016"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22016" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22016">(Sep 06 2016 at 18:56)</a>:</h4>
<p>Yeah, but that's a good reminder...we may see folks posting issues on that as well if they install off the tarball.</p>



<a name="22017"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22017" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22017">(Sep 06 2016 at 18:56)</a>:</h4>
<p>Posted a comment to that effect on the issue</p>



<a name="22018"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22018" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22018">(Sep 06 2016 at 18:56)</a>:</h4>
<p>Oh, <a href="https://zulip.org/server.html" target="_blank" title="https://zulip.org/server.html">https://zulip.org/server.html</a> wasn't updated with the 1.4.1 release</p>



<a name="22019"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22019" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22019">(Sep 06 2016 at 18:56)</a>:</h4>
<p>That's probably the problem here</p>



<a name="22020"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22020" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22020">(Sep 06 2016 at 18:57)</a>:</h4>
<p>I can deal</p>



<a name="22021"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22021" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22021">(Sep 06 2016 at 18:57)</a>:</h4>
<p>Yeah, also folks who did the 1.4.0 install may have some files dropped in the wrong directory that they need to move.</p>



<a name="22023"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22023" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22023">(Sep 06 2016 at 18:59)</a>:</h4>
<p>yeah, can you post a comment to that effect on the issues opened about this so it's easy for people to find?</p>



<a name="22027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22027">(Sep 06 2016 at 19:05)</a>:</h4>
<p>I think we should open an issue that says something along the lines of "How to fix problems with 1.4.0" and then we can link everybody there.  I want to avoid having to reply to each individual one, especially if we find nuances later.  I think <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> sent something to zulip-announce or something?  Do you have a link handy?</p>



<a name="22028"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22028" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22028">(Sep 06 2016 at 19:08)</a>:</h4>
<p>I think the message goes along the lines of...we found two bugs in 1.4.0, one with prod_settings.py and one with 1.4.1.</p>
<p>If you tried to install 1.4.0 but backed out to an earlier version, you should be able to just install 1.4.1.</p>
<p>If you managed to install 1.4.0 and are on that version now but encountering problems with uploads, you need to upgrade and possibly move some files.</p>
<p>If you have not yet tried 1.4.0, go directly to 1.4.1 and do no pass "go".</p>



<a name="22029"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22029" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22029">(Sep 06 2016 at 19:11)</a>:</h4>
<p>Is there a reason we still have the 1.4.0 tarball here?</p>
<p><a href="https://www.zulip.com/dist/releases/" target="_blank" title="https://www.zulip.com/dist/releases/">https://www.zulip.com/dist/releases/</a></p>
<p>I guess there's not an easy way to annotate that it's broken, but this is the page people will hit from the upgrade docs.</p>



<a name="22030"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22030" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22030">(Sep 06 2016 at 19:12)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/pull/1758" target="_blank" title="https://github.com/zulip/zulip/pull/1758">#1758</a> is where I'm going to point folks.</p>



<a name="22039"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22039" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22039">(Sep 06 2016 at 20:54)</a>:</h4>
<p>Ended up not having bits to zulip-announce, so had just sent a quick note to zulip-devel:</p>
<div class="codehilite"><pre>Hi everyone,

One more update: 1.4.0 had two issues, one of which affected the upgrade
path from 1.3.13, and one of which affected file uploads and attachments.

An updated build is available at
  https://dl.dropboxusercontent.com/u/23782125/zulip-server-1.4.1.tar.gz,
and should be on the release server soon.

Thank you to Steve Howell and Christie Koehler for debugging and
submitting patches!
</pre></div>



<a name="22041"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22041" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22041">(Sep 06 2016 at 20:58)</a>:</h4>
<p>Sounds good.  <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> <span class="user-mention" data-user-email="tabbott@gmail.com">@Tim Abbott</span> If there's anything else you want to add to <a href="https://github.com/zulip/zulip/pull/1758" target="_blank" title="https://github.com/zulip/zulip/pull/1758">#1758</a> beyond what I wrote, please update the ticket, as that's where I'll be pointing people.  Is there anything else we can do in terms of updating docs or other channels that had previous communication?</p>



<a name="22042"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22042" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22042">(Sep 06 2016 at 20:59)</a>:</h4>
<p>I'm sorta opposed to the idea of taking down old release tarballs philosophically; the problem right now is that the <a href="http://zulip.org" target="_blank" title="http://zulip.org">zulip.org</a> website still tells you to download the old one</p>



<a name="22043"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22043" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22043">(Sep 06 2016 at 20:59)</a>:</h4>
<p>Working on getting Luke to do a <a href="http://zulip.org" target="_blank" title="http://zulip.org">zulip.org</a> deploy to fix that</p>



<a name="22084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22084">(Sep 06 2016 at 22:46)</a>:</h4>
<p>OK <a href="http://zulip.org" target="_blank" title="http://zulip.org">zulip.org</a> is updated with the 1.4.1 release</p>



<a name="22118"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22118" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22118">(Sep 07 2016 at 08:55)</a>:</h4>
<p>I upgraded to the latest version of zulip by following the instructions mentioned here <a href="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading">docs</a> <br>
I downloaded the tarball from <a href="https://www.zulip.com/dist/releases/" target="_blank" title="https://www.zulip.com/dist/releases/">zulip</a> and then ran <code>/home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-lastest.tar.gz</code>.<br>
After that I tried to upload an image to a stream but the same issue still persists. I attached the upgrade log.<br>
<a href="/user_uploads/2/f6/T1N-ogfoGjbbtimv8xGjAzsc/upgrade.log" target="_blank" title="upgrade.log">upgrade.log</a> </p>



<a name="22122"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22122" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22122">(Sep 07 2016 at 09:35)</a>:</h4>
<p>I fixed the issue by changing one line in <code>/etc/nginx/sites-available/zulip-enterprise</code> <br>
The line was <code>alias /home/zulip/uploads/files;</code> Now it is <code>alias /home/zulip/var/uploads/files;</code><br>
restarted ngnix and it worked correctly.</p>



<a name="22123"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22123" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22123">(Sep 07 2016 at 09:38)</a>:</h4>
<p>I think that the install script <code>/root/zulip/scripts/setup/install</code> installs this file right?<br>
We should modify it to correct the issue.</p>



<a name="22124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22124">(Sep 07 2016 at 09:39)</a>:</h4>
<p>In 1.4.1 we did sort of the opposite.  We put the uploaded files back in <code>/home/zulip/uploads/files</code>.</p>



<a name="22125"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22125" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22125">(Sep 07 2016 at 09:42)</a>:</h4>
<p>I think this path<code>/home/zulip/uploads/files/</code> no longer exists.</p>



<a name="22126"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22126" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22126">(Sep 07 2016 at 09:43)</a>:</h4>
<p>I believe it will exist in 1.4.1.</p>



<a name="22127"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22127" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22127">(Sep 07 2016 at 09:44)</a>:</h4>
<p>What version of the tarball are you working with currently?</p>



<a name="22128"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22128" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22128">(Sep 07 2016 at 09:48)</a>:</h4>
<p>The latest, and I do not have it.</p>



<a name="22129"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22129" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22129">(Sep 07 2016 at 09:48)</a>:</h4>
<p>The same issue is for the avatars by the way.</p>



<a name="22130"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22130" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22130">(Sep 07 2016 at 09:53)</a>:</h4>
<p>What does line 158 of zproject/prod_settings_template.py say in your install?</p>



<a name="22131"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22131" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22131">(Sep 07 2016 at 09:54)</a>:</h4>
<p>It says <code># (2) Edit /etc/nginx/sites-available/zulip-enterprise to comment out</code></p>



<a name="22132"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22132" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22132">(Sep 07 2016 at 09:55)</a>:</h4>
<p>What does it say a few lines down, for LOCAL_UPLOADS_DIR?</p>



<a name="22133"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22133" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22133">(Sep 07 2016 at 09:55)</a>:</h4>
<p>Lines 154 to 158</p>
<div class="codehilite"><pre># the nginx configuration for /user_uploads and /user_avatars (see
# https://github.com/zulip/zulip/issues/291 for discussion of a better
# solution that won&#39;t be automatically reverted by the Zulip upgrade
# script), and then restart nginx.
LOCAL_UPLOADS_DIR = &quot;/home/zulip/uploads&quot;
</pre></div>



<a name="22134"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22134" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22134">(Sep 07 2016 at 09:56)</a>:</h4>
<p>Ok, so you have the correct version of that.  What does your <code>prod_settings.py</code> say? </p>



<a name="22135"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22135" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22135">(Sep 07 2016 at 09:59)</a>:</h4>
<p>It says</p>
<div class="codehilite"><pre># (2) Edit /etc/nginx/sites-available/zulip-enterprise to comment out
# the nginx configuration for /user_uploads and /user_avatars (see
# https://github.com/zulip/zulip/issues/291 for discussion of a better
# solution that won&#39;t be automatically reverted by the Zulip upgrade
# script), and then restart nginx.
LOCAL_UPLOADS_DIR = &quot;/home/zulip/var/uploads&quot;
</pre></div>


<p>But before you should now that I manually modified <code>zproject/settings.py</code> and changed the value of <code>LOCAL_UPLOADS_DIR</code> to <code>/home/zulip/var/uploads</code>.</p>



<a name="22136"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22136" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22136">(Sep 07 2016 at 09:59)</a>:</h4>
<p>Then restarted the server.</p>



<a name="22137"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22137" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22137">(Sep 07 2016 at 10:00)</a>:</h4>
<p>Yeah, I am trying to say that you should back out the "var" change, and then I think your problem will go away.</p>



<a name="22138"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22138" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22138">(Sep 07 2016 at 10:01)</a>:</h4>
<p>We introduced "var" for both development and production in 1.4.0.   In retrospect it made sense for development, but not production, so we backed it out in 1.4.1.</p>



<a name="22140"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22140" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22140">(Sep 07 2016 at 10:09)</a>:</h4>
<p>(sorry, wrong channel, edited)</p>



<a name="22142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22142">(Sep 07 2016 at 10:10)</a>:</h4>
<p>I added <code>var</code> in nginx config file and it worked.</p>



<a name="22143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22143">(Sep 07 2016 at 10:11)</a>:</h4>
<p>Yeah, but you want to remove "var" from the nginx config and your prod_settings.py, because otherwise the next time you upgrade nginx will get overwritten.</p>



<a name="22144"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22144" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22144">(Sep 07 2016 at 10:12)</a>:</h4>
<p>So, adding "var" was a mistake in 1.4.0.  In 1.4.1 we fixed the template to not have "var."  But if you already had your own settings, you probably ignored the template, understandably.  I think that's the source of confusion.  But you don't want "var" going forward.</p>



<a name="22145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22145">(Sep 07 2016 at 10:13)</a>:</h4>
<p>If I do that now, I won't be able to open uploaded images right?</p>



<a name="22146"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22146" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22146">(Sep 07 2016 at 10:14)</a>:</h4>
<p>If you change the nginx config and the settings.py and restart Zulip, everything should be in sync going forward.  You may need to manually create the directory and move any files from the last few days into it, I suppose.</p>



<a name="22147"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22147" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22147">(Sep 07 2016 at 10:15)</a>:</h4>
<p>I will try to do this, thanks. <img alt=":smile:" class="emoji" src="/static/third/gemoji/images/emoji/smile.png" title=":smile:"> </p>



<a name="22148"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22148" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22148">(Sep 07 2016 at 10:17)</a>:</h4>
<p>I did as you said and created the uploads folder, manually copied data from <code>var</code> it worked as expected.</p>



<a name="22149"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22149" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22149">(Sep 07 2016 at 10:18)</a>:</h4>
<p>great!  sorry about all the confusion</p>



<a name="22150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mohsen Ibrahim <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22150">(Sep 07 2016 at 10:20)</a>:</h4>
<p>I really love zulip and hope to be able to contribute to it when I have some free time and learn about django.<br>
It is tooo bad that my boss refused to use it as our chat system.</p>



<a name="22151"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/22151" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#22151">(Sep 07 2016 at 10:22)</a>:</h4>
<p>What was your boss's objection to Zulip?</p>



<a name="23259"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/23259" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#23259">(Sep 12 2016 at 02:03)</a>:</h4>
<p><span class="user-mention" data-user-email="mohsen47@hotmail.co.uk">@Mohsen Ibrahim</span> Thanks for letting us know what worked! I second Steve's question. :)</p>



<a name="23265"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/23265" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#23265">(Sep 12 2016 at 02:13)</a>:</h4>
<p><span class="user-mention" data-user-email="mohsen47@hotmail.co.uk">@Mohsen Ibrahim</span> responded to me privately about the boss's objections.  I don't think I'll be revealing anything too private to paraphrase that his boss basically liked another tool due to inertia.</p>



<a name="23266"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/file%20uploads%20not%20found/near/23266" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/file.20uploads.20not.20found.html#23266">(Sep 12 2016 at 02:14)</a>:</h4>
<p>Got it! Thanks Steve.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>