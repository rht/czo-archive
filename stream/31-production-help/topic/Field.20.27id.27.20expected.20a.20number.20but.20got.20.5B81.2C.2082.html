<html>
<head><meta charset="utf-8"><title>Field &#x27;id&#x27; expected a number but got [81, 82 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html">Field &#x27;id&#x27; expected a number but got [81, 82</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1119193"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119193" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119193">(Feb 16 2021 at 19:14)</a>:</h4>
<p>Hi, since upgrading to master 4.0-dev-2101-gccf520ff13 on febr 4, we have occasionally received these errors at 18:00 sharp: "[Django] zulip: Field 'id' expected a number but got [81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 95, 96, 97, 98, 99, 100, 101, 102, 103].</p>
<p>Searching here and github, yields no results. The fact that they come at 18:00...perhaps something cron related..?</p>
<p>Below is the full email that is sent:</p>
<div class="codehilite"><pre><span></span><code>Logger root, from module zerver.worker.queue_processors line 321:
Error generated by Anonymous user (not logged in) on zulip deployment

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/fields/__init__.py&quot;, line 1774, in get_prep_value
    return int(value)
TypeError: int() argument must be a string, a bytes-like object or a number, not &#39;list&#39;

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zerver/worker/queue_processors.py&quot;, line 269, in do_consume
    consume_func(events)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zerver/worker/queue_processors.py&quot;, line 306, in &lt;lambda&gt;
    consume_func = lambda events: self.consume(events[0])
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zerver/worker/queue_processors.py&quot;, line 621, in consume
    bulk_handle_digest_email(user_ids, event[&quot;cutoff&quot;])
  File &quot;/usr/lib/python3.7/contextlib.py&quot;, line 74, in inner
    return func(*args, **kwds)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zerver/lib/digest.py&quot;, line 327, in bulk_handle_digest_email
    users = UserProfile.objects.filter(id__in=user_ids).order_by(&quot;id&quot;).select_related(&quot;realm&quot;)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/manager.py&quot;, line 85, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/query.py&quot;, line 942, in filter
    return self._filter_or_exclude(False, *args, **kwargs)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/query.py&quot;, line 962, in _filter_or_exclude
    clone._filter_or_exclude_inplace(negate, *args, **kwargs)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/query.py&quot;, line 969, in _filter_or_exclude_inplace
    self._query.add_q(Q(*args, **kwargs))
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/sql/query.py&quot;, line 1358, in add_q
    clause, _ = self._add_q(q_object, self.used_aliases)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/sql/query.py&quot;, line 1380, in _add_q
    split_subq=split_subq, check_filterable=check_filterable,
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/sql/query.py&quot;, line 1319, in build_filter
    condition = self.build_lookup(lookups, col, value)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/sql/query.py&quot;, line 1165, in build_lookup
    lookup = lookup_class(lhs, rhs)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/lookups.py&quot;, line 24, in __init__
    self.rhs = self.get_prep_lookup()
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/lookups.py&quot;, line 227, in get_prep_lookup
    rhs_value = self.lhs.output_field.get_prep_value(rhs_value)
  File &quot;/home/zulip/deployments/2021-02-04-11-21-29/zulip-py3-venv/lib/python3.7/site-packages/django/db/models/fields/__init__.py&quot;, line 1778, in get_prep_value
    ) from e
TypeError: Field &#39;id&#39; expected a number but got [81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 95, 96, 97, 98, 99, 100, 101, 102, 103].


Deployed code:
- git: 4.0-dev-2101-gccf520ff13
- ZULIP_VERSION: 4.0-dev-2101-gccf520ff13


Request info: none
</code></pre></div>
<p>Anyone with an idea what to do?  Should I simply try upgrading to todays most recent master?</p>



<a name="1119194"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119194" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119194">(Feb 16 2021 at 19:17)</a>:</h4>
<p>This is fixed by <a href="https://github.com/zulip/zulip/commit/d0f0c2f2ed35d4265961eaa21d9d38e18d85d28f">d0f0c2f2ed35d4265961eaa21d9d38e18d85d28f</a></p>



<a name="1119195"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119195" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119195">(Feb 16 2021 at 19:18)</a>:</h4>
<p>So please try upgrading to latest <code>master</code> and see if that fixes it.</p>



<a name="1119217"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119217" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119217">(Feb 16 2021 at 19:59)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> Thanks! Will do.</p>



<a name="1119219"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119219" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119219">(Feb 16 2021 at 20:05)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span>  I read that without this fix, digests are not sent. Is there a way to re-try sending them, or are they simply lost..?</p>



<a name="1119278"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119278" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119278">(Feb 16 2021 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="16223">@mouk</span> that's correct; you can likely run <code>zerver/management/commands/enqueue_digest_emails.py</code> (aka <code>./manage.py enqueue_digest_emails</code>) by hand; if you're running it days after the original time, you may want to temporarily replace DIGEST_CUTOFF with a larger number of days.</p>



<a name="1119555"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119555" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119555">(Feb 17 2021 at 09:14)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Thanks for the really fantastic support we receive here! I have looked, but not sure where to define DIGEST_CUTOFF. Should I simply add it to our settings.py?</p>



<a name="1119558"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119558" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ganesh Pawar (ganpa3) <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119558">(Feb 17 2021 at 09:39)</a>:</h4>
<p><span class="user-mention" data-user-id="16223">@mouk</span> I think it's in <code>zerver/lib/digest.py</code>:34</p>
<div class="codehilite" data-code-language="Python"><pre><span></span><code><span class="n">DIGEST_CUTOFF</span> <span class="o">=</span> <span class="mi">5</span>
</code></pre></div>



<a name="1119569"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Field%20%27id%27%20expected%20a%20number%20but%20got%20%5B81%2C%2082/near/1119569" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Field.20.27id.27.20expected.20a.20number.20but.20got.20.5B81.2C.2082.html#1119569">(Feb 17 2021 at 10:01)</a>:</h4>
<p><span class="user-mention" data-user-id="17967">@Ganesh Pawar (ganpa3)</span>  Thank you, I just found it myself with grep as well. Thanks!</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>