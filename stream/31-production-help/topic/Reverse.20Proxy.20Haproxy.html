<html>
<head><meta charset="utf-8"><title>Reverse Proxy Haproxy · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html">Reverse Proxy Haproxy</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="625351"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625351" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625351">(Aug 03 2018 at 22:28)</a>:</h4>
<p>I'm running the docker version and having some trouble sorting the reverse proxy. I use haproxy with SSL termination at the frontend and then http to the back end. Both proxy and docker container are on the same server.</p>
<p>I found two sets of info:<br>
<a href="https://github.com/zulip/docker-zulip/wiki/Proxying-via-nginx-on-host-machine" target="_blank" title="https://github.com/zulip/docker-zulip/wiki/Proxying-via-nginx-on-host-machine">https://github.com/zulip/docker-zulip/wiki/Proxying-via-nginx-on-host-machine</a></p>
<p><a href="https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy">https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy</a></p>
<p>The latter has a different nginx config file than the former.</p>



<a name="625352"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625352" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625352">(Aug 03 2018 at 22:29)</a>:</h4>
<p>Unless I've misunderstood, it should be a simple case of redirecting <a href="http://zulip.yourdomain.com" target="_blank" title="http://zulip.yourdomain.com">zulip.yourdomain.com</a> to 1.2.3.4:80?</p>
<p>I wanted to confirm no URL rewrites?</p>



<a name="625353"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625353" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625353">(Aug 03 2018 at 22:30)</a>:</h4>
<p><span class="user-mention" data-user-id="9080">@Ashraf Miah</span> I just pushed some updates to the related documentation, though it sounds like you've found both.</p>



<a name="625354"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625354" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625354">(Aug 03 2018 at 22:30)</a>:</h4>
<p>Yeah, you shouldn't need to do any URL rewrites.</p>



<a name="625355"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625355" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625355">(Aug 03 2018 at 22:31)</a>:</h4>
<p>OK, browser reports too many rewrites and finding it difficult to debug.</p>



<a name="625356"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625356" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625356">(Aug 03 2018 at 22:31)</a>:</h4>
<p><a href="https://github.com/zulip/docker-zulip#networking-and-reverse-proxy-configuration" target="_blank" title="https://github.com/zulip/docker-zulip#networking-and-reverse-proxy-configuration">https://github.com/zulip/docker-zulip#networking-and-reverse-proxy-configuration</a></p>



<a name="625357"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625357" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625357">(Aug 03 2018 at 22:31)</a>:</h4>
<p>If you're doing HTTP without <code>DISABLE_HTTPS</code>, it'll just get redirected back to HTTPS.</p>



<a name="625358"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625358" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625358">(Aug 03 2018 at 22:32)</a>:</h4>
<p>I would recommend the version from <a href="https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy">https://zulip.readthedocs.io/en/latest/production/deployment.html#putting-the-zulip-application-behind-a-reverse-proxy</a>, in that it's what I've been using for the last several years without issue.</p>



<a name="625359"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625359" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625359">(Aug 03 2018 at 22:32)</a>:</h4>
<p>(The docker-zulip wiki page is planned to be merged in and removed)</p>



<a name="625367"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625367" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625367">(Aug 03 2018 at 22:35)</a>:</h4>
<p>Aaah, good clue. How does one disable HTTPS via the docker-compose file?</p>
<p>I searched docs for <code>DISABLE_HTTPS</code> and got nothing</p>



<a name="625370"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625370" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625370">(Aug 03 2018 at 22:39)</a>:</h4>
<p>Never mind, found it on the docker page.</p>



<a name="625372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ashraf Miah <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625372">(Aug 03 2018 at 22:44)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="7">@Tim Abbott</span> for pointing me in the right direction, I got it sorted.</p>
<p>Is there any reason I couldn't use <a href="http://yourdomain.com/zulip" target="_blank" title="http://yourdomain.com/zulip">yourdomain.com/zulip</a> ?</p>



<a name="625376"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/625376" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#625376">(Aug 03 2018 at 22:50)</a>:</h4>
<p>Yeah, that's not supported.  There's potentially cookie/security issues with doing that, but even if we were to resolve those, we'd need to have a way to configure every URL Zulip returns to clients to have that basename, which we haven't done.</p>



<a name="661058"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661058" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bruce Lewin <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661058">(Nov 14 2018 at 05:35)</a>:</h4>
<blockquote>
<p>If you're doing HTTP without <code>DISABLE_HTTPS</code>, it'll just get redirected back to HTTPS.</p>
</blockquote>
<p>Does anyone know if it's possible to disable https when installing Zulip via the standard installation? I want to run Zulip in an LXD container, likely on Debian 9 but I also have haproxy with SSL termination at the frontend and then http to the back end as above. I've tried getting this going a week or so ago but got the too many rewrites problem from NGINX...</p>



<a name="661387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661387">(Nov 14 2018 at 19:18)</a>:</h4>
<p><span class="user-mention" data-user-id="133">@Bruce Lewin</span> if you set in <code>/etc/zulip/zulip.conf</code> a block like this:</p>
<div class="codehilite"><pre><span></span>[application_server]
http_only = true
</pre></div>


<p>and then do <code>/home/zulip/deployments/current/scripts/zulip-puppet-apply</code>, that will convert the <code>nginx</code> config to HTTP only.</p>



<a name="661769"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661769" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bruce Lewin <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661769">(Nov 15 2018 at 07:25)</a>:</h4>
<p>Thank you very much <span class="user-mention" data-user-id="7">@Tim Abbott</span> that worked a treat!</p>



<a name="661771"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661771" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661771">(Nov 15 2018 at 07:42)</a>:</h4>
<p><span class="user-mention" data-user-id="133">@Bruce Lewin</span> great, thanks for the confirmation.</p>



<a name="661774"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661774" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bruce Lewin <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661774">(Nov 15 2018 at 07:44)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> btw, I saw a few tweaks are needed in the docs around the import/export process<br>
<a href="https://zulip.readthedocs.io/en/stable/production/export-and-import.html" target="_blank" title="https://zulip.readthedocs.io/en/stable/production/export-and-import.html">https://zulip.readthedocs.io/en/stable/production/export-and-import.html</a><br>
and I'm not sure your original comment around </p>
<div class="codehilite"><pre><span></span>[application_server]
http_only = true
</pre></div>


<p>Is in their either...</p>
<p>Have I got to do a whole zulip pull git-thing to edit this <a href="https://github.com/zulip/zulip/blob/06d39f87b78944ca841f64f0722b77d799e1b361/docs/production/export-and-import.md" target="_blank" title="https://github.com/zulip/zulip/blob/06d39f87b78944ca841f64f0722b77d799e1b361/docs/production/export-and-import.md">one page</a>? Or is there an easier way?</p>



<a name="661776"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661776" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661776">(Nov 15 2018 at 07:45)</a>:</h4>
<p><span class="user-mention" data-user-id="133">@Bruce Lewin</span> there's a little edit button in the GitHub web UI that you can use for small edits, but for larger efforts usually I'd recommend doing the <code>git clone</code> thing, because then you get to use a read text editor.</p>



<a name="661777"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661777" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661777">(Nov 15 2018 at 07:46)</a>:</h4>
<p>I'd very much appreciate any suggestions to improve that doc; I actually added a few things earlier today, in <a href="https://github.com/zulip/zulip/commit/f1c65975ad44c7d666270b1eea7ec8a5316f7dcc" target="_blank" title="https://github.com/zulip/zulip/commit/f1c65975ad44c7d666270b1eea7ec8a5316f7dcc">f1c65975ad44c7d666270b1eea7ec8a5316f7dcc</a></p>



<a name="661778"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661778" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661778">(Nov 15 2018 at 07:47)</a>:</h4>
<p>The <code>http_only</code> thing probably belongs in <code>production/deployment-options.html</code>, with maybe a link from the SSL docs.  Currently it's only documented indirectly in the docker-zulip documentation.</p>



<a name="661779"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661779" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bruce Lewin <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661779">(Nov 15 2018 at 07:47)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Hmmm, the edit button <a href="http://i.imgur.com/mlmCcxh.png" target="_blank" title="http://i.imgur.com/mlmCcxh.png">doesn't work</a> for me? Do you know what I'm doing wrong? It's only small stuff...</p>
<div class="message_inline_image"><a href="http://i.imgur.com/mlmCcxh.png" target="_blank" title="doesn't work"><img data-src-fullsize="/thumbnail?url=http%3A%2F%2Fi.imgur.com%2FmlmCcxh.png&amp;size=full" src="/thumbnail?url=http%3A%2F%2Fi.imgur.com%2FmlmCcxh.png&amp;size=thumbnail"></a></div>



<a name="661780"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661780" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661780">(Nov 15 2018 at 07:47)</a>:</h4>
<p>You need to click the "fork" button to make your own fork first, I think.</p>



<a name="661781"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661781" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Bruce Lewin <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661781">(Nov 15 2018 at 07:47)</a>:</h4>
<p>ok... cool... I'll see what I can do...</p>



<a name="661782"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661782" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661782">(Nov 15 2018 at 07:48)</a>:</h4>
<p>That, or you're on a weird page for a specific commit, not a branch; try navigating from <a href="https://github.com/zulip/zulip/tree/master/docs/production" target="_blank" title="https://github.com/zulip/zulip/tree/master/docs/production">https://github.com/zulip/zulip/tree/master/docs/production</a></p>



<a name="661850"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Reverse%20Proxy%20Haproxy/near/661850" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Reverse.20Proxy.20Haproxy.html#661850">(Nov 15 2018 at 18:30)</a>:</h4>
<p>I think you should just be able to use the "edit" icon, with no need to click "fork" first. Here's a GH help page confirming that:<br>
<a href="https://help.github.com/articles/editing-files-in-another-user-s-repository/" target="_blank" title="https://help.github.com/articles/editing-files-in-another-user-s-repository/">https://help.github.com/articles/editing-files-in-another-user-s-repository/</a></p>
<p>Makes sense that you need to be looking at a branch, though, rather than a specific commit.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>