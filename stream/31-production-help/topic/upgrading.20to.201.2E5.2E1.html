<html>
<head><meta charset="utf-8"><title>upgrading to 1.5.1 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html">upgrading to 1.5.1</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="190501"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190501" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190501">(Apr 20 2017 at 21:01)</a>:</h4>
<p>I've attempted to update the FHIR zulip server to 1.5.1 and hit a DB update script error (<a href="https://gist.github.com/jmandel/6bfdca7920e91faa85aabe0f0ead7247" target="_blank" title="https://gist.github.com/jmandel/6bfdca7920e91faa85aabe0f0ead7247">https://gist.github.com/jmandel/6bfdca7920e91faa85aabe0f0ead7247</a>)</p>



<a name="190502"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190502" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190502">(Apr 20 2017 at 21:02)</a>:</h4>
<p>Hi <span class="user-mention" data-user-email="jmandel@gmail.com" data-user-id="111">@Josh Mandel</span> - on <a href="https://groups.google.com/forum/#!forum/zulip-devel" target="_blank" title="https://groups.google.com/forum/#!forum/zulip-devel">https://groups.google.com/forum/#!forum/zulip-devel</a> I just saw someone had trouble with your site</p>



<a name="190503"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190503" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190503">(Apr 20 2017 at 21:02)</a>:</h4>
<p>I also see </p>
<div class="codehilite"><pre><span></span>$ supervisorctl status
process-fts-updates                                             RUNNING   pid 21355, uptime 0:00:13
zulip-django                                                    FATAL     can&#39;t find command &#39;/home/zulip/deployments/current/zulip-current-venv/bin/uwsgi&#39;
</pre></div>



<a name="190504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190504">(Apr 20 2017 at 21:02)</a>:</h4>
<p><a href="https://groups.google.com/forum/#!topic/zulip-devel/FRsUlbQwRUA" target="_blank" title="https://groups.google.com/forum/#!topic/zulip-devel/FRsUlbQwRUA">https://groups.google.com/forum/#!topic/zulip-devel/FRsUlbQwRUA</a></p>



<a name="190505"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190505" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190505">(Apr 20 2017 at 21:03)</a>:</h4>
<p>That was an out-of-disk error yesterrday</p>



<a name="190507"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190507" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190507">(Apr 20 2017 at 21:03)</a>:</h4>
<p>which we fixed. And while I was paying attention, I figured it was a good plan to bring things up to date.</p>



<a name="190508"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190508" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190508">(Apr 20 2017 at 21:04)</a>:</h4>
<p>The crux of the update error is: <strong>django.db.utils.DataError: value too long for type character varying(100)</strong></p>



<a name="190520"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190520" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sumana Harihareswara <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190520">(Apr 20 2017 at 21:13)</a>:</h4>
<p>I'm gonna defer to Rishi, Tim, and Steve on this</p>



<a name="190522"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190522" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190522">(Apr 20 2017 at 21:14)</a>:</h4>
<p><span class="user-mention" data-user-email="sh@changeset.nyc" data-user-id="18">@Sumana Harihareswara</span> should <code>/home/zulip/deployments/current/zulip-current-venv/bin/uwsgi</code> exist?</p>



<a name="190523"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190523" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190523">(Apr 20 2017 at 21:15)</a>:</h4>
<p>It's what the zulip-django <code>/etc/supervisor/conf.d/zulip.conf</code> says should run, but it doesn't exist.</p>



<a name="190524"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190524" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190524">(Apr 20 2017 at 21:15)</a>:</h4>
<p><a href="https://chat.zulip.org/#narrow/near/160620/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration" target="_blank" title="https://chat.zulip.org/#narrow/near/160620/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration">https://chat.zulip.org/#narrow/near/160620/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration</a></p>



<a name="190530"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190530" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190530">(Apr 20 2017 at 21:19)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span> . Given that experience, what should I run at this point?</p>



<a name="190531"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190531" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190531">(Apr 20 2017 at 21:19)</a>:</h4>
<p>Should I be modifying the "0041_create_attachments_for_old_messages.py" script?</p>



<a name="190532"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190532" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190532">(Apr 20 2017 at 21:21)</a>:</h4>
<p>Also, is there a good way to pick up migrations from where I left off?</p>



<a name="190533"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190533" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190533">(Apr 20 2017 at 21:25)</a>:</h4>
<p>In theory <code>.manage.py migrate</code> should be smart.  I haven't re-read that thread myself yet, but I think I suggest a patch there.  Let me look...</p>



<a name="190534"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190534" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190534">(Apr 20 2017 at 21:26)</a>:</h4>
<p><a href="https://chat.zulip.org/#narrow/near/160621/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration" target="_blank" title="https://chat.zulip.org/#narrow/near/160621/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration">https://chat.zulip.org/#narrow/near/160621/stream/production.20help/topic/Upgrade.20to.201.2E5.2E1.20fails.20during.20migration</a></p>



<a name="190535"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190535" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190535">(Apr 20 2017 at 21:26)</a>:</h4>
<p>OK. I've just updated the python file in-place and re-running upgrade-zulip</p>



<a name="190536"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190536" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190536">(Apr 20 2017 at 21:26)</a>:</h4>
<p>Looking</p>



<a name="190538"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190538" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190538">(Apr 20 2017 at 21:27)</a>:</h4>
<p>We're back up! Thanks guys.</p>



<a name="190539"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190539" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190539">(Apr 20 2017 at 21:27)</a>:</h4>
<p>Ahh, yeah, I think this is something where migration 0042 fixes the length, but unfortunately is in the wrong order for that upgrade to be happy :/</p>



<a name="190541"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190541" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190541">(Apr 20 2017 at 21:28)</a>:</h4>
<p>Yeah :/  BTW, is there something I should have done ahead of time so as not to have been surprised by this?</p>



<a name="190544"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190544" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190544">(Apr 20 2017 at 21:30)</a>:</h4>
<p>Unfortunately, there's not a great way to test database migrations on your server without running them</p>



<a name="190545"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190545" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190545">(Apr 20 2017 at 21:30)</a>:</h4>
<p>One thing you can do is make a replica of your database on a test server, which some orgs do</p>



<a name="190546"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190546" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190546">(Apr 20 2017 at 21:31)</a>:</h4>
<p>And then run the migration there, check it's happy, and then do it on their user-facing system</p>



<a name="190547"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190547" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190547">(Apr 20 2017 at 21:31)</a>:</h4>
<p>That's fair!</p>



<a name="190548"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190548" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190548">(Apr 20 2017 at 21:32)</a>:</h4>
<p>Might be good to advertise known issues on the dev e-mail list, too</p>



<a name="190550"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190550" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190550">(Apr 20 2017 at 21:32)</a>:</h4>
<p>Anyway, I really appreciate the super-fast response here.</p>



<a name="190551"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190551" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190551">(Apr 20 2017 at 21:32)</a>:</h4>
<p>yeah, probably the smartest thing to do would be to do a 1.5.2 that reorders the migrations</p>



<a name="190553"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190553" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190553">(Apr 20 2017 at 21:32)</a>:</h4>
<p>So that it's impossible, and then send an email encouraging folks to skip 1.5.1 when upgrading.</p>



<a name="190555"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190555" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190555">(Apr 20 2017 at 21:33)</a>:</h4>
<p>s/impossible/possible/ ?</p>



<a name="190573"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190573" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190573">(Apr 20 2017 at 21:38)</a>:</h4>
<p>For <code>/stats</code>, BTW, is there a background process that computes these? (Or: is it normal for my stats page to be empty?)</p>



<a name="190576"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190576" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190576">(Apr 20 2017 at 21:39)</a>:</h4>
<p>So the bug is impossible :)</p>



<a name="190577"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190577" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190577">(Apr 20 2017 at 21:39)</a>:</h4>
<p>Yes, there's a background process that runs hourly.  <code>manage.py update_analytics_counts</code> if you want to run it manually</p>



<a name="190578"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190578" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190578">(Apr 20 2017 at 21:40)</a>:</h4>
<p>That, at least, was in the release notes for 1.5.0 :)</p>



<a name="190579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrading%20to%201.5.1/near/190579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Mandel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrading.20to.201.2E5.2E1.html#190579">(Apr 20 2017 at 21:40)</a>:</h4>
<p>haha, thanks (I do have those open ;-))</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>