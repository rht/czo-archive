<html>
<head><meta charset="utf-8"><title>LDAP filter users by memberOf · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html">LDAP filter users by memberOf</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="696555"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696555" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696555">(Feb 08 2019 at 13:05)</a>:</h4>
<p>Is it possible to filter users by AD group, so that only users that are a member of a specific group have access to ZULIP?</p>



<a name="696563"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696563" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> niels <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696563">(Feb 08 2019 at 13:09)</a>:</h4>
<p>you can define a specific ldap search</p>



<a name="696565"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696565" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696565">(Feb 08 2019 at 13:11)</a>:</h4>
<p>How can I define it? Do you have some example?</p>



<a name="696568"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696568" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> niels <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696568">(Feb 08 2019 at 13:13)</a>:</h4>
<div class="codehilite"><pre><span></span>LDAPSearch(&quot;ou=users,dc=example,dc=com&quot;, ldap.SCOPE_SUBTREE, &quot;(uid=%(user)s)&quot;), there only user are allowed
LDAPSearch(&quot;ou=otherusers,dc=example,dc=com&quot;, ldap.SCOPE_SUBTREE, &quot;(uid=%(user)s)&quot;), there only otherusers are allowed
</pre></div>



<a name="696570"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696570" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696570">(Feb 08 2019 at 13:22)</a>:</h4>
<p>I know about this filter but it is only based on the Organization Unit... I need a filter for a security group</p>



<a name="696600"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696600" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696600">(Feb 08 2019 at 14:42)</a>:</h4>
<p>I have tried a few filters but every time I get an error:  ERR  [django_auth_ldap] search_s('(&amp;(objectCategory=user)(memberOf=CN=</p>



<a name="696601"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696601" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696601">(Feb 08 2019 at 14:42)</a>:</h4>
<p>raised INVALID_DN_SYNTAX({'info': 'invalid DN', 'desc': 'Invalid DN syntax'},)</p>



<a name="696638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696638">(Feb 08 2019 at 16:28)</a>:</h4>
<p><span class="user-mention" data-user-id="11281">@Ivan</span> check out <a href="https://django-auth-ldap.readthedocs.io/en/latest/groups.html" target="_blank" title="https://django-auth-ldap.readthedocs.io/en/latest/groups.html">https://django-auth-ldap.readthedocs.io/en/latest/groups.html</a></p>



<a name="696640"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/696640" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#696640">(Feb 08 2019 at 16:28)</a>:</h4>
<p>I think you can use the <code>AUTH_LDAP_REQUIRE_GROUP</code> setting.  Let me know if that works for you.</p>



<a name="697373"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/697373" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> niels <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#697373">(Feb 09 2019 at 18:30)</a>:</h4>
<p>Thanks for the hint. I misunderstood the concept of groups. Here the things I must add in <code>/etc/zulip/settings.py</code></p>
<div class="codehilite"><pre><span></span>AUTH_LDAP_GROUP_SEARCH = LDAPSearch(&quot;OU=Groups,DC=###,DC=###&quot;,
    ldap.SCOPE_SUBTREE, &quot;(objectClass=groupOfNames)&quot;
)
AUTH_LDAP_GROUP_TYPE = GroupOfNamesType()
AUTH_LDAP_REQUIRE_GROUP = &quot;CN=ZULIP_USER,OU=Groups,DC=###,DC=###&quot;
</pre></div>


<p>then it works. If you add for test a user you can delete it following <a href="https://github.com/zulip/zulip/issues/10533" target="_blank" title="https://github.com/zulip/zulip/issues/10533">Issue 10533</a>. There is an <a href="https://github.com/zulip/zulip/issues/338" target="_blank" title="https://github.com/zulip/zulip/issues/338">old issue  about groups</a> with more information</p>



<a name="697899"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/697899" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#697899">(Feb 11 2019 at 10:38)</a>:</h4>
<p>It is not working... I get this error:   File "/home/zulip/deployments/2018-12-19-14-27-08/zulip-py3-venv/lib/python3.5/site-packages/django_auth_ldap/backend.py", line 547, in _search_for_user_dn<br>
    raise ImproperlyConfigured('AUTH_LDAP_USER_SEARCH must be an LDAPSearch instance.')<br>
django.core.exceptions.ImproperlyConfigured: AUTH_LDAP_USER_SEARCH must be an LDAPSearch instance.</p>



<a name="697900"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/697900" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> niels <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#697900">(Feb 11 2019 at 11:02)</a>:</h4>
<p><span class="user-mention" data-user-id="11281">@Ivan</span> Have you added the AUTH_LDAP_GROUP_SEARCH? The 4 first lines in my example are important.</p>



<a name="697901"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/697901" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#697901">(Feb 11 2019 at 11:07)</a>:</h4>
<p>Yes, I did. But I did remove AUTH_LDAP_USER_SEARCH... After I added back AUTH_LDAP_USER_SEARCH now it is working. Here is my configuration: </p>
<div class="codehilite"><pre><span></span>AUTH_LDAP_USER_SEARCH = LDAPSearch(&quot;dc=xxx,dc=corp&quot;, ldap.SCOPE_SUBTREE, &quot;(mail=%(user)s)&quot;)
AUTH_LDAP_GROUP_SEARCH = LDAPSearch(&quot;dc=xxx,dc=corp&quot;, ldap.SCOPE_SUBTREE, &quot;(objectClass=groupOfNames)&quot;)
AUTH_LDAP_GROUP_TYPE = GroupOfNamesType()
AUTH_LDAP_REQUIRE_GROUP = &quot;CN=Zulip-Access,OU=Special,OU=Domain Custom Groups,DC=xxx,DC=corp&quot;
</pre></div>


<p>Now I have to find out how to add multiple groups, because I use OPENLDAP as a Proxy to query multiple LDAP servers...</p>



<a name="697914"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/697914" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Ivan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#697914">(Feb 11 2019 at 13:41)</a>:</h4>
<p>Thanks for your help! I'm now able to add more groups and it is working fine...<br>
<code>AUTH_LDAP_REQUIRE_GROUP = (
    (
        LDAPGroupQuery("CN=Zulip1-Access,OU=Special,OU=Domain Custom Groups,DC=xxx,DC=corp") |
        LDAPGroupQuery("CN=Zulip2-Access,OU=Special,OU=Domain Custom Groups,DC=xxx,DC=corp") |
        LDAPGroupQuery("CN=Zulip3-Access,OU=Special,OU=Domain Custom Groups,DC=xxx,DC=corp")
    )
)</code></p>



<a name="698084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/LDAP%20filter%20users%20by%20memberOf/near/698084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/LDAP.20filter.20users.20by.20memberOf.html#698084">(Feb 11 2019 at 19:41)</a>:</h4>
<p>Thanks folks!  I added <a href="https://github.com/zulip/zulip/commit/a46640b3257794eab408b5da8ae274f71326dcb5" target="_blank" title="https://github.com/zulip/zulip/commit/a46640b3257794eab408b5da8ae274f71326dcb5">a46640b3257794eab408b5da8ae274f71326dcb5</a> to document this feature.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>