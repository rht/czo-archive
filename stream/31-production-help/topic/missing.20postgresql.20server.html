<html>
<head><meta charset="utf-8"><title>missing postgresql server · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html">missing postgresql server</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1639278"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639278" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639278">(Sep 13 2023 at 03:44)</a>:</h4>
<p>I was having trouble with installing the "Just Works" method with getting the certbot step to work, I've just skipped that step now by using self signed certs instead. Now I have a new error, exit code 2. It asks if the server is running locally and accepting connections on that socket. It talks about connection to server on socket "var/run/postgresql/.s.PGSQL.5432" failed. I had a look and cannot see this file or even the directory postgresql, do I have to install Postgres manually or does the installer do the DB install?</p>



<a name="1639288"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639288" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639288">(Sep 13 2023 at 04:09)</a>:</h4>
<p><span class="user-mention" data-user-id="27754">@James Brown</span>: Are you installing on a standalone host, or on Docker?</p>



<a name="1639289"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639289" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639289">(Sep 13 2023 at 04:14)</a>:</h4>
<p>But the standalone installer (i.e. <a href="https://zulip.readthedocs.io/en/latest/production/install.html">https://zulip.readthedocs.io/en/latest/production/install.html</a>) installs everything, including PostgreSQL.</p>
<p>If might be helpful to show us the complete <code>/var/log/zulip/install.log</code> -- though it's likely too long to paste in, so you'll have to either upload it, or use a GitHub Gist or similar.</p>



<a name="1639290"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639290" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639290">(Sep 13 2023 at 04:14)</a>:</h4>
<p>3 messages were moved here from <a class="stream-topic" data-stream-id="3" href="/#narrow/stream/3-backend/topic/installation.20failed">#backend &gt; installation failed</a> by <span class="user-mention silent" data-user-id="12178">Alex Vandiver</span>.</p>



<a name="1639296"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639296" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639296">(Sep 13 2023 at 04:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/missing.20postgresql.20server/near/1639288">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="27754">James Brown</span>: Are you installing on a standalone host, or on Docker?</p>
</blockquote>
<p>Initially I was attempting the docker method, I kept encountering problems so I thought I would stop trying that for now and attempt the standalone host installer to just get that going.</p>



<a name="1639297"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639297" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639297">(Sep 13 2023 at 04:32)</a>:</h4>
<p>OK, that's what I thought I understood you were saying, I just wanted to check.</p>
<p>But yes, if it's not installing PostgreSQL, that's very much not expected, and we'll probably need the logs to debug.</p>



<a name="1639298"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639298" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639298">(Sep 13 2023 at 04:35)</a>:</h4>
<p>Sure, I'll get the latest log file here in a sec</p>



<a name="1639299"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639299" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639299">(Sep 13 2023 at 04:37)</a>:</h4>
<p><a href="/user_uploads/2/fc/olidSLTmT9wkUu2th4rkYQvV/install.log">install.log</a></p>



<a name="1639300"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639300" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639300">(Sep 13 2023 at 04:40)</a>:</h4>
<p>I believe that has me attempting the install with providing the ProgresSql parameters on the install script, same outcome as without them though</p>



<a name="1639301"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639301" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639301">(Sep 13 2023 at 04:40)</a>:</h4>
<p>Can you show the command-line you ran?</p>
<p>Do you use puppet on this server?</p>



<a name="1639302"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639302" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639302">(Sep 13 2023 at 04:43)</a>:</h4>
<p>I don't believe puppet is on this machine. I'm practicing the standalone install from my personal Ubuntu laptop before trying it on my Debian server with docker/helm</p>



<a name="1639304"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639304" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639304">(Sep 13 2023 at 04:47)</a>:</h4>
<p>Oh, you've run the installer multiple times on this machine, which is why the logs don't show puppet making any notable changes.</p>
<p>Can you show:</p>
<div class="codehilite"><pre><span></span><code>cat /etc/zulip/zulip.conf

dpkg --get-selections | grep postgres
</code></pre></div>



<a name="1639305"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639305" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639305">(Sep 13 2023 at 04:47)</a>:</h4>
<p>I might strip out some of my personal info from this chat....</p>



<a name="1639306"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639306" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639306">(Sep 13 2023 at 04:48)</a>:</h4>
<p>Do note that the installer doesn't have an uninstaller, and (re)configures nginx, postgresql, memcached, and redis.  Which may or may not be what you want on your laptop.</p>



<a name="1639307"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639307" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639307">(Sep 13 2023 at 04:50)</a>:</h4>
<p>I can remove the message with your email and hostname if you'd like (it's still in the edit history); you can remove the uploaded install log <a href="https://zulip.com/help/manage-your-uploaded-files">like so</a>.</p>



<a name="1639308"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639308" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639308">(Sep 13 2023 at 04:53)</a>:</h4>
<p>root@JB-Lenovo-Lappy:/tmp/zulip-server/zulip-server-7.3# cat /etc/zulip/zulip.conf<br>
[machine]<br>
puppet_classes = zulip::profile::standalone<br>
deploy_type = production</p>
<p>[postgresql]<br>
version = 15<br>
database_name = zulip<br>
database_user = zulip<br>
root@JB-Lenovo-Lappy:/tmp/zulip-server/zulip-server-7.3# dpkg --get-selections | grep postgres<br>
check-postgres                                  install<br>
postgresql-15                                   install<br>
postgresql-client                               install<br>
postgresql-client-15                            install<br>
postgresql-client-common                        install<br>
postgresql-common                               install</p>



<a name="1639309"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639309" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639309">(Sep 13 2023 at 04:54)</a>:</h4>
<p>OK, so PostgreSQL is installed, it's just not running.</p>
<p>Show:</p>
<div class="codehilite"><pre><span></span><code>service postgresql status

pg_lsclusters
</code></pre></div>
<p>(please use <a href="https://zulip.com/help/code-blocks">code blocks</a> for pasting in output)</p>



<a name="1639310"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639310" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639310">(Sep 13 2023 at 04:54)</a>:</h4>
<p>I looked at that conf file earlier and it didn't have the databse_name and database_user entries, I wonder if when I provided params in the latest run attempt it inserted those. don't know if that info helps or not</p>



<a name="1639311"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639311" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639311">(Sep 13 2023 at 04:55)</a>:</h4>
<p>Those values are the default and don't make a difference.</p>



<a name="1639312"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639312" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639312">(Sep 13 2023 at 04:56)</a>:</h4>
<p>ok, its reporting down, so it is installed and set for port 5432 just not running</p>



<a name="1639313"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639313" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639313">(Sep 13 2023 at 04:57)</a>:</h4>
<p>So somewhere on your adventure of this installation it got stopped.</p>
<div class="codehilite"><pre><span></span><code>service postgresql start
</code></pre></div>
<p>...and then run the installer again.</p>



<a name="1639314"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639314" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639314">(Sep 13 2023 at 04:57)</a>:</h4>
<div class="codehilite"><pre><span></span><code>root@JB-Lenovo-Lappy:/tmp/zulip-server/zulip-server-7.3# cat /var/log/postgresql/postgresql-2023-09-05_164830.log
2023-09-05 16:48:30.416 AEST [64f6cf3e.ca2]: [3-1] LOG:  starting PostgreSQL 15.4 (Ubuntu 15.4-1.pgdg20.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0, 64-bit
2023-09-05 16:48:30.416 AEST [64f6cf3e.ca2]: [4-1] LOG:  listening on IPv4 address &quot;127.0.0.1&quot;, port 5432
2023-09-05 16:48:30.422 AEST [64f6cf3e.ca2]: [5-1] LOG:  listening on Unix socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;
2023-09-05 16:48:30.434 AEST [64f6cf3e.ca6]: [1-1] LOG:  database system was shut down at 2023-09-05 16:48:27 AEST
2023-09-05 16:48:30.447 AEST [64f6cf3e.ca2]: [6-1] LOG:  database system is ready to accept connections
2023-09-05 16:53:30.480 AEST [64f6cf3e.ca4]: [1-1] LOG:  checkpoint starting: time
2023-09-05 16:53:34.948 AEST [64f6cf3e.ca4]: [2-1] LOG:  checkpoint complete: wrote 47 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.432 s, sync=0.011 s, total=4.469 s; sync files=11, longest=0.005 s, average=0.001 s; distance=274 kB, estimate=274 kB
2023-09-06 10:33:07.794 AEST [64f7c8c3.573b]: [1-1] FATAL:  role &quot;zulip&quot; does not exist
2023-09-06 10:33:09.180 AEST [64f7c8c5.5799]: [1-1] FATAL:  role &quot;zulip&quot; does not exist
2023-09-06 10:33:11.479 AEST [64f7c8c7.58f7]: [1-1] FATAL:  role &quot;zulip&quot; does not exist
2023-09-06 10:33:14.737 AEST [64f7c8ca.5939]: [1-1] FATAL:  role &quot;zulip&quot; does not exist
</code></pre></div>



<a name="1639315"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639315" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639315">(Sep 13 2023 at 04:58)</a>:</h4>
<p>oh sorry, I just ran that, looks like its started ok now maybe...</p>



<a name="1639316"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639316" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639316">(Sep 13 2023 at 04:59)</a>:</h4>
<p>yeah, status and clusters reports online now</p>



<a name="1639317"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639317" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639317">(Sep 13 2023 at 05:04)</a>:</h4>
<p>nice, looks like the install worked and server is running. Could I run the installer again to change the hostname of the server to be localhost instead of the domain name?</p>



<a name="1639323"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639323" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639323">(Sep 13 2023 at 05:05)</a>:</h4>
<p>I don't think that'll work well -- it needs some sort of domain name to be able to generate links to itself.</p>



<a name="1639324"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639324" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639324">(Sep 13 2023 at 05:07)</a>:</h4>
<p>ok, no probs, thanks for your help!</p>



<a name="1639325"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639325" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> James Brown <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639325">(Sep 13 2023 at 05:07)</a>:</h4>
<p>now I need to work out what I was doing wrong with the docker/helm install</p>



<a name="1639326"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/missing%20postgresql%20server/near/1639326" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/missing.20postgresql.20server.html#1639326">(Sep 13 2023 at 05:08)</a>:</h4>
<p>Our helm charts are contributed, and we don't have much experience with them -- so it's entirely possible that they have errors.  Do report your progress and issues here, and we're happy to rubber-duck through the problem.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>