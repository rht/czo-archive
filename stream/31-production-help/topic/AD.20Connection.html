<html>
<head><meta charset="utf-8"><title>AD Connection · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html">AD Connection</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="602129"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/602129" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pantoufle <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#602129">(Jun 21 2018 at 14:57)</a>:</h4>
<p>Hello,<br>
I'm a beginner with Zulip and that I have installed in my enterprise.<br>
However I encouter some diffiulties to connect Zulip with our Active Directory.<br>
I have read the Zulip's documentation but I'm still blocked.<br>
Have you got some leads to resolve this ?<br>
Thank</p>



<a name="602135"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/602135" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Russell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#602135">(Jun 21 2018 at 15:57)</a>:</h4>
<p>What are you seeing exactly and what are your settings?</p>



<a name="602760"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/602760" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#602760">(Jun 22 2018 at 21:20)</a>:</h4>
<p><span class="user-mention" data-user-id="8437">@Pantoufle</span> did you see the question here?</p>



<a name="603814"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/603814" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pantoufle <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#603814">(Jun 26 2018 at 08:14)</a>:</h4>
<p><span class="user-mention" data-user-id="5233">@Scott Russell</span> The address mail is not recognized when I try to login.</p>



<a name="603815"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/603815" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pantoufle <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#603815">(Jun 26 2018 at 08:15)</a>:</h4>
<p><a href="/user_uploads/2/fa/zjndt05xoDBC1ouOcGD1CszB/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/fa/zjndt05xoDBC1ouOcGD1CszB/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/fa/zjndt05xoDBC1ouOcGD1CszB/pasted_image.png"></a></div>



<a name="603816"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/603816" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pantoufle <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#603816">(Jun 26 2018 at 08:15)</a>:</h4>
<p><a href="/user_uploads/2/b2/Ys7xn5HZtXUwIp9sUCXCp_mm/settings.py" target="_blank" title="settings.py">settings.py</a></p>



<a name="603824"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/603824" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Pantoufle <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#603824">(Jun 26 2018 at 08:32)</a>:</h4>
<p>Line 439, if I put this :</p>
<p>LDAP_APPEND_DOMAIN = &lt;Domain_Name&gt;.local</p>
<p>And I try to search an email address with /home/zulip/deployments/current/manage.py query_ldap &lt;email_address&gt;</p>
<p>here is the error :</p>
<p>zulip@zulip:/home/toto$ /home/zulip/deployments/current/manage.py query_ldap &lt;email_address&gt;<br>
Traceback (most recent call last):<br>
  File "/home/zulip/deployments/current/manage.py", line 25, in &lt;module&gt;<br>
    execute_from_command_line(sys.argv)<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/__init__.py", line 364, in execute_from_command_line<br>
    utility.execute()<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/__init__.py", line 356, in execute<br>
    self.fetch_command(subcommand).run_from_argv(self.argv)<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/base.py", line 283, in run_from_argv<br>
    self.execute(*args, **cmd_options)<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zulip-py3-venv/lib/python3.5/site-packages/django/core/management/base.py", line 330, in execute<br>
    output = self.handle(*args, **options)<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zerver/management/commands/query_ldap.py", line 28, in handle<br>
    query_ldap(**options)<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zerver/management/commands/query_ldap.py", line 15, in query_ldap<br>
    ldap_attrs = _LDAPUser(backend, backend.django_to_ldap_username(email)).attrs<br>
  File "/home/zulip/deployments/2018-06-18-17-16-23/zproject/backends.py", line 405, in django_to_ldap_username<br>
    raise ZulipLDAPException("Username does not match LDAP domain.")<br>
zproject.backends.ZulipLDAPException: Username does not match LDAP domain.</p>



<a name="603998"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/AD%20Connection/near/603998" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Russell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/AD.20Connection.html#603998">(Jun 26 2018 at 19:37)</a>:</h4>
<p>Try this type of setup. Note the AUTH_LDAP_USER_SEARCH value. I think you are trying to login with email addresses BUT you are likely using sAMAccountName which is not an email address. Also note when connecting to AD the AUTH_LDAP_CONNECTION_OPTIONS are super important. Set them exactly as shown here.</p>
<div class="codehilite"><pre><span></span>AUTH_LDAP_SERVER_URI = &quot;ldap://ldap.example.com&quot;

AUTH_LDAP_BIND_DN = &quot;cn=ldapbind,cn=Users,dc=example,dc=com&quot;

AUTH_LDAP_USER_SEARCH = LDAPSearch(&quot;dc=example,dc=com&quot;, ldap.SCOPE_SUBTREE, &quot;(mail=%(user)s)&quot;)

LDAP_APPEND_DOMAIN = None

LDAP_EMAIL_ATTR = None

AUTH_LDAP_USER_ATTR_MAP = {
    &quot;full_name&quot;: &quot;cn&quot;,
}

AUTH_LDAP_CONNECTION_OPTIONS = {
        ldap.OPT_REFERRALS: 0,
        ldap.OPT_X_TLS_REQUIRE_CERT: 0,
}
</pre></div>


<p>If you still have trouble please paste your LDAP settings along with the latest error.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>