<html>
<head><meta charset="utf-8"><title>✔ LDAP synchronization user failed · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html">✔ LDAP synchronization user failed</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1517554"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517554" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517554">(Mar 03 2023 at 08:13)</a>:</h4>
<p>LDAP synchronization user failed Same configuration. Version 6.1 is synchronized normally. 6.0 is not available<br>
the is 6.0 Version</p>
<div class="codehilite"><pre><span></span><code>zulip@zulip6:/root$ /home/zulip/deployments/current/manage.py query_ldap fits04
2023-03-03 08:08:37.001 DEBG [django_auth_ldap] Binding as admin
2023-03-03 08:08:37.004 DEBG [django_auth_ldap] Invoking search_s(&#39;ou=userid,ou=vmware,dc=t-demo.com,dc=com&#39;, 2, &#39;(sAMAccountName=fits04)&#39;)
2023-03-03 08:08:37.004 ERR  [django_auth_ldap] search_s(&#39;ou=userid,ou=vmware,dc=t-demo.com,dc=com&#39;, 2, &#39;(sAMAccountName=fits04)&#39;) raised REFERRAL({&#39;msgtype&#39;: 101, &#39;msgid&#39;: 2, &#39;result&#39;: 10, &#39;desc&#39;: &#39;Referral&#39;, &#39;ctrls&#39;: [], &#39;info&#39;: &#39;Referral:\nldap://t-demo.com.com/ou=userid,ou=vmware,dc=t-demo.com,dc=com&#39;})
2023-03-03 08:08:37.005 DEBG [django_auth_ldap] search_s(&#39;ou=userid,ou=vmware,dc=t-demo.com,dc=com&#39;, 2, &#39;(sAMAccountName=%(user)s)&#39;) returned 0 objects:
No such user found: No LDAP user matching django_to_ldap_username result: fits04. Input username: fits04
</code></pre></div>
<p>the is 6.1 Version</p>
<div class="codehilite"><pre><span></span><code>zulip@zulip:/root$ /home/zulip/deployments/current/manage.py query_ldap fits042023-03-03 08:12:41.421 DEBG [django_auth_ldap] Binding as admin
2023-03-03 08:12:41.465 DEBG [django_auth_ldap] Invoking search_s(&#39;ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 2, &#39;(sAMAccountName=fits04)&#39;)
2023-03-03 08:12:41.467 DEBG [django_auth_ldap] search_s(&#39;ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 2, &#39;(sAMAccountName=%(user)s)&#39;) returned 1 objects: cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com
2023-03-03 08:12:41.467 DEBG [django_auth_ldap] Invoking search_s(&#39;cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 0, &#39;(objectClass=*)&#39;)
2023-03-03 08:12:41.468 DEBG [django_auth_ldap] search_s(&#39;cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 0, &#39;(objectClass=*)&#39;) returned 1 objects: cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com
2023-03-03 08:12:41.469 DEBG [django_auth_ldap] Binding as admin
2023-03-03 08:12:41.471 DEBG [django_auth_ldap] Invoking search_s(&#39;ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 2, &#39;(sAMAccountName=fits04)&#39;)
2023-03-03 08:12:41.472 DEBG [django_auth_ldap] search_s(&#39;ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 2, &#39;(sAMAccountName=%(user)s)&#39;) returned 1 objects: cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com
2023-03-03 08:12:41.472 DEBG [django_auth_ldap] Invoking search_s(&#39;cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 0, &#39;(objectClass=*)&#39;)
2023-03-03 08:12:41.473 DEBG [django_auth_ldap] search_s(&#39;cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com&#39;, 0, &#39;(objectClass=*)&#39;) returned 1 objects: cn=fits04,ou=userid,ou=vmware,dc=t-demo,dc=com
full_name: fits04
</code></pre></div>



<a name="1517556"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517556" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517556">(Mar 03 2023 at 08:15)</a>:</h4>
<p>the is 6.0 version configuration file</p>
<div class="codehilite"><pre><span></span><code>AUTHENTICATION_BACKENDS: Tuple[str, ...] = (
    #&quot;zproject.backends.EmailAuthBackend&quot;,  # Email and password; just requires SMTP setup
    # &quot;zproject.backends.GoogleAuthBackend&quot;,  # Google auth, setup below
    # &quot;zproject.backends.GitHubAuthBackend&quot;,  # GitHub auth, setup below
    # &quot;zproject.backends.GitLabAuthBackend&quot;,  # GitLab auth, setup below
    # &quot;zproject.backends.AzureADAuthBackend&quot;,  # Microsoft Azure Active Directory auth, setup below
    # &quot;zproject.backends.AppleAuthBackend&quot;,  # Apple auth, setup below
    # &quot;zproject.backends.SAMLAuthBackend&quot;,  # SAML, setup below
    &quot;zproject.backends.ZulipLDAPAuthBackend&quot;,  # LDAP, setup below
    # &quot;zproject.backends.ZulipRemoteUserBackend&quot;,  # Local SSO, setup docs on readthedocs
    # &quot;zproject.backends.GenericOpenIdConnectBackend&quot;,  # Generic OIDC integration, setup below
)

## LDAP integration.
##
## Zulip supports retrieving information about users via LDAP, and
## optionally using LDAP as an authentication mechanism.

import ldap
from django_auth_ldap.config import GroupOfNamesType, LDAPGroupQuery, LDAPSearch  # noqa: F401

AUTH_LDAP_SERVER_URI = &quot;ldap://dc.t-demo.com:389&quot;
AUTH_LDAP_USER_SEARCH = LDAPSearch(&quot;ou=userid,ou=vmware,dc=t-demo,dc=com&quot;,ldap.SCOPE_SUBTREE, &quot;(sAMAccountName=%(user)s)&quot;)
AUTH_LDAP_REVERSE_EMAIL_SEARCH = LDAPSearch(&quot;ou=userid,ou=vmware,dc=t-demo.com,dc=com&quot;,ldap.SCOPE_SUBTREE, &quot;(mail=%(email)s)&quot;)
AUTH_LDAP_USERNAME_ATTR = &quot;sAMAccountName&quot;
AUTH_LDAP_BIND_DN = &quot;admin&quot;


## Connecting to the LDAP server.
## For more details and alternatives, see the documentation linked above.
AUTH_LDAP_USER_SEARCH = LDAPSearch(
    &quot;ou=userid,ou=vmware,dc=t-demo.com,dc=com&quot;, ldap.SCOPE_SUBTREE, &quot;(sAMAccountName=%(user)s)&quot;
)

## Configuration to look up a user&#39;s LDAP data given their email address
## (for Zulip reverse mapping).  If users log in as e.g. &quot;sam&quot; when
## their email address is &quot;sam@example.com&quot;, set LDAP_APPEND_DOMAIN to
## &quot;example.com&quot;.  Otherwise, leave LDAP_APPEND_DOMAIN=None and set
## AUTH_LDAP_REVERSE_EMAIL_SEARCH and AUTH_LDAP_USERNAME_ATTR below.
# LDAP_APPEND_DOMAIN = None
LDAP_APPEND_DOMAIN = &quot;t-demo.com&quot;
## LDAP attribute to find a user&#39;s email address.
</code></pre></div>



<a name="1517559"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517559" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517559">(Mar 03 2023 at 08:17)</a>:</h4>
<p>the is 6.1 version configuration file</p>
<div class="codehilite"><pre><span></span><code>148 AUTHENTICATION_BACKENDS: Tuple[str, ...] = (
149     &quot;zproject.backends.EmailAuthBackend&quot;,  # Email and password; just requires SMTP setup
150     # &quot;zproject.backends.GoogleAuthBackend&quot;,  # Google auth, setup below
151     # &quot;zproject.backends.GitHubAuthBackend&quot;,  # GitHub auth, setup below
152     # &quot;zproject.backends.GitLabAuthBackend&quot;,  # GitLab auth, setup below
153     # &quot;zproject.backends.AzureADAuthBackend&quot;,  # Microsoft Azure Active Directory auth, setup below
154     # &quot;zproject.backends.AppleAuthBackend&quot;,  # Apple auth, setup below
155     # &quot;zproject.backends.SAMLAuthBackend&quot;,  # SAML, setup below
156     &quot;zproject.backends.ZulipLDAPAuthBackend&quot;,  # LDAP, setup below
157     # &quot;zproject.backends.ZulipRemoteUserBackend&quot;,  # Local SSO, setup docs on readthedocs
158     # &quot;zproject.backends.GenericOpenIdConnectBackend&quot;,  # Generic OIDC integration, setup below
159 )
160
161 ## LDAP integration.
162 ##
163 ## Zulip supports retrieving information about users via LDAP, and
164 ## optionally using LDAP as an authentication mechanism.
165
166 import ldap
167 from django_auth_ldap.config import GroupOfNamesType, LDAPGroupQuery, LDAPSearch  # noqa: F401
168
169 ## Connecting to the LDAP server.
170 ##
171 ## For detailed instructions, see the Zulip documentation:
172 ##   https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap
173
174 ## The LDAP server to connect to.  Setting this enables Zulip
175 ## automatically fetching each new user&#39;s name from LDAP.
176 # AUTH_LDAP_SERVER_URI = &quot;ldaps://ldap.example.com&quot;
177 AUTH_LDAP_SERVER_URI = &quot;ldap://dc.t-demo.com:389&quot;
178 AUTH_LDAP_USER_SEARCH = LDAPSearch(&quot;ou=userid,ou=vmware,dc=t-demo,dc=com&quot;,ldap.SCOPE_SUBTREE, &quot;(sAMAccountName=%(user)s)&quot;)
179 AUTH_LDAP_REVERSE_EMAIL_SEARCH = LDAPSearch(&quot;ou=userid,ou=vmware,dc=t-demo.com,dc=com&quot;,ldap.SCOPE_SUBTREE, &quot;(mail=%(email)s)&quot;)
180 AUTH_LDAP_USERNAME_ATTR = &quot;sAMAccountName&quot;
181 #AUTH_LDAP_USERNAME_ATTR = &quot;mail&quot;
182 AUTH_LDAP_BIND_DN = &quot;admin&quot;
183 # AUTH_LDAP_BIND_PASSWORD = &quot;1qaz@WSX&quot;
184 ## The DN of the user to bind as (i.e., authenticate as) in order to
185 ## query LDAP.  If unset, Zulip does an anonymous bind.
186 # AUTH_LDAP_BIND_DN = &quot;&quot;
187
188 ## Passwords and secrets are not stored in this file.  The password
189 ## corresponding to AUTH_LDAP_BIND_DN goes in `/etc/zulip/zulip-secrets.conf`.
190 ## In that file, set `auth_ldap_bind_password`.  For example:
191 # auth_ldap_bind_password = abcd1234
192
193 ## Mapping user info from LDAP to Zulip.
194 ##
195 ## For detailed instructions, see the Zulip documentation:
196 ##   https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap
197
198 ## The LDAP search query to find a given user.
199 ##
200 ## The arguments to `LDAPSearch` are (base DN, scope, filter).  In the
201 ## filter, the string `%(user)s` is a Python placeholder.  The Zulip
202 ## server will replace this with the user&#39;s Zulip username, i.e. the
203 ## name they type into the Zulip login form.
204 ##
205 ## For more details and alternatives, see the documentation linked above.
206 AUTH_LDAP_USER_SEARCH = LDAPSearch(
207     &quot;ou=userid,ou=vmware,dc=t-demo,dc=com&quot;, ldap.SCOPE_SUBTREE, &quot;(sAMAccountName=%(user)s)&quot;
208 )
209
210 ## Configuration to look up a user&#39;s LDAP data given their email address
211 ## (for Zulip reverse mapping).  If users log in as e.g. &quot;sam&quot; when
212 ## their email address is &quot;sam@example.com&quot;, set LDAP_APPEND_DOMAIN to
213 ## &quot;example.com&quot;.  Otherwise, leave LDAP_APPEND_DOMAIN=None and set
214 ## AUTH_LDAP_REVERSE_EMAIL_SEARCH and AUTH_LDAP_USERNAME_ATTR below.
215 # LDAP_APPEND_DOMAIN = None
216 LDAP_APPEND_DOMAIN = &quot;t-demo.com&quot;
</code></pre></div>



<a name="1517560"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517560" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517560">(Mar 03 2023 at 08:19)</a>:</h4>
<p>The password has been placed in<code>/etc/zulip/zulip-secrets.conf</code></p>



<a name="1517567"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517567" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517567">(Mar 03 2023 at 08:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="25948">TwoDogs2</span> has marked this topic as resolved.</p>



<a name="1517686"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1517686" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1517686">(Mar 03 2023 at 14:39)</a>:</h4>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span>: What was the issue?</p>



<a name="1518498"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20LDAP%20synchronization%20user%20failed/near/1518498" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20LDAP.20synchronization.20user.20failed.html#1518498">(Mar 04 2023 at 15:53)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> I'm not sure if it's a problem with the version. My configuration file contains dc=t-demo.com, dc=com, but version 6.1 will automatically correct this error when synchronizing users. 6.0 won't, so there is no problem with the same configuration version 6.1, but 6.0 will report an error</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>