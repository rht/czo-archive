<html>
<head><meta charset="utf-8"><title>upgrade from 5 to 7 and debian distupgrade · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html">upgrade from 5 to 7 and debian distupgrade</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1602950"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1602950" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1602950">(Jul 03 2023 at 14:47)</a>:</h4>
<p>Hi All.<br>
I was able to upgrade from an V3 to V7 on debian 11, just for test. that works but I seems that I lost datas, I'm not very about that for now. But, when I did dist-upgrade from debian 11 to debian 12. zulip stopped working. And I got errors such like</p>
<div class="codehilite"><pre><span></span><code>No such file or directory: &#39;/home/zulip/deployments/2023-07-03-15-45-34/zulip-py3-venv/bin/activate_this.py
</code></pre></div>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/current/scripts/setup/upgrade-postgresql
</code></pre></div>
<p>give:</p>
<div class="codehilite"><pre><span></span><code>No such file or directory: &#39;/home/zulip/deployments/2023-07-03-15-45-34/zulip-py3-venv/bin/activate_this.py&#39;
</code></pre></div>
<p>in fact: </p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/2023-07-03-15-45-34/zulip-py3-venv
</code></pre></div>
<p>is just empty.</p>
<p>So, How can I get zulip-py3-venv folder back?<br>
what are the good steps to upgrade an existing installation:<br>
zulip ; V5 -&gt; V7<br>
debian: 11 -&gt; 12</p>
<p>that's for your answers.<br>
regards</p>



<a name="1603188"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603188" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603188">(Jul 03 2023 at 22:01)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade">#issues &gt; upgrade from 5 to 7 and debian distupgrade</a> by <span class="user-mention silent" data-user-id="12178">Alex Vandiver</span>.</p>



<a name="1603190"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603190" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603190">(Jul 03 2023 at 22:03)</a>:</h4>
<p><span class="user-mention" data-user-id="17197">@lne</span>: Zulip 3.x didn't support Debian 11, so I'm a bit confused about the premise.  But you later say version 5 -- I'm assuming that one is correct?</p>
<p>The right way to do this is to upgrade from 5.x to 7.x using our <a href="https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-to-a-release">standard upgrade steps</a>, and then follow up with our <a href="https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12">instructions for upgrading to Debian 12</a>.</p>



<a name="1603191"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603191" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603191">(Jul 03 2023 at 22:04)</a>:</h4>
<p>You likely got hung up doing this manually because you needed to reinstall the module dependencies, as documented in step 5 of the second link in my previous message.</p>



<a name="1603192"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603192" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603192">(Jul 03 2023 at 22:04)</a>:</h4>
<p>But all of the steps I linked you to are necessary for various reasons, so do run all of them.</p>



<a name="1603480"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603480" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603480">(Jul 04 2023 at 07:28)</a>:</h4>
<p>The production server is under v5, but the test server is running v3. I will make clone of V5 and try these upgrade steps,</p>



<a name="1603542"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603542" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603542">(Jul 04 2023 at 09:59)</a>:</h4>
<p>ok, I upgarded zulip v5 to v7 on debian 11. but, debian dist-upgrade made crashed zulip redeployment.</p>
<p>as </p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/current/scripts/zulip-puppet-apply -f
</code></pre></div>
<p>was not able to start redis, I changed in /etc/redis/redis.conf</p>
<div class="codehilite"><pre><span></span><code>bind 127.0.0.1 ::1
</code></pre></div>
<p>to</p>
<div class="codehilite"><pre><span></span><code>bind 0.0.0.0
</code></pre></div>
<p>and re-execute: /home/zulip/deployments/current/scripts/zulip-puppet-apply -f<br>
but</p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/2023-07-04-10-20-38/zulip-py3-venv -&gt; /srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv
</code></pre></div>
<p>is linked to non-existent folder. so, </p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes
</code></pre></div>
<p>failed with</p>
<div class="codehilite"><pre><span></span><code>FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/zulip/deployments/2023-07-04-10-20-38/zulip-py3-venv/bin/activate_this.py&#39;
</code></pre></div>
<p>so, the re-deployment failed because of redis binding issue??? how can I rebuild /srv/zulip-venv-cache/ and link /home/zulip/deployments/2023-07-04-10-20-38/zulip-py3-venv to that?</p>



<a name="1603620"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1603620" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1603620">(Jul 04 2023 at 12:43)</a>:</h4>
<p>I did the process for the second time, just after debian dist-upgrade, I got</p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/2023-07-04-14-00-27/zulip-py3-venv was not set up for this Python version
</code></pre></div>
<p>even the correct redis parameter can not make redeploy zulip. python version would be the problem ?</p>



<a name="1604023"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604023" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604023">(Jul 05 2023 at 09:50)</a>:</h4>
<p>Next episod: since I'm not able to upgrade from v5 to v7, I did a fresh v7 installation and tried to import a v5 backup. and actually, it dosen't work because of different postgres version:</p>
<div class="codehilite"><pre><span></span><code>Notice: /Stage[main]/Zulip::Postgresql_base/File[/usr/share/postgresql/12/tsearch_data/zulip_english.stop]/ensure: defined content as &#39;{sha256}1770a60919243d444df54a3b28817191a8d226c893610835c2e6ca085dbe6c0b&#39;
Notice: /Stage[main]/Zulip::Profile::Postgresql/File[/etc/postgresql/12/main/postgresql.conf]/content: content changed &#39;{sha256}61f74136cd0d36e0a503b23cd4c51d986e142e53c57ac293c7e956c49b7a3953&#39; to &#39;{sha256}3cf368edccfb3889ac7af1d8eec30712560aa837d4c0d46d3badddd151dcc567&#39;
Notice: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]/returns: Job for postgresql@12-main.service failed because the service did not take the steps required by its unit configuration.
Notice: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]/returns: See &quot;systemctl status postgresql@12-main.service&quot; and &quot;journalctl -xeu postgresql@12-main.service&quot; for details.
Error: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]: Failed to call refresh: &#39;pg_ctlcluster 12 main restart&#39; returned 1 instead of one of [0]
Error: /Stage[main]/Zulip::Profile::Postgresql/Exec[pg_ctlcluster 12 main restart]: &#39;pg_ctlcluster 12 main restart&#39; returned 1 instead of one of [0]
</code></pre></div>
<p>Yes, v5 is using postgres 12 and v7 uses postgres 15...<br>
I'm keeping look for a solution, but it's becoming difficult</p>



<a name="1604076"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604076" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604076">(Jul 05 2023 at 12:39)</a>:</h4>
<p><span class="user-mention" data-user-id="17197">@lne</span>: You need to install the new server with <code>--postgresql-version 12</code>, as <a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html#backups-export-and-import">documented here</a></p>



<a name="1604077"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604077" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604077">(Jul 05 2023 at 12:39)</a>:</h4>
<p>That isn't mentioned <a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html#restoring-backups">here</a>, though -- let me push a PR to do so.  (edit: <a href="https://github.com/zulip/zulip/pull/26191">#26191</a>)</p>



<a name="1604080"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604080" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604080">(Jul 05 2023 at 12:44)</a>:</h4>
<p>Oh, but you fundamentally cannot import a version 5 backup into a version 7 server -- that's not going to work.  See the caveats in the same section I just linked to.</p>



<a name="1604081"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604081" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604081">(Jul 05 2023 at 12:45)</a>:</h4>
<p>Can you explain what error made you change the redis configuration?</p>



<a name="1604084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604084">(Jul 05 2023 at 12:55)</a>:</h4>
<p>Also, can you show the full output from the command that produced this:</p>
<div class="codehilite"><pre><span></span><code>FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/zulip/deployments/2023-07-04-10-20-38/zulip-py3-venv/bin/activate_this.py&#39;
</code></pre></div>
<p>Seeing the full output (including the command you ran) will help track down the logic that led to the failure.</p>



<a name="1604185"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604185" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604185">(Jul 05 2023 at 15:30)</a>:</h4>
<ol>
<li>fully upgrade zulip V5 to V7 on debian 11: OK</li>
<li>fully dist-upgrade debian 11 to debian 12: Ok excepting replace <strong>bind 127.0.0.1 ::1</strong> by <strong>bind 0.0.0.0</strong>, or redis can not start</li>
<li>try to re-deploy zulip:</li>
</ol>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/current/manage.py backup --output=/home/zulip/release-upgrade.backup.tar.gz
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/manage.py&quot;, line 12, in &lt;module&gt;
    setup_path()
  File &quot;/home/zulip/deployments/2023-07-05-16-39-52/scripts/lib/setup_path.py&quot;, line 20, in setup_path
    raise RuntimeError(venv + &quot; was not set up for this Python version&quot;)
RuntimeError: /home/zulip/deployments/2023-07-05-16-39-52/zulip-py3-venv was not set up for this Python version
</code></pre></div>
<p>as you can see, I'm even not able to backup datas. it's not happy with python version change.<br>
so, actually, I didn't go forward steps.</p>



<a name="1604563"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604563" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604563">(Jul 05 2023 at 22:07)</a>:</h4>
<p><span class="user-mention" data-user-id="17197">@lne</span> you need to follow <a href="https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12">https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12</a> when upgrading the OS.</p>



<a name="1604792"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1604792" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1604792">(Jul 06 2023 at 08:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade/near/1604563">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="17197">lne</span> you need to follow <a href="https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12">https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12</a> when upgrading the OS.</p>
</blockquote>
<p>Yes, I followed this instruction, I made backup BEFORE dist-upgrade OS. I had made mistake. <br>
So I restarted all steps and I still getting errors at step 5:</p>
<div class="codehilite"><pre><span></span><code>/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
    /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes
2023-07-06 07:59:54,893 upgrade-zulip-stage-2: Upgrading from 7.1 to 7.1, in /home/zulip/deployments/current/
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2023-07-05-16-39-52/../current/manage.py&quot;, line 12, in &lt;module&gt;
    setup_path()
  File &quot;/home/zulip/deployments/2023-07-05-16-39-52/scripts/lib/setup_path.py&quot;, line 14, in setup_path
    with open(activate_this) as f:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/zulip/deployments/2023-07-05-16-39-52/zulip-py3-venv/bin/activate_this.py&#39;
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2&quot;, line 210, in &lt;module&gt;
    django_pg_version = subprocess.check_output(
  File &quot;/usr/lib/python3.9/subprocess.py&quot;, line 424, in check_output
    return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
  File &quot;/usr/lib/python3.9/subprocess.py&quot;, line 528, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command &#39;[&#39;../current/manage.py&#39;, &#39;shell&#39;, &#39;-c&#39;, &#39;from django.db import connection; print(int(connection.cursor().connection.server_version/10000))&#39;]&#39; returned non-zero exit status 1.
</code></pre></div>
<p>/home/zulip/deployments/2023-07-05-16-39-52/zulip-py3-venv is a symlink to non existing folder.</p>
<div class="codehilite"><pre><span></span><code>/srv/zulip-venv-cache/ef5b89e42da45eb76e374b8cb352c4619fedb1ec/zulip-py3-venv
</code></pre></div>
<p>because</p>
<div class="codehilite"><pre><span></span><code>/srv/zulip-venv-cache/
</code></pre></div>
<p>is empty.</p>



<a name="1605528"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1605528" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1605528">(Jul 07 2023 at 00:32)</a>:</h4>
<p>Hmm, I don't see a way to get into that situation if you follow the process we recommended; and I'd be very surprised if that were your first error. I'd try again and be careful to note the first failure you encounter.</p>



<a name="1606497"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1606497" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1606497">(Jul 08 2023 at 21:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade/near/1605528">said</a>:</p>
<blockquote>
<p>Hmm, I don't see a way to get into that situation if you follow the process we recommended; and I'd be very surprised if that were your first error. I'd try again and be careful to note the first failure you encounter.</p>
</blockquote>
<p>ok, thanks, I will retry in a couple of weeks.</p>



<a name="1618473"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1618473" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1618473">(Aug 01 2023 at 14:07)</a>:</h4>
<p>Ok, I followed : these steps: <a href="https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12">https://zulip.readthedocs.io/en/latest/production/upgrade.html#upgrading-from-debian-11-to-12</a></p>
<p>and first errors were:<br>
<strong>at step 5</strong></p>
<div class="codehilite"><pre><span></span><code>rm -rf /srv/zulip-venv-cache/*
/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 \
    /home/zulip/deployments/current/ --ignore-static-assets --audit-fts-indexes

2023-08-01 13:56:34,362 upgrade-zulip-stage-2: Upgrading from 7.2 to 7.2, in /home/zulip/deployments/current/
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2023-08-01-14-57-57/../current/manage.py&quot;, line 12, in &lt;module&gt;
    setup_path()
  File &quot;/home/zulip/deployments/2023-08-01-14-57-57/scripts/lib/setup_path.py&quot;, line 14, in setup_path
    with open(activate_this) as f:
         ^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/zulip/deployments/2023-08-01-14-57-57/zulip-py3-venv/bin/activate_this.py&#39;
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2&quot;, line 212, in &lt;module&gt;
    django_pg_version = subprocess.check_output(
                        ^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/usr/lib/python3.11/subprocess.py&quot;, line 466, in check_output
    return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/usr/lib/python3.11/subprocess.py&quot;, line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command &#39;[&#39;../current/manage.py&#39;, &#39;shell&#39;, &#39;-c&#39;, &#39;from django.db import connection; print(int(connection.cursor().connection.server_version/10000))&#39;]&#39; returned non-zero exit status 1.
</code></pre></div>
<p>at this step, I had dist-upgraded Debian to 12.1, and zulip from v5 to v7.2 succefully. But, I'm unable to redeploy zulip 7.2 after dist-upgrading debian from 11 to 12.1</p>



<a name="1618479"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1618479" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1618479">(Aug 01 2023 at 14:36)</a>:</h4>
<p><span class="user-mention" data-user-id="17197">@lne</span>: This is <a href="https://github.com/zulip/zulip/pull/26227">#26227</a>, which is not yet in a release yet.  We'll release 7.3 soonish, which will include that fix.</p>



<a name="1618485"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1618485" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1618485">(Aug 01 2023 at 14:37)</a>:</h4>
<p>If you'd like a workaround, for step 5 you can run:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>rm<span class="w"> </span>-rf<span class="w"> </span>/srv/zulip-venv-cache/*
/home/zulip/deployments/current/scripts/lib/create-production-venv<span class="w"> </span>/home/zulip/deployments/current
/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/home/zulip/deployments/current/<span class="w"> </span>--ignore-static-assets<span class="w"> </span>--audit-fts-indexes
</code></pre></div>



<a name="1618522"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%205%20to%207%20and%20debian%20distupgrade/near/1618522" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.205.20to.207.20and.20debian.20distupgrade.html#1618522">(Aug 01 2023 at 16:28)</a>:</h4>
<p>Ok, so, I'm waiting for next minor release. thx for all.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>