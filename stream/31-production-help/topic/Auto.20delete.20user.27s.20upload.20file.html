<html>
<head><meta charset="utf-8"><title>Auto delete user&#x27;s upload file · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html">Auto delete user&#x27;s upload file</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="807753"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/807753" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> R2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#807753">(Jan 09 2020 at 08:18)</a>:</h4>
<p>How to automatically delete user's upload file. like saved for 30 days</p>



<a name="813579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/813579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Felix <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#813579">(Jan 31 2020 at 10:25)</a>:</h4>
<p>I join. And better with the file size condition - if the file is larger than xx MB</p>



<a name="813645"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/813645" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#813645">(Jan 31 2020 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="14399">@R2</span> <span class="user-mention" data-user-id="12634">@Felix</span> can you talk about the goal/use case for that?  There's a message retention policy feature (which would delete old messages) that we're planning to make available soon, or is this something specific to uploaded files.  And is the goal storage reduction or security?</p>



<a name="815373"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/815373" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> fitze <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#815373">(Feb 07 2020 at 19:13)</a>:</h4>
<p>Looking forward to the message retention policy feature. Would be nice to purge a stream after a set time.</p>



<a name="817875"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/817875" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#817875">(Feb 18 2020 at 13:42)</a>:</h4>
<p>A way to globally purge old attachments would be great, if it doesn't exist already.</p>



<a name="823549"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/823549" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PeGaSuS <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#823549">(Feb 28 2020 at 19:20)</a>:</h4>
<p>not only purge old attachments but also messages. this is kinda related to privacy policy and stuff like that. any ETA for when the retention policy will land on self hosted instances?</p>



<a name="823615"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/823615" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#823615">(Feb 28 2020 at 20:17)</a>:</h4>
<p><span class="user-mention" data-user-id="15037">@PeGaSuS</span> the retention policy feature may be usable right now; we implemented the feature (with tests) and just have been waiting on being able to do sufficient production-side performance testing before advertising it.  So it should be ready soon, hopefully in 2.2.</p>



<a name="823651"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/823651" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> PeGaSuS <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#823651">(Feb 28 2020 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> that's amazing news. thanks for the quick reply.</p>



<a name="919745"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/919745" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sebastian Elsner <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#919745">(Jun 30 2020 at 12:12)</a>:</h4>
<p>I am facing the same issue right now and while searching, found this topic. Our server space is tight and user uploads are piling. Would I break something on the zulip server if I just delete everything in "uploads/files" that is, say, 30 days or older?</p>



<a name="1217851"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1217851" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1217851">(Jun 24 2021 at 16:39)</a>:</h4>
<p>Hi all. We are facing to a disk space issue. old messages are being cleaned, but not uploaded files. and we have installed V 3.2, is the uploaded files auto-clean feature implanted??</p>



<a name="1217888"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1217888" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1217888">(Jun 24 2021 at 17:12)</a>:</h4>
<p><span class="user-mention" data-user-id="17197">@lne</span> certainly the feature described above was implemented, but I think it only deletes references to files, not the files themselves.</p>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> does that fit your recollection?  If so, we should at least open an issue for making the archive tool auto-delete files that no longer appear in Attachment or ArchiveAttachment (with care taken to avoid racing with new file uploads).</p>



<a name="1217890"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1217890" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1217890">(Jun 24 2021 at 17:13)</a>:</h4>
<p>I think it should be pretty straightforward for the local file uploads backend; I'm less sure about the S3 backend (just because one needs a way to iterate through files to potentially delete, and I don't recall if there's a nicer batched iterator API for that).</p>



<a name="1217896"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1217896" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1217896">(Jun 24 2021 at 17:16)</a>:</h4>
<p>Yeah, the retention system doesn't delete the actual files. I'll open an issue.</p>



<a name="1217902"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1217902" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1217902">(Jun 24 2021 at 17:18)</a>:</h4>
<p>Great. Let's tag it as a priority; it's something I'd backport a fix to 4.x when we have one.</p>



<a name="1219077"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1219077" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> lne <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1219077">(Jun 25 2021 at 07:45)</a>:</h4>
<p>thanks for you answers. If the oldest files are not referenced anymore, I'll remove them with a bash hack for now.</p>



<a name="1277921"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1277921" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Huebner <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1277921">(Nov 08 2021 at 09:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="173">Sebastian Elsner</span> <a href="#narrow/stream/31-production-help/topic/Auto.20delete.20user's.20upload.20file/near/919745">said</a>:</p>
<blockquote>
<p>I am facing the same issue right now and while searching, found this topic. Our server space is tight and user uploads are piling. Would I break something on the zulip server if I just delete everything in "uploads/files" that is, say, 30 days or older?</p>
</blockquote>
<p>Hi, I came here for exactly the same reason. We want to keep old messages, but not old file uploads. A file upload retention policy based on filetype and size would be really nice.</p>



<a name="1278172"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1278172" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1278172">(Nov 08 2021 at 21:10)</a>:</h4>
<p><span class="user-mention" data-user-id="22107">@Philipp Huebner</span> can you talk more about the details here?  I'd expect adding more disk to be an easy solution unless there's a very large amount of data being uploaded.  </p>
<p>It's not a good experience for users to have uploaded files be unexpectedly deleted, so we'd want to be pretty thoughtful about how we communicated a feature of that form with users, so I'd like to make sure we understand the reason one would need this clearly.</p>



<a name="1278415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1278415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Huebner <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1278415">(Nov 09 2021 at 06:32)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> I fully understand your concerns when looking only at Zulip. At my employer however there are already too many places where employees can place + share files, management does not want Zulip to become yet another data grave where we keep more and more files for all eternity of which 99% will never be accessed again.<br>
For now I solved this according to my employers wishes as best I could by limiting new uploads to 5MB and writing a script that uses the Django shell to delete all attachments older than 7 days if they are above 1MB and not a PDF or a common picture format. PDFs and pictures may stay (for now). I announced this in our <a class="stream" data-stream-id="2" href="/#narrow/stream/2-general">#general</a> stream.<br>
It would be better though,if instead of simple deletion, a replacement message in its place would inform about the deletion.<br>
And really awesome would it be to be informed with each upload or already uploaded attachment about when this will be deleted according to the defined retention policy.</p>



<a name="1278672"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1278672" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1278672">(Nov 09 2021 at 17:05)</a>:</h4>
<p>Thanks for sharing that background!</p>



<a name="1278899"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1278899" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Dehnert <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1278899">(Nov 10 2021 at 00:34)</a>:</h4>
<p>If you already have, eg, Google Drive, I vaguely wonder if disabling uploads entirely would be better? (Is that possible? I'm somehow not seeing upload-related settings...)</p>



<a name="1278944"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1278944" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Philipp Huebner <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1278944">(Nov 10 2021 at 06:10)</a>:</h4>
<p>I would not want to loose the feature of simply pasting partial screenshots into a Zulip message.</p>



<a name="1279165"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Auto%20delete%20user%27s%20upload%20file/near/1279165" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Auto.20delete.20user.27s.20upload.20file.html#1279165">(Nov 10 2021 at 19:01)</a>:</h4>
<p><span class="user-mention" data-user-id="591">@Alex Dehnert</span> yes, one can, but only in <code>/etc/zulip/settings.py</code>, so it's not in the settings UI.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>