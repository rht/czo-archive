<html>
<head><meta charset="utf-8"><title>Cloudflare · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html">Cloudflare</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="263065"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263065" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263065">(Aug 04 2017 at 22:21)</a>:</h4>
<p>I'm setting up Zulip on a Google Compute Engine VM, and the actual IP is being masked by CloudFlare, so the LetsEncrypt setup (using <code>tls-sni-01</code>) fails.  There's a <a href="https://community.letsencrypt.org/t/how-to-use-cloudflare-along-with-lets-encrypt/29221/8" target="_blank" title="https://community.letsencrypt.org/t/how-to-use-cloudflare-along-with-lets-encrypt/29221/8">thread</a> suggesting using the <code>webroot</code>challenge instead.  Is it possible to run the zulip setup partway to get a functional <code>nginx</code> server that can then be used to generate the certificate successfully?  Or is there something different that I should be doing (a self-signed cert for example)?</p>



<a name="263067"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263067" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263067">(Aug 04 2017 at 22:21)</a>:</h4>
<p>Yep, you can use self-signed to get it setup and then switch</p>



<a name="263068"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263068" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263068">(Aug 04 2017 at 22:21)</a>:</h4>
<p>(going AFK)</p>



<a name="263070"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263070" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263070">(Aug 04 2017 at 22:22)</a>:</h4>
<p>Ok, thanks!</p>



<a name="263074"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263074" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263074">(Aug 04 2017 at 23:00)</a>:</h4>
<p>I got through most of the setup, but get a Bad Gateway 502 error when I try to navigate to the realm creation link.  Ideas?  Is there a webserver running at this point in the installation?</p>



<a name="263075"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263075" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263075">(Aug 04 2017 at 23:04)</a>:</h4>
<p>I got a traceback by e-mail.</p>
<div class="codehilite"><pre><span></span>Error generated by Anonymous user (not logged in) on zulip.sagemath.org deployment

Traceback (most recent call last):

File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 42, in inner
  response = get_response(request)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 244, in _legacy_get_response
  response = middleware_method(request)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 62, in process_request
  if self.should_redirect_with_slash(request):
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 80, in should_redirect_with_slash
  not is_valid_path(request.path_info, urlconf) and
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 157, in is_valid_path
  resolve(path, urlconf)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 27, in resolve
  return get_resolver(urlconf).resolve(path)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 270, in resolve
  for pattern in self.url_patterns:
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__
  res = instance.__dict__[self.name] = self.func(instance)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 313, in url_patterns
  patterns = getattr(self.urlconf_module, &quot;urlpatterns&quot;, self.urlconf_module)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__
  res = instance.__dict__[self.name] = self.func(instance)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 306, in urlconf_module
  return import_module(self.urlconf_name)
File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
  __import__(name)
File &quot;./zproject/urls.py&quot;, line 7, in &lt;module&gt;
  import zerver.forms
File &quot;./zerver/forms.py&quot;, line 14, in &lt;module&gt;
  from zerver.lib.actions import do_change_password, is_inactive, user_email_is_unique
File &quot;./zerver/lib/actions.py&quot;, line 24, in &lt;module&gt;
  from zerver.lib.message import (
File &quot;./zerver/lib/message.py&quot;, line 10, in &lt;module&gt;
  from zerver.lib.avatar import avatar_url_from_dict
File &quot;./zerver/lib/avatar.py&quot;, line 11, in &lt;module&gt;
  from zerver.lib.upload import upload_backend, MEDIUM_AVATAR_SIZE
File &quot;./zerver/lib/upload.py&quot;, line 17, in &lt;module&gt;
  from boto.s3.bucket import Bucket
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/__init__.py&quot;, line 1216, in &lt;module&gt;
  boto.plugin.load_plugins(config)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/plugin.py&quot;, line 93, in load_plugins
  _import_module(file)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/plugin.py&quot;, line 75, in _import_module
  return imp.load_module(name, file, filename, data)
File &quot;/usr/lib/python3/dist-packages/google_compute_engine/boto/compute_auth.py&quot;, line 19, in &lt;module&gt;
  from google_compute_engine import logger

ImportError: No module named google_compute_engine

Request info:

    path: /create_realm/....

    GET: {}

    REMOTE_ADDR: “[u&#39;2601:547:500:880:583a:685d:21e9:c0c9&#39;]”

    QUERY_STRING: “[u&#39;&#39;]”

    SERVER_NAME: “[u&#39;&#39;]”
</pre></div>



<a name="263080"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263080" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263080">(Aug 04 2017 at 23:30)</a>:</h4>
<p>I tried the realm creation link again and got a slightly different traceback.</p>
<div class="codehilite"><pre><span></span>Error generated by Anonymous user (not logged in) on zulip.sagemath.org deployment

Traceback (most recent call last):

File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 42, in inner
  response = get_response(request)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 244, in _legacy_get_response
  response = middleware_method(request)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 62, in process_request
  if self.should_redirect_with_slash(request):
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/middleware/common.py&quot;, line 80, in should_redirect_with_slash
  not is_valid_path(request.path_info, urlconf) and
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 157, in is_valid_path
  resolve(path, urlconf)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/base.py&quot;, line 27, in resolve
  return get_resolver(urlconf).resolve(path)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 270, in resolve
  for pattern in self.url_patterns:
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__
  res = instance.__dict__[self.name] = self.func(instance)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 313, in url_patterns
  patterns = getattr(self.urlconf_module, &quot;urlpatterns&quot;, self.urlconf_module)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/utils/functional.py&quot;, line 35, in __get__
  res = instance.__dict__[self.name] = self.func(instance)
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/django/urls/resolvers.py&quot;, line 306, in urlconf_module
  return import_module(self.urlconf_name)
File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
  __import__(name)
File &quot;./zproject/urls.py&quot;, line 7, in &lt;module&gt;
  import zerver.forms
File &quot;./zerver/forms.py&quot;, line 14, in &lt;module&gt;
  from zerver.lib.actions import do_change_password, is_inactive, user_email_is_unique
File &quot;./zerver/lib/actions.py&quot;, line 24, in &lt;module&gt;
  from zerver.lib.message import (
File &quot;./zerver/lib/message.py&quot;, line 10, in &lt;module&gt;
  from zerver.lib.avatar import avatar_url_from_dict
File &quot;./zerver/lib/avatar.py&quot;, line 11, in &lt;module&gt;
  from zerver.lib.upload import upload_backend, MEDIUM_AVATAR_SIZE
File &quot;./zerver/lib/upload.py&quot;, line 17, in &lt;module&gt;
  from boto.s3.bucket import Bucket
File &quot;/home/zulip/deployments/2017-08-04-22-30-22/zulip-venv/lib/python2.7/site-packages/boto/__init__.py&quot;, line 1216, in &lt;module&gt;
  boto.plugin.load_plugins(config)

AttributeError: ‘module’ object has no attribute ‘plugin’

Request info:

    path: /create_realm/....

    GET: {}

    REMOTE_ADDR: “[u&#39;2601:547:500:880:583a:685d:21e9:c0c9&#39;]”

    QUERY_STRING: “[u&#39;&#39;]”

    SERVER_NAME: “[u&#39;&#39;]”
</pre></div>



<a name="263081"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263081" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263081">(Aug 05 2017 at 00:08)</a>:</h4>
<p><span class="user-mention" data-user-email="roed314@gmail.com" data-user-id="2972">@David Roe</span> Hmm, interesting! So we import stuff from <code>boto</code>because if you configured the server to store uploaded images in S3, we'd use <code>boto</code> to do that.  The first traceback kind of looks like a story like</p>
<ul>
<li>we import <code>boto</code>, it goes around looking for plugins of itself to load</li>
<li>because you're on GCE, that somehow causes it to go try to load a GCE-related plugin</li>
<li>we haven't installed that plugin because we don't have code to use it, so ImportError.</li>
</ul>



<a name="263082"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263082" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263082">(Aug 05 2017 at 00:10)</a>:</h4>
<p>Interesting.</p>



<a name="263083"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263083" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263083">(Aug 05 2017 at 00:11)</a>:</h4>
<p>The second one is odder. I think perhaps it's fallout from the first? We got an ImportError inside trying to import <code>boto</code> (in its <code>__init__.py</code>, so now the <code>boto</code> module never got the <code>plugin</code> attribute it was supposed to have (pointing to the <code>boto.plugin</code> module.)</p>



<a name="263084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263084">(Aug 05 2017 at 00:11)</a>:</h4>
<p>On that hypothesis, if you restart the server it should go back to the first error.</p>



<a name="263085"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263085" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263085">(Aug 05 2017 at 00:11)</a>:</h4>
<p>Yeah, that seems likely.  Want me to try that?</p>



<a name="263086"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263086" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263086">(Aug 05 2017 at 00:12)</a>:</h4>
<p>Sure!</p>



<a name="263087"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263087" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263087">(Aug 05 2017 at 00:12)</a>:</h4>
<p>Restarting is done by <code>/home/zulip/deployments/current/manage.py restart</code>?</p>



<a name="263088"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263088" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263088">(Aug 05 2017 at 00:12)</a>:</h4>
<p>(just guessing)</p>



<a name="263089"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263089" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263089">(Aug 05 2017 at 00:13)</a>:</h4>
<p><code>.../current/scripts/restart-server</code> is the recommended command</p>



<a name="263090"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263090" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263090">(Aug 05 2017 at 00:13)</a>:</h4>
<p>Ok</p>



<a name="263092"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263092" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263092">(Aug 05 2017 at 00:13)</a>:</h4>
<p>Also, should we switch the topic to GCE?  What's the standard for when a conversation changes topic?</p>



<a name="263093"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263093" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263093">(Aug 05 2017 at 00:13)</a>:</h4>
<p>I'm not sure that's actually written down really clearly, but it's mentioned here: <a href="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html">http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html</a></p>



<a name="263094"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263094" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263094">(Aug 05 2017 at 00:14)</a>:</h4>
<p>My approach is usually to not worry about the topic when it's still one conversation.</p>



<a name="263095"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263095" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263095">(Aug 05 2017 at 00:15)</a>:</h4>
<p>Makes sense.</p>



<a name="263096"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263096" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263096">(Aug 05 2017 at 00:15)</a>:</h4>
<p>After restarting, we're back to the first error.</p>



<a name="263097"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263097" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263097">(Aug 05 2017 at 00:17)</a>:</h4>
<p>Cool. So basically the question is how to get boto to not try to load irrelevant plugins.</p>



<a name="263098"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263098" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263098">(Aug 05 2017 at 00:18)</a>:</h4>
<p>This looks like an explanation:<br>
<a href="https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882" target="_blank" title="https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882">https://github.com/travis-ci/travis-ci/issues/5246#issuecomment-166460882</a></p>



<a name="263099"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263099" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263099">(Aug 05 2017 at 00:19)</a>:</h4>
<p>So a workaround would be to set BOTO_CONFIG to a bogus value -- I think this should work:<br>
<code>BOTO_CONFIG=/tmp/nowhere /home/zulip/deployments/current/scripts/restart-server</code></p>



<a name="263100"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263100" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263100">(Aug 05 2017 at 00:20)</a>:</h4>
<p>I'll try that....</p>



<a name="263101"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263101" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263101">(Aug 05 2017 at 00:21)</a>:</h4>
<p>If that works (or I guess also if it doesn't), I'm curious what is in your <code>/etc/boto.cfg</code></p>



<a name="263102"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263102" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263102">(Aug 05 2017 at 00:21)</a>:</h4>
<p>And probably we should add a Puppet rule to blow away that file, or something.</p>



<a name="263103"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263103" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263103">(Aug 05 2017 at 00:21)</a>:</h4>
<p>It doesn't seem to work.  Here's <code>/etc/boto.cfg</code>:</p>
<div class="codehilite"><pre><span></span># This file is automatically created at boot time by the /usr/lib/python
# 3/dist-packages/google_compute_engine/boto/boto_config.py script. Do
# not edit this file directly. If you need to add items to this file,
# create or edit /etc/boto.cfg.template instead and then re-run the
# script.

[GSUtil]
default_project_id = 817585749775
default_api_version = 2

[GoogleCompute]
service_account = default

[Plugin]
plugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto
</pre></div>



<a name="263104"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263104" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263104">(Aug 05 2017 at 00:22)</a>:</h4>
<p>I'm still getting a 502 error, and no e-mailed traceback now.</p>



<a name="263105"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263105" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263105">(Aug 05 2017 at 00:22)</a>:</h4>
<p>Hmm. I suspect that command just isn't successfully setting the environment variable -- that the environment is getting cleared or something.</p>



<a name="263106"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263106" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263106">(Aug 05 2017 at 00:23)</a>:</h4>
<p>Ah of course -- because that just signals supervisord to actually start the server.</p>



<a name="263107"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263107" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263107">(Aug 05 2017 at 00:24)</a>:</h4>
<p>(also, can I keep trying to use this same realm creation link, or do I ever need to make a new one?)</p>



<a name="263108"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263108" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263108">(Aug 05 2017 at 00:24)</a>:</h4>
<p>These errors are at import time, so I think as far as the server is concerned you haven't tried to use it at all</p>



<a name="263109"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263109" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263109">(Aug 05 2017 at 00:25)</a>:</h4>
<p>It's not getting far enough to really look at your request</p>



<a name="263110"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263110" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263110">(Aug 05 2017 at 00:25)</a>:</h4>
<p>Okay.</p>



<a name="263111"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263111" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263111">(Aug 05 2017 at 00:25)</a>:</h4>
<p>OK, so look at <code>/etc/zulip/uwsgi.ini</code>, and the <code>env</code> setting there</p>



<a name="263112"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263112" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263112">(Aug 05 2017 at 00:26)</a>:</h4>
<p>If you add <code>BOTO_CONFIG=/tmp/nowhere</code> to that line, that should actually set it for the server process</p>



<a name="263113"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263113" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263113">(Aug 05 2017 at 00:26)</a>:</h4>
<div class="codehilite"><pre><span></span>[uwsgi]
socket=/home/zulip/deployments/uwsgi-socket
module=zproject.wsgi:application
chdir=/home/zulip/deployments/current/
master=true
chmod-socket=700
chown-socket=zulip:zulip
processes=5
harakiri=20
post-buffering=4096
env= LANG=en_US.UTF-8
uid=zulip
gid=zulip
</pre></div>



<a name="263115"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263115" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263115">(Aug 05 2017 at 00:27)</a>:</h4>
<p>So, change to <code>env= "LANG=en_US.UTF-8 BOTO_CONFIG=/tmp/nowhere"</code></p>



<a name="263116"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263116" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263116">(Aug 05 2017 at 00:28)</a>:</h4>
<p>Yeah, except I'd try it without the quotes</p>



<a name="263117"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263117" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263117">(Aug 05 2017 at 00:28)</a>:</h4>
<p>(Not sure if those will be parsed away)</p>



<a name="263118"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263118" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263118">(Aug 05 2017 at 00:30)</a>:</h4>
<p>Looks like <a href="https://docs.python.org/3/library/configparser.html#supported-ini-file-structure" target="_blank" title="https://docs.python.org/3/library/configparser.html#supported-ini-file-structure">this</a> is the documentation, and no-quotes it is</p>



<a name="263119"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263119" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263119">(Aug 05 2017 at 00:31)</a>:</h4>
<p>Still getting the same error.</p>



<a name="263120"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263120" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263120">(Aug 05 2017 at 00:31)</a>:</h4>
<p>uwsgi is now</p>
<div class="codehilite"><pre><span></span>[uwsgi]
socket=/home/zulip/deployments/uwsgi-socket
module=zproject.wsgi:application
chdir=/home/zulip/deployments/current/
master=true
chmod-socket=700
chown-socket=zulip:zulip
processes=5
harakiri=20
post-buffering=4096
env= LANG=en_US.UTF-8 BOTO_CONFIG=/tmp/nowhere
uid=zulip
gid=zulip
</pre></div>



<a name="263121"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263121" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263121">(Aug 05 2017 at 00:32)</a>:</h4>
<p>Hrm.</p>



<a name="263122"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263122" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263122">(Aug 05 2017 at 00:33)</a>:</h4>
<p>Would it help if you had access to the server?</p>



<a name="263123"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263123" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263123">(Aug 05 2017 at 00:34)</a>:</h4>
<p>Sure.</p>



<a name="263124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263124">(Aug 05 2017 at 00:34)</a>:</h4>
<p>If you send me a public key I can add you.</p>



<a name="263126"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263126" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263126">(Aug 05 2017 at 00:34)</a>:</h4>
<p>(sent)</p>



<a name="263127"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263127" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263127">(Aug 05 2017 at 00:35)</a>:</h4>
<p>I think the next thing I'd try is just knocking out that file -- setting BOTO_CONFIG was really in the first place just a quick hack to have the same effect</p>



<a name="263128"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263128" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263128">(Aug 05 2017 at 00:35)</a>:</h4>
<p>So if it's not working out to be quick, time to bail in favor of the actual fix :)</p>



<a name="263138"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263138" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263138">(Aug 05 2017 at 00:41)</a>:</h4>
<p>Cool. So I think the next thing I'd do is</p>
<ul>
<li>move <code>/etc/boto.cfg</code> out of the way</li>
<li>restart the server and see if that works</li>
</ul>



<a name="263139"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263139" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263139">(Aug 05 2017 at 00:42)</a>:</h4>
<p>Then because of the warning at the top that the file will be regenerated at boot time, if that works go on to make a file <code>/etc/boto.cfg.template</code> that causes the script to make an empty file, or one without <code>Plugin.plugin_directory</code>.</p>



<a name="263140"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263140" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263140">(Aug 05 2017 at 00:44)</a>:</h4>
<p>Great, that worked.</p>



<a name="263141"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263141" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263141">(Aug 05 2017 at 00:44)</a>:</h4>
<p>Sweet</p>



<a name="263142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263142">(Aug 05 2017 at 00:44)</a>:</h4>
<p>What should be in <code>/etc/boto.cfg.template</code>?  Just an empty file?</p>



<a name="263143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263143">(Aug 05 2017 at 00:45)</a>:</h4>
<p>I'd try that. I'm failing to find docs for this file.</p>



<a name="263144"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263144" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263144">(Aug 05 2017 at 00:45)</a>:</h4>
<p>(And run the indicated script and see what it does.)</p>



<a name="263145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263145">(Aug 05 2017 at 00:46)</a>:</h4>
<p>Also I think that is not actually a script, and the script is somewhere else</p>



<a name="263146"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263146" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263146">(Aug 05 2017 at 00:46)</a>:</h4>
<p>(From reading its source)</p>



<a name="263147"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263147" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263147">(Aug 05 2017 at 00:47)</a>:</h4>
<p>Yeah, <code>python3 /usr/lib/python3/dist-packages/google_compute_engine/boto/boto_config.py</code> doesn't work.</p>



<a name="263148"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263148" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263148">(Aug 05 2017 at 00:49)</a>:</h4>
<p>I think <code>/usr/bin/google_instance_setup</code> is it</p>



<a name="263149"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263149" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263149">(Aug 05 2017 at 00:49)</a>:</h4>
<p>(maybe)</p>



<a name="263150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263150">(Aug 05 2017 at 00:49)</a>:</h4>
<p>It's mentioned in similar header text in a neighboring file</p>



<a name="263152"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263152" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263152">(Aug 05 2017 at 00:50)</a>:</h4>
<p>And the one thing in that package that imports that <code>boto_config.py</code> is a file that sounds like it'd be involved in that script</p>



<a name="263153"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263153" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263153">(Aug 05 2017 at 00:50)</a>:</h4>
<p>:-)</p>



<a name="263154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263154">(Aug 05 2017 at 00:56)</a>:</h4>
<p>So, running that script does in fact regenerate <code>boto.cfg</code>, but the bad one.</p>
<div class="codehilite"><pre><span></span>[GSUtil]
default_project_id = 817585749775
default_api_version = 2

[GoogleCompute]
service_account = default

[Plugin]
plugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto
</pre></div>



<a name="263155"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263155" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263155">(Aug 05 2017 at 00:57)</a>:</h4>
<p>Hm. Maybe make the template file just have the <code>Plugin.plugin_directory</code> setting, with an empty value?</p>



<a name="263156"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263156" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263156">(Aug 05 2017 at 00:57)</a>:</h4>
<p>I would be more impressed with GCE if I could find documentation for any of this :)</p>



<a name="263157"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263157" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263157">(Aug 05 2017 at 00:57)</a>:</h4>
<p>(or for that matter if the instructions at the top of the generated file were accurate...)</p>



<a name="263158"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263158" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263158">(Aug 05 2017 at 01:00)</a>:</h4>
<p>Nope, still has the line <code>plugin_directory = /usr/lib/python3/dist-packages/google_compute_engine/boto</code>.  I can try setting it to <code>/tmp/nowhere</code>....</p>



<a name="263159"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263159" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263159">(Aug 05 2017 at 01:00)</a>:</h4>
<p>Nope.</p>



<a name="263160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263160">(Aug 05 2017 at 01:01)</a>:</h4>
<p>Yuck.</p>



<a name="263161"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263161" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263161">(Aug 05 2017 at 01:03)</a>:</h4>
<p>Current contents of <code>boto.cfg.template</code>:</p>
<div class="codehilite"><pre><span></span>[Plugin]
plugin_directory = /tmp/nowhere
</pre></div>



<a name="263162"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263162" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263162">(Aug 05 2017 at 01:03)</a>:</h4>
<p>I don't know where that template file is being parsed....</p>



<a name="263163"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263163" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263163">(Aug 05 2017 at 01:03)</a>:</h4>
<p>Looks awfully reasonable to me.</p>



<a name="263164"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263164" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263164">(Aug 05 2017 at 01:09)</a>:</h4>
<p>So, this will currently break when the VM gets restarted, right?</p>



<a name="263165"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263165" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263165">(Aug 05 2017 at 01:09)</a>:</h4>
<p>Right. And it'll be fixed by removing that file again.</p>



<a name="263166"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263166" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263166">(Aug 05 2017 at 01:11)</a>:</h4>
<p>So, is this the first time Zulip has been installed on GCE?</p>



<a name="263167"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263167" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263167">(Aug 05 2017 at 01:12)</a>:</h4>
<p>Might be!</p>



<a name="263168"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263168" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263168">(Aug 05 2017 at 01:13)</a>:</h4>
<p>:-)</p>



<a name="263169"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263169" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263169">(Aug 05 2017 at 01:18)</a>:</h4>
<p>Okay, thanks a lot for your help.  I'm going to work on setting up Zulip for SageMath. :-)</p>
<p>I'll let you know if I figure anything out about <code>boto.cfg.template</code></p>



<a name="263170"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263170" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263170">(Aug 05 2017 at 01:19)</a>:</h4>
<p>So I think a reasonable way to fix this (so that it stays fixed after reboot) would be to make a trivial systemd "service" that just removes that file. <a href="https://linuxconfig.org/how-to-automatically-execute-shell-script-at-startup-boot-on-systemd-linux" target="_blank" title="https://linuxconfig.org/how-to-automatically-execute-shell-script-at-startup-boot-on-systemd-linux">This</a> looks like a decent short tutorial/example.</p>



<a name="263171"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263171" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Joshua Pan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263171">(Aug 05 2017 at 01:19)</a>:</h4>
<p>Oh cool! I use SageMath or didn't it change its name?</p>



<a name="263172"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263172" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263172">(Aug 05 2017 at 01:20)</a>:</h4>
<p>Yeah, and also moving on to set up Zulip, and leaving the on-reboot issue to deal with later, is a very sensible choice :)</p>



<a name="263173"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263173" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263173">(Aug 05 2017 at 01:20)</a>:</h4>
<p>Sounds good.</p>



<a name="263174"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263174" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263174">(Aug 05 2017 at 01:21)</a>:</h4>
<p>If you do make a fix for it, I'd be glad to see a PR to add it to <code>puppet/</code></p>



<a name="263175"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263175" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263175">(Aug 05 2017 at 01:21)</a>:</h4>
<p><span class="user-mention" data-user-email="joshuapan8@gmail.com" data-user-id="857">@Joshua Pan</span>, it's the Sage of <a href="http://sagemath.org" target="_blank" title="http://sagemath.org">sagemath.org</a>.  I'm setting up a zulip server for Sage development.</p>



<a name="263176"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263176" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263176">(Aug 05 2017 at 01:21)</a>:</h4>
<p>It will be hosted at <a href="http://zulip.sagemath.org" target="_blank" title="http://zulip.sagemath.org">zulip.sagemath.org</a> (well, it probably already is, but there's a lot of setup to do).</p>



<a name="263177"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263177" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263177">(Aug 05 2017 at 01:23)</a>:</h4>
<p>Greg, I'm not sure if I'll get around to that anytime soon, but I'll let you know if I do.</p>



<a name="263178"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263178" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263178">(Aug 05 2017 at 01:23)</a>:</h4>
<p>I'll try. <img alt=":simple_smile:" class="emoji" src="/static/generated/emoji/images/emoji/unicode/1f642.png" title="simple smile"></p>



<a name="263180"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263180" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263180">(Aug 05 2017 at 01:30)</a>:</h4>
<p><span class="user-mention" data-user-email="roed314@gmail.com" data-user-id="2972">@David Roe</span> Oh hey there is already a known issue about this!<br>
<a href="https://github.com/zulip/zulip/pull/4839" target="_blank" title="https://github.com/zulip/zulip/pull/4839">#4839</a>.</p>



<a name="263181"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263181" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263181">(Aug 05 2017 at 01:30)</a>:</h4>
<p>Found that when I went to go report one so that we'd have it to refer to if/when someone runs into it again. I guess searching the known issues would have been a smart thing for me to try up front. &lt;_&lt;</p>



<a name="263182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263182">(Aug 05 2017 at 01:30)</a>:</h4>
<p>Hehe</p>



<a name="263183"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263183" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263183">(Aug 05 2017 at 01:32)</a>:</h4>
<p>Oh ha and as that thread points out, the <code>python3</code> in that path is a hint that things are going to inevitably be busted when running on Python 2.</p>



<a name="263184"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263184" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> David Roe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263184">(Aug 05 2017 at 01:32)</a>:</h4>
<p>Yeah.  It looks like your work on switching to python3 will be useful here. :-)</p>



<a name="263185"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263185" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263185">(Aug 05 2017 at 01:32)</a>:</h4>
<p>Yeah, seems likely. :-)</p>



<a name="263186"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263186" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263186">(Aug 05 2017 at 01:32)</a>:</h4>
<p>Cool, so that will be the long-term solution pretty soon, then.</p>



<a name="263187"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Cloudflare/near/263187" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Cloudflare.html#263187">(Aug 05 2017 at 01:33)</a>:</h4>
<p>This whole episode does not give me a lot of confidence in GCE, though.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>