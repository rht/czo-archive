<html>
<head><meta charset="utf-8"><title>✔ Users cannot be synchronized using ldap function #24369 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html">✔ Users cannot be synchronized using ldap function #24369</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1508025"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508025" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508025">(Feb 14 2023 at 06:59)</a>:</h4>
<p>The current connection is normal, but users cannot be synchronized<br>
zulip@zulip:/root$ /home/zulip/deployments/current/manage.py sync_ldap_user_data<br>
2023-02-11 20:13:40.646 INFO [zulip.sync_ldap_user_data] Starting update.<br>
2023-02-11 20:13:40.648 DEBG [django_auth_ldap] Binding as<br>
2023-02-11 20:13:40.650 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=zulip@t-demo.com)')<br>
2023-02-11 20:13:40.651 ERR [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=zulip@t-demo.com)') raised OPERATIONS_ERROR({'msgtype': 101, 'msgid': 2, 'result': 1, 'desc': 'Operations error', 'ctrls': [], 'info': '000004DC: LdapErr: DSID-0C090A37, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563'})<br>
2023-02-11 20:13:40.651 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=%(email)s)') returned 0 objects:<br>
2023-02-11 20:13:40.651 DEBG [django_auth_ldap] Binding as<br>
2023-02-11 20:13:40.652 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=zulip@t-demo.com)')<br>
2023-02-11 20:13:40.652 ERR [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=zulip@t-demo.com)') raised OPERATIONS_ERROR({'msgtype': 101, 'msgid': 2, 'result': 1, 'desc': 'Operations error', 'ctrls': [], 'info': '000004DC: LdapErr: DSID-0C090A37, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563'})<br>
2023-02-11 20:13:40.653 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=%(user)s)') returned 0 objects:<br>
2023-02-11 20:13:40.653 WARN [zulip.sync_ldap_user_data] Did not find <a href="mailto:zulip@t-demo.com">zulip@t-demo.com</a> in LDAP.<br>
2023-02-11 20:13:40.653 DEBG [django_auth_ldap] Binding as<br>
2023-02-11 20:13:40.654 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=fits01@t-demo.com)')<br>
2023-02-11 20:13:40.654 ERR [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=fits01@t-demo.com)') raised OPERATIONS_ERROR({'msgtype': 101, 'msgid': 2, 'result': 1, 'desc': 'Operations error', 'ctrls': [], 'info': '000004DC: LdapErr: DSID-0C090A37, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563'})<br>
2023-02-11 20:13:40.654 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo.com,dc=com', 2, '(mail=%(email)s)') returned 0 objects:<br>
2023-02-11 20:13:40.655 DEBG [django_auth_ldap] Binding as<br>
2023-02-11 20:13:40.656 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=fits01@t-demo.com)')<br>
2023-02-11 20:13:40.656 ERR [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=fits01@t-demo.com)') raised OPERATIONS_ERROR({'msgtype': 101, 'msgid': 2, 'result': 1, 'desc': 'Operations error', 'ctrls': [], 'info': '000004DC: LdapErr: DSID-0C090A37, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563'})<br>
2023-02-11 20:13:40.656 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=%(user)s)') returned 0 objects:<br>
2023-02-11 20:13:40.656 WARN [zulip.sync_ldap_user_data] Did not find <a href="mailto:fits01@t-demo.com">fits01@t-demo.com</a> in LDAP.<br>
2023-02-11 20:13:40.659 INFO [zulip.sync_ldap_user_data] Finished update.<br>
zulip@zulip:/root$ /home/zulip/deployments/current/manage.py query_ldap fits03<br>
2023-02-11 20:14:03.864 DEBG [django_auth_ldap] Binding as<br>
2023-02-11 20:14:03.865 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=fits03)')<br>
2023-02-11 20:14:03.866 ERR [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=fits03)') raised OPERATIONS_ERROR({'msgtype': 101, 'msgid': 2, 'result': 1, 'desc': 'Operations error', 'ctrls': [], 'info': '000004DC: LdapErr: DSID-0C090A37, comment: In order to perform this operation a successful bind must be completed on the connection., data 0, v4563'})<br>
2023-02-11 20:14:03.866 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=%(user)s)') returned 0 objects:<br>
No such user found: No LDAP user matching django_to_ldap_username result: fits03. Input username: fits03</p>



<a name="1508047"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508047" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508047">(Feb 14 2023 at 10:54)</a>:</h4>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span> Please put logs in code blocks (<a href="https://zulip.com/help/code-blocks">https://zulip.com/help/code-blocks</a>), since that makes it readable more easily.</p>
<p>Do you have <code>AUTH_LDAP_BIND_DN</code> and the password configured? <code>In order to perform this operation a successful bind must be completed on the connection</code> log sounds like you may not be authenticated I think?  Also <code>2023-02-11 20:13:40.648 DEBG [django_auth_ldap] Binding as</code> is missing information about binding as <em>what</em>, so sounds like there may be an empty string there, hinting at missing configuration?</p>



<a name="1508426"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508426" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508426">(Feb 15 2023 at 05:48)</a>:</h4>
<p>I have bound users before, but the result is the same</p>



<a name="1508429"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508429" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508429">(Feb 15 2023 at 06:04)</a>:</h4>
<p><a href="/user_uploads/2/43/oVkpM7qnGiHqk3yY2Jehtjdy/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/43/oVkpM7qnGiHqk3yY2Jehtjdy/image.png" title="image.png"><img src="/user_uploads/2/43/oVkpM7qnGiHqk3yY2Jehtjdy/image.png"></a></div>



<a name="1508430"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508430" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508430">(Feb 15 2023 at 06:05)</a>:</h4>
<p>This is the result of execution after binding the user</p>



<a name="1508437"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508437" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508437">(Feb 15 2023 at 07:00)</a>:</h4>
<p>I am using ldap instead of ldaps</p>



<a name="1508518"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508518" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508518">(Feb 15 2023 at 12:06)</a>:</h4>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span> That's due to some other ldap search settings still not being quite right I assume, but having binding configured is needed to even try the search. Could you show also the other LDAP settings and say which of the (A) (B) (C) from <a href="https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap-including-active-directory">https://zulip.readthedocs.io/en/latest/production/authentication-methods.html#ldap-including-active-directory</a> you're doing?</p>



<a name="1508691"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508691" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508691">(Feb 16 2023 at 04:48)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> What I want to achieve is to log in directly with the ldap account as the user name So this is my  server configuration<br>
<a href="/user_uploads/2/7c/FSsS-LP5fLroi3SD7q3bPhLM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/7c/FSsS-LP5fLroi3SD7q3bPhLM/image.png" title="image.png"><img src="/user_uploads/2/7c/FSsS-LP5fLroi3SD7q3bPhLM/image.png"></a></div>



<a name="1508692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508692">(Feb 16 2023 at 04:49)</a>:</h4>
<p><a href="/user_uploads/2/93/GP49x0uIT5P1i3A13Th5iL1i/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/93/GP49x0uIT5P1i3A13Th5iL1i/image.png" title="image.png"><img src="/user_uploads/2/93/GP49x0uIT5P1i3A13Th5iL1i/image.png"></a></div>



<a name="1508694"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508694" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508694">(Feb 16 2023 at 04:50)</a>:</h4>
<p>Like the instruction manual, I just changed the AD information to mine</p>



<a name="1508771"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508771" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508771">(Feb 16 2023 at 12:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="25948">TwoDogs2</span> <a href="#narrow/stream/31-production-help/topic/Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369/near/1508429">said</a>:</p>
<blockquote>
<p><a href="/user_uploads/2/43/oVkpM7qnGiHqk3yY2Jehtjdy/image.png">image.png</a></p>
</blockquote>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span> Hmm, was this screenshot taken with the settings you posted above? I'm just noticing that the <code>search_s</code> query in the log involves <code>uid=...</code> - but with the settings you've posted I'd expect the query to be by  <code>sAMAccountName</code> rather than by uid? Unless I'm missing something</p>



<a name="1508797"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1508797" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1508797">(Feb 16 2023 at 15:16)</a>:</h4>
<p>Note you do need to restart the server (<code>~/deployments/current/scripts/restart-server</code>) after making changes to <code>/etc/zulip/settings.py</code></p>



<a name="1509092"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509092" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509092">(Feb 17 2023 at 02:48)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> My service has been restarted</p>



<a name="1509093"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509093" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509093">(Feb 17 2023 at 02:49)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> Yes, I want to synchronize domain accounts so that domain accounts can log in</p>



<a name="1509094"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509094" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509094">(Feb 17 2023 at 02:49)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> Is there a problem with my configuration</p>



<a name="1509152"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509152" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509152">(Feb 17 2023 at 09:23)</a>:</h4>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span> Can you run the <code>query_ldap</code> command again with the settings you posted?</p>



<a name="1509190"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509190" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509190">(Feb 17 2023 at 13:06)</a>:</h4>
<p>This is the new synchronization information<br>
<a href="/user_uploads/2/2c/aCsfmsIFaeytq7L3Vs4zgAJf/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/2c/aCsfmsIFaeytq7L3Vs4zgAJf/image.png" title="image.png"><img src="/user_uploads/2/2c/aCsfmsIFaeytq7L3Vs4zgAJf/image.png"></a></div>



<a name="1509194"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509194" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509194">(Feb 17 2023 at 13:10)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> <br>
This is the information synchronized after the new configuration The service has been restarted</p>



<a name="1509202"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509202" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509202">(Feb 17 2023 at 13:18)</a>:</h4>
<p>That shows it searching by <code>uid</code>, which means the config you showed above isn't active.</p>
<p>Can you show:</p>
<div class="codehilite"><pre><span></span><code>grep AUTH_LDAP_USERNAME_ATTR /etc/zulip/settings.py
</code></pre></div>



<a name="1509203"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509203" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509203">(Feb 17 2023 at 13:23)</a>:</h4>
<p>root@zulip:~# grep AUTH_LDAP_USERNAME_ATTR /etc/zulip/settings.py<br>
AUTH_LDAP_USERNAME_ATTR = "sAMAccountName"<br>
#AUTH_LDAP_USERNAME_ATTR = "mail"</p>
<h2>AUTH_LDAP_REVERSE_EMAIL_SEARCH and AUTH_LDAP_USERNAME_ATTR below.</h2>
<h2>AUTH_LDAP_USERNAME_ATTR are required when LDAP_APPEND_DOMAIN is None.</h2>
<h2>AUTH_LDAP_USERNAME_ATTR should be the Zulip username attribute</h2>
<h1>AUTH_LDAP_USERNAME_ATTR = "uid"</h1>



<a name="1509204"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509204" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509204">(Feb 17 2023 at 13:23)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> <br>
  This is the display result</p>



<a name="1509206"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509206" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509206">(Feb 17 2023 at 13:26)</a>:</h4>
<p>root@zulip:~# grep AUTH_LDAP_USERNAME_ATTR /etc/zulip/settings.py<br>
AUTH_LDAP_USERNAME_ATTR = "sAMAccountName"<br>
#AUTH_LDAP_USERNAME_ATTR = "mail"</p>
<h2>AUTH_LDAP_REVERSE_EMAIL_SEARCH and AUTH_LDAP_USERNAME_ATTR below.</h2>
<h2>AUTH_LDAP_USERNAME_ATTR are required when LDAP_APPEND_DOMAIN is None.</h2>
<h2>AUTH_LDAP_USERNAME_ATTR should be the Zulip username attribute</h2>
<h1>AUTH_LDAP_USERNAME_ATTR = "uid"</h1>
<p>root@zulip:~#</p>



<a name="1509207"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509207" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509207">(Feb 17 2023 at 13:27)</a>:</h4>
<p>Please use code blocks when pasting in output from the terminal: <a href="https://zulip.com/help/code-blocks">https://zulip.com/help/code-blocks</a></p>



<a name="1509208"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509208" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509208">(Feb 17 2023 at 13:28)</a>:</h4>
<p><a href="/user_uploads/2/38/bM3nvrkIsX_nB4qUgrlECKUm/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/38/bM3nvrkIsX_nB4qUgrlECKUm/image.png" title="image.png"><img src="/user_uploads/2/38/bM3nvrkIsX_nB4qUgrlECKUm/image.png"></a></div>



<a name="1509209"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509209" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509209">(Feb 17 2023 at 13:32)</a>:</h4>
<p>That's a screenshot, not a code block. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<p>Regardless, I don't understand how that config is producing the output you showed above, to <code>query_ldap</code>.</p>



<a name="1509214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509214">(Feb 17 2023 at 13:45)</a>:</h4>
<p>Yes, I also don't understand, so I want to ask for help</p>



<a name="1509215"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509215" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509215">(Feb 17 2023 at 13:46)</a>:</h4>
<p>Is there a problem with my configuration from the perspective of configuration</p>



<a name="1509221"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509221" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509221">(Feb 17 2023 at 13:50)</a>:</h4>
<p>Let me drink my morning coffee and I'll see if I can come up with any theories. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1509223"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509223" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509223">(Feb 17 2023 at 13:52)</a>:</h4>
<p>No problem, please enjoy the coffee in the morning. It can bring you mysterious power <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="1509236"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509236" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509236">(Feb 17 2023 at 14:24)</a>:</h4>
<p><span class="user-mention" data-user-id="25948">@TwoDogs2</span>: Can you show the output of:</p>
<div class="codehilite"><pre><span></span><code>./scripts/get-django-setting AUTH_LDAP_USERNAME_ATTR
</code></pre></div>



<a name="1509239"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509239" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509239">(Feb 17 2023 at 14:35)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span>  This is the information displayed<br>
<a href="/user_uploads/2/f5/kZMoso3HCi9SjU35JGatMS-U/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/f5/kZMoso3HCi9SjU35JGatMS-U/image.png" title="image.png"><img src="/user_uploads/2/f5/kZMoso3HCi9SjU35JGatMS-U/image.png"></a></div>



<a name="1509244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509244">(Feb 17 2023 at 15:23)</a>:</h4>
<p>Hmm, what about <code>./scripts/get-django-setting AUTH_LDAP_USER_SEARCH</code>?</p>



<a name="1509245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509245">(Feb 17 2023 at 15:29)</a>:</h4>
<p>The result is the same<br>
<a href="/user_uploads/2/8c/xak9pGZ3IcZl7LWjOojd4596/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/8c/xak9pGZ3IcZl7LWjOojd4596/image.png" title="image.png"><img src="/user_uploads/2/8c/xak9pGZ3IcZl7LWjOojd4596/image.png"></a></div>



<a name="1509246"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509246" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509246">(Feb 17 2023 at 15:30)</a>:</h4>
<p>zulip@zulip:~$ /home/zulip/deployments/current/manage.py query_ldap fits02<br>
2023-02-17 15:28:48.395 DEBG [django_auth_ldap] Binding as admin<br>
2023-02-17 15:28:48.398 DEBG [django_auth_ldap] Invoking search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=fits02)')<br>
2023-02-17 15:28:48.399 DEBG [django_auth_ldap] search_s('ou=userid,ou=vmware,dc=t-demo,dc=com', 2, '(uid=%(user)s)') returned 0 objects:<br>
No such user found: No LDAP user matching django_to_ldap_username result: fits02. Input username: fits02<br>
zulip@zulip:~$</p>



<a name="1509247"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509247" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509247">(Feb 17 2023 at 15:32)</a>:</h4>
<p>root@zulip:/home/zulip/deployments/2023-02-08-00-06-18# ./scripts/get-django-setting AUTH_LDAP_USER_SEARCH<br>
&lt;LDAPSearch: ou=userid,ou=vmware,dc=t-demo,dc=com&gt;<br>
root@zulip:/home/zulip/deployments/2023-02-08-00-06-18#</p>



<a name="1509248"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509248" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509248">(Feb 17 2023 at 15:32)</a>:</h4>
<p>Can return the correct OU</p>



<a name="1509253"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509253" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509253">(Feb 17 2023 at 16:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="25948">TwoDogs2</span> <a href="#narrow/stream/31-production-help/topic/Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369/near/1509247">said</a>:</p>
<blockquote>
<p>root@zulip:/home/zulip/deployments/2023-02-08-00-06-18# ./scripts/get-django-setting AUTH_LDAP_USER_SEARCH<br>
&lt;LDAPSearch: ou=userid,ou=vmware,dc=t-demo,dc=com&gt;<br>
root@zulip:/home/zulip/deployments/2023-02-08-00-06-18#</p>
</blockquote>
<p>Ah, this doesn't print the full LDAPSearch. How about just <code>grep AUTH_LDAP_USER_SEARCH /etc/zulip/settings.py</code>?</p>
<p>If this is right, I'm quite at a loss here, but clearly the settings are not being correctly applied - I just tried this by myself and if I have AUTH_LDAP_USER_SEARCH configured to search with <code>(sAMAccountName=%(user)s)</code>, that's reflected in the logged quries as expected:</p>
<div class="codehilite"><pre><span></span><code>2023-02-17 16:15:57.889 DEBG [django_auth_ldap] Invoking search_s(&#39;ou=users,dc=zulip,dc=com&#39;, 1, &#39;(sAMAccountName=ldapuser1)&#39;)
</code></pre></div>
<p><code>uid</code> should not be in the query</p>



<a name="1509254"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509254" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509254">(Feb 17 2023 at 16:26)</a>:</h4>
<p>This is the return result</p>
<div class="codehilite"><pre><span></span><code>root@zulip:~# grep AUTH_LDAP_USER_SEARCH /etc/zulip/settings.py
AUTH_LDAP_USER_SEARCH = LDAPSearch(&quot;ou=userid,ou=vmware,dc=t-demo,dc=com&quot;,ldap.SCOPE_SUBTREE, &quot;(sAMAccountName=%(user)s)&quot;)
AUTH_LDAP_USER_SEARCH = LDAPSearch(
## AUTH_LDAP_REVERSE_EMAIL_SEARCH works like AUTH_LDAP_USER_SEARCH and
## (defined in AUTH_LDAP_USER_SEARCH).
</code></pre></div>



<a name="1509257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1509257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1509257">(Feb 17 2023 at 17:05)</a>:</h4>
<p>That uncommented <code>AUTH_LDAP_USER_SEARCH = LDAPSearch(</code> line  looks suspicious. Do you have a second uncommented <code>AUTH_LDAP_USER_SEARCH = ...</code> entry that's overriding the correct config?</p>



<a name="1510007"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1510007" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> TwoDogs2 <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1510007">(Feb 20 2023 at 01:32)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> <span class="user-mention" data-user-id="12178">@Alex Vandiver</span> My problem has been solved Thank you very much</p>



<a name="1510008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Users%20cannot%20be%20synchronized%20using%20ldap%20function%20%2324369/near/1510008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Users.20cannot.20be.20synchronized.20using.20ldap.20function.20.2324369.html#1510008">(Feb 20 2023 at 01:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="25948">TwoDogs2</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>