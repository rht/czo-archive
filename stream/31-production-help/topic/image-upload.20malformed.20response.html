<html>
<head><meta charset="utf-8"><title>image-upload malformed response · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html">image-upload malformed response</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1604634"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1604634" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Bobbe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1604634">(Jul 05 2023 at 23:40)</a>:</h4>
<p>In <a href="https://github.com/zulip/zulip-mobile/pull/5744">#M5744</a>, we got a report that looks like the server sending a 200 response for an <a href="https://zulip.com/api/upload-file">upload-file request</a> but it doesn't parse as JSON.</p>



<a name="1604635"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1604635" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Bobbe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1604635">(Jul 05 2023 at 23:42)</a>:</h4>
<p>The server version is 7.1.</p>



<a name="1604636"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1604636" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Bobbe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1604636">(Jul 05 2023 at 23:43)</a>:</h4>
<blockquote>
<p>It's just the error when I try to upload an image. All other functionalities work without problems. It happens to me both with images and with files that I want to upload.</p>
<p>I can send messages, make a link for video calls, but I can't upload files or images from the mobile AP</p>
</blockquote>



<a name="1605013"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605013" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605013">(Jul 06 2023 at 16:33)</a>:</h4>
<p><span class="user-mention" data-user-id="27328">@Manuel</span>: Are you the reporter?  Can you talk about your deployment -- do you have any reverse proxies in front of Zulip, and have you adjusted the server in any way?</p>



<a name="1605014"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605014" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605014">(Jul 06 2023 at 16:33)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="3" href="/#narrow/stream/3-backend/topic/image-upload.20malformed.20response">#backend &gt; image-upload malformed response</a> by <span class="user-mention silent" data-user-id="12178">Alex Vandiver</span>.</p>



<a name="1605015"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605015" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605015">(Jul 06 2023 at 16:34)</a>:</h4>
<p><span class="user-mention" data-user-id="27328">@Manuel</span>: I moved the topic here, FYI.</p>



<a name="1605019"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605019" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605019">(Jul 06 2023 at 16:35)</a>:</h4>
<p>Also, are you using the <a href="https://zulip.readthedocs.io/en/latest/production/upload-backends.html#s3-backend-configuration">S3 file storage backend</a>, or the default on-disk backend?</p>



<a name="1605504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605504">(Jul 06 2023 at 23:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605013">ha dicho</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="27328">Manuel</span>: Are you the reporter?  Can you talk about your deployment -- do you have any reverse proxies in front of Zulip, and have you adjusted the server in any way?</p>
</blockquote>
<p>R: I am the administrator and who implemented and did the configuration. There is no reverse proxy.</p>



<a name="1605505"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605505" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605505">(Jul 06 2023 at 23:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605019">ha dicho</a>:</p>
<blockquote>
<p>Also, are you using the <a href="https://zulip.readthedocs.io/en/latest/production/upload-backends.html#s3-backend-configuration">S3 file storage backend</a>, or the default on-disk backend?</p>
</blockquote>
<p>using on default disk. As I mentioned, it works without problems in the desktop application (AP PC), it works without problems even on the web, but with the application it does not work. The way I see it, it's a problem with the application mobile, because the method works both from the web and from the PC application.</p>



<a name="1605618"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605618" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605618">(Jul 07 2023 at 02:51)</a>:</h4>
<p>There are some differences between the mobile and desktop APIs, but for <code>/api/v1/user_uploads</code> it's pretty consistent, particularly in response payload.</p>
<p><span class="user-mention" data-user-id="27328">@Manuel</span>: Do you see the same problems on wifi, or is this just on mobile data?</p>



<a name="1605964"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605964" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605964">(Jul 07 2023 at 15:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605618">ha dicho</a>:</p>
<blockquote>
<p>There are some differences between the mobile and desktop APIs, but for <code>/api/v1/user_uploads</code> it's pretty consistent, particularly in response payload.</p>
<p><span class="user-mention silent" data-user-id="27328">Manuel</span>: Do you see the same problems on wifi, or is this just on mobile data?</p>
</blockquote>
<p>Hello, thanks for the support. It happens to me both through mobile data and wifi</p>



<a name="1605987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605987">(Jul 07 2023 at 16:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27328">Manuel</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605964">ha dicho</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605618">ha dicho</a>:</p>
<blockquote>
<p>There are some differences between the mobile and desktop APIs, but for <code>/api/v1/user_uploads</code> it's pretty consistent, particularly in response payload.</p>
<p><span class="user-mention silent" data-user-id="27328">Manuel</span>: Do you see the same problems on wifi, or is this just on mobile data?</p>
</blockquote>
<p>Hello, thanks for the support. It happens to me both through mobile data and wifi</p>
</blockquote>
<p>Trying some solution, notice that when I enable the PUSH according to the procedure, it doesn't let me upload files on any platform, so I left it disabled to leave the scenario as I commented. Is worth to say:</p>
<p>Web upload works<br>
Upload works on pc app<br>
It doesn't work for me when uploading by mobile</p>
<p>Thank you</p>



<a name="1605990"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1605990" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1605990">(Jul 07 2023 at 16:37)</a>:</h4>
<p>To make sure I am understanding right -- when you enabled push notifications via <a href="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html">these instructions</a>, it broke file uploads on web and desktop?</p>



<a name="1606234"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1606234" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Chris Bobbe <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1606234">(Jul 07 2023 at 21:48)</a>:</h4>
<p>^ <span class="user-mention" data-user-id="27328">@Manuel</span> (@-mentioning so you see Alex's question.)</p>



<a name="1606292"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1606292" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1606292">(Jul 08 2023 at 01:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1605990">ha dicho</a>:</p>
<blockquote>
<p>To make sure I am understanding right -- when you enabled push notifications via <a href="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html">these instructions</a>, it broke file uploads on web and desktop?</p>
</blockquote>
<p>Indeed. Now I am doing another test because as I was telling you, it only happens to me in the mobile APP. Maybe the problem is giving me the antivirus. Sorry, for not having done it before, but I found it very strange that it happened only in the mobile application and not the desktop app</p>



<a name="1606300"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1606300" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1606300">(Jul 08 2023 at 03:20)</a>:</h4>
<p>I can come up with no way to explain an interaction between enabling push notifications, and breaking file uploads, so I suspect some other system (on the server, or the network the server is behind) is breaking things for you.</p>



<a name="1606429"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/image-upload%20malformed%20response/near/1606429" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Manuel <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/image-upload.20malformed.20response.html#1606429">(Jul 08 2023 at 14:53)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/image-upload.20malformed.20response/near/1606300">ha dicho</a>:</p>
<blockquote>
<p>I can come up with no way to explain an interaction between enabling push notifications, and breaking file uploads, so I suspect some other system (on the server, or the network the server is behind) is breaking things for you.</p>
</blockquote>
<p>Thanks for the tip, I'll check it out and see what happens. Your contributions helped me a lot. Thank you.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>