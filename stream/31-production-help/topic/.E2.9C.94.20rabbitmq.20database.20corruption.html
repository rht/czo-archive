<html>
<head><meta charset="utf-8"><title>✔ rabbitmq database corruption · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html">✔ rabbitmq database corruption</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="727882"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/727882" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#727882">(Apr 04 2019 at 04:58)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Reverting back to old Python is just two symlinks.  Easy.  (Learning that Zulip doesn't support Ubuntu 18.04's default version of python was the PITA)</p>



<a name="727887"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/727887" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#727887">(Apr 04 2019 at 05:48)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> </p>
<blockquote>
<p>I think given that you're on 2.0.x and have upgraded your database, what you should do is a fresh installation on Ubuntu 18.04, and then use our documented backup + restore procedure to migrate your data over to the newly installed system in a known-good state:</p>
</blockquote>
<p>Okay I did not see this before I responded earlier.  Okay I'll try this.</p>



<a name="727888"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/727888" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#727888">(Apr 04 2019 at 05:49)</a>:</h4>
<p>It was going to be my backup plan if you didn't have suggestions to start with.</p>



<a name="727889"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/727889" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#727889">(Apr 04 2019 at 05:49)</a>:</h4>
<p>But can you at least tell me how I can get some attention to the issues I post to GitHub?  Like this one: <a href="https://github.com/zulip/zulip/issues/11905" target="_blank" title="https://github.com/zulip/zulip/issues/11905">https://github.com/zulip/zulip/issues/11905</a></p>



<a name="727892"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/727892" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#727892">(Apr 04 2019 at 05:59)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> But please explain how a fresh install of Ubuntu 18.04 will prevent manual python install of 3.5 being necessary, since Zulip does not work with 3.6 and that is the default that comes with Ubuntu 18.04?</p>



<a name="728131"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728131" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728131">(Apr 04 2019 at 18:00)</a>:</h4>
<p><span class="user-mention" data-user-id="5955">@SSD</span> the answer is that Zulip does work with Python 3.6, it works with whatever version of Python the install/upgrade tool byte-compiled it against.</p>



<a name="728132"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728132" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728132">(Apr 04 2019 at 18:01)</a>:</h4>
<p>So when you did a <code>do-release-upgrade</code>, you upgraded the system Python version from 3.5 to 3.6, but didn't rebuild the Zulip virtualenv, so you had a bunch of Python modules built against Python 3.5 trying to run on 3.6.</p>



<a name="728133"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728133" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728133">(Apr 04 2019 at 18:01)</a>:</h4>
<p>We fully support 18.04; it's just that you need to do some extra extra stuff when doing an OS upgrade to update the Zulip installation.</p>



<a name="728134"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728134" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728134">(Apr 04 2019 at 18:02)</a>:</h4>
<p>(Similarly, with full-text search, upgrading to a new version of Ubuntu upgraded the postgres version, and there's things you need to do to update the database as well as install the appropriate Zulip full-text search extension)</p>



<a name="728143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728143">(Apr 04 2019 at 18:20)</a>:</h4>
<p>(And sorry I've been slow about responding this week; I've been quite sick)</p>



<a name="728407"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728407" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728407">(Apr 05 2019 at 05:32)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> </p>
<blockquote>
<p>We fully support 18.04; it's just that you need to do some extra extra stuff when doing an OS upgrade to update the Zulip installation.</p>
</blockquote>
<p>Okay <em>what extra stuff</em> and where do I find this?  Maybe I can re-store the symlinks to Python 3.6, run these upgrades, and be back to normal.</p>
<blockquote>
<p>and there's things you need to do to update the database as well as install the appropriate Zulip full-text search extension</p>
</blockquote>
<p>Okay.  Where is this stuff mentioned?   (I did update the PostGres database to 10)</p>
<p>Thank you for replying despite being sick.</p>



<a name="728451"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728451" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728451">(Apr 05 2019 at 07:28)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Okay I have worked on several things and I think I am close.  This is the current status.  Hopefull a simple question ("How to upgrade virtualenv from python3.5 to python3.6")</p>
<p><a href="https://github.com/zulip/zulip/issues/12065" target="_blank" title="https://github.com/zulip/zulip/issues/12065">https://github.com/zulip/zulip/issues/12065</a></p>



<a name="728740"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728740" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728740">(Apr 05 2019 at 19:54)</a>:</h4>
<p><span class="user-mention" data-user-id="5955">@SSD</span> cool, I believe for upgrading the virtualenv you roughly want to run <br>
<code>/home/zulip/deployments/current/scripts/setup/create-production-venv /home/zulip/deployments/current</code>.</p>



<a name="728743"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728743" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728743">(Apr 05 2019 at 19:56)</a>:</h4>
<p>It's possible there's a caching issue to work around manually, though; posted details on the issue thread.</p>



<a name="728982"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/728982" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#728982">(Apr 06 2019 at 04:54)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Many successes and a path between tickets leading back here: <a href="https://github.com/zulip/zulip/issues/12009" target="_blank" title="https://github.com/zulip/zulip/issues/12009">https://github.com/zulip/zulip/issues/12009</a>.  I think maybe everything is upgraded (ubuntu, python, zulip) but search still does not work.  We are not in "internal server error" territory now of course.</p>



<a name="729252"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/729252" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#729252">(Apr 06 2019 at 19:46)</a>:</h4>
<p><span class="user-mention" data-user-id="5955">@SSD</span> posted a comment that I think should resolve your issue.</p>



<a name="729478"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/729478" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#729478">(Apr 07 2019 at 04:53)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> replying there.  Thank you.</p>



<a name="732445"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/732445" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> SSD <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#732445">(Apr 13 2019 at 08:33)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> You saw my reply I hope.  We still can not use search and it is becoming a major problem.  We're talking migration and I want to avoid that.</p>



<a name="732531"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/732531" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#732531">(Apr 13 2019 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="5955">@SSD</span> if you're available to chat/debug interactively sometime today, that might accelerate things; otherwise, I am definitely going to do my own test of the OS upgrade workflow for our documentation today in any case.</p>



<a name="1204887"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1204887" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> amirreza ansari <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1204887">(Jun 09 2021 at 10:48)</a>:</h4>
<p>Hi, I installed Zulip on Ubuntu 20.04 then I configured the outgoing SMTP mail server setting and restarted the server. Now I face an Internal Server Error Message. I checked the error log file and here are the details. Would you please help me resolve this?</p>
<p>2021-06-09 09:15:21.862 WARN [zerver.lib.push_notifications] Mobile push notifications are not configured.<br>
  See <a href="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html">https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html</a><br>
2021-06-09 06:18:02,087 ERROR zproject.wsgi get_wsgi_application() failed:<br>
Traceback (most recent call last):<br>
  File "./zproject/wsgi.py", line 34, in &lt;module&gt;<br>
    application = get_wsgi_application()<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py", line 12, in get_wsgi_application<br>
    django.setup(set_prefix=False)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py", line 19, in setup<br>
    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 82, in __getattr__<br>
    self._setup(name)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 69, in _setup<br>
    self._wrapped = Settings(settings_module)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 170, in __init__<br>
    mod = importlib.import_module(self.SETTINGS_MODULE)<br>
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module<br>
    return _bootstrap._gcd_import(name[level:], package, level)<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 1014, in _gcd_import<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 991, in _find_and_load<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 975, in _find_and_load_unlocked<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 671, in _load_unlocked<br>
  File "&lt;frozen importlib._bootstrap_external&gt;", line 783, in exec_module<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 219, in _call_with_frames_removed<br>
  File "./zproject/settings.py", line 19, in &lt;module&gt;<br>
    from .configured_settings import *  # noqa: F401,F403 isort: skip<br>
  File "./zproject/configured_settings.py", line 8, in &lt;module&gt;<br>
    from .default_settings import *  # noqa: F401,F403 isort: skip<br>
  File "./zproject/default_settings.py", line 13, in &lt;module&gt;<br>
    from .prod_settings import EXTERNAL_HOST, ZULIP_ADMINISTRATOR<br>
  File "./zproject/prod_settings.py", line 61<br>
    Outgoing email (SMTP) settings.<br>
             ^<br>
SyntaxError: invalid syntax<br>
2021-06-09 06:21:15,364 ERROR zproject.wsgi get_wsgi_application() failed:<br>
Traceback (most recent call last):<br>
  File "./zproject/wsgi.py", line 34, in &lt;module&gt;<br>
    application = get_wsgi_application()<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py", line 12, in get_wsgi_application<br>
    django.setup(set_prefix=False)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py", line 19, in setup<br>
    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 82, in __getattr__<br>
    self._setup(name)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 69, in _setup<br>
    self._wrapped = Settings(settings_module)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 170, in __init__<br>
    mod = importlib.import_module(self.SETTINGS_MODULE)<br>
  File "/usr/lib/python3.8/importlib/__init__.py", line 127, in import_module<br>
    return _bootstrap._gcd_import(name[level:], package, level)<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 1014, in _gcd_import<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 991, in _find_and_load<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 975, in _find_and_load_unlocked<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 671, in _load_unlocked<br>
  File "&lt;frozen importlib._bootstrap_external&gt;", line 783, in exec_module<br>
  File "&lt;frozen importlib._bootstrap&gt;", line 219, in _call_with_frames_removed<br>
  File "./zproject/settings.py", line 19, in &lt;module&gt;<br>
    from .configured_settings import *  # noqa: F401,F403 isort: skip<br>
  File "./zproject/configured_settings.py", line 8, in &lt;module&gt;<br>
    from .default_settings import *  # noqa: F401,F403 isort: skip<br>
  File "./zproject/default_settings.py", line 13, in &lt;module&gt;<br>
    from .prod_settings import EXTERNAL_HOST, ZULIP_ADMINISTRATOR<br>
  File "./zproject/prod_settings.py", line 61<br>
    Outgoing email (SMTP) settings.<br>
             ^<br>
SyntaxError: invalid syntax<br>
2021-06-09 06:36:05,387 ERROR zproject.wsgi get_wsgi_application() failed:<br>
Traceback (most recent call last):<br>
  File "./zproject/wsgi.py", line 34, in &lt;module&gt;<br>
    application = get_wsgi_application()<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/core/wsgi.py", line 12, in get_wsgi_application<br>
    django.setup(set_prefix=False)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/__init__.py", line 19, in setup<br>
    configure_logging(settings.LOGGING_CONFIG, settings.LOGGING)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 82, in __getattr__<br>
    self._setup(name)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 69, in _setup<br>
    self._wrapped = Settings(settings_module)<br>
  File "/srv/zulip-venv-cache/32fcc960bfb7387aa422d8595f3e85936ecbc5eb/zulip-py3-venv/lib/python3.8/site-packages/django/conf/__init__.py", line 170, in __init__<br>
    mod = importlib.import_module(self.SETTINGS_MODULE)</p>



<a name="1205657"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1205657" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1205657">(Jun 10 2021 at 00:00)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/Internal.20Server.20error">#issues &gt; Internal Server error</a> by <span class="user-mention silent" data-user-id="7">Tim Abbott</span></p>



<a name="1205658"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1205658" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1205658">(Jun 10 2021 at 00:01)</a>:</h4>
<p><span class="user-mention" data-user-id="20664">@amirreza ansari</span> the problem is you seem to have removed the <code>#</code> comments before some of the documentation in the settings file, resulting in the format being invalid.</p>



<a name="1367967"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367967" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367967">(Apr 15 2022 at 22:27)</a>:</h4>
<p>Hello,<br>
We had just shutdown the server for a few minutes and then rebooted, the login screen shows, but when you press the login button it returns you to a page asking you to contact someone.</p>
<p>The Page says "<br>
Internal server error<br>
"</p>
<p>I ssh'ed into the server, and opened the log file, unfortunately it looks like there are alot of errors.</p>



<a name="1367968"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367968" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367968">(Apr 15 2022 at 22:28)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span></p>



<a name="1367969"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367969" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367969">(Apr 15 2022 at 22:30)</a>:</h4>
<p>Can you show the last ~50 lines of <code>/var/log/zulip/errors.log</code>?</p>



<a name="1367971"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367971" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367971">(Apr 15 2022 at 22:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1367969">said</a>:</p>
<blockquote>
<p>Can you show the last ~50 lines of <code>/var/log/zulip/errors.log</code>?</p>
</blockquote>
<p>sure, hold on..</p>



<a name="1367973"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367973" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367973">(Apr 15 2022 at 22:31)</a>:</h4>
<blockquote>
<blockquote>
<blockquote>
<p>Read 2648372 lines</p>
</blockquote>
</blockquote>
</blockquote>



<a name="1367978"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367978" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367978">(Apr 15 2022 at 22:33)</a>:</h4>
<p>You can show the last 50 lines of the file with:</p>
<div class="codehilite"><pre><span></span><code>tail -n50 /var/log/zulip/errors.log
</code></pre></div>



<a name="1367982"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367982" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367982">(Apr 15 2022 at 22:34)</a>:</h4>
<p>oh! thanks, here it is:<br>
2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>
2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>
2022-04-15 22:33:42.955 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...<br>
2022-04-15 22:33:43.250 ERR  [pika.adapters.utils.io_services_utils] Socket failed to connect: &lt;socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 35832)&gt;; error=111 (Connection refused)<br>
2022-04-15 22:33:43.251 ERR  [pika.adapters.utils.connection_workflow] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>
2022-04-15 22:33:43.253 ERR  [pika.adapters.utils.connection_workflow] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>
2022-04-15 22:33:43.257 ERR  [pika.adapters.utils.connection_workflow] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>
2022-04-15 22:33:43.259 ERR  [pika.adapters.utils.connection_workflow] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-04-15 22:33:43.261 ERR  [pika.adapters.blocking_connection] Connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-04-15 22:33:43.265 ERR  [pika.adapters.blocking_connection] Error in _create_connection().<br>
Traceback (most recent call last):<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py", line 451, in _create_connection<br>
    raise self._reap_last_connection_workflow_error(error)<br>
pika.exceptions.AMQPConnectionError<br>
2022-04-15 22:33:43.284 ERR  [process_queue] Unhandled exception from queue: invites<br>
Traceback (most recent call last):<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py", line 24, in log_and_exit_if_exception<br>
    yield<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py", line 106, in handle<br>
    worker.setup()<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/worker/queue_processors.py", line 400, in setup<br>
    self.q = SimpleQueueClient(prefetch=self.PREFETCH)<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py", line 44, in __init__<br>
    self._connect()<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py", line 142, in _connect<br>
    self.connection = pika.BlockingConnection(self._get_parameters())<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py", line 360, in __init__<br>
    self._impl = self._create_connection(parameters, _impl_class)<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py", line 451, in _create_connection<br>
    raise self._reap_last_connection_workflow_error(error)<br>
pika.exceptions.AMQPConnectionError<br>
Stack (most recent call last):<br>
  File "/home/zulip/deployments/current/manage.py", line 157, in &lt;module&gt;<br>
    execute_from_command_line(sys.argv)<br>
  File "/home/zulip/deployments/current/manage.py", line 122, in execute_from_command_line<br>
    utility.execute()<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py", line 413, in execute<br>
    self.fetch_command(subcommand).run_from_argv(self.argv)<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py", line 354, in run_from_argv<br>
    self.execute(*args, **cmd_options)<br>
  File "/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py", line 398, in execute<br>
    output = self.handle(*args, **options)<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py", line 111, in handle<br>
    worker.start()<br>
  File "/usr/lib/python3.8/contextlib.py", line 131, in __exit__<br>
    self.gen.throw(type, value, traceback)<br>
  File "/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py", line 26, in log_and_exit_if_exception<br>
    logger.exception("Unhandled exception from queue: %s", queue_name, stack_info=True)</p>



<a name="1367984"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367984" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367984">(Apr 15 2022 at 22:35)</a>:</h4>
<p>You can make that more readable by using code blocks:</p>
<div class="codehilite"><pre><span></span><code>```
put the log lines here
```
</code></pre></div>



<a name="1367986"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367986" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367986">(Apr 15 2022 at 22:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None.
2022-04-15 22:33:42.953 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None
2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None
2022-04-15 22:33:42.954 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None,)
2022-04-15 22:33:42.955 CRIT [zulip.queue:9800] TornadoQueueClient couldn&#39;t connect to RabbitMQ, retrying in 2 secs...
2022-04-15 22:33:43.250 ERR  [pika.adapters.utils.io_services_utils] Socket failed to connect: &lt;socket.socket fd=20, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=(&#39;127.0.0.1&#39;, 35832)&gt;; error=111 (Connection refused)
2022-04-15 22:33:43.251 ERR  [pika.adapters.utils.connection_workflow] TCP Connection attempt failed: ConnectionRefusedError(111, &#39;Connection refused&#39;); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, &#39;&#39;, (&#39;127.0.0.1&#39;, 5672))
2022-04-15 22:33:43.253 ERR  [pika.adapters.utils.connection_workflow] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;)
2022-04-15 22:33:43.257 ERR  [pika.adapters.utils.connection_workflow] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None.
2022-04-15 22:33:43.259 ERR  [pika.adapters.utils.connection_workflow] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None
2022-04-15 22:33:43.261 ERR  [pika.adapters.blocking_connection] Connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, &#39;Connection refused&#39;); first exception - None
2022-04-15 22:33:43.265 ERR  [pika.adapters.blocking_connection] Error in _create_connection().
Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 451, in _create_connection
    raise self._reap_last_connection_workflow_error(error)
pika.exceptions.AMQPConnectionError
2022-04-15 22:33:43.284 ERR  [process_queue] Unhandled exception from queue: invites
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 24, in log_and_exit_if_exception
    yield
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 106, in handle
    worker.setup()
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/worker/queue_processors.py&quot;, line 400, in setup
    self.q = SimpleQueueClient(prefetch=self.PREFETCH)
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py&quot;, line 44, in __init__
    self._connect()
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/lib/queue.py&quot;, line 142, in _connect
    self.connection = pika.BlockingConnection(self._get_parameters())
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 360, in __init__
    self._impl = self._create_connection(parameters, _impl_class)
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/pika/adapters/blocking_connection.py&quot;, line 451, in _create_connection
    raise self._reap_last_connection_workflow_error(error)
pika.exceptions.AMQPConnectionError
Stack (most recent call last):
  File &quot;/home/zulip/deployments/current/manage.py&quot;, line 157, in &lt;module&gt;
    execute_from_command_line(sys.argv)
  File &quot;/home/zulip/deployments/current/manage.py&quot;, line 122, in execute_from_command_line
    utility.execute()
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py&quot;, line 413, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 354, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/srv/zulip-venv-cache/726c7d1d35d9cd61bb4b70e98167a1db7b0c524d/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py&quot;, line 398, in execute
    output = self.handle(*args, **options)
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 111, in handle
    worker.start()
  File &quot;/usr/lib/python3.8/contextlib.py&quot;, line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File &quot;/home/zulip/deployments/2022-04-08-18-54-21/zerver/management/commands/process_queue.py&quot;, line 26, in log_and_exit_if_exception
    logger.exception(&quot;Unhandled exception from queue: %s&quot;, queue_name, stack_info=True)
</code></pre></div>



<a name="1367987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367987">(Apr 15 2022 at 22:36)</a>:</h4>
<p>But it looks like the RabbitMQ server didn't come up cleanly.</p>
<p>What version of Zulip are you running?  Did the hostname of the server change when you rebooted (i.e. is this in a VPS or similar situation where you get allocated a random hostname each time you reboot?)</p>



<a name="1367991"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367991" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367991">(Apr 15 2022 at 22:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1367987">said</a>:</p>
<blockquote>
<p>But it looks like the RabbitMQ server didn't come up cleanly.</p>
<p>What version of Zulip are you running?  Did the hostname of the server change when you rebooted (i.e. is this in a VPS or similar situation where you get allocated a random hostname each time you reboot?)</p>
</blockquote>
<p>Is there a command to pull up the version? No, it is a dedicated server, static ip and domain.. You can see here: <a href="http://chat.ehvengate.com">chat.ehvengate.com</a>, that it runs, just when you go to login, it returns the error</p>



<a name="1367994"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367994" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367994">(Apr 15 2022 at 22:40)</a>:</h4>
<p>You can get the version from:</p>
<div class="codehilite"><pre><span></span><code>head -n5 /home/zulip/deployments/current/version.py
</code></pre></div>



<a name="1367995"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367995" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367995">(Apr 15 2022 at 22:40)</a>:</h4>
<p>ZULIP_VERSION = "5.1"</p>



<a name="1367997"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367997" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367997">(Apr 15 2022 at 22:40)</a>:</h4>
<p>OK, great.</p>
<p>What does this show:</p>
<div class="codehilite"><pre><span></span><code>service rabbitmq-server status
</code></pre></div>



<a name="1367998"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1367998" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1367998">(Apr 15 2022 at 22:41)</a>:</h4>
<div class="codehilite"><pre><span></span><code>root@chat:~# service rabbitmq-server status
● rabbitmq-server.service - RabbitMQ Messaging Server
     Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)
     Active: activating (start) since Fri 2022-04-15 22:41:04 UTC; 3s ago
   Main PID: 1626535 (rabbitmq-server)
      Tasks: 89 (limit: 4599)
     Memory: 39.8M
     CGroup: /system.slice/rabbitmq-server.service
             ├─1626535 /bin/sh /usr/sbin/rabbitmq-server
             ├─1626548 /usr/lib/erlang/erts-10.6.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -MBlmbcs 512 -&gt;
             └─1626832 erl_child_setup 65536

Apr 15 22:41:04 chat systemd[1]: rabbitmq-server.service: Scheduled restart job, restart counter is at 3930.
Apr 15 22:41:04 chat systemd[1]: Stopped RabbitMQ Messaging Server.
Apr 15 22:41:04 chat systemd[1]: Starting RabbitMQ Messaging Server...
lines 1-14/14 (END)
</code></pre></div>



<a name="1368001"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368001" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368001">(Apr 15 2022 at 22:43)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span></p>



<a name="1368002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368002">(Apr 15 2022 at 22:43)</a>:</h4>
<p>No need to @ me, I'm following along.</p>



<a name="1368003"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368003" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368003">(Apr 15 2022 at 22:44)</a>:</h4>
<p>Let's see if rabbitmq will tell us more about why it's rebooting:</p>
<div class="codehilite"><pre><span></span><code>rabbitmqctl status
</code></pre></div>



<a name="1368007"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368007" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368007">(Apr 15 2022 at 22:45)</a>:</h4>
<p>Thanks, I am kind of nervous, I've got some people waiting on  me... I really appreciate your time:</p>
<div class="codehilite"><pre><span></span><code>Error: unable to perform an operation on node &#39;zulip@localhost&#39;. Please see diagnostics information and suggestions below.

Most common reasons for this are:

 * Target node is unreachable (e.g. due to hostname resolution, TCP connection or firewall issues)
 * CLI tool fails to authenticate with the server (e.g. due to CLI tool&#39;s Erlang cookie not matching that of the server)
 * Target node is not running

In addition to the diagnostics info below:

 * See the CLI, clustering and networking guides on https://rabbitmq.com/documentation.html to learn more
 * Consult server logs on node zulip@localhost
 * If target node is configured to use long node names, don&#39;t forget to use --longnames with CLI tools

DIAGNOSTICS
===========

attempted to contact: [zulip@localhost]

zulip@localhost:
  * connected to epmd (port 4369) on localhost
  * epmd reports: node &#39;zulip&#39; not running at all
                  no other nodes on localhost
  * suggestion: start the node

Current node details:
 * node name: &#39;rabbitmqcli-1630253-zulip@localhost&#39;
 * effective user&#39;s home directory: /var/lib/rabbitmq
 * Erlang cookie hash: LvrGBZIuQRyeeKxBDuFavw==
</code></pre></div>



<a name="1368009"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368009" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368009">(Apr 15 2022 at 22:47)</a>:</h4>
<p>Let's check the rabbitmq logs:</p>
<div class="codehilite"><pre><span></span><code>tail -n50 /var/log/rabbitmq/zulip@localhost.log
</code></pre></div>



<a name="1368010"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368010" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368010">(Apr 15 2022 at 22:47)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2022-04-15 22:47:08.055 [info] &lt;0.43.0&gt; Application ranch exited with reason: stopped
2022-04-15 22:47:08.057 [info] &lt;0.43.0&gt; Application observer_cli exited with reason: stopped
2022-04-15 22:47:08.058 [info] &lt;0.43.0&gt; Application sysmon_handler exited with reason: stopped
2022-04-15 22:47:08.062 [info] &lt;0.43.0&gt; Application os_mon exited with reason: stopped
2022-04-15 22:47:08.065 [info] &lt;0.43.0&gt; Application credentials_obfuscation exited with reason: stopped
2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application ssl exited with reason: stopped
2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application public_key exited with reason: stopped
2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application asn1 exited with reason: stopped
2022-04-15 22:47:08.070 [info] &lt;0.43.0&gt; Application recon exited with reason: stopped
2022-04-15 22:47:08.123 [info] &lt;0.43.0&gt; Application mnesia exited with reason: stopped
2022-04-15 22:47:08.127 [info] &lt;0.43.0&gt; Application inets exited with reason: stopped
2022-04-15 22:47:08.127 [info] &lt;0.43.0&gt; Application stdout_formatter exited with reason: stopped
2022-04-15 22:47:08.128 [info] &lt;0.43.0&gt; Application crypto exited with reason: stopped
2022-04-15 22:47:08.128 [info] &lt;0.43.0&gt; Application jsx exited with reason: stopped
2022-04-15 22:47:08.128 [error] &lt;0.8.0&gt;
Error description:
    init:do_boot/3
    init:start_em/1
    rabbit:start_it/1 line 474
    rabbit:broker_start/1 line 350
    rabbit:start_loaded_apps/2 line 600
    app_utils:manage_applications/6 line 126
    lists:foldl/3 line 1263
    rabbit:&#39;-handle_app_error/1-fun-0-&#39;/3 line 723
throw:{could_not_start,ra,
       {ra,
        {{shutdown,
          {failed_to_start_child,ra_system_sup,
           {shutdown,
            {failed_to_start_child,ra_log_sup,
             {shutdown,
              {failed_to_start_child,ra_log_wal_sup,
               {shutdown,
                {failed_to_start_child,ra_log_wal,
                 {{case_clause,{ok,&lt;&lt;&gt;&gt;}},
                  [{ra_log_wal,open_existing,1,
                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,646}]},
                   {ra_log_wal,&#39;-recover_wal/2-lc$^0/1-0-&#39;,1,
                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,265}]},
                   {ra_log_wal,recover_wal,2,
                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,268}]},
                   {ra_log_wal,init,1,
                    [{file,&quot;src/ra_log_wal.erl&quot;},{line,214}]},
                   {gen_batch_server,init_it,6,
                    [{file,&quot;src/gen_batch_server.erl&quot;},{line,133}]},
                   {proc_lib,init_p_do_apply,3,
                    [{file,&quot;proc_lib.erl&quot;},{line,249}]}]}}}}...
Log file(s) (may contain more information):
   /var/log/rabbitmq/zulip@localhost.log
   /var/log/rabbitmq/zulip@localhost_upgrade.log
</code></pre></div>



<a name="1368011"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368011" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368011">(Apr 15 2022 at 22:48)</a>:</h4>
<p>You may need to try a large value to <code>-n</code> to see if you can see something that looks more like the <em>reason</em> it's restarting.</p>



<a name="1368013"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368013" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368013">(Apr 15 2022 at 22:49)</a>:</h4>
<p>One possibility -- do you have free disk space:</p>
<div class="codehilite"><pre><span></span><code>df -h
</code></pre></div>



<a name="1368015"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368015" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368015">(Apr 15 2022 at 22:50)</a>:</h4>
<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>
<div class="codehilite"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on
udev                               1.9G     0  1.9G   0% /dev
tmpfs                              393M  1.4M  391M   1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /
tmpfs                              2.0G  204K  2.0G   1% /dev/shm
tmpfs                              5.0M     0  5.0M   0% /run/lock
tmpfs                              2.0G     0  2.0G   0% /sys/fs/cgroup
/dev/loop2                          62M   62M     0 100% /snap/core20/1405
/dev/loop0                          62M   62M     0 100% /snap/core20/1328
/dev/loop1                          68M   68M     0 100% /snap/lxd/22753
/dev/loop3                          44M   44M     0 100% /snap/snapd/14978
/dev/loop4                          44M   44M     0 100% /snap/snapd/15177
/dev/loop5                          68M   68M     0 100% /snap/lxd/21835
/dev/sda2                          1.5G  209M  1.2G  16% /boot
tmpfs                              393M     0  393M   0% /run/user/1000
</code></pre></div>



<a name="1368017"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368017" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368017">(Apr 15 2022 at 22:51)</a>:</h4>
<p>Yup, that's fine.</p>



<a name="1368019"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368019" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368019">(Apr 15 2022 at 22:52)</a>:</h4>
<p>Was this a sudden reboot, or a graceful one?  It's possible that the rabbitmq database got corrupted.</p>



<a name="1368026"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368026" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368026">(Apr 15 2022 at 22:54)</a>:</h4>
<p>We run a once a year graceful reboot on all of our machines, as a way to, clean, repair parts, clear extra cache, ect</p>



<a name="1368027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368027">(Apr 15 2022 at 22:54)</a>:</h4>
<p>it worked just fine last year</p>



<a name="1368031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368031">(Apr 15 2022 at 22:55)</a>:</h4>
<p>how would we check if the database was corrupted?</p>



<a name="1368035"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368035" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368035">(Apr 15 2022 at 22:56)</a>:</h4>
<p>and if it was, does that mean that we cannot transfer anything to a different server? is that the database that stores the messages, ect?</p>



<a name="1368036"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368036" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368036">(Apr 15 2022 at 22:56)</a>:</h4>
<p>I'm making assumptions based on the <code>/var/log/rabbitmq/zulip@localhost.log</code> output you pasted above.</p>



<a name="1368037"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368037" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368037">(Apr 15 2022 at 22:56)</a>:</h4>
<p>No, the rabbitmq database isn't the main database for Zulip.  If we have to recreate it, you won't lose any messages or anything.</p>



<a name="1368039"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368039" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368039">(Apr 15 2022 at 22:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368037">said</a>:</p>
<blockquote>
<p>No, the rabbitmq database isn't the main database for Zulip.  If we have to recreate it, you won't lose any messages or anything.</p>
</blockquote>
<p>would it hurt the system to try and recreate it?</p>



<a name="1368043"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368043" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368043">(Apr 15 2022 at 22:58)</a>:</h4>
<p>Shouldn't, but it won't necessarily solve the problem.  Let's give it a try:</p>
<div class="codehilite"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server
service rabbitmq-server stop
rm -rf /var/lib/rabbitmq/mnesia/
service rabbitmq-server start
~zulip/deployments/current/scripts/setup/configure-rabbitmq
sudo -u zulip ~zulip/deployments/current/scripts/start-server
</code></pre></div>



<a name="1368047"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368047" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368047">(Apr 15 2022 at 23:00)</a>:</h4>
<p>It Worked!</p>



<a name="1368048"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368048" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368048">(Apr 15 2022 at 23:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="23556">Josiah R</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368015">said</a>:</p>
<blockquote>
<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>
</blockquote>
<p>For reference, it looks like it only has 100G in its main disk:</p>
<div class="codehilite"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on
/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /
</code></pre></div>
<p>Which is fine, as 82G of it is unused, just correcting this statement.</p>



<a name="1368049"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368049" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368049">(Apr 15 2022 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-id="23556">@Josiah R</span>: OK, that means that the server wasn't actually cleanly shut down.</p>



<a name="1368050"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368050" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368050">(Apr 15 2022 at 23:01)</a>:</h4>
<p>its back up and running, thanks for your time.</p>



<a name="1368052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368052">(Apr 15 2022 at 23:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368049">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="23556">Josiah R</span>: OK, that means that the server wasn't actually cleanly shut down.</p>
</blockquote>
<p>it was shutdown by a technician, so could it have been something else?</p>



<a name="1368055"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368055" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368055">(Apr 15 2022 at 23:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368048">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="23556">Josiah R</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368015">said</a>:</p>
<blockquote>
<p>its running on one of our smaller systems, but it has 500 GB so it should be fine, as its a private server, right?</p>
</blockquote>
<p>For reference, it looks like it only has 100G in its main disk:</p>
<div class="codehilite"><pre><span></span><code>Filesystem                         Size  Used Avail Use% Mounted on
/dev/mapper/ubuntu--vg-ubuntu--lv   98G   12G   82G  13% /
</code></pre></div>
<p>Which is fine, as 82G of it is unused, just correcting this statement.</p>
</blockquote>
<p>that is intresting, I wounder where the other 400 GB's went?</p>



<a name="1368057"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368057" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368057">(Apr 15 2022 at 23:02)</a>:</h4>
<p>It can always be stray cosmic rays, but I suspect you can scroll back through the <code>/var/log/rabbitmq/zulip@localhost.log</code> and see where the trouble started.  It's likely it won't have orderly shutdown messages before the errors start.</p>



<a name="1368059"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368059" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368059">(Apr 15 2022 at 23:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368057">said</a>:</p>
<blockquote>
<p>It can always be stray cosmic rays, but I suspect you can scroll back through the <code>/var/log/rabbitmq/zulip@localhost.log</code> and see where the trouble started.  It's likely it won't have orderly shutdown messages before the errors start.</p>
</blockquote>
<p>ok, thanks</p>



<a name="1368060"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368060" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368060">(Apr 15 2022 at 23:03)</a>:</h4>
<p>But it'd be good to know if you can see anything in that area.  This is the second report we've gotten of rabbitmq database corruption recently, so digging a little deeper into the logs would be appreciated.</p>



<a name="1368074"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368074" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368074">(Apr 15 2022 at 23:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368060">said</a>:</p>
<blockquote>
<p>But it'd be good to know if you can see anything in that area.  This is the second report we've gotten of rabbitmq database corruption recently, so digging a little deeper into the logs would be appreciated.</p>
</blockquote>
<p>ok, how could I do that without holding the down button for about 15 minutes?</p>



<a name="1368076"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368076" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368076">(Apr 15 2022 at 23:06)</a>:</h4>
<p>You can run:</p>
<div class="codehilite"><pre><span></span><code>less /var/log/rabbitmq/zulip@localhost.log
</code></pre></div>
<p>Then, you can use pageup / pagedown.  Though what I'd suggest is typing <code>/</code>, which lets you search in the file.  Then type the date that the trouble started (<code>2022-04-15</code>, or earlier if it didn't start today), and press enter; that will jump to the first line that matches that.  You should be able to scroll around that more easily.</p>



<a name="1368084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368084">(Apr 15 2022 at 23:11)</a>:</h4>
<p>looking through the file, it seems that it would keep restarting, and clossing connections unexpectedly</p>



<a name="1368086"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368086" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368086">(Apr 15 2022 at 23:12)</a>:</h4>
<p>just that part of the file is too big to put into one message, so if you want, I can slit it up into multiple messages.</p>



<a name="1368088"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368088" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368088">(Apr 15 2022 at 23:12)</a>:</h4>
<p>Yup.  What we want to know is what the logs say right at the cusp of when it <em>started</em> doing that.</p>



<a name="1368089"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368089" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368089">(Apr 15 2022 at 23:13)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2022-04-11 15:41:20.378 [info] &lt;0.662.0&gt; connection &lt;0.662.0&gt; (127.0.0.1:39684 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-11 15:41:23.717 [info] &lt;0.674.0&gt; accepting AMQP connection &lt;0.674.0&gt; (127.0.0.1:39692 -&gt; 127.0.0.1:5672)
2022-04-11 15:41:23.720 [info] &lt;0.674.0&gt; connection &lt;0.674.0&gt; (127.0.0.1:39692 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-11 15:41:38.889 [info] &lt;0.698.0&gt; accepting AMQP connection &lt;0.698.0&gt; (127.0.0.1:39706 -&gt; 127.0.0.1:5672)
2022-04-11 15:41:38.892 [info] &lt;0.698.0&gt; connection &lt;0.698.0&gt; (127.0.0.1:39706 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-11 15:41:39.190 [info] &lt;0.708.0&gt; accepting AMQP connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672)
2022-04-11 15:41:39.192 [info] &lt;0.708.0&gt; connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-11 15:42:19.862 [warning] &lt;0.611.0&gt; closing AMQP connection &lt;0.611.0&gt; (127.0.0.1:39666 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):
client unexpectedly closed TCP connection
2022-04-11 15:42:20.222 [warning] &lt;0.562.0&gt; closing AMQP connection &lt;0.562.0&gt; (127.0.0.1:39642 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):
client unexpectedly closed TCP connection
2022-04-11 15:42:20.354 [warning] &lt;0.544.0&gt; closing AMQP connection &lt;0.544.0&gt; (127.0.0.1:39632 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):
client unexpectedly closed TCP connection
2022-04-11 15:42:20.379 [warning] &lt;0.589.0&gt; closing AMQP connection &lt;0.589.0&gt; (127.0.0.1:39652 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):
client unexpectedly closed TCP connection
2022-04-11 15:42:20.418 [warning] &lt;0.662.0&gt; closing AMQP connection &lt;0.662.0&gt; (127.0.0.1:39684 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;):
client unexpectedly closed TCP connection
</code></pre></div>



<a name="1368090"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368090" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368090">(Apr 15 2022 at 23:13)</a>:</h4>
<div class="codehilite"><pre><span></span><code>2022-04-11 15:42:26.422 [info] &lt;0.64.0&gt; SIGTERM received - shutting down
2022-04-11 15:42:26.422 [info] &lt;0.323.0&gt; Peer discovery backend rabbit_peer_discovery_classic_config does not support registration, skipping unregistration.
2022-04-11 15:42:26.423 [info] &lt;0.513.0&gt; stopped TCP listener on 127.0.0.1:5672
2022-04-11 15:42:26.428 [error] &lt;0.708.0&gt; Error on AMQP connection &lt;0.708.0&gt; (127.0.0.1:39716 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 15:42:26.429 [info] &lt;0.401.0&gt; Closing all connections in vhost &#39;/&#39; on node &#39;zulip@localhost&#39; because the vhost is stopping
2022-04-11 15:42:26.678 [info] &lt;0.416.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39;
2022-04-11 15:42:26.735 [info] &lt;0.416.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39; is stopped
2022-04-11 15:42:26.735 [info] &lt;0.413.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39;
2022-04-11 15:42:26.852 [info] &lt;0.413.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39; is stopped
2022-04-11 15:45:25.777 [info] &lt;0.8.0&gt; Log file opened with Lager
2022-04-11 15:45:37.820 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:
2022-04-11 15:45:37.820 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings
2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue
2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata
2022-04-11 15:45:37.821 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes
2022-04-11 15:45:38.314 [info] &lt;0.298.0&gt; ra: meta data store initialised. 0 record(s) recovered
2022-04-11 15:45:38.315 [info] &lt;0.313.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000004.wal&quot;]
2022-04-11 15:45:38.405 [info] &lt;0.317.0&gt;
</code></pre></div>



<a name="1368091"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368091" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368091">(Apr 15 2022 at 23:13)</a>:</h4>
<p>That's pretty normal.  What we care about is what happens between then and the first line which has <code>error</code> on it.</p>



<a name="1368092"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368092" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368092">(Apr 15 2022 at 23:14)</a>:</h4>
<p>this is when it shut down</p>



<a name="1368093"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368093" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368093">(Apr 15 2022 at 23:14)</a>:</h4>
<p>Yeah, that's not an orderly shutdown</p>



<a name="1368094"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368094" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368094">(Apr 15 2022 at 23:15)</a>:</h4>
<p>ok, here you are:</p>
<div class="codehilite"><pre><span></span><code>2022-04-11 19:05:01.771 [info] &lt;0.64.0&gt; SIGTERM received - shutting down
2022-04-11 19:05:01.870 [info] &lt;0.330.0&gt; Peer discovery backend rabbit_peer_discovery_classic_config does not support registration, skipping unregistration.
2022-04-11 19:05:01.936 [info] &lt;0.503.0&gt; stopped TCP listener on 127.0.0.1:5672
2022-04-11 19:05:01.964 [error] &lt;0.620.0&gt; Error on AMQP connection &lt;0.620.0&gt; (127.0.0.1:35760 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.964 [error] &lt;0.528.0&gt; Error on AMQP connection &lt;0.528.0&gt; (127.0.0.1:35718 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.964 [error] &lt;0.663.0&gt; Error on AMQP connection &lt;0.663.0&gt; (127.0.0.1:35780 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.964 [error] &lt;0.538.0&gt; Error on AMQP connection &lt;0.538.0&gt; (127.0.0.1:35722 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.964 [error] &lt;0.799.0&gt; Error on AMQP connection &lt;0.799.0&gt; (127.0.0.1:35804 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.964 [error] &lt;0.557.0&gt; Error on AMQP connection &lt;0.557.0&gt; (127.0.0.1:35732 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.548.0&gt; Error on AMQP connection &lt;0.548.0&gt; (127.0.0.1:35728 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.575.0&gt; Error on AMQP connection &lt;0.575.0&gt; (127.0.0.1:35740 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.611.0&gt; Error on AMQP connection &lt;0.611.0&gt; (127.0.0.1:35756 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.1685.0&gt; Error on AMQP connection &lt;0.1685.0&gt; (127.0.0.1:35820 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.2188.0&gt; Error on AMQP connection &lt;0.2188.0&gt; (127.0.0.1:35828 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.966 [error] &lt;0.638.0&gt; Error on AMQP connection &lt;0.638.0&gt; (127.0.0.1:35768 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.966 [error] &lt;0.629.0&gt; Error on AMQP connection &lt;0.629.0&gt; (127.0.0.1:35764 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.566.0&gt; Error on AMQP connection &lt;0.566.0&gt; (127.0.0.1:35736 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.513.0&gt; Error on AMQP connection &lt;0.513.0&gt; (127.0.0.1:35710 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:01.965 [error] &lt;0.2769.0&gt; Error on AMQP connection &lt;0.2769.0&gt; (127.0.0.1:35854 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 0:
 operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
</code></pre></div>
<p>little farther down in the file</p>



<a name="1368096"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368096" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368096">(Apr 15 2022 at 23:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code>operation none caused a connection exception connection_forced: &quot;broker forced connection closure with reason &#39;shutdown&#39;&quot;
2022-04-11 19:05:06.965 [error] &lt;0.592.0&gt; ** Generic server &lt;0.592.0&gt; terminating
** Last message in was {&#39;EXIT&#39;,&lt;0.591.0&gt;,killed}
** When Server state == {state,{&lt;0.592.0&gt;,rabbit_connection_helper_sup},one_for_one,[{child,&lt;0.599.0&gt;,channel_sup_sup,{rabbit_channel_sup_sup,start_link,[]},intrinsic,infinity,supervisor,[rabbit_channel_sup_sup]},{child,&lt;0.597.0&gt;,collec&gt;** Reason for termination ==
** killed
2022-04-11 19:05:06.965 [error] &lt;0.592.0&gt; CRASH REPORT Process &lt;0.592.0&gt; with 0 neighbours exited with reason: killed in gen_server:decode_msg/9 line 432
2022-04-11 19:05:07.018 [info] &lt;0.391.0&gt; Closing all connections in vhost &#39;/&#39; on node &#39;zulip@localhost&#39; because the vhost is stopping
2022-04-11 19:05:07.509 [error] &lt;0.593.0&gt; Error on AMQP connection &lt;0.593.0&gt; (127.0.0.1:35750 -&gt; 127.0.0.1:5672, vhost: &#39;/&#39;, user: &#39;zulip&#39;, state: running), channel 1:error while terminating:
shutdown
2022-04-11 19:05:07.509 [warning] &lt;0.391.0&gt; Could not close connection &lt;0.593.0&gt;: {{noproc,{gen_server,call,[&lt;0.597.0&gt;,delete_all,infinity]}},{gen_server,call,[&lt;0.593.0&gt;,{shutdown,&quot;vhost &#39;/&#39; is down&quot;},infinity]}}
2022-04-11 19:05:07.509 [error] &lt;0.593.0&gt; CRASH REPORT Process &lt;0.593.0&gt; with 0 neighbours exited with reason: no such process or port in call to gen_server:call(&lt;0.597.0&gt;, delete_all, infinity) in gen_server:call/3 line 223
2022-04-11 19:05:07.538 [info] &lt;0.406.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39;
2022-04-11 19:05:08.171 [info] &lt;0.406.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_persistent&#39; is stopped
2022-04-11 19:05:08.171 [info] &lt;0.403.0&gt; Stopping message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39;
2022-04-11 19:05:09.355 [info] &lt;0.403.0&gt; Message store for directory &#39;/var/lib/rabbitmq/mnesia/zulip@localhost/msg_stores/vhosts/628WB79CIFDYO9LJI6DKMI09L/msg_store_transient&#39; is stopped
2022-04-11 19:06:38.117 [info] &lt;0.8.0&gt; Log file opened with Lager
2022-04-11 19:06:50.265 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:
2022-04-11 19:06:50.265 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings
2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue
2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata
2022-04-11 19:06:50.266 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes
2022-04-11 19:06:50.888 [info] &lt;0.299.0&gt; ra: meta data store initialised. 0 record(s) recovered
2022-04-11 19:06:50.889 [info] &lt;0.313.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000006.wal&quot;]
2022-04-11 19:06:50.946 [info] &lt;0.323.0&gt;
</code></pre></div>



<a name="1368100"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368100" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368100">(Apr 15 2022 at 23:18)</a>:</h4>
<p>Let me digest that a little.</p>
<p>When you say "it was shutdown by a technician" what technique did they use to shut it down?</p>



<a name="1368101"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368101" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368101">(Apr 15 2022 at 23:19)</a>:</h4>
<p>And does <code>2022-04-11 19:05:06</code> match when you think the host was shut down (in UTC)?</p>



<a name="1368102"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368102" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368102">(Apr 15 2022 at 23:19)</a>:</h4>
<p>used the zulip shutdown command you gave me, then shutdown ubuntu</p>



<a name="1368103"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368103" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368103">(Apr 15 2022 at 23:19)</a>:</h4>
<p>OK, and when you shutdown ubuntu, how did that happen?</p>



<a name="1368108"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368108" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368108">(Apr 15 2022 at 23:21)</a>:</h4>
<p>systemctl shutdown</p>



<a name="1368109"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368109" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368109">(Apr 15 2022 at 23:22)</a>:</h4>
<p>it ran through its normal process of shutting down all the packages and other things</p>



<a name="1368113"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368113" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368113">(Apr 15 2022 at 23:25)</a>:</h4>
<p>as to your later message.. not sure what you mean</p>



<a name="1368114"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368114" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368114">(Apr 15 2022 at 23:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368101">said</a>:</p>
<blockquote>
<p>And does <code>2022-04-11 19:05:06</code> match when you think the host was shut down (in UTC)?</p>
</blockquote>
<p>I think so</p>



<a name="1368115"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368115" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368115">(Apr 15 2022 at 23:27)</a>:</h4>
<p>The timestamps for the section of the rabbitmq log we're looking at are <code>2022-04-11 19:05:06</code>.   That time is given in UTC (the time in Greenwich, England, roughly -- pedants, don't @ me).</p>
<p>The question is if these error messages line up with the time that you shut the machine off, or if they're from some other event.   So I was asking you if <code>2022-04-11 19:05:06 UTC</code> matches when you believe the host was restarted.</p>



<a name="1368116"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368116" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368116">(Apr 15 2022 at 23:27)</a>:</h4>
<p>Ah, OK.</p>



<a name="1368118"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368118" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368118">(Apr 15 2022 at 23:28)</a>:</h4>
<p>how can I download the log file to my local machine using ssh? then I can just send it to you</p>



<a name="1368121"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368121" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368121">(Apr 15 2022 at 23:30)</a>:</h4>
<p><a href="https://linux.die.net/man/1/scp">scp</a>:</p>
<div class="codehilite"><pre><span></span><code>scp username@hostname:/path/to/file /path/to/local/file
</code></pre></div>



<a name="1368126"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368126" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368126">(Apr 15 2022 at 23:35)</a>:</h4>
<div class="codehilite"><pre><span></span><code>scp: /var/log/rabbitmq/zulip@localhost.log: Permission denied
</code></pre></div>



<a name="1368132"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368132" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368132">(Apr 15 2022 at 23:36)</a>:</h4>
<p>do I need to be logged into the server?</p>



<a name="1368133"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368133" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368133">(Apr 15 2022 at 23:37)</a>:</h4>
<p>No, it's likely that you're connecting as a non-<code>root</code> user, which doesn't have read access to the logfile.</p>



<a name="1368136"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368136" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368136">(Apr 15 2022 at 23:37)</a>:</h4>
<p>I do <em>not</em> suggest fixing this by adjusting the file's permissions.</p>



<a name="1368139"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368139" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368139">(Apr 15 2022 at 23:38)</a>:</h4>
<p>As root, you can make a copy which you make readable by your user:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>sudo -i
cp /var/log/rabbitmq/zulip@localhost.log ~username/rabbitmq.log
chown username ~username/rabbitmq.log
</code></pre></div>



<a name="1368150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368150">(Apr 15 2022 at 23:44)</a>:</h4>
<p>I got it. I wonder why the other way didn't work, I am root...<br>
its uploading...</p>



<a name="1368153"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368153" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368153">(Apr 15 2022 at 23:46)</a>:</h4>
<p><a href="/user_uploads/2/ba/4vTmBDEkbMvJk8nXE0Xj1Kvo/rabbitmq.zip">rabbitmq.zip</a></p>



<a name="1368154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368154">(Apr 15 2022 at 23:46)</a>:</h4>
<p>here it is</p>



<a name="1368160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368160">(Apr 15 2022 at 23:51)</a>:</h4>
<p>If i wanted to become a zulip developer, on the team, what would I have to do?</p>



<a name="1368161"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368161" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368161">(Apr 15 2022 at 23:51)</a>:</h4>
<p>Thanks!</p>
<p>OK, so this gap right here is when it was shut down so abruptly that it didn't log anything about the shutdown:</p>
<div class="codehilite"><pre><span></span><code>2022-04-13 23:35:14.881 [info] &lt;0.299.6&gt; accepting AMQP connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672)
2022-04-13 23:35:14.884 [info] &lt;0.299.6&gt; connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-14 12:43:32.796 [info] &lt;0.17025.7&gt; accepting AMQP connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672)
2022-04-14 12:43:32.908 [info] &lt;0.17025.7&gt; connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
2022-04-14 17:11:45.096 [info] &lt;0.1101.8&gt; accepting AMQP connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672)
2022-04-14 17:11:45.106 [info] &lt;0.1101.8&gt; connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost &#39;/&#39;
---------------------------- here --------------------------
2022-04-14 19:31:59.900 [info] &lt;0.8.0&gt; Log file opened with Lager
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes
2022-04-14 19:32:12.724 [info] &lt;0.192.0&gt; disk_log: repairing &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/DECISION_TAB.LOG&quot; ...
2022-04-14 19:32:12.953 [info] &lt;0.308.0&gt; ra: meta data store initialised. 0 record(s) recovered
2022-04-14 19:32:12.955 [info] &lt;0.323.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000008.wal&quot;]
2022-04-14 19:32:12.955 [error] &lt;0.322.0&gt; Supervisor ra_log_wal_sup had child ra_log_wal started with ra_log_wal:start_link(#{compute_checksums =&gt; true,dir =&gt; &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@local...&quot;,...}, [{max_batch_size,32768}]) at undefined exit with reason no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in context start_error
2022-04-14 19:32:12.955 [error] &lt;0.323.0&gt; CRASH REPORT Process &lt;0.323.0&gt; with 0 neighbours exited with reason: no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in gen_batch_server:init_it/6 line 165
</code></pre></div>



<a name="1368162"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368162" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368162">(Apr 15 2022 at 23:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368161">said</a>:</p>
<blockquote>
<p>Thanks!</p>
<p>OK, so this gap right here is when it was shut down so abruptly that it didn't log anything about the shutdown:</p>
<p><div class="codehilite"><pre><span></span><code>2022-04-13 23:35:14.881 [info] &lt;0.299.6&gt; accepting AMQP connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672)
2022-04-13 23:35:14.884 [info] &lt;0.299.6&gt; connection &lt;0.299.6&gt; (127.0.0.1:40448 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhost
&#39;/&#39;
2022-04-14 12:43:32.796 [info] &lt;0.17025.7&gt; accepting AMQP connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672)
2022-04-14 12:43:32.908 [info] &lt;0.17025.7&gt; connection &lt;0.17025.7&gt; (127.0.0.1:40558 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vh
ost &#39;/&#39;
2022-04-14 17:11:45.096 [info] &lt;0.1101.8&gt; accepting AMQP connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672)
2022-04-14 17:11:45.106 [info] &lt;0.1101.8&gt; connection &lt;0.1101.8&gt; (127.0.0.1:40948 -&gt; 127.0.0.1:5672): user &#39;zulip&#39; authenticated and granted access to vhos
t &#39;/&#39;
2022-04-14 19:31:59.900 [info] &lt;0.8.0&gt; Log file opened with Lager
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: list of feature flags found:
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] implicit_default_bindings
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] quorum_queue
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags:   [x] virtual_host_metadata
2022-04-14 19:32:12.413 [info] &lt;0.8.0&gt; Feature flags: feature flag states written to disk: yes
2022-04-14 19:32:12.724 [info] &lt;0.192.0&gt; disk_log: repairing &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/DECISION_TAB.LOG&quot; ...
2022-04-14 19:32:12.953 [info] &lt;0.308.0&gt; ra: meta data store initialised. 0 record(s) recovered
2022-04-14 19:32:12.955 [info] &lt;0.323.0&gt; WAL: recovering [&quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@localhost/00000008.wal&quot;]
2022-04-14 19:32:12.955 [error] &lt;0.322.0&gt; Supervisor ra_log_wal_sup had child ra_log_wal started with ra_log_wal:start_link(#{compute_checksums =&gt; true,di
r =&gt; &quot;/var/lib/rabbitmq/mnesia/zulip@localhost/quorum/zulip@local...&quot;,...}, [{max_batch_size,32768}]) at undefined exit with reason no case clause matchin
g {ok,&lt;&lt;&gt;&gt;} in ra_log_wal:open_existing/1 line 646 in context start_error
2022-04-14 19:32:12.955 [error] &lt;0.323.0&gt; CRASH REPORT Process &lt;0.323.0&gt; with 0 neighbours exited with reason: no case clause matching {ok,&lt;&lt;&gt;&gt;} in ra_log
_wal:open_existing/1 line 646 in gen_batch_server:init_it/6 line 165
</code></pre></div><br>
</p>
</blockquote>
<p>interesting, we'll have to be more careful about that in the future</p>



<a name="1368163"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368163" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368163">(Apr 15 2022 at 23:54)</a>:</h4>
<p>You can possibly go digging in the system logs (e.g. <code>/var/log/syslog</code>) at that same time to see if the whole system was shut down uncleanly, or if it somehow just killed rabbitmq uncleanly.</p>



<a name="1368164"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368164" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368164">(Apr 15 2022 at 23:54)</a>:</h4>
<p>What would I have to know/do to become a part of the zulip team? I know some python, and nodejs have been working in html, css, js for over 4 years</p>



<a name="1368165"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368165" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368165">(Apr 15 2022 at 23:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368163">said</a>:</p>
<blockquote>
<p>You can possibly go digging in the system logs (e.g. <code>/var/log/syslog</code>) at that same time to see if the whole system was shut down uncleanly, or if it somehow just killed rabbitmq uncleanly.</p>
</blockquote>
<p>ok</p>



<a name="1368166"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368166" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368166">(Apr 15 2022 at 23:54)</a>:</h4>
<p><a href="https://zulip.readthedocs.io/en/latest/overview/contributing.html">https://zulip.readthedocs.io/en/latest/overview/contributing.html</a> is a great place to get started.</p>



<a name="1368167"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368167" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368167">(Apr 15 2022 at 23:55)</a>:</h4>
<p>I'm going to mark this as resolved, but don't hesitate to start another topic if you run into other problems or have other questions.</p>



<a name="1368169"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368169" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josiah R <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368169">(Apr 15 2022 at 23:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/500.20error.20on.20login/near/1368167">said</a>:</p>
<blockquote>
<p>I'm going to mark this as resolved, but don't hesitate to start another topic if you run into other problems or have other questions.</p>
</blockquote>
<p>ok, Thanks</p>



<a name="1368171"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368171" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368171">(Apr 15 2022 at 23:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> has marked this topic as resolved.</p>



<a name="1368372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368372">(Apr 16 2022 at 12:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption/near/1368043">said</a>:</p>
<blockquote>
<p>Shouldn't, but it won't necessarily solve the problem.  Let's give it a try:</p>
<p><div class="codehilite"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server
service rabbitmq-server stop
rm -rf /var/lib/rabbitmq/mnesia/
service rabbitmq-server start
~zulip/deployments/current/scripts/setup/configure-rabbitmq
sudo -u zulip ~zulip/deployments/current/scripts/start-server
</code></pre></div><br>
</p>
</blockquote>
<p>Out of curiosity, what was the reason for <code>rm -rf /var/lib/rabbitmq/mnesia/</code>? (the other steps are much more obvious, this one looks a bit mysterious <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> )</p>



<a name="1368414"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368414" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368414">(Apr 16 2022 at 16:20)</a>:</h4>
<p>That directory is the RabbitMQ database, so deleting it is a way to reset the RabbitMQ state fully.</p>



<a name="1368473"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1368473" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1368473">(Apr 16 2022 at 19:40)</a>:</h4>
<p>Ah, makes sense</p>



<a name="1392395"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392395" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392395">(Jun 14 2022 at 11:24)</a>:</h4>
<p>hii</p>



<a name="1392400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392400">(Jun 14 2022 at 11:27)</a>:</h4>
<p>hii</p>



<a name="1392401"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392401" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392401">(Jun 14 2022 at 11:28)</a>:</h4>
<p>i just restart the server than error is coming Internal server error</p>



<a name="1392402"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392402" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392402">(Jun 14 2022 at 11:30)</a>:</h4>
<p>can any one help</p>



<a name="1392403"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392403" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392403">(Jun 14 2022 at 11:43)</a>:</h4>
<p>hi</p>



<a name="1392404"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392404" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392404">(Jun 14 2022 at 11:43)</a>:</h4>
<p>Internal server error</p>



<a name="1392405"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392405" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392405">(Jun 14 2022 at 11:47)</a>:</h4>
<p>hi</p>



<a name="1392406"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392406" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392406">(Jun 14 2022 at 11:54)</a>:</h4>
<p>hii</p>



<a name="1392407"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392407" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392407">(Jun 14 2022 at 11:54)</a>:</h4>
<p>hii</p>



<a name="1392408"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392408" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392408">(Jun 14 2022 at 11:54)</a>:</h4>
<p>Internal server error</p>



<a name="1392415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392415">(Jun 14 2022 at 13:08)</a>:</h4>
<p>hii</p>



<a name="1392416"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392416" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392416">(Jun 14 2022 at 13:08)</a>:</h4>
<p>This Zulip server is currently experiencing some technical difficulties. Sorry about that!</p>



<a name="1392417"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392417" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392417">(Jun 14 2022 at 13:08)</a>:</h4>
<p>can any one please help here</p>



<a name="1392510"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392510" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392510">(Jun 14 2022 at 17:37)</a>:</h4>
<p><span class="user-mention" data-user-id="24295">@Azure IT Support</span>: I have moved all of your messages here, to one stream and topic.</p>
<p>Please read our <a href="https://zulip.com/development-community/">community guidelines</a> -- posting to a bunch of random topic is not the right way to get help -- posting to a single topic with as many relevant details as you have, is.  And help may not be immediate -- folks are in different time zones (I only just woke up) and may not be around to help.</p>



<a name="1392513"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392513" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392513">(Jun 14 2022 at 17:38)</a>:</h4>
<p>You should log in via SSH to your server, and look at the last lines from <code>/var/log/zulip/errors.log</code>:</p>
<div class="codehilite"><pre><span></span><code>tail -n 100 /var/log/zulip/errors.log
</code></pre></div>



<a name="1392628"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392628" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392628">(Jun 15 2022 at 03:58)</a>:</h4>
<p>2022-06-15 03:57:46.015 WARN [zulip.queue:9800] TornadoQueueClient attempting to reconnect to RabbitMQ<br>
2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.io_services_utils:9800] Socket failed to connect: &lt;socket.socket fd=22, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 51386)&gt;; error=111 (Connection refused)<br>
2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.connection_workflow:9800] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>
2022-06-15 03:57:46.020 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>
2022-06-15 03:57:46.021 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>
2022-06-15 03:57:46.021 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-06-15 03:57:46.021 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-06-15 03:57:46.021 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>
2022-06-15 03:57:46.021 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...</p>



<a name="1392629"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392629" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392629">(Jun 15 2022 at 04:12)</a>:</h4>
<p><span class="user-mention" data-user-id="24295">@Azure IT Support</span>: For future reference, it's good practice to put log out put and such things in <a href="https://zulip.com/help/format-your-message-using-markdown#code">code blocks</a>.</p>
<p>It looks like RabbitMQ isn't running.</p>
<p>As root, try:</p>
<div class="codehilite"><pre><span></span><code>service rabbitmq-server start
</code></pre></div>



<a name="1392630"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392630" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392630">(Jun 15 2022 at 04:18)</a>:</h4>
<p>Job for rabbitmq-server.service failed because the control process exited with error code.<br>
See "systemctl status rabbitmq-server.service" and "journalctl -xe" for details.</p>



<a name="1392631"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392631" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392631">(Jun 15 2022 at 04:18)</a>:</h4>
<p>when i do service rabbitmq-server start</p>



<a name="1392653"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392653" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392653">(Jun 15 2022 at 06:47)</a>:</h4>
<p><span class="user-mention" data-user-id="24295">@Azure IT Support</span>: OK, so time to look at the rabbitmq logs.</p>
<p>Look at <code>/var/log/rabbitmq/startup_log</code> and the last page of <code>/var/log/rabbitmq/zulip@localhost.log</code></p>



<a name="1392654"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392654" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392654">(Jun 15 2022 at 06:52)</a>:</h4>
<p>-bash: /var/log/rabbitmq/startup_log: Permission denied from both user (local &amp; root)</p>



<a name="1392655"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392655" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392655">(Jun 15 2022 at 06:53)</a>:</h4>
<p>when i /var/log/rabbitmq/startup_log</p>



<a name="1392656"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392656" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392656">(Jun 15 2022 at 06:53)</a>:</h4>
<p>Sorry, by "look at" I mean using something that shows the contents, like:</p>
<div class="codehilite"><pre><span></span><code>cat /var/log/rabbitmq/startup_log
</code></pre></div>



<a name="1392657"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392657" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392657">(Jun 15 2022 at 06:54)</a>:</h4>
<p>{"init terminating in do_boot",{could_not_start,ra,{ra,{{shutdown,{failed_to_start_child,ra_system_sup,{shutdown,{failed_to_start_child,ra_log_sup,{shutdown,{failed_to_start_child,ra_log_wal_sup,{shutdown,{failed_to_start_child,ra_log_wal,{{case_clause,{ok,&lt;&lt;&gt;&gt;}},[{ra_log_wal,open_existing,1,[{file,"src/ra_log_wal.erl"},{line,646}]},{ra_log_wal,'-recover_wal/2-lc$^0/1-0-',1,[{file,"src/ra_log_wal.erl"},{line,265}]},{ra_log_wal,recover_wal,2,[{file,"src/ra_log_wal.erl"},{line,268}]},{ra_log_wal,init,1,[{file,"src/ra_log_wal.erl"},{line,214}]},{gen_batch_server,init_it,6,[{file,"src/gen_batch_server.erl"},{line,133}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,249}]}]}}}}}}}}},{ra_app,start,[normal,[]]}}}}}</p>



<a name="1392658"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392658" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392658">(Jun 15 2022 at 06:54)</a>:</h4>
<p>Did you shut this server down cleanly?  That looks like rabbitmq database corruption.</p>



<a name="1392659"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392659" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392659">(Jun 15 2022 at 06:55)</a>:</h4>
<p>no not shutdown properly</p>



<a name="1392660"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392660" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392660">(Jun 15 2022 at 06:55)</a>:</h4>
<p>some power issue in this server</p>



<a name="1392661"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392661" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392661">(Jun 15 2022 at 06:55)</a>:</h4>
<p>how ro repair  rabbitmq database corruption</p>



<a name="1392662"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392662" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392662">(Jun 15 2022 at 06:56)</a>:</h4>
<p>OK, that's likely the problem.</p>
<p>Give this a shot:</p>
<div class="codehilite"><pre><span></span><code>sudo -u zulip ~zulip/deployments/current/scripts/stop-server
service rabbitmq-server stop
rm -rf /var/lib/rabbitmq/mnesia/
service rabbitmq-server start
~zulip/deployments/current/scripts/setup/configure-rabbitmq
sudo -u zulip ~zulip/deployments/current/scripts/start-server
</code></pre></div>



<a name="1392663"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392663" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392663">(Jun 15 2022 at 06:56)</a>:</h4>
<p>my data lost ?????????</p>



<a name="1392664"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392664" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392664">(Jun 15 2022 at 06:56)</a>:</h4>
<p>No.  Rabbitmq doesn't store any data that is necessary</p>



<a name="1392665"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392665" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392665">(Jun 15 2022 at 06:57)</a>:</h4>
<p>we have 100+ user configured</p>



<a name="1392666"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392666" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392666">(Jun 15 2022 at 06:57)</a>:</h4>
<p>The real message data is stored in PostgreSQL, which is much more resilient to this</p>



<a name="1392667"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392667" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392667">(Jun 15 2022 at 06:57)</a>:</h4>
<p>This will not lose any of your user data, or users.</p>



<a name="1392668"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392668" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392668">(Jun 15 2022 at 06:57)</a>:</h4>
<p>my all stream and private message not ifected</p>



<a name="1392669"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392669" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392669">(Jun 15 2022 at 06:58)</a>:</h4>
<p>Correct, they will not be affected.</p>



<a name="1392670"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392670" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392670">(Jun 15 2022 at 06:58)</a>:</h4>
<p>ok</p>



<a name="1392671"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392671" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392671">(Jun 15 2022 at 06:58)</a>:</h4>
<p>Think of RabbitMQ as being the pipes that Zulip uses to tell clients that they have new messages waiting.  We're recreating the pipes.  The real data is elsewhere.</p>



<a name="1392672"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392672" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392672">(Jun 15 2022 at 06:59)</a>:</h4>
<p>we will do and let you know...</p>



<a name="1392673"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392673" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392673">(Jun 15 2022 at 06:59)</a>:</h4>
<p>(this <em>will</em> throw away some information that was in the pipes, but that information ("tell user A's browser there's a new message") is very out of date and not relevant anymore)</p>



<a name="1392674"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392674" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392674">(Jun 15 2022 at 07:00)</a>:</h4>
<p>web page is not opening</p>



<a name="1392675"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392675" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392675">(Jun 15 2022 at 07:00)</a>:</h4>
<p>error : This Zulip server is currently experiencing some technical difficulties. Sorry about that!</p>



<a name="1392676"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392676" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392676">(Jun 15 2022 at 07:01)</a>:</h4>
<p>OK, so start from the top of the debugging process again.  What does <code>/var/log/zulip/errors.log</code> have in it?</p>



<a name="1392677"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392677" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392677">(Jun 15 2022 at 07:01)</a>:</h4>
<div class="codehilite"><pre><span></span><code>tail -n50 /var/log/zulip/errors.log
</code></pre></div>



<a name="1392678"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392678" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392678">(Jun 15 2022 at 07:02)</a>:</h4>
<p>2022-06-15 07:02:19.325 WARN [zulip.queue:9800] TornadoQueueClient attempting to reconnect to RabbitMQ<br>
2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.io_services_utils:9800] Socket failed to connect: &lt;socket.socket fd=22, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 33462)&gt;; error=111 (Connection refused)<br>
2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.connection_workflow:9800] TCP Connection attempt failed: ConnectionRefusedError(111, 'Connection refused'); dest=(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 6, '', ('127.0.0.1', 5672))<br>
2022-06-15 07:02:19.330 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnector - reporting failure: AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused')<br>
2022-06-15 07:02:19.331 ERR  [pika.adapters.utils.connection_workflow:9800] AMQP connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None.<br>
2022-06-15 07:02:19.331 ERR  [pika.adapters.utils.connection_workflow:9800] AMQPConnectionWorkflow - reporting failure: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-06-15 07:02:19.331 ERR  [pika.adapters.base_connection:9800] Full-stack connection workflow failed: AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None<br>
2022-06-15 07:02:19.331 ERR  [pika.adapters.base_connection:9800] Self-initiated stack bring-up failed: AMQPConnectionError: (AMQPConnectionWorkflowFailed: 1 exceptions in all; last exception - AMQPConnectorSocketConnectError: ConnectionRefusedError(111, 'Connection refused'); first exception - None,)<br>
2022-06-15 07:02:19.332 CRIT [zulip.queue:9800] TornadoQueueClient couldn't connect to RabbitMQ, retrying in 2 secs...</p>



<a name="1392679"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392679" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392679">(Jun 15 2022 at 07:03)</a>:</h4>
<p>OK, so rabbitmq still.  What does this say about rabbitmq being running:</p>
<div class="codehilite"><pre><span></span><code>service rabbitmq-server status
</code></pre></div>



<a name="1392680"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392680" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392680">(Jun 15 2022 at 07:04)</a>:</h4>
<p>rabbitmq-server.service - RabbitMQ Messaging Server<br>
     Loaded: loaded (/lib/systemd/system/rabbitmq-server.service; enabled; vendor preset: enabled)<br>
     Active: activating (auto-restart) (Result: exit-code) since Wed 2022-06-15 07:03:47 UTC; 2s ago<br>
    Process: 332972 ExecStart=/usr/sbin/rabbitmq-server (code=exited, status=1/FAILURE)<br>
   Main PID: 332972 (code=exited, status=1/FAILURE)</p>



<a name="1392681"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392681" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392681">(Jun 15 2022 at 07:05)</a>:</h4>
<p>sudo -u zulip ~zulip/deployments/current/scripts/stop-server<br>
service rabbitmq-server stop<br>
rm -rf /var/lib/rabbitmq/mnesia/<br>
service rabbitmq-server start<br>
~zulip/deployments/current/scripts/setup/configure-rabbitmq<br>
sudo -u zulip ~zulip/deployments/current/scripts/start-server</p>



<a name="1392682"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392682" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392682">(Jun 15 2022 at 07:05)</a>:</h4>
<div class="codehilite"><pre><span></span><code> we need to run those commands???????
</code></pre></div>



<a name="1392683"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392683" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392683">(Jun 15 2022 at 07:06)</a>:</h4>
<p>You need to run all of those commands, yes.</p>



<a name="1392684"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392684" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392684">(Jun 15 2022 at 07:06)</a>:</h4>
<p>but my data and stream not affecated ???</p>



<a name="1392685"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392685" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392685">(Jun 15 2022 at 07:07)</a>:</h4>
<p>personal message and all</p>



<a name="1392686"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392686" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392686">(Jun 15 2022 at 07:08)</a>:</h4>
<p>becuase so many personal messages and stream messages in this server</p>



<a name="1392687"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392687" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392687">(Jun 15 2022 at 07:08)</a>:</h4>
<p>Again, those commands will not affect any of your data.</p>



<a name="1392688"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392688" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392688">(Jun 15 2022 at 07:09)</a>:</h4>
<p>Your data is not lost, and running those commands will not delete it.</p>



<a name="1392689"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392689" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392689">(Jun 15 2022 at 07:09)</a>:</h4>
<p>ok...we will check and let you know..</p>



<a name="1392690"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392690" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392690">(Jun 15 2022 at 07:09)</a>:</h4>
<p>thank you so much for help</p>



<a name="1392691"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392691" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392691">(Jun 15 2022 at 07:10)</a>:</h4>
<p>Much appreciated.</p>



<a name="1392692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392692">(Jun 15 2022 at 07:12)</a>:</h4>
<p>You're welcome.</p>
<p>In the future, it's also helpful to think about, and tell folks, any potentially relevant facts.  Like "the server was improperly shut down." <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1392693"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392693" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Azure IT Support <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392693">(Jun 15 2022 at 07:13)</a>:</h4>
<p>sure <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="1392694"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20rabbitmq%20database%20corruption/near/1392694" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20rabbitmq.20database.20corruption.html#1392694">(Jun 15 2022 at 07:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>