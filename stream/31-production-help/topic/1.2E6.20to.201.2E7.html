<html>
<head><meta charset="utf-8"><title>1.6 to 1.7 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html">1.6 to 1.7</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="304531"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304531" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304531">(Oct 25 2017 at 18:03)</a>:</h4>
<p><a href="https://blog.zulip.org/2017/10/25/zulip-server-1-7-released/" target="_blank" title="https://blog.zulip.org/2017/10/25/zulip-server-1-7-released/">https://blog.zulip.org/2017/10/25/zulip-server-1-7-released/</a></p>
<div class="codehilite"><pre><span></span>We’ve removed support for an uncommon legacy deployment model where a Zulip server served multiple organizations (“realms”) on the same domain. Installs with multiple realms now require each realm to have its own subdomain.
</pre></div>



<a name="304532"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304532" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304532">(Oct 25 2017 at 18:03)</a>:</h4>
<p>oh no!</p>



<a name="304533"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304533" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304533">(Oct 25 2017 at 18:04)</a>:</h4>
<p>I'm heavily reliant on having multiple realms!</p>



<a name="304534"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304534" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304534">(Oct 25 2017 at 18:04)</a>:</h4>
<p>what do I do when upgrading?</p>



<a name="304535"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304535" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304535">(Oct 25 2017 at 18:04)</a>:</h4>
<p>I run both my company production zulip, and my personal family &amp; friends zulip on <code>zulip.sweeting.me</code></p>



<a name="304536"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304536" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304536">(Oct 25 2017 at 18:04)</a>:</h4>
<p>how can I safely upgrade without breaking zulip for everyone?</p>



<a name="304542"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304542" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304542">(Oct 25 2017 at 18:08)</a>:</h4>
<p><span class="user-mention" data-user-email="git@nicksweeting.com" data-user-id="2356">@Nick Sweeting</span> howdy!  What I'd recommend is moving each organization to their own (sub)domain on the server.</p>



<a name="304544"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304544" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304544">(Oct 25 2017 at 18:10)</a>:</h4>
<p>We're actually soon going to add support for having the domains not be related; so perhaps what I'd recommend is that you wait for that and then move the work one to e.g. <code>zulip.example.com</code>, while leaving your friends/family one on <code>zulip.sweeting.me</code></p>



<a name="304547"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304547" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304547">(Oct 25 2017 at 18:10)</a>:</h4>
<p>I was about to propose the same thing</p>



<a name="304548"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304548" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304548">(Oct 25 2017 at 18:10)</a>:</h4>
<p><a href="http://zulip.sweeting.me" target="_blank" title="http://zulip.sweeting.me">zulip.sweeting.me</a> for personal, and <a href="http://zulip.monadical.com" target="_blank" title="http://zulip.monadical.com">zulip.monadical.com</a> for work</p>



<a name="304550"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304550" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304550">(Oct 25 2017 at 18:11)</a>:</h4>
<p>other than that, looks like a sweet upgrade, great work everyone who contributed!</p>



<a name="304552"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304552" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304552">(Oct 25 2017 at 18:11)</a>:</h4>
<p>OK, cool.  <a href="https://github.com/zulip/zulip/pull/7116" target="_blank" title="https://github.com/zulip/zulip/pull/7116">https://github.com/zulip/zulip/pull/7116</a> is what you want to follow.</p>



<a name="304554"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304554" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304554">(Oct 25 2017 at 18:12)</a>:</h4>
<p>I'm happy to help you with the bit of mechanics for switching to that once it's merged.</p>



<a name="304555"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304555" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304555">(Oct 25 2017 at 18:12)</a>:</h4>
<p>thanks, much appreciated!</p>



<a name="304615"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304615" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304615">(Oct 25 2017 at 20:51)</a>:</h4>
<p><span class="user-mention" data-user-email="git@nicksweeting.com" data-user-id="2356">@Nick Sweeting</span> Good to know! That support should be out in the next couple of days. :-)</p>



<a name="304667"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/304667" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Nick Sweeting <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#304667">(Oct 25 2017 at 21:42)</a>:</h4>
<p>Cool, thanks a ton for your work on that <span class="user-mention" data-user-email="greg@zulipchat.com" data-user-id="2187">@Greg Price</span>, no rush, we're quite happy on 1.6 for now.  Let me know if you want help testing any particular scenario.  My userbase is not very demanding, so I'm ok with some downtime while migrating to 1.7 and testing out the new realms/domains system.</p>



<a name="306250"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306250" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306250">(Oct 29 2017 at 14:50)</a>:</h4>
<p>I tried to upgrade from 1.6 to 1.7, but encountered an error.</p>



<a name="306251"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306251" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306251">(Oct 29 2017 at 14:50)</a>:</h4>
<p>This is a part of what was shown:</p>
<div class="codehilite"><pre><span></span>+ pip install --no-deps --requirement /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt
Collecting pyoembed==0.1.1.zulip1 from git+https://github.com/zulip/pyoembed.git@d6d34a6a73404ef6bffe79109da68feb224ef8c6#egg=pyoembed==0.1.1.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 10))
  Cloning https://github.com/zulip/pyoembed.git (to d6d34a6a73404ef6bffe79109da68feb224ef8c6) to /tmp/pip-build-48p2xl6r/pyoembed
  Could not find a tag or branch &#39;d6d34a6a73404ef6bffe79109da68feb224ef8c6&#39;, assuming commit.
  Requested pyoembed==0.1.1.zulip1 from git+https://github.com/zulip/pyoembed.git@d6d34a6a73404ef6bffe79109da68feb224ef8c6#egg=pyoembed==0.1.1.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 10)), but installing version None
Collecting talon==1.2.10.zulip1 from git+https://github.com/zulip/talon.git@7d8bdc4dbcfcc5a73298747293b99fe53da55315#egg=talon==1.2.10.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 11))
  Cloning https://github.com/zulip/talon.git (to 7d8bdc4dbcfcc5a73298747293b99fe53da55315) to /tmp/pip-build-48p2xl6r/talon
  Could not find a tag or branch &#39;7d8bdc4dbcfcc5a73298747293b99fe53da55315&#39;, assuming commit.
    Complete output from command python setup.py egg_info:
    Traceback (most recent call last):
      File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
      File &quot;/tmp/pip-build-48p2xl6r/talon/setup.py&quot;, line 9, in &lt;module&gt;
        long_description=open(&quot;README.rst&quot;).read(),
      File &quot;/srv/zulip-venv-cache/28c46b2610f25e461725004503a2f0e9dc80c1a7/zulip-py3-venv/lib/python3.5/encodings/ascii.py&quot;, line 26, in decode
        return codecs.ascii_decode(input, self.errors)[0]
    UnicodeDecodeError: &#39;ascii&#39; codec can&#39;t decode byte 0xe2 in position 475: ordinal not in range(128)

    ----------------------------------------
Command &quot;python setup.py egg_info&quot; failed with error code 1 in /tmp/pip-build-48p2xl6r/talon/

Error running a subcommand of /home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/create-production-venv: pip install --no-deps --requirement /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt
Actual error output for the subcommand is just above this.

`pip install` failed; retrying...
+ pip install -U --requirement /home/zulip/deployments/2017-10-29-18-10-20/requirements/pip.txt
Requirement already up-to-date: setuptools==36.5.0 in /srv/zulip-venv-cache/28c46b2610f25e461725004503a2f0e9dc80c1a7/zulip-py3-venv/lib/python3.5/site-packages (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/pip.txt (line 2))
Requirement already up-to-date: pip==9.0.1 in /srv/zulip-venv-cache/28c46b2610f25e461725004503a2f0e9dc80c1a7/zulip-py3-venv/lib/python3.5/site-packages (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/pip.txt (line 3))
Requirement already up-to-date: wheel==0.30.0 in /srv/zulip-venv-cache/28c46b2610f25e461725004503a2f0e9dc80c1a7/zulip-py3-venv/lib/python3.5/site-packages (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/pip.txt (line 4))
+ pip install --no-deps --requirement /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt
Collecting pyoembed==0.1.1.zulip1 from git+https://github.com/zulip/pyoembed.git@d6d34a6a73404ef6bffe79109da68feb224ef8c6#egg=pyoembed==0.1.1.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 10))
  Cloning https://github.com/zulip/pyoembed.git (to d6d34a6a73404ef6bffe79109da68feb224ef8c6) to /tmp/pip-build-rrig_0sw/pyoembed
  Could not find a tag or branch &#39;d6d34a6a73404ef6bffe79109da68feb224ef8c6&#39;, assuming commit.
  Requested pyoembed==0.1.1.zulip1 from git+https://github.com/zulip/pyoembed.git@d6d34a6a73404ef6bffe79109da68feb224ef8c6#egg=pyoembed==0.1.1.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 10)), but installing version None
Collecting talon==1.2.10.zulip1 from git+https://github.com/zulip/talon.git@7d8bdc4dbcfcc5a73298747293b99fe53da55315#egg=talon==1.2.10.zulip1 (from -r /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt (line 11))
  Cloning https://github.com/zulip/talon.git (to 7d8bdc4dbcfcc5a73298747293b99fe53da55315) to /tmp/pip-build-rrig_0sw/talon
  Could not find a tag or branch &#39;7d8bdc4dbcfcc5a73298747293b99fe53da55315&#39;, assuming commit.
    Complete output from command python setup.py egg_info:
    Traceback (most recent call last):
      File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
      File &quot;/tmp/pip-build-rrig_0sw/talon/setup.py&quot;, line 9, in &lt;module&gt;
        long_description=open(&quot;README.rst&quot;).read(),
      File &quot;/srv/zulip-venv-cache/28c46b2610f25e461725004503a2f0e9dc80c1a7/zulip-py3-venv/lib/python3.5/encodings/ascii.py&quot;, line 26, in decode
        return codecs.ascii_decode(input, self.errors)[0]
    UnicodeDecodeError: &#39;ascii&#39; codec can&#39;t decode byte 0xe2 in position 475: ordinal not in range(128)

    ----------------------------------------
Command &quot;python setup.py egg_info&quot; failed with error code 1 in /tmp/pip-build-rrig_0sw/talon/

Error running a subcommand of /home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/create-production-venv: pip install --no-deps --requirement /home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt
Actual error output for the subcommand is just above this.

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/setup_venv.py&quot;, line 256, in do_setup_virtualenv
    install_venv_deps(requirements_file)
  File &quot;/home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/setup_venv.py&quot;, line 44, in install_venv_deps
    run([&quot;pip&quot;, &quot;install&quot;, &quot;--no-deps&quot;, &quot;--requirement&quot;, requirements_file])
  File &quot;/home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/zulip_tools.py&quot;, line 173, in run
    subprocess.check_call(args, **kwargs)
  File &quot;/usr/lib/python3.5/subprocess.py&quot;, line 581, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;pip&#39;, &#39;install&#39;, &#39;--no-deps&#39;, &#39;--requirement&#39;, &#39;/home/zulip/deployments/2017-10-29-18-10-20/requirements/prod_lock.txt&#39;]&#39; returned non-zero exit status 1

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/create-production-venv&quot;, line 31, in &lt;module&gt;
    virtualenv_args=[&#39;-p&#39;, &#39;python{}&#39;.format(python_version)])
  File &quot;/home/zulip/deployments/2017-10-29-18-10-20/scripts/lib/setup_venv.py&quot;, line 223, in setup_virtualenv
    do_setup_virtualenv(cached_venv_path, requirements_file, virtualenv_args or [])
</pre></div>



<a name="306257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306257">(Oct 29 2017 at 15:05)</a>:</h4>
<p>One quick theory is that either <code>pip</code> or <code>python</code> is still pointing at python2.</p>



<a name="306262"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306262" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306262">(Oct 29 2017 at 15:08)</a>:</h4>
<p>So... What can I do?</p>



<a name="306263"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306263" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306263">(Oct 29 2017 at 15:09)</a>:</h4>
<p>I think the first step is to see if my theory is even true, so do something like <code>pip -v</code> to see what version of <code>pip</code> is running.  Also, any info about your configuration can help us troubleshoot this.</p>



<a name="306264"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306264" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306264">(Oct 29 2017 at 15:11)</a>:</h4>
<p>Another possibility is that there's something wrong with the<code>talon</code> package.</p>



<a name="306267"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306267" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306267">(Oct 29 2017 at 16:40)</a>:</h4>
<p><code>pip 9.0.1 from /usr/local/lib/python2.7/dist-packages (python 2.7)</code><br>
Seems like it is true!</p>



<a name="306269"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306269" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306269">(Oct 29 2017 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span></p>



<a name="306270"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306270" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306270">(Oct 29 2017 at 17:02)</a>:</h4>
<p>Hrm...glad to know that was it, but I wish I knew the production install better to know why that happened for you. <span class="emoji emoji-1f626" title="frowning">:frowning:</span></p>



<a name="306271"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306271" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306271">(Oct 29 2017 at 17:03)</a>:</h4>
<p>Are you in a hurry to finish, or can you wait for other folks to see this?  I'd like to know why this happens, so we can prevent it for others.  (If you're in a hurry, the workaround is probably to manually upgrade pip.)</p>



<a name="306276"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306276" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306276">(Oct 29 2017 at 17:20)</a>:</h4>
<p>No. My server seems to be running pretty smoothly. I'll wait.</p>



<a name="306315"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306315" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306315">(Oct 29 2017 at 18:46)</a>:</h4>
<p><span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span> I don't think pip being Python 2 is plausible; that's running in a Python 3 virtualenv.</p>



<a name="306317"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306317" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306317">(Oct 29 2017 at 18:48)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> I think the problem has to do with locale; try setting <code>export LC_ALL=en_US.UTF-8</code> first...</p>



<a name="306318"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306318" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306318">(Oct 29 2017 at 18:49)</a>:</h4>
<p>Do I always have to do that thing?</p>



<a name="306320"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306320" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306320">(Oct 29 2017 at 18:49)</a>:</h4>
<p>No the fix is <a href="https://github.com/zulip/zulip/commit/11ab545f3b989c667d337b11000514bcc2dad43d" target="_blank" title="https://github.com/zulip/zulip/commit/11ab545f3b989c667d337b11000514bcc2dad43d">11ab545f3b989c667d337b11000514bcc2dad43d</a>; apparently we failed to merge that for the 1.7 release.</p>



<a name="306322"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306322" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306322">(Oct 29 2017 at 18:49)</a>:</h4>
<p>So just this one time.</p>



<a name="306323"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306323" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306323">(Oct 29 2017 at 18:50)</a>:</h4>
<p>Thanks Tim.</p>



<a name="306339"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306339" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306339">(Oct 29 2017 at 19:01)</a>:</h4>
<p>And one other thing. Why is "Upgrading from Zulip 1.6 and older" under "Upgrading from a git repository" in <a href="https://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older" target="_blank" title="https://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older">here</a>?</p>



<a name="306341"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306341" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306341">(Oct 29 2017 at 19:06)</a>:</h4>
<p>And I think I found a bug in the updater script. It deleted my previous installation. I think that the first time it tried to install (which failed) it created an installation folder, and the second time it created another one, and it only kept the 2 newest ones (so it deleted my previous installation).</p>



<a name="306342"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306342" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306342">(Oct 29 2017 at 19:08)</a>:</h4>
<p>Before the second attempt, <code>current</code> was correctly set to the previous installation folder. And now, <code>last</code> is set to the same folder (and is now broken).</p>



<a name="306347"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306347" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306347">(Oct 29 2017 at 19:19)</a>:</h4>
<p>hmm, I just checked out the code and we are by default purging deployments older than 14 days. I think the criteria for recent deployments might need a bit improvement?</p>



<a name="306348"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306348" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306348">(Oct 29 2017 at 19:20)</a>:</h4>
<p>I think so. Because I now lost my older deployment, and the current one is broken!!</p>



<a name="306350"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306350" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306350">(Oct 29 2017 at 19:29)</a>:</h4>
<p>thinking about it, its an interesting problem to solve, since if we do something like exclude the n most recent deployments from the purge process irrespective of there publish date, a user might still end up purging that deployment by kind of trying out n number of faulty upgrades without the knowledge that they might end up purging there only working deployment.<br>
Probably something with folder name could work. eg: folder name such as deployment date_status(working|non-working) and then saying exclude most recent working deployment from purge irrespective of everything.</p>



<a name="306354"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306354" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306354">(Oct 29 2017 at 19:34)</a>:</h4>
<p>what do you think about it <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> ?</p>



<a name="306355"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306355" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306355">(Oct 29 2017 at 19:34)</a>:</h4>
<p>I think that we should exclude the one pointed at by <code>current</code> at least.</p>



<a name="306358"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306358" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306358">(Oct 29 2017 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> we exclude the ones pointed to by current/last/next, as well as any that are less than 2 weeks old.  But I think maybe we should also exclude any that have been <strong>used</strong> in the last 2 weeks, if we can figure out how to detect that?</p>



<a name="306360"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306360" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306360">(Oct 29 2017 at 19:36)</a>:</h4>
<p>Or are you saying that somehow <code>last</code> got deleted?</p>



<a name="306362"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306362" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306362">(Oct 29 2017 at 19:36)</a>:</h4>
<p>Yes, <code>last</code> is deleted. It is in red in <code>ls -l</code>.</p>



<a name="306364"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306364" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306364">(Oct 29 2017 at 19:37)</a>:</h4>
<p>OK, that sounds like a bug; the endpoint of the <code>last</code> symlink should not ever be deleted.  <span class="user-mention" data-user-email="harshitbansal2015@gmail.com" data-user-id="907">@Harshit Bansal</span> FYI, can you investigate?</p>



<a name="306365"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306365" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306365">(Oct 29 2017 at 19:37)</a>:</h4>
<p>Re: this: <a href="https://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older" target="_blank" title="https://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older">https://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading-from-zulip-1-6-and-older</a>, those docs are only for upgrading from Git where the old version is 1.6 or older.  I'll see if I can edit that to make it clear.</p>



<a name="306367"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306367" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306367">(Oct 29 2017 at 19:38)</a>:</h4>
<p>You mean that I shouldn't have done it?</p>



<a name="306368"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306368" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Harshit Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306368">(Oct 29 2017 at 19:38)</a>:</h4>
<p>Weird! Looking into it...</p>



<a name="306371"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306371" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306371">(Oct 29 2017 at 19:41)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> it's fine to have done it, but you don't need to unless you're installing from Git.</p>



<a name="306407"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/1.6%20to%201.7/near/306407" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Harshit Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/1.2E6.20to.201.2E7.html#306407">(Oct 29 2017 at 20:26)</a>:</h4>
<p>Fixed the deployment purging script in <a href="https://github.com/zulip/zulip/pull/7218" target="_blank" title="https://github.com/zulip/zulip/pull/7218">#7218</a>.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>