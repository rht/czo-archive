<html>
<head><meta charset="utf-8"><title>Upgrade from 4.9. to 6.0 ? · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html">Upgrade from 4.9. to 6.0 ?</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1492987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1492987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1492987">(Jan 19 2023 at 18:30)</a>:</h4>
<p>Hi, is it possible to upgrade directly from 4.9. to 6.0 (Ubuntu 20.04) ? Thanks</p>



<a name="1492988"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1492988" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1492988">(Jan 19 2023 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="11118">@Stefan Meyer</span>: Yup.  <a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-to-a-release">https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-to-a-release</a> should get you started.</p>



<a name="1492989"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1492989" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1492989">(Jan 19 2023 at 18:32)</a>:</h4>
<p><span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span> <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="1495070"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495070" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495070">(Jan 23 2023 at 19:06)</a>:</h4>
<p>I've made an upgrade to Zulip 6.0/Ubuntu 22.04 from  Zulip 4.9./Ubuntu 18.04  step by step. Everthing seems to work, by no I get a large number of these messages in /var/log/syslog: </p>
<div class="codehilite"><pre><span></span><code>puppet-agent[1108]: Could not request certificate: Failed to open TCP connection to puppet:8140 (getaddrinfo: Temporary failure in name resolution)
</code></pre></div>



<a name="1495080"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495080" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495080">(Jan 23 2023 at 19:14)</a>:</h4>
<p>Hmm, the configuration file /etc/puppet/puppet.conf seems to be wrong, /var/lib/puppet/ssl/ca does not exist</p>



<a name="1495087"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495087" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495087">(Jan 23 2023 at 19:22)</a>:</h4>
<p>Those are all only relevant if you're using a central puppet server, which we're not.</p>



<a name="1495088"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495088" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495088">(Jan 23 2023 at 19:26)</a>:</h4>
<p>I've changed to netplan, perhaps this is the reason</p>
<div class="codehilite"><pre><span></span><code> ping puppet
ping: puppet: Temporary failure in name resolution
</code></pre></div>



<a name="1495124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495124">(Jan 23 2023 at 19:48)</a>:</h4>
<p>Let me try to explain better -- <code>puppet</code> has two modes of operation, one where you hand it a manifest directly, and the other where it connects to a central server who hands it the right manifest based on some properties.  Zulip uses the former; however, in installing it to do that, we also get the <code>puppet</code> system service, which tries to do the latter.  By default, it assumes that your central Puppet server is named <code>puppet</code> -- that's what it's trying and failing to look up in that warning.</p>
<p>This warning is harmless.  It's not related to netplan, as far I would guess.</p>
<p>Regardless, we potentially should disable the <code>puppet</code> service so it doesn't try and fail to reach a <code>puppet</code> server repeatedly.  Ironically, we'd probably do this within our puppet configuration.</p>



<a name="1495143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495143">(Jan 23 2023 at 20:00)</a>:</h4>
<blockquote>
<p>This warning is harmless.  It's not related to netplan, as far I would guess.</p>
</blockquote>
<p>Ok thanks, but I get the message every two minutes in /var/log/syslog</p>



<a name="1495146"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495146" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495146">(Jan 23 2023 at 20:02)</a>:</h4>
<p>You can run <code>systemctl disable puppet</code> if that's an issue.</p>



<a name="1495154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Stefan Meyer <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495154">(Jan 23 2023 at 20:05)</a>:</h4>
<p>Now puppet is disabled <span aria-label="+1" class="emoji emoji-1f44d" role="img" title="+1">:+1:</span></p>



<a name="1495178"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495178" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495178">(Jan 23 2023 at 20:26)</a>:</h4>
<p>Pushed <a href="https://github.com/zulip/zulip/pull/24148">#24148</a>.</p>



<a name="1495542"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1495542" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1495542">(Jan 24 2023 at 02:11)</a>:</h4>
<p>Hmm, I worry that this will break anyone's configuration that is using <code>puppet</code> to manage their own non-Zulip-related configuration (SSH keys, logging configuration, etc. -- the sorts of things that one might manage for one's entire fleet centrally).</p>
<p>We don't want to start/run the puppet daemon ourselves, but won't this stop the puppet daemon on every Zulip upgrade even if the installation is using puppet.</p>



<a name="1496066"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496066" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496066">(Jan 24 2023 at 19:01)</a>:</h4>
<p>I don't know that we really expect that configuration to work?  I guess it might, but it just seems likely to have the puppet configs fight.</p>



<a name="1496124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496124">(Jan 24 2023 at 19:39)</a>:</h4>
<p>My memory could be wrong, but I'm pretty sure that like 5 years ago we fixed all the issues around that -- I think the construction of<code>scripts/zulip-puppet-apply</code> is such that it doesn't use the <code>/etc/puppet</code>  configuration at all, passing its own configuration to <code>puppet</code> instead of the <code>/etc/</code> stuff, and so we should only have an issue if their puppet tries to manage the same files that ours does.</p>



<a name="1496126"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496126" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496126">(Jan 24 2023 at 19:43)</a>:</h4>
<p>I don't see anything in the history of <code>scripts/zulip-puppet-apply</code> that hints at that.  Though it's quite possible I'm missing it, or it didn't call out that reason, or didn't need to touch that file.</p>



<a name="1496127"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496127" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496127">(Jan 24 2023 at 19:46)</a>:</h4>
<p>I do find <a href="https://github.com/zulip/zulip/pull/23">#23</a> and <a href="https://github.com/zulip/zulip/commit/974878019224869908bf014fa3363a3dd7b217f1">974878019224869908bf014fa3363a3dd7b217f1</a> which are tangentially relevant.</p>



<a name="1496150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496150">(Jan 24 2023 at 20:19)</a>:</h4>
<p>Yeah, I think stopping managing <code>/etc/puppet</code> was the key change to make "ahh I also use puppet and it's broken" stop being a thing we got complaints about.</p>



<a name="1496151"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496151" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496151">(Jan 24 2023 at 20:20)</a>:</h4>
<p>We were definitely less good about describing the motivations for changes back in 2015 <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1496154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496154">(Jan 24 2023 at 20:23)</a>:</h4>
<p>This is in some sense a regression of <a href="https://github.com/zulip/zulip/pull/23">#23</a>, though.</p>



<a name="1496158"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%204.9.%20to%206.0%20%3F/near/1496158" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.204.2E9.2E.20to.206.2E0.20.3F.html#1496158">(Jan 24 2023 at 20:23)</a>:</h4>
<p>We can revert <a href="https://github.com/zulip/zulip/pull/24148">#24148</a>, but that will restore zulip hosts to trying to connect to a local <code>puppet</code> host to configure themselves.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>