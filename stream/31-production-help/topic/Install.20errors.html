<html>
<head><meta charset="utf-8"><title>Install errors · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html">Install errors</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="625761"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625761" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625761">(Aug 04 2018 at 19:18)</a>:</h4>
<p>I got this error when installing, from latest git:</p>
<div class="codehilite"><pre><span></span>./manage.py checkconfig
Traceback (most recent call last):
  File &quot;./manage.py&quot;, line 36, in &lt;module&gt;
    execute_from_command_line(sys.argv)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/__init__.py&quot;, line 364, in execute_from_command_line
    utility.execute()
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/__init__.py&quot;, line 356, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py&quot;, line 283, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py&quot;, line 327, in execute
    self.check()
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py&quot;, line 359, in check
    include_deployment_checks=include_deployment_checks,
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py&quot;, line 346, in _run_checks
    return checks.run_checks(**kwargs)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/checks/registry.py&quot;, line 81, in run_checks
    new_errors = check(app_configs=app_configs)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/checks/urls.py&quot;, line 16, in check_url_config
    return check_resolver(resolver)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/core/checks/urls.py&quot;, line 26, in check_resolver
    return check_method()
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/urls/resolvers.py&quot;, line 254, in check
    for pattern in self.url_patterns:
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/utils/functional.py&quot;, line 35, in __get__
    res = instance.__dict__[self.name] = self.func(instance)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/urls/resolvers.py&quot;, line 405, in url_patterns
    patterns = getattr(self.urlconf_module, &quot;urlpatterns&quot;, self.urlconf_module)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/utils/functional.py&quot;, line 35, in __get__
    res = instance.__dict__[self.name] = self.func(instance)
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zulip-py3-venv/lib/python3.6/site-packages/django/urls/resolvers.py&quot;, line 398, in urlconf_module
    return import_module(self.urlconf_name)
  File &quot;/usr/lib/python3.6/importlib/__init__.py&quot;, line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 994, in _gcd_import
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 971, in _find_and_load
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 955, in _find_and_load_unlocked
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 665, in _load_unlocked
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 678, in exec_module
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 219, in _call_with_frames_removed
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zproject/urls.py&quot;, line 8, in &lt;module&gt;
    import zerver.forms
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zerver/forms.py&quot;, line 20, in &lt;module&gt;
    from zerver.lib.actions import do_change_password, email_not_system_bot, \
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zerver/lib/actions.py&quot;, line 18, in &lt;module&gt;
    from zerver.lib.bugdown import (
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zerver/lib/bugdown/__init__.py&quot;, line 35, in &lt;module&gt;
    from zerver.lib.emoji import translate_emoticons, emoticon_regex
  File &quot;/home/zulip/deployments/2018-08-04-20-00-00/zerver/lib/emoji.py&quot;, line 19, in &lt;module&gt;
    with open(NAME_TO_CODEPOINT_PATH) as fp:
FileNotFoundError: [Errno 2] No such file or directory: &#39;/home/zulip/prod-static/generated/emoji/name_to_codepoint.json&#39;
zulip@zulip2:~/deployments/2018-08-04-20-00-00$ ls -l /home/zulip/prod-static/generated/emoji/name_to_codepoint.json
ls: cannot access &#39;/home/zulip/prod-static/generated/emoji/name_to_codepoint.json&#39;: No such file or directory
</pre></div>


<p>I searched on the system and found name_to_codepoint.json in <code>/srv/zulip-emoji-cache/24c3428ae5f5f3c84e9ebb2cad8eb79be7454116/emoji/name_to_codepoint.json</code>, so I just copied that whole dir:</p>
<div class="codehilite"><pre><span></span>cp -a /srv/zulip-emoji-cache/24c3428ae5f5f3c84e9ebb2cad8eb79be7454116/emoji/ /home/zulip/prod-static/generated/
</pre></div>


<p>and that seemed to fix the problem...</p>



<a name="625762"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625762" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625762">(Aug 04 2018 at 19:19)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>  is this something you think should be resolved before release?</p>



<a name="625768"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625768" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625768">(Aug 04 2018 at 19:31)</a>:</h4>
<p>Hmm, definitely a bug in that it should have been generated in the install process.  Don't have time to look right now; <span class="user-mention" data-user-id="907">@Harshit Bansal</span> may be able to help investigate.</p>



<a name="625770"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625770" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625770">(Aug 04 2018 at 19:45)</a>:</h4>
<p>I'm also getting <code>open() "/home/zulip/prod-static/html/5xx.html" failed</code> now.  There was nothing in /home/zulip/prod-static/ apart from generated/bots .  I'll check over the installer console output and see if there was maybe some error that didn't abort it.</p>
<p>edit to clairfy: I meant that /home/zulip/prod-static/generated/bots already existed.  Creating /home/zulip/prod-static/generated/emoji fixed the ./manage.py checkconfig errror, but then trying to access the new organisation page gave the error <code>open() "/home/zulip/prod-static/html/5xx.html" failed</code> in the nginx logs.</p>



<a name="625776"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625776" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625776">(Aug 04 2018 at 20:14)</a>:</h4>
<p>Figured out part of the issue, there was this error earlier:</p>
<div class="codehilite"><pre><span></span>+ su zulip -c &#39;/home/zulip/deployments/current/tools/update-prod-static --authors-not-required&#39;
+ mkdir -p var/log
Cached version not found! Installing node modules.
+ mkdir -p /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56
+ cp package.json yarn.lock /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56
+ /home/zulip/deployments/current/scripts/lib/cd_exec /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56 /srv/zulip-yarn/bin/yarn install --non-interactive --prod
+ touch /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56/.success-stamp
Using cached node modules from /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56/node_modules
+ rm -rf node_modules
+ ln -nsf /srv/zulip-npm-cache/8ea4cd291dd23441aec0f298b77b6ddc0d0a7a56/node_modules node_modules
+ ./tools/setup/emoji/build_emoji
+ ./tools/inline-email-css
+ ./tools/setup/generate_zulip_bots_static_files
+ ./tools/generate-custom-icon-webfont
+ ./tools/setup/build_pygments_data
+ ./tools/minify-js

Error running a subcommand of /home/zulip/deployments/current/tools/update-prod-static: ./tools/minify-js
Actual error output for the subcommand is just above this.
</pre></div>


<p>This created /home/zulip/prod-static/generated, but didn't complete it, but then the install script skips update-prod-static if generated exists.</p>



<a name="625778"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625778" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625778">(Aug 04 2018 at 20:17)</a>:</h4>
<p>running ./tools/minify-js manually gives this:</p>
<div class="codehilite"><pre><span></span>ERROR - Cannot read: static/node_modules/katex/dist/katex.js
</pre></div>



<a name="625782"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625782" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625782">(Aug 04 2018 at 20:35)</a>:</h4>
<div class="codehilite"><pre><span></span>root@zulip2:~/zulip# cd static/
root@zulip2:~/zulip/static# ln -s ../node_modules/
root@zulip2:~/zulip/static# cd ..
</pre></div>


<p>fixed that issue.</p>



<a name="625786"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625786" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625786">(Aug 04 2018 at 20:47)</a>:</h4>
<p>And finally the update-prod-static command worked, and created everything in /home/zulip/prod-static/generated/,  and the install script was successful.  So, a few things to fix here:</p>
<ul>
<li>if update-prod-static fails then need to delete the generated dir, so it's re-attempted</li>
<li>if ./tools/minify-js fails, the error isn't printed unless it's run manually</li>
<li>finally the node_modules path, /home/zulip/deployments/current/node_modules exists but not /home/zulip/deployments/current/static/node_modules  (was something supposed to create static/node_modules that failed?  I did the same trick again of just finding the files it was looking for and putting them in place, the first time with the emojis that was wrong and didn't actually help).</li>
</ul>



<a name="625792"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625792" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625792">(Aug 04 2018 at 21:09)</a>:</h4>
<p>Hmm, yeah, these must be recent regressions.  I'll try reproducing probably tomorrow.</p>



<a name="625805"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/625805" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#625805">(Aug 04 2018 at 23:22)</a>:</h4>
<p>sorry, <span class="user-mention" data-user-id="7">@Tim Abbott</span>  the ../node_modules/ is already there, nothing to fix really (although maybe the first 2 issues could still be improved...)</p>
<p>I had done <code>scp -r ./zulip zulip-server:~/ </code> which deleted the symlink.  Incredibly annoying!</p>



<a name="627614"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/627614" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#627614">(Aug 08 2018 at 19:35)</a>:</h4>
<p><span class="user-mention" data-user-id="9089">@Laurence Darby</span> just wanted to follow-up; I was unable to reproduce any issues with running the installer; it sounds like the root cause was that you copied the contents in a way that didn't preserve symlinks after unpacking it?</p>



<a name="627615"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/627615" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#627615">(Aug 08 2018 at 19:35)</a>:</h4>
<p>If so, it's possible we should just add a check early in the installer for whether certain symlinks are present, and if not, throw an error?</p>



<a name="627708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/627708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Laurence Darby <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#627708">(Aug 08 2018 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>  yes that was the issue, got it all working now.  So yes checking the symlink exists would make sense, thanks. </p>
<p>Also, after doing all that I realised I'd need to migrate the data from the old 1604 install one to the new, and jump postgres versions, then read <a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/export-and-import.html">https://zulip.readthedocs.io/en/latest/production/export-and-import.html</a>,  which says it has to be the same version...  </p>
<p>So I needed to get the old one upgraded anyway - I fixed the rabbitmq errors by doing this:</p>
<div class="codehilite"><pre><span></span>apt-get purge rabbitmq-server
apt-get install rabbitmq-server
..../scripts/setup/configure-rabbitmq
</pre></div>


<p>then apt could stop and start it properly, then the zulip upgrade to git worked (so trying 1804 at all was a waste of time...)</p>



<a name="627710"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Install%20errors/near/627710" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Install.20errors.html#627710">(Aug 08 2018 at 20:43)</a>:</h4>
<p><span class="user-mention" data-user-id="9089">@Laurence Darby</span> cool, congrats on the upgrade, and thanks for the feedback!</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>