<html>
<head><meta charset="utf-8"><title>server migration · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html">server migration</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="626977"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/626977" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#626977">(Aug 07 2018 at 21:06)</a>:</h4>
<p>In the coming weeks we want to move our current zulip VM to a KVM container instance. I browsed through the documentation about exporting and importing the zulip data and that sounds pretty straight forward. </p>
<p>However a question I still have is: <br>
The two Zulip instances should be the same version. Since I always run our updates with the git clone option I'm hoping </p>
<ul>
<li>to fork Zulip to freeze the repo, </li>
<li>upgrade the old instance to it and </li>
<li>install the new instance from it. </li>
</ul>
<p>Is there documentation how to install Zulip from a git clone? <br>
I only know that installing Zulip has been simplified this year...</p>



<a name="626984"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/626984" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#626984">(Aug 07 2018 at 21:16)</a>:</h4>
<p><span class="user-mention" data-user-id="6250">@Matthias</span> you definitely want the two servers running the same version.</p>



<a name="626985"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/626985" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#626985">(Aug 07 2018 at 21:17)</a>:</h4>
<p>Our backup-related instructions are probably what you most want to follow (<code>postgres</code> dump, etc.)</p>



<a name="626987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/626987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#626987">(Aug 07 2018 at 21:17)</a>:</h4>
<p>On modern Zulip, you can just <code>git clone</code> and the run <code>scripts/setup/install</code> (that's only worked for a major release or two)</p>



<a name="626998"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/626998" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#626998">(Aug 07 2018 at 21:24)</a>:</h4>
<p>thanks for the quick infos. I'll definitely go for that then. Will <a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/export-and-import.html">this export feature</a> also create the postgres dump?</p>



<a name="627002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/627002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#627002">(Aug 07 2018 at 21:30)</a>:</h4>
<p>You don't want to use that tool for this purpose.  Let me update those docs to clarify.</p>



<a name="627038"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/627038" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#627038">(Aug 07 2018 at 22:11)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/commit/c6bbb9a8d4fb9e160a5fbce4d39ddf6acbb2da6d" target="_blank" title="https://github.com/zulip/zulip/commit/c6bbb9a8d4fb9e160a5fbce4d39ddf6acbb2da6d">c6bbb9a8d4fb9e160a5fbce4d39ddf6acbb2da6d</a></p>



<a name="628437"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/628437" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Russell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#628437">(Aug 09 2018 at 21:41)</a>:</h4>
<p>On the subject of moving servers, do I need to re-register the push mobile notification service on the new box? The new server will have a new hostname, but I'll be migrating the application using the backup and restore procedures. We will be migrating the 1.9rc1 release.</p>



<a name="628438"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/628438" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#628438">(Aug 09 2018 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="5233">@Scott Russell</span> if you preserved <code>zulip-secrets.conf</code> when migrating, you won't need to re-register.</p>



<a name="628439"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/628439" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#628439">(Aug 09 2018 at 21:43)</a>:</h4>
<p>I think there's an option you can pass to <code>manage.py register_server</code> to update the contact info in your registration if you like (or rotate the secret key part of the keypair)</p>



<a name="628440"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/628440" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#628440">(Aug 09 2018 at 21:43)</a>:</h4>
<p>But it's not required to do so.</p>



<a name="628442"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/628442" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Scott Russell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#628442">(Aug 09 2018 at 21:45)</a>:</h4>
<p>Okay. Right now my plan is</p>
<p>1. install 1.9rc1 to the new host and do all connectivity testing<br>
2. backup following the docs the old host (also 1.9rc1)<br>
3. restore to the new host following the docs<br>
4. celebrate because it was that easy.</p>



<a name="634392"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/634392" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#634392">(Aug 18 2018 at 15:57)</a>:</h4>
<p><span class="emoji emoji-1f389" title="tada">:tada:</span>  at last our Zulip server has found a new home from the previous Ubuntu 16.04.1 with Postgresql 9.5 now in Debian 9.3 LXC container with Postgres 9.6<br>
But as for the <code>/home/zulip/uploads</code>: a symlink is definitely necessary because the nginx config uses the path multiple times so I had to symlink the samba share. As for performance I can't notice a different. The alternative is to hard code the new path manually in the nginx config file and all its includes.</p>



<a name="634393"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/634393" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#634393">(Aug 18 2018 at 15:59)</a>:</h4>
<p>Another thing: I tried to do a release upgrade of the old Ubuntu to be able to raise postgresql to 9.6. But after the dist-upgrade zulip was broken. I didn't look at the logs because it was the production server and my only concern was to restore the backup.<br>
What are the experiences with Zulip and running <code>do release-upgrade</code>?</p>



<a name="634589"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/server%20migration/near/634589" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/server.20migration.html#634589">(Aug 19 2018 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="6250">@Matthias</span> without the traceback I can't be sure, the story there is most likely just that <code>do-release-upgrade</code> will probably replace the postgres package, but I don't think it migrates your databases to be in the postgres 9.3 format to 9.6 format automatically.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>