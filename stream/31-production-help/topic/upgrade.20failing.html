<html>
<head><meta charset="utf-8"><title>upgrade failing · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html">upgrade failing</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="20146"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20146" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20146">(Aug 28 2016 at 00:46)</a>:</h4>
<p>The upgrade is failing for me on my VM running 1.3.13.<br>
I downloaded 1.4.0 and ran the command:  <code>/home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-1.4.0.tar.gz</code></p>
<p>It runs for a long time and then finally fails at the following stage.</p>
<div class="codehilite"><pre>Notice: /Stage[main]/Zulip::Postgres_appdb_tuned/Exec[pg_ctlcluster 9.3 main restart]/returns: pg_ctl: server does not shut down
Notice: /Stage[main]/Zulip::Postgres_appdb_tuned/Exec[pg_ctlcluster 9.3 main restart]/returns: HINT: The &quot;-m fast&quot; option immediately disconnects sessions rather than
Notice: /Stage[main]/Zulip::Postgres_appdb_tuned/Exec[pg_ctlcluster 9.3 main restart]/returns: waiting for session-initiated disconnection.
Error: /Stage[main]/Zulip::Postgres_appdb_tuned/Exec[pg_ctlcluster 9.3 main restart]: Failed to call refresh: pg_ctlcluster 9.3 main restart returned 1 instead of one of [0]
Error: /Stage[main]/Zulip::Postgres_appdb_tuned/Exec[pg_ctlcluster 9.3 main restart]: pg_ctlcluster 9.3 main restart returned 1 instead of one of [0]
Notice: /Stage[main]/Zulip::Base/Package[crudini]/ensure: ensure changed &#39;purged&#39; to &#39;present&#39;
Notice: Finished catalog run in 115.44 seconds
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2016-08-27-20-51-27/scripts/lib/upgrade-zulip-stage-2&quot;, line 59, in &lt;module&gt;
    subprocess.check_call([&quot;./scripts/zulip-puppet-apply&quot;, &quot;--force&quot;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;./scripts/zulip-puppet-apply&#39;, &#39;--force&#39;]&#39; returned non-zero exit status 1
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip&quot;, line 53, in &lt;module&gt;
    subprocess.check_call([os.path.abspath(&quot;./scripts/lib/upgrade-zulip-stage-2&quot;), deploy_path])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/home/zulip/deployments/2016-08-27-20-51-27/scripts/lib/upgrade-zulip-stage-2&#39;, &#39;/home/zulip/deployments/2016-08-27-20-51-27&#39;]&#39; returned non-zero exit status 1
</pre></div>


<p>Anyone have any suggestions on what to do? I have a snapshot of my server, so I have rolled back and tried to run the upgrade more than once with the same result.</p>



<a name="20147"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20147" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20147">(Aug 28 2016 at 01:20)</a>:</h4>
<p>It looks like some kind of permission problem.</p>



<a name="20148"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20148" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20148">(Aug 28 2016 at 01:25)</a>:</h4>
<p>I'm running the command as root...</p>



<a name="20149"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20149" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20149">(Aug 28 2016 at 01:31)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span>  Where do you see the permissions issue? I am running the command as root. Do you have a suggestion as to how I can correct the issue?</p>



<a name="20150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20150">(Aug 28 2016 at 01:45)</a>:</h4>
<p>No, sorry, the issue is not immediately apparent to me.  Did postgres have problems shutting down, possibly from the earlier version running?</p>



<a name="20151"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20151" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20151">(Aug 28 2016 at 01:47)</a>:</h4>
<p>It was off when I checked. May have been slow to stop.</p>



<a name="20152"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20152" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20152">(Aug 28 2016 at 05:29)</a>:</h4>
<p><span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span>  postgres can be slow to stop, so that could be your problem.  If so, probably just rerunning the upgrade script will work</p>



<a name="20153"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20153" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20153">(Aug 28 2016 at 05:29)</a>:</h4>
<p>(Hello from a brief window of Internet)</p>



<a name="20222"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20222" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20222">(Aug 28 2016 at 23:23)</a>:</h4>
<p>No upgrade for me...</p>
<p>I ran:<br>
<code>/home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-1.4.0.tar.gz</code><br>
It failed, so I reran<br>
<code>/home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-1.4.0.tar.gz</code></p>
<p>This is what the errors says:</p>
<div class="codehilite"><pre>+ sudo ln -nsf /srv/zulip-venv-cache/3f3aca99403f3bbcc8ffd2c4b24d1296f904c04b/zulip-venv /home/zulip/deployments/2016-08-28-20-12-34/zulip-venv
process-fts-updates: ERROR (not running)
2016-08-28 20:12:48,416 upgrade-zulip-stage-2: Stopping Zulip...
zulip-django: ERROR (not running)
zulip-tornado: ERROR (not running)
2016-08-28 20:12:48,509 upgrade-zulip-stage-2: Applying puppet changes...
Notice: Compiled catalog for zulip.demontbrun.com in environment production in 0.82 seconds
Notice: /Stage[main]/Zulip::Postgres_common/Exec[disable_logrotate]/returns: executed successfully
Notice: Finished catalog run in 1.47 seconds
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
2016-08-28 20:12:53,945 upgrade-zulip-stage-2: Applying database migrations...
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/scripts/lib/log-management-command&quot;, line 15, in &lt;module&gt;
    file_handler = logging.FileHandler(settings.MANAGEMENT_LOG_PATH)
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/zulip-venv/local/lib/python2.7/site-packages/django/conf/__init__.py&quot;, line 48, in __getattr__
    self._setup(name)
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/zulip-venv/local/lib/python2.7/site-packages/django/conf/__init__.py&quot;, line 44, in _setup
    self._wrapped = Settings(settings_module)
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/zulip-venv/local/lib/python2.7/site-packages/django/conf/__init__.py&quot;, line 92, in __init__
    mod = importlib.import_module(self.SETTINGS_MODULE)
  File &quot;/usr/lib/python2.7/importlib/__init__.py&quot;, line 37, in import_module
    __import__(name)
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/zproject/settings.py&quot;, line 85, in &lt;module&gt;
    from .prod_settings import *
ImportError: No module named prod_settings
Traceback (most recent call last):
  File &quot;./manage.py&quot;, line 22, in &lt;module&gt;
    &quot; &quot;.join(sys.argv)])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/home/zulip/deployments/2016-08-28-20-12-34/scripts/lib/log-management-command&#39;, &#39;./manage.py migrate --noinput&#39;]&#39; returned non-zero exit status 1
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2016-08-28-20-12-34/scripts/lib/upgrade-zulip-stage-2&quot;, line 64, in &lt;module&gt;
    subprocess.check_call([&quot;./manage.py&quot;, &quot;migrate&quot;, &quot;--noinput&quot;], preexec_fn=su_to_zulip)
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;./manage.py&#39;, &#39;migrate&#39;, &#39;--noinput&#39;]&#39; returned non-zero exit status 1
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip&quot;, line 53, in &lt;module&gt;
    subprocess.check_call([os.path.abspath(&quot;./scripts/lib/upgrade-zulip-stage-2&quot;), deploy_path])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/home/zulip/deployments/2016-08-28-20-12-34/scripts/lib/upgrade-zulip-stage-2&#39;, &#39;/home/zulip/deployments/2016-08-28-20-12-34&#39;]&#39; returned non-zero exit status 1
root@zulip:/home/zulip#
</pre></div>


<p><img alt=":cry:" class="emoji" src="/static/third/gemoji/images/emoji/cry.png" title=":cry:"> </p>



<a name="20223"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20223" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20223">(Aug 28 2016 at 23:27)</a>:</h4>
<p>Can you track down your <code>prod_settings.py</code> file?</p>



<a name="20224"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20224" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20224">(Aug 28 2016 at 23:37)</a>:</h4>
<p>where should prod_settings.py be?<br>
is there a standard directory where I should find it?<br>
Doing a find on the server now.</p>



<a name="20225"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20225" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20225">(Aug 28 2016 at 23:40)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> I'm not finding it...</p>



<a name="20226"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20226" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20226">(Aug 28 2016 at 23:44)</a>:</h4>
<p>interesting... I found a few template files...</p>
<div class="codehilite"><pre>/home/zulip/deployments/2016-08-28-20-05-05/zproject/prod_settings_template.py
/home/zulip/deployments/2016-08-28-20-12-02/zproject/prod_settings_template.py
/home/zulip/deployments/2016-08-28-20-12-34/zproject/prod_settings_template.py
</pre></div>


<p>I'm looking at them now. Where should they be in "real life?"</p>



<a name="20227"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20227" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20227">(Aug 28 2016 at 23:52)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/blob/master/scripts/upgrade-zulip-from-git#L69" target="_blank" title="https://github.com/zulip/zulip/blob/master/scripts/upgrade-zulip-from-git#L69">https://github.com/zulip/zulip/blob/master/scripts/upgrade-zulip-from-git#L69</a></p>



<a name="20228"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20228" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20228">(Aug 28 2016 at 23:57)</a>:</h4>
<p>Hmmm, that link I just posted might not be that helpful.  Your settings should be in <code>/etc/zulip/settings.py</code>.</p>



<a name="20229"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20229" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20229">(Aug 28 2016 at 23:58)</a>:</h4>
<p>more info here: <a href="http://zulip.readthedocs.io/en/latest/settings.html#server-settings" target="_blank" title="http://zulip.readthedocs.io/en/latest/settings.html#server-settings">http://zulip.readthedocs.io/en/latest/settings.html#server-settings</a></p>



<a name="20230"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20230" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20230">(Aug 28 2016 at 23:58)</a>:</h4>
<p>Yep... that's where they are.</p>



<a name="20231"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20231" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20231">(Aug 29 2016 at 00:00)</a>:</h4>
<p>So now that I have the location of my settings file, should there be something I am looking for in there? Something that is blocking my upgrade? </p>



<a name="20232"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20232" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20232">(Aug 29 2016 at 00:05)</a>:</h4>
<p>I am wondering if the soft link didn't get created for some reason:</p>
<div class="codehilite"><pre>$ git grep zproject | grep ln
scripts/lib/install:    ln -nsf /etc/zulip/settings.py /root/zulip/zproject/prod_settings.py
scripts/lib/install:    ln -nsf /etc/zulip/settings.py &quot;$deploy_path&quot;/zproject/prod_settings.py
scripts/upgrade-zulip-from-git:        subprocess.check_call([&quot;ln&quot;, &quot;-nsf&quot;, os.path.join(deploy_path, &quot;zproject/local_settings.py&quot;),
</pre></div>



<a name="20233"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20233" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20233">(Aug 29 2016 at 00:06)</a>:</h4>
<p>Did you run the install as root?  Did you see any error messages?</p>



<a name="20234"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20234" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20234">(Aug 29 2016 at 00:07)</a>:</h4>
<p>I did run as root... No errors until the ones I posted here.</p>



<a name="20235"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20235" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20235">(Aug 29 2016 at 00:07)</a>:</h4>
<p>Do you have a <code>/root/zulip/zproject</code> directory?</p>



<a name="20236"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20236" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20236">(Aug 29 2016 at 00:07)</a>:</h4>
<p>My vm is a mess right now... I'll check un a minute... Sorry.</p>



<a name="20237"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20237" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20237">(Aug 29 2016 at 00:08)</a>:</h4>
<p>I'm going to rerun everything and then check.</p>



<a name="20242"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20242" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20242">(Aug 29 2016 at 02:01)</a>:</h4>
<p>Finally back with you... </p>
<div class="codehilite"><pre>root@zulip:/home/zulip# ls -ld /root/zulip/zproject
drwxr-xr-x 3 zulip zulip 4096 Aug 28 22:36 /root/zulip/zproject
root@zulip:/home/zulip# ls -ld /root/zulip
lrwxrwxrwx 1 root root 28 Oct  4  2015 /root/zulip -&gt; /home/zulip/deployments/next
</pre></div>


<p>I do have a <code>/root/zulip/zproject</code> dir and it is pointing to the <code>next</code> deployment<br>
<code>current</code> is still pointing to the old version</p>



<a name="20248"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20248" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20248">(Aug 29 2016 at 02:31)</a>:</h4>
<p>Hmmm, this suggests that maybe the upgrade failed before getting to the point where it cut over the soft link to point to the new current version?</p>



<a name="20249"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20249" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20249">(Aug 29 2016 at 02:36)</a>:</h4>
<p>I don't know enough about the deployment/upgrade process to comment.  <img alt=":cry:" class="emoji" src="/static/third/gemoji/images/emoji/cry.png" title=":cry:"> <br>
It's 11:35pm here and my brain is done for the day... I'm rolling back to a working version and going to bed. <br>
It's very easy for me to get back to this point, so I can try again tomorrow.</p>
<p>Thanks for the help so far and good night.</p>



<a name="20251"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20251" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20251">(Aug 29 2016 at 02:38)</a>:</h4>
<p>Yeah, let's try again tomorrow!</p>



<a name="20252"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20252" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20252">(Aug 29 2016 at 02:45)</a>:</h4>
<p>(oops, wrong stream)</p>



<a name="20379"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20379" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20379">(Aug 30 2016 at 01:46)</a>:</h4>
<p>I still can't figure out why my server won't upgrade... I can't even remember how I set it up originally. <img alt=":frowning:" class="emoji" src="/static/third/gemoji/images/emoji/frowning.png" title=":frowning:"> <br>
I hate not being able to upgrade. If no one has any hints as to where I should look for a reason, perhaps I will try a fresh install and restore my db backup (and files, etc).</p>



<a name="20499"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20499" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20499">(Aug 30 2016 at 02:16)</a>:</h4>
<p>I was thinking that it had something to do with my settings files and the server not loading the productions environment, but I don't think that is the case after looking at <a href="http://zulip.readthedocs.io" target="_blank" title="http://zulip.readthedocs.io">zulip.readthedocs.io</a></p>
<hr>
<p>Any suggestions would be appreciated</p>



<a name="20500"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20500" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20500">(Aug 30 2016 at 02:18)</a>:</h4>
<p>Have you been able to track down any log files that might help you understand what's going on?  Unfortunately, I don't think many folks in the world have done a Zulip upgrade since it was open sourced.  The one expert, Tim, is on vacation this week.</p>



<a name="20501"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20501" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20501">(Aug 30 2016 at 02:20)</a>:</h4>
<p>All the scripts to do the upgrade should be more or less readable, and you can insert print statements in them to see progress.  Also, do you understand the basic process where we install to a new directory then cut over the soft link at the end?</p>



<a name="20502"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20502" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20502">(Aug 30 2016 at 02:24)</a>:</h4>
<p>I think I do now. I've been doing a lot of reading. There is the upgrade.log, but the error is essentially the python error that I pasted in yesterday.</p>



<a name="20503"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20503" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20503">(Aug 30 2016 at 02:25)</a>:</h4>
<p>I'll keep poking at it (in my evenings as this is not for work). Perhaps, I'll find it and be able to send some info back, or Tim might be able to steer me in the right direction.</p>
<p>Thanks for the help <span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> </p>



<a name="20504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20504">(Aug 30 2016 at 03:19)</a>:</h4>
<p>is this a similar error? <a href="https://github.com/zulip/zulip/issues/1731" target="_blank" title="https://github.com/zulip/zulip/issues/1731">https://github.com/zulip/zulip/issues/1731</a></p>



<a name="20505"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20505" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20505">(Aug 30 2016 at 03:22)</a>:</h4>
<p>In the changelog it appears we renamed local_settings.py to prod_settings.py.</p>



<a name="20506"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20506" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20506">(Aug 30 2016 at 03:25)</a>:</h4>
<p>Or, to be precise, the changelog says this: "Renamed local_settings.py symlink to prod_settings.py for clarity."</p>



<a name="20507"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/20507" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#20507">(Aug 30 2016 at 03:31)</a>:</h4>
<p>line 63 or so of <code>scripts/lib/upgrade-zulip-stage-2</code> is where the migrations start to be applied, and that's where <code>zprojects/settings.py</code> seems to fail to import <code>prod_settings</code> from the same directory.  If you make the upgrade script stop right before applying the migrations, it would be worthwhile to snoop around to see where, if anywhere, prod_settings.py lives.</p>



<a name="21291"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21291" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21291">(Sep 01 2016 at 00:04)</a>:</h4>
<p>I'm pretty sure what's happening is that the symlink is created in the previous version of <code>scripts/lib/upgrade-zulip</code> (via <code>scripts/lib/unpack-zulip</code>, which creates local_settings. Then the rest of the upgrade is processes by <code>scripts/lib/upgrade-zulip-stage-2</code> which expects prod_settings.</p>



<a name="21292"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21292" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21292">(Sep 01 2016 at 00:05)</a>:</h4>
<p>That would make sense.</p>



<a name="21301"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21301" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21301">(Sep 01 2016 at 00:12)</a>:</h4>
<p>Not sure the best way to address other than to add code to upgrade-zulip-stage-2 that checks for prod_settings.py and creates the symlink if not there</p>



<a name="21302"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21302" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21302">(Sep 01 2016 at 00:12)</a>:</h4>
<p>though there's probably a case to re-factor the whole upgrade process to be driven from the new release, not the old one</p>



<a name="21303"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21303" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21303">(Sep 01 2016 at 00:13)</a>:</h4>
<p>I'm pretty sure this means any upgrade from 1.3.x will fail without manual intervention</p>



<a name="21304"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21304" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21304">(Sep 01 2016 at 00:24)</a>:</h4>
<p>Does prod_settings.py point to something outside of the release that's manually edited?</p>



<a name="21305"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21305" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21305">(Sep 01 2016 at 00:27)</a>:</h4>
<p>yes, /etc/zulip/settings.py</p>



<a name="21306"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21306" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21306">(Sep 01 2016 at 00:28)</a>:</h4>
<p>I'm setting up an instance of 1.3.13 to confirm right now</p>



<a name="21307"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21307" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21307">(Sep 01 2016 at 00:29)</a>:</h4>
<p>not sure why we don't just include /etc/zulip/settings.py directly, but perhaps that's a django thing</p>



<a name="21310"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21310" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21310">(Sep 01 2016 at 00:31)</a>:</h4>
<p>yeah, I think it's just trying to avoid having to put /etc/zulip in the Python path or have Django do a direct import to get there</p>



<a name="21311"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21311" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21311">(Sep 01 2016 at 00:31)</a>:</h4>
<p>One thing that I am noticing is that even the old 1.13.13 upgrade script basically just untars the tarball, then it moves into the new deploy path to run stage 2.</p>



<a name="21312"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21312" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21312">(Sep 01 2016 at 00:33)</a>:</h4>
<p>yeah</p>



<a name="21313"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21313" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21313">(Sep 01 2016 at 00:33)</a>:</h4>
<p>Oh, I see, the problem is that unpack-zulip does more than unpacking.</p>



<a name="21314"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21314" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21314">(Sep 01 2016 at 00:34)</a>:</h4>
<p>Like you said above.  (catching up here slowly but surely)</p>



<a name="21315"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21315" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21315">(Sep 01 2016 at 00:36)</a>:</h4>
<p>And in this commit the symlink got renamed, but the upgrades are still running the old version of unpack-zulip:</p>
<div class="codehilite"><pre>commit 19b860ceec7844156376c7c96710ddb06ccafae6
Author: Tim Abbott &lt;tabbott@mit.edu&gt;
Date:   Tue Jul 19 20:42:43 2016 -0700

    Rename local_settings.py symlink to prod_settings.py.
</pre></div>



<a name="21316"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21316" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21316">(Sep 01 2016 at 00:40)</a>:</h4>
<p>I think people that use <code>scripts/upgrade-zulip-from-git</code> will be ok, because there the symlink logic seemed to survive all the refactorings and moving stuff around.</p>



<a name="21317"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21317" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21317">(Sep 01 2016 at 00:43)</a>:</h4>
<p>sounds like you guys are making some progress that will make me happy (and maybe some other people) <img alt=":smile:" class="emoji" src="/static/third/gemoji/images/emoji/smile.png" title=":smile:"> <br>
I have a clone of my server... I can do some testing if you have suggestions, wait for a fix from y'all or whatever.</p>



<a name="21319"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21319" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21319">(Sep 01 2016 at 00:49)</a>:</h4>
<p>One thing I recommend doing is going to your <strong>old</strong> install and comment out one of the very last lines of <code>scripts/lib/upgrade-zulip</code> so that it doesn't automatically call <code>./scripts/lib/upgrade-zulip-stage-2</code>.  Then re-run the upgrade, and you'll be a nice stopping point right after the tarball is unpacked but before stuff really happens.  Then we'll have you manually fix up the symlink then manually run stage-2.</p>



<a name="21320"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21320" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21320">(Sep 01 2016 at 00:57)</a>:</h4>
<p><span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> Can you try what I suggested to Gervaise in the previous message?</p>



<a name="21321"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21321" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21321">(Sep 01 2016 at 00:58)</a>:</h4>
<p>once I get 1.3.13 running, yeah</p>



<a name="21322"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21322" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21322">(Sep 01 2016 at 00:59)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> <br>
I made a snapshot of my "real" server so I can try this... </p>



<a name="21323"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21323" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21323">(Sep 01 2016 at 00:59)</a>:</h4>
<p>almost there</p>



<a name="21324"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21324" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21324">(Sep 01 2016 at 00:59)</a>:</h4>
<p>ah, heh...yeah, the hardest part about troubleshooting upgrades is that you have to downgrade first <img alt=":face_with_cold_sweat:" class="emoji" src="/static/third/gemoji/images/emoji/face_with_cold_sweat.png" title=":face_with_cold_sweat:"> </p>



<a name="21325"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21325" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21325">(Sep 01 2016 at 01:01)</a>:</h4>
<p>should I just uncomment:<br>
<code>subprocess.check_call([os.path.abspath("./scripts/lib/upgrade-zulip-stage-2"), deploy_path])</code><br>
?</p>



<a name="21326"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21326" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21326">(Sep 01 2016 at 01:01)</a>:</h4>
<p>this is the downside of teh zulip prod install script doing everything</p>



<a name="21327"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21327" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21327">(Sep 01 2016 at 01:02)</a>:</h4>
<p>yes <span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span> comment out that line please</p>



<a name="21328"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21328" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21328">(Sep 01 2016 at 01:04)</a>:</h4>
<p>note to self: zulip-secrets.conf is not totally portable between servers</p>



<a name="21329"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21329" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21329">(Sep 01 2016 at 01:06)</a>:</h4>
<p>so now upgrade-zulip only does the untar?</p>
<div class="codehilite"><pre>root@zulip:/home/zulip# /home/zulip/deployments/current/scripts/upgrade-zulip zulip-server-1.4.0.tar.gz
2016-08-31 22:05:33,577 upgrade-zulip: Archiving the tarball under /home/zulip/archives
2016-08-31 22:05:33,794 upgrade-zulip: Unpacking the tarball
2016-08-31 22:05:34,977 upgrade-zulip: Deployment complete
</pre></div>



<a name="21330"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21330" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21330">(Sep 01 2016 at 01:07)</a>:</h4>
<p>yeah, the way it works is that the first script only untars stuff and it's kind of a bootstrapping thing to get you into the stage-2 part of the deployment that happens with 1.4 code</p>



<a name="21331"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21331" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21331">(Sep 01 2016 at 01:07)</a>:</h4>
<p>but we need to manually fix the symlink before stage 2 starts</p>



<a name="21332"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21332" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21332">(Sep 01 2016 at 01:08)</a>:</h4>
<p>can you do <code>cwd</code>?</p>



<a name="21333"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21333" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21333">(Sep 01 2016 at 01:08)</a>:</h4>
<p>er, <code>pwd</code></p>



<a name="21334"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21334" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21334">(Sep 01 2016 at 01:09)</a>:</h4>
<p>I can be in any dir you want... :-)<br>
<code>/home/zulip</code></p>



<a name="21335"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21335" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21335">(Sep 01 2016 at 01:09)</a>:</h4>
<p>you should be in the deployments directory...hold on</p>



<a name="21336"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21336" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21336">(Sep 01 2016 at 01:09)</a>:</h4>
<p><code>/home/zulip/deployments</code></p>



<a name="21337"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21337" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21337">(Sep 01 2016 at 01:09)</a>:</h4>
<p>:)</p>



<a name="21338"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21338" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21338">(Sep 01 2016 at 01:09)</a>:</h4>
<p>yup</p>



<a name="21339"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21339" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21339">(Sep 01 2016 at 01:10)</a>:</h4>
<p>did you see how fast I ran <code>cd</code>?<br>
<img alt=":smile:" class="emoji" src="/static/third/gemoji/images/emoji/smile.png" title=":smile:"> </p>



<a name="21340"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21340" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21340">(Sep 01 2016 at 01:12)</a>:</h4>
<p>then do: <code>ln -nsf /etc/zulip/settings.py /home/zulip/deployments/zproject/prod_settings.py</code></p>



<a name="21341"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21341" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21341">(Sep 01 2016 at 01:12)</a>:</h4>
<p>and then do <code>ls zproject/*settings*.py</code></p>



<a name="21342"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21342" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21342">(Sep 01 2016 at 01:13)</a>:</h4>
<p>pathing is off</p>



<a name="21343"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21343" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21343">(Sep 01 2016 at 01:13)</a>:</h4>
<p>there is no deployments/zproject dir</p>



<a name="21344"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21344" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21344">(Sep 01 2016 at 01:13)</a>:</h4>
<p>current?</p>



<a name="21345"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21345" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21345">(Sep 01 2016 at 01:14)</a>:</h4>
<p>like <code>/home/zulip/deployments/current</code></p>



<a name="21346"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21346" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21346">(Sep 01 2016 at 01:15)</a>:</h4>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments# ln -nsf /etc/zulip/settings.py /home/zulip/deployments/zproject/prod_settings.py
ln: failed to create symbolic link ‘/home/zulip/deployments/zproject/prod_settings.py’: No such file or directory
</pre></div>



<a name="21347"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21347" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21347">(Sep 01 2016 at 01:16)</a>:</h4>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments# pwd
/home/zulip/deployments
root@zulip:/home/zulip/deployments# ls -l
total 8
drwxr-xr-x 14 zulip zulip 4096 Aug 17 20:00 2016-06-21-23-34-49
drwxr-xr-x 14 zulip zulip 4096 Aug 25 14:49 2016-08-31-22-05-33
lrwxrwxrwx  1 zulip zulip   43 Jul 27 23:50 current -&gt; /home/zulip/deployments/2016-06-21-23-34-49
srwx------  1 zulip zulip    0 Aug 31 22:04 fastcgi-socket
lrwxrwxrwx  1 zulip zulip   43 Aug 31 22:05 next -&gt; /home/zulip/deployments/2016-08-31-22-05-33
</pre></div>



<a name="21348"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21348" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21348">(Sep 01 2016 at 01:17)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span>  <img alt=":point_up:" class="emoji" src="/static/third/gemoji/images/emoji/point_up.png" title=":point_up:"> </p>



<a name="21349"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21349" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21349">(Sep 01 2016 at 01:19)</a>:</h4>
<p>oh yeah, current is what you want</p>



<a name="21350"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21350" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21350">(Sep 01 2016 at 01:21)</a>:</h4>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments/current# ls -l zproject/*settings*.py
-rw-r--r-- 1 zulip zulip   910 Jun 21 20:59 zproject/dev_settings.py
lrwxrwxrwx 1 zulip zulip    22 Jun 21 23:34 zproject/local_settings.py -&gt; /etc/zulip/settings.py
-rw-r--r-- 1 zulip zulip 15360 Jun 21 20:59 zproject/local_settings_template.py
lrwxrwxrwx 1 root  root     22 Aug 31 22:20 zproject/prod_settings.py -&gt; /etc/zulip/settings.py
-rw-r--r-- 1 zulip zulip 35020 Jun 21 20:59 zproject/settings.py
</pre></div>



<a name="21351"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21351" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21351">(Sep 01 2016 at 01:22)</a>:</h4>
<p>you can rm local_settings.py</p>



<a name="21352"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21352" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21352">(Sep 01 2016 at 01:23)</a>:</h4>
<p>and then we should be ready to run stage-2 from the shell, from the "current" directory</p>



<a name="21353"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21353" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21353">(Sep 01 2016 at 01:24)</a>:</h4>
<p>basically that line of Python code you commented out earlier, you want to run that command from the command line now</p>



<a name="21354"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21354" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21354">(Sep 01 2016 at 01:24)</a>:</h4>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments/current# rm zproject/local_settings.py
root@zulip:/home/zulip/deployments/current# ls zproject/*settings*.py
zproject/dev_settings.py  zproject/local_settings_template.py  zproject/prod_settings.py  zproject/settings.py
</pre></div>



<a name="21355"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21355" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21355">(Sep 01 2016 at 01:25)</a>:</h4>
<p>just to confirm before running it...<br>
<code>scripts/lib/upgrade-zulip-stage-2</code></p>
<p>right?</p>



<a name="21356"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21356" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21356">(Sep 01 2016 at 01:25)</a>:</h4>
<p>no, slightly more complicated</p>



<a name="21357"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21357" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21357">(Sep 01 2016 at 01:25)</a>:</h4>
<p>you need to pass in the deployment path similar to what the Python code is doing</p>



<a name="21358"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21358" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21358">(Sep 01 2016 at 01:27)</a>:</h4>
<p><code>/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 /home/zulip/deployments/current</code> is what Python would  have run earlier had we not intervened</p>



<a name="21359"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21359" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21359">(Sep 01 2016 at 01:28)</a>:</h4>
<p>ok... shouldn't the second argument point to the new unpacked tarball? like:<br>
<code>/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 /home/zulip/deployments/2016-08-31-22-05-33</code></p>



<a name="21360"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21360" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21360">(Sep 01 2016 at 01:29)</a>:</h4>
<p>I think the symlink needs to be created in /next/ not /current/</p>



<a name="21361"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21361" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21361">(Sep 01 2016 at 01:32)</a>:</h4>
<p>the script would have run:<br>
<code>subprocess.check_call([os.path.abspath("./scripts/lib/upgrade-zulip-stage-2"), deploy_path])</code><br>
above this line... <code>deploy_path</code> is defined as:</p>
<div class="codehilite"><pre>    deploy_path = subprocess.check_output([unpack_zulip, archived_tarball_path],
                                          preexec_fn=su_to_zulip)
</pre></div>


<p>I think this is pointing to the path to the recently created dir from untar'ing the zulip-server-1.4.0.tgz tarball, no?</p>



<a name="21362"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21362" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21362">(Sep 01 2016 at 01:32)</a>:</h4>
<p>probably</p>



<a name="21363"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21363" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21363">(Sep 01 2016 at 01:32)</a>:</h4>
<p>I'm not a python guy... so I am just poking at it as best I can...</p>



<a name="21364"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21364" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21364">(Sep 01 2016 at 01:32)</a>:</h4>
<p>it's probably the most recent directory created under deployments if you do <code>ls -lt</code></p>



<a name="21365"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21365" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21365">(Sep 01 2016 at 01:33)</a>:</h4>
<p>yeah, I'm just trying to interpret the code, and I don't have the directory structure in front of me, and I'm trying to feed the dogs while checking in here haha</p>



<a name="21366"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21366" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21366">(Sep 01 2016 at 01:34)</a>:</h4>
<p>yup... that's the one I pointed to earlier (the one with today's date)<br>
<code>/home/zulip/deployments/2016-08-31-22-05-33</code></p>
<p>so I think the command I suggested earlier is correct<br>
<code>/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2 /home/zulip/deployments/2016-08-31-22-05-33</code></p>



<a name="21367"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21367" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21367">(Sep 01 2016 at 01:34)</a>:</h4>
<p>feeding the dogs... :-)<br>
I have a tiny dog sitting on my lap as I do this</p>



<a name="21368"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21368" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21368">(Sep 01 2016 at 01:35)</a>:</h4>
<p>ok... I'm going to run the above command and let you know if it works</p>



<a name="21369"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21369" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21369">(Sep 01 2016 at 01:35)</a>:</h4>
<p>On a high level this is all that really happens:<br>
- untar to new dir with timestamp<br>
- fix up some symlinks<br>
- stage2 stuff: stop old server/run migrations/start new server<br>
- fix up some symlinks</p>



<a name="21370"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21370" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21370">(Sep 01 2016 at 01:35)</a>:</h4>
<p>/me crosses his fingers</p>



<a name="21371"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21371" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21371">(Sep 01 2016 at 01:35)</a>:</h4>
<p>stage2 is running apt updates</p>



<a name="21372"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21372" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21372">(Sep 01 2016 at 01:36)</a>:</h4>
<p>yeah, that makes sense</p>



<a name="21373"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21373" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21373">(Sep 01 2016 at 01:36)</a>:</h4>
<p>I'm just building suspense...</p>



<a name="21374"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21374" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21374">(Sep 01 2016 at 01:36)</a>:</h4>
<p>failed</p>



<a name="21375"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21375" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21375">(Sep 01 2016 at 01:36)</a>:</h4>
<div class="codehilite"><pre>zulip-senders:zulip-events-message_sender-0: stopped
zulip-senders:zulip-events-message_sender-4: stopped
zulip-senders:zulip-events-message_sender-1: stopped
zulip-senders:zulip-events-message_sender-2: stopped
zulip-senders:zulip-events-message_sender-3: stopped
2016-08-31 22:36:29,864 upgrade-zulip-stage-2: Applying puppet changes...
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/current/scripts/lib/upgrade-zulip-stage-2&quot;, line 43, in &lt;module&gt;
    subprocess.check_call([&quot;./scripts/zulip-puppet-apply&quot;, &quot;--force&quot;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 535, in check_call
    retcode = call(*popenargs, **kwargs)
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 522, in call
    return Popen(*popenargs, **kwargs).wait()
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 710, in __init__
    errread, errwrite)
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 1327, in _execute_child
    raise child_exception
OSError: [Errno 2] No such file or directory
</pre></div>



<a name="21376"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21376" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21376">(Sep 01 2016 at 01:38)</a>:</h4>
<p>cd'd into <code>current</code> dir and re-ran... looks like it got past that</p>



<a name="21377"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21377" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21377">(Sep 01 2016 at 01:38)</a>:</h4>
<p>Strange.  Can you do <code>ls scripts/*puppet*</code>?</p>



<a name="21378"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21378" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21378">(Sep 01 2016 at 01:39)</a>:</h4>
<p>Is <code>current</code> pointing at the "new" stuff yet?</p>



<a name="21379"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21379" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21379">(Sep 01 2016 at 01:39)</a>:</h4>
<p>puppet stuff is still running...</p>



<a name="21380"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21380" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21380">(Sep 01 2016 at 01:40)</a>:</h4>
<p>are you running old code or new?</p>



<a name="21381"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21381" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21381">(Sep 01 2016 at 01:40)</a>:</h4>
<p>upgrade-stage-2 needs to run in the new directory</p>



<a name="21382"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21382" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21382">(Sep 01 2016 at 01:41)</a>:</h4>
<p>so upgrade-stage-2 should be called from <code>next</code> or <code>2016-08-31-22-05-33</code> (in this instance)<br>
?</p>



<a name="21383"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21383" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21383">(Sep 01 2016 at 01:42)</a>:</h4>
<p>yeah that's what <span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> was pointing out earlier</p>



<a name="21384"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21384" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21384">(Sep 01 2016 at 01:43)</a>:</h4>
<p>that's also where the soft link should have happened</p>



<a name="21385"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21385" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21385">(Sep 01 2016 at 01:43)</a>:</h4>
<p>I was confused..."current" is still "old" till the final install finishes</p>



<a name="21386"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21386" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21386">(Sep 01 2016 at 01:44)</a>:</h4>
<p>so you want to do the symlink-fixing and stage-2 out of the most recent directory</p>



<a name="21387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21387">(Sep 01 2016 at 01:44)</a>:</h4>
<p>ok..</p>



<a name="21388"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21388" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21388">(Sep 01 2016 at 01:47)</a>:</h4>
<p><img alt=":hankey:" class="emoji" src="/static/third/gemoji/images/emoji/hankey.png" title=":hankey:"> is happening... <br>
It's setting up the zulip python environment... lots of stuff downloading</p>



<a name="21389"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21389" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21389">(Sep 01 2016 at 01:48)</a>:</h4>
<p>I know this is normal... I have seen it 100 times</p>



<a name="21390"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21390" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21390">(Sep 01 2016 at 01:48)</a>:</h4>
<p>just letting you know what is going on</p>



<a name="21391"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21391" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21391">(Sep 01 2016 at 01:49)</a>:</h4>
<p>cool, afk for about 10 minutes</p>



<a name="21392"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21392" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21392">(Sep 01 2016 at 01:50)</a>:</h4>
<p>Okay, I have a working 1.3.13 install so I can try the upgrade </p>



<a name="21393"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21393" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21393">(Sep 01 2016 at 01:58)</a>:</h4>
<p>failed in the end:</p>
<div class="codehilite"><pre>Calculating upgrade... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
2016-08-31 22:56:47,291 upgrade-zulip-stage-2: Applying database migrations...
Traceback (most recent call last):
  File &quot;./manage.py&quot;, line 29, in &lt;module&gt;
    execute_from_command_line(sys.argv)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py&quot;, line 338, in execute_from_command_line
    utility.execute()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py&quot;, line 330, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py&quot;, line 390, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py&quot;, line 441, in execute
    output = self.handle(*args, **options)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/core/management/commands/migrate.py&quot;, line 93, in handle
    executor = MigrationExecutor(connection, self.migration_progress_callback)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/migrations/executor.py&quot;, line 19, in __init__
    self.loader = MigrationLoader(self.connection)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/migrations/loader.py&quot;, line 47, in __init__
    self.build_graph()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/migrations/loader.py&quot;, line 180, in build_graph
    self.applied_migrations = recorder.applied_migrations()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/migrations/recorder.py&quot;, line 59, in applied_migrations
    self.ensure_schema()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/migrations/recorder.py&quot;, line 49, in ensure_schema
    if self.Migration._meta.db_table in self.connection.introspection.table_names(self.connection.cursor()):
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/base/base.py&quot;, line 164, in cursor
    cursor = self.make_cursor(self._cursor())
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/base/base.py&quot;, line 135, in _cursor
    self.ensure_connection()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/base/base.py&quot;, line 130, in ensure_connection
    self.connect()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/utils.py&quot;, line 97, in __exit__
    six.reraise(dj_exc_type, dj_exc_value, traceback)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/base/base.py&quot;, line 130, in ensure_connection
    self.connect()
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/base/base.py&quot;, line 119, in connect
    self.connection = self.get_new_connection(conn_params)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/django/db/backends/postgresql_psycopg2/base.py&quot;, line 178, in get_new_connection
    connection = Database.connect(**conn_params)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zulip-venv/lib/python2.7/site-packages/psycopg2/__init__.py&quot;, line 164, in connect
    conn = _connect(dsn, connection_factory=connection_factory, async=async)
  File &quot;/home/zulip/deployments/2016-08-31-22-05-33/zerver/lib/db.py&quot;, line 45, in __init__
    super(TimeTrackingConnection, self).__init__(*args, **kwargs)
django.db.utils.OperationalError: could not connect to server: No such file or directory
        Is the server running locally and accepting
        connections on Unix domain socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;?

Traceback (most recent call last):
  File &quot;./scripts/lib/upgrade-zulip-stage-2&quot;, line 64, in &lt;module&gt;
    subprocess.check_call([&quot;./manage.py&quot;, &quot;migrate&quot;, &quot;--noinput&quot;], preexec_fn=su_to_zulip)
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 540, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;./manage.py&#39;, &#39;migrate&#39;, &#39;--noinput&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="21394"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21394" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21394">(Sep 01 2016 at 01:59)</a>:</h4>
<p>current still points to old install<br>
next points to 1.4.0 extracted tarball dir</p>



<a name="21395"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21395" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21395">(Sep 01 2016 at 02:01)</a>:</h4>
<p><span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span> what does your /next/ directory look like?</p>



<a name="21396"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21396" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21396">(Sep 01 2016 at 02:01)</a>:</h4>
<p>e.g. is there is symlink there to /etc/zulip/settings.py?</p>



<a name="21397"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21397" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21397">(Sep 01 2016 at 02:02)</a>:</h4>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments/next# ls -l
total 124
drwxr-xr-x 6 zulip zulip  4096 Aug 25 14:49 api
-rw-r--r-- 1 zulip zulip    41 Aug 25 14:50 build_id
drwxr-xr-x 4 zulip zulip  4096 Aug 31 22:56 confirmation
drwxr-xr-x 3 zulip zulip  4096 Aug 25 14:49 contrib_bots
-rw-r--r-- 1 zulip zulip   254 Aug 25 14:49 Dockerfile
drwxr-xr-x 4 zulip zulip  4096 Aug 25 14:49 docs
-rw-r--r-- 1 zulip zulip 11358 Aug 25 14:49 LICENSE
-rwxr-xr-x 1 zulip zulip  1012 Aug 25 14:49 manage.py
-rw-r--r-- 1 zulip zulip   716 Aug 25 14:49 package.json
drwxr-xr-x 4 zulip zulip  4096 Aug 25 14:50 prod-static
drwxr-xr-x 5 zulip zulip  4096 Aug 25 14:49 puppet
-rw-r--r-- 1 zulip zulip 10859 Aug 25 14:49 README.md
drwxr-xr-x 2 zulip zulip  4096 Aug 25 14:49 requirements
drwxr-xr-x 5 zulip zulip  4096 Aug 31 22:46 scripts
drwxr-xr-x 6 zulip zulip  4096 Aug 25 14:49 templates
-rw-r--r-- 1 zulip zulip 23635 Aug 25 14:49 THIRDPARTY
-rw-r--r-- 1 zulip zulip  2414 Aug 25 14:49 Vagrantfile
drwxr-xr-x 2 zulip zulip  4096 Aug 31 22:56 var
-rw-r--r-- 1 zulip zulip     6 Aug 25 14:50 version
drwxr-xr-x 8 zulip zulip  4096 Aug 31 22:56 zerver
drwxr-xr-x 3 zulip zulip  4096 Aug 31 22:56 zproject
lrwxrwxrwx 1 root  root     73 Aug 31 22:56 zulip-venv -&gt; /srv/zulip-venv-cache/3f3aca99403f3bbcc8ffd2c4b24d1296f904c04b/zulip-venv
root@zulip:/home/zulip/deployments/next# ls -l zproject/
total 148
-rw-r--r-- 1 zulip zulip 13214 Aug 25 14:49 backends.py
-rw-r--r-- 1 zulip zulip  1036 Aug 25 14:49 dev_settings.py
-rw-r--r-- 1 zulip zulip   820 Aug 25 14:49 dev_urls.py
-rw-r--r-- 1 zulip zulip     0 Aug 25 14:49 __init__.py
-rw-r--r-- 1 zulip zulip   151 Aug 31 22:56 __init__.pyc
drwxr-xr-x 2 zulip zulip  4096 Aug 25 14:49 jinja2
-rw-r--r-- 1 zulip zulip  3138 Aug 25 14:49 legacy_urls.py
lrwxrwxrwx 1 root  root     22 Aug 31 22:45 prod_settings.py -&gt; /etc/zulip/settings.py
-rw-r--r-- 1 zulip zulip  1851 Aug 31 22:56 prod_settings.pyc
-rw-r--r-- 1 zulip zulip 16710 Aug 25 14:49 prod_settings_template.py
-rw-r--r-- 1 zulip zulip 38716 Aug 25 14:49 settings.py
-rw-r--r-- 1 zulip zulip 24138 Aug 31 22:56 settings.pyc
-rw-r--r-- 1 zulip zulip    59 Aug 25 14:49 terms.md.template
-rw-r--r-- 1 zulip zulip 15140 Aug 25 14:49 urls.py
-rw-r--r-- 1 zulip zulip  1340 Aug 25 14:49 wsgi.py
</pre></div>



<a name="21398"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21398" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21398">(Sep 01 2016 at 02:02)</a>:</h4>
<p>I think that is right...</p>



<a name="21399"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21399" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21399">(Sep 01 2016 at 02:03)</a>:</h4>
<p>yeah, it looks correct</p>



<a name="21400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21400">(Sep 01 2016 at 02:04)</a>:</h4>
<p>I think you might have gotten a different error this time, though. It looks like a postgres error?</p>



<a name="21401"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21401" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21401">(Sep 01 2016 at 02:04)</a>:</h4>
<p>postgres server is currently down...</p>



<a name="21402"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21402" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21402">(Sep 01 2016 at 02:05)</a>:</h4>
<p>I started it and re-running...</p>



<a name="21403"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21403" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21403">(Sep 01 2016 at 02:06)</a>:</h4>
<p>looks like it finished.<br>
trying to log in</p>



<a name="21404"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21404" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21404">(Sep 01 2016 at 02:08)</a>:</h4>
<p>I'm in and it looks like upgrade completed!<br>
<img alt=":smile:" class="emoji" src="/static/third/gemoji/images/emoji/smile.png" title=":smile:"> </p>
<div class="codehilite"><pre>root@zulip:/home/zulip/deployments# ls -l
total 8
drwxr-xr-x 14 zulip zulip 4096 Aug 17 20:00 2016-06-21-23-34-49
drwxr-xr-x 15 zulip zulip 4096 Aug 31 23:05 2016-08-31-22-05-33
lrwxrwxrwx  1 zulip zulip   43 Aug 31 23:06 current -&gt; /home/zulip/deployments/2016-08-31-22-05-33
srwx------  1 zulip zulip    0 Aug 31 23:06 fastcgi-socket
lrwxrwxrwx  1 zulip zulip   43 Aug 31 23:06 last -&gt; /home/zulip/deployments/2016-06-21-23-34-49
lrwxrwxrwx  1 zulip zulip   43 Aug 31 22:05 next -&gt; /home/zulip/deployments/2016-08-31-22-05-33
</pre></div>



<a name="21405"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21405" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21405">(Sep 01 2016 at 02:08)</a>:</h4>
<p>yay!</p>



<a name="21406"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21406" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21406">(Sep 01 2016 at 02:08)</a>:</h4>
<p>yay!</p>



<a name="21407"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21407" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21407">(Sep 01 2016 at 02:08)</a>:</h4>
<p>thanks!</p>



<a name="21408"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21408" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21408">(Sep 01 2016 at 02:09)</a>:</h4>
<p>is there a way to show version of server running when logged in?</p>



<a name="21409"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21409" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21409">(Sep 01 2016 at 02:09)</a>:</h4>
<p>Thanks for your patience slogging through this!</p>



<a name="21410"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21410" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21410">(Sep 01 2016 at 02:09)</a>:</h4>
<p>fun!</p>



<a name="21411"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21411" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21411">(Sep 01 2016 at 02:10)</a>:</h4>
<p>I'm not aware of any way to check the version of the server from the browser.  I vaguely recall a ticket is open on this, but not sure.</p>



<a name="21412"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21412" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21412">(Sep 01 2016 at 02:11)</a>:</h4>
<p>ok... after an upgrade, I'd like to be able to get it to report the version...</p>



<a name="21413"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21413" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21413">(Sep 01 2016 at 02:11)</a>:</h4>
<p>I'm going to shutdown vm, snapshot and bring it back up... </p>



<a name="21414"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21414" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21414">(Sep 01 2016 at 02:11)</a>:</h4>
<p>thanks for the help folks</p>



<a name="21415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21415">(Sep 01 2016 at 02:12)</a>:</h4>
<p>no prob...I'll go create a version ticket now</p>



<a name="21416"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21416" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21416">(Sep 01 2016 at 02:13)</a>:</h4>
<p>all of a sudden I have huge latency from my digital ocean vms</p>



<a name="21417"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21417" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21417">(Sep 01 2016 at 02:13)</a>:</h4>
<p>ugh</p>



<a name="21418"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21418" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21418">(Sep 01 2016 at 02:14)</a>:</h4>
<p>my vm's run in virtualbox on my ancient Mac Pro tower.  <img alt=":grimacing:" class="emoji" src="/static/third/gemoji/images/emoji/grimacing.png" title=":grimacing:"> </p>



<a name="21419"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21419" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21419">(Sep 01 2016 at 02:22)</a>:</h4>
<p>rabbitmq-server didn't start automatically and I had to start it manually with the init script<br>
zulip client tells me that it is "not a vaild zulip server" when I try to switch to it, but I can log in with a web brower.</p>



<a name="21420"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21420" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21420">(Sep 01 2016 at 02:23)</a>:</h4>
<p><a href="/user_uploads/2/80/bg-H65MI_dGjJ5n88GwVqqEr/Screen-Shot-2016-08-31-at-11.21.28-PM.png" target="_blank" title="Screen-Shot-2016-08-31-at-11.21.28-PM.png">typo.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/2/80/bg-H65MI_dGjJ5n88GwVqqEr/Screen-Shot-2016-08-31-at-11.21.28-PM.png" target="_blank" title="Screen-Shot-2016-08-31-at-11.21.28-PM.png"><img src="/user_uploads/2/80/bg-H65MI_dGjJ5n88GwVqqEr/Screen-Shot-2016-08-31-at-11.21.28-PM.png"></a></div>



<a name="21421"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21421" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21421">(Sep 01 2016 at 02:24)</a>:</h4>
<p>wonder why it says that the server is not valid?</p>



<a name="21422"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21422" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21422">(Sep 01 2016 at 02:25)</a>:</h4>
<p>It's 11:25PM, so that is a question for tomorrow.</p>



<a name="21433"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21433" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21433">(Sep 01 2016 at 03:47)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> <a href="https://github.com/zulip/zulip/pull/1746" target="_blank" title="https://github.com/zulip/zulip/pull/1746">https://github.com/zulip/zulip/pull/1746</a> my attempt at a fix. works on my dev server</p>



<a name="21435"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21435" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21435">(Sep 01 2016 at 05:08)</a>:</h4>
<p>cool, ping me tomorrow so we can figure out the other pieces to this (re-sending the release email or whatever, may have to wait for TIm)</p>



<a name="21436"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21436" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21436">(Sep 01 2016 at 05:10)</a>:</h4>
<p><span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> Do you have the ability to upload a new tarball to <a href="https://www.zulip.com/dist/releases/" target="_blank" title="https://www.zulip.com/dist/releases/">https://www.zulip.com/dist/releases/</a>?</p>



<a name="21444"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21444" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21444">(Sep 01 2016 at 06:25)</a>:</h4>
<p>I think I do, though I haven't managed to figure out how to make the tarball correctly. I can play with it a bit more tomorrow.</p>



<a name="21504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21504">(Sep 01 2016 at 17:00)</a>:</h4>
<p>pinging <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> and <span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> about getting her fix merged, possibly a new tarball uploaded, and possibly some new communication sent out regarding the upgrade issue</p>



<a name="21506"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21506" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21506">(Sep 01 2016 at 17:01)</a>:</h4>
<p>I'm here for a bit, then will need to run an errand.</p>



<a name="21507"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21507" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21507">(Sep 01 2016 at 17:01)</a>:</h4>
<p>One thing -- my branch for that PR was made off master, not the 1.4.0 tag</p>



<a name="21508"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21508" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21508">(Sep 01 2016 at 17:01)</a>:</h4>
<p>Not sure if we want to cherry-pick just that fix or use other things that have been merged into master since the 1.4.0 release</p>



<a name="21509"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21509" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21509">(Sep 01 2016 at 17:02)</a>:</h4>
<p>Ok, sounds good.  I'll be in and out, too.  I think your push looks good, but, yeah, I need to figure out where to merge it.</p>



<a name="21510"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21510" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21510">(Sep 01 2016 at 17:02)</a>:</h4>
<p>I probably should have made a branch from 1.4.0</p>



<a name="21511"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21511" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21511">(Sep 01 2016 at 17:02)</a>:</h4>
<p>I'm 90% sure that we should rebase off of 1.4.0 for now and create a special "fix" branch.</p>



<a name="21513"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21513" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21513">(Sep 01 2016 at 17:03)</a>:</h4>
<p>I can handle the rebase, don't worry about that.  It's more deciding how we want to present this to the world that's a problem, and I think we need Rishi for that.</p>



<a name="21514"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21514" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21514">(Sep 01 2016 at 17:03)</a>:</h4>
<p>Okay, thanks for taking care of the rebase.</p>



<a name="21517"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21517" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21517">(Sep 01 2016 at 17:04)</a>:</h4>
<p>At least there's a work around, but yeah, I feel like getting a fix out quickly is good.</p>



<a name="21518"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21518" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21518">(Sep 01 2016 at 17:04)</a>:</h4>
<p>If you do have some today, I think it's probably worthwhile for us to rm local_settings.py, like you mentioned in the PR, but I don't consider that a critical issue for putting out a fix.</p>



<a name="21521"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21521" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21521">(Sep 01 2016 at 17:05)</a>:</h4>
<p>I should be able to do that after running my errand. </p>



<a name="21522"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21522" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21522">(Sep 01 2016 at 17:05)</a>:</h4>
<p>Fixing the code is the easy part. The more time consuming part is testing it. </p>



<a name="21531"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21531" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21531">(Sep 01 2016 at 17:15)</a>:</h4>
<p>Indeed.</p>



<a name="21540"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21540" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21540">(Sep 01 2016 at 22:05)</a>:</h4>
<p>PR updated to remove local_settings.py symlink if it exists <a href="https://github.com/zulip/zulip/pull/1746" target="_blank" title="https://github.com/zulip/zulip/pull/1746">https://github.com/zulip/zulip/pull/1746</a></p>



<a name="21541"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21541" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21541">(Sep 01 2016 at 22:05)</a>:</h4>
<p>and tested on 1.3.13 &gt; 1.4.0 upgrade</p>



<a name="21543"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21543" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21543">(Sep 01 2016 at 22:13)</a>:</h4>
<p>Awesome!  Do you agree with me that we should at least simple-merge this to master for now?  Here's my reasoning:<br>
- Anybody that upgrades from master will have no problems.<br>
- Nothing major has hit master since 1.4.0<br>
- Rewriting history on the master branch isn't really gonna help anybody installing off the 1.4.0 branch.<br>
- Once Tim gets back, we can decide on more permanent history-rewriting as needed.</p>



<a name="21544"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21544" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21544">(Sep 01 2016 at 22:14)</a>:</h4>
<p>It is also easy to "twist my arm" and just do nothing proactive until Tim comes back, since now anybody that shows up on Zulip tomorrow will be greeted by us with the workaround, and we can always do a reactive branch with your fixes.</p>



<a name="21545"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21545" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21545">(Sep 01 2016 at 22:26)</a>:</h4>
<p><span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> Any thoughts on communication to potential upgraders?</p>



<a name="21546"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21546" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21546">(Sep 01 2016 at 22:49)</a>:</h4>
<p>Once you have a 1.4.1 (or whatever you want to number/name it), I should be able to test re-running the upgrade. I still have a clone and snapshot of my server that I can test on.</p>



<a name="21549"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21549" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21549">(Sep 01 2016 at 22:59)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> when you say "simple merge" do you merge as we would most other PR?</p>



<a name="21550"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21550" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21550">(Sep 01 2016 at 22:59)</a>:</h4>
<p>yeah, just rebase on top of master, <span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> </p>



<a name="21551"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21551" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21551">(Sep 01 2016 at 23:00)</a>:</h4>
<p>oops, sorry for disappearing. I do have bits for upgrading <a href="http://zulipchat.com" target="_blank" title="http://zulipchat.com">zulipchat.com</a>, but I think I don't actually have bits for putting out a new tarball release</p>



<a name="21552"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21552" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21552">(Sep 01 2016 at 23:00)</a>:</h4>
<p>currently looking into it</p>



<a name="21553"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21553" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21553">(Sep 01 2016 at 23:00)</a>:</h4>
<p>Given what <span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span> said just now, I'm more inclined to push to master, and we can have him try upgrading from git</p>



<a name="21554"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21554" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21554">(Sep 01 2016 at 23:00)</a>:</h4>
<p>Upgrade from git only works starting with 1.4</p>



<a name="21555"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21555" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21555">(Sep 01 2016 at 23:00)</a>:</h4>
<p>afaik</p>



<a name="21556"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21556" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21556">(Sep 01 2016 at 23:01)</a>:</h4>
<p><span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> At this point, maybe the best tactic is just to send out some communication...</p>
<blockquote>
<p>If you are about to install, please go to ztn for guidance.</p>
</blockquote>



<a name="21557"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21557" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21557">(Sep 01 2016 at 23:01)</a>:</h4>
<p>yeah</p>



<a name="21558"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21558" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21558">(Sep 01 2016 at 23:01)</a>:</h4>
<p>I don't like that the upgrade is broken, but I also think it's low-exposure given the Labour Day holiday.</p>



<a name="21559"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21559" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21559">(Sep 01 2016 at 23:01)</a>:</h4>
<p>And we have a pretty easy to apply work-around</p>



<a name="21560"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21560" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21560">(Sep 01 2016 at 23:02)</a>:</h4>
<p>I noticed earlier that I can't edit sent messages on my server.I thought it was an issue with the alpha client, but it seems to be happening in a browser also. I wonder if this is an issue with the server.</p>



<a name="21561"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21561" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21561">(Sep 01 2016 at 23:02)</a>:</h4>
<p><span class="user-mention" data-user-email="christie@authenticengine.com">@Christie Koehler</span> ah, good point, so maybe we wait on pushing to master, and just deal with anybody who needs to upgrade before TIm gets back</p>



<a name="21562"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21562" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21562">(Sep 01 2016 at 23:02)</a>:</h4>
<p>Yeah, I think that's best.</p>



<a name="21563"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21563" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21563">(Sep 01 2016 at 23:03)</a>:</h4>
<p>We could send a note to zulip-dev</p>



<a name="21564"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21564" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21564">(Sep 01 2016 at 23:04)</a>:</h4>
<p><span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span> Hmmmm.  We have mucked with the edit code recently.  One of the changes is intentional--we prevent people from editing messages too late after the fact.   But the settings on that might not have the perfect defaults for somebody upgrading and used to the old behavior.  (Or it could just be a bug.)</p>



<a name="21565"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21565" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21565">(Sep 01 2016 at 23:04)</a>:</h4>
<p><span class="user-mention" data-user-email="gervais@demontbrun.com">@GervaisdeM</span> Do you not have the option (e..g the user interface for 'edit'), or does editing just not work?</p>



<a name="21566"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21566" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21566">(Sep 01 2016 at 23:04)</a>:</h4>
<p>Yeah, and google groups, or is that one and the same,  Christie?</p>



<a name="21567"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21567" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21567">(Sep 01 2016 at 23:05)</a>:</h4>
<p>It looks locked, so might be that I just went back too late to edit the message</p>



<a name="21568"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21568" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Christie Koehler <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21568">(Sep 01 2016 at 23:05)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> afaik zulip-dev is the google group</p>



<a name="21569"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21569" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21569">(Sep 01 2016 at 23:05)</a>:</h4>
<p>rock/paper/scissors for who sends out the GG update</p>



<a name="21570"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21570" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21570">(Sep 01 2016 at 23:06)</a>:</h4>
<p>If I had a vote, I would like to be able to edit any message no matter how old... I've gone back and edited messages that were months old that I post for users to read...</p>



<a name="21571"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21571" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21571">(Sep 01 2016 at 23:06)</a>:</h4>
<p>Let me test...</p>



<a name="21572"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21572" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21572">(Sep 01 2016 at 23:06)</a>:</h4>
<p>yeah, I think the new code is a little too stringent</p>



<a name="21573"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21573" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21573">(Sep 01 2016 at 23:07)</a>:</h4>
<p>yep... editing works if I edit right away, so must be new code.</p>



<a name="21574"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21574" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21574">(Sep 01 2016 at 23:07)</a>:</h4>
<p>There's an admin setting that controls how long messages can be edited</p>



<a name="21575"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21575" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21575">(Sep 01 2016 at 23:07)</a>:</h4>
<p>I agree with the thought process that once a message has lived on the server for a few hours, everybody assumes that was the final message, but if you want to edit a message, you want to edit a message, and we should mostly leave it up to the discretion of the person who originally wrote it</p>



<a name="21576"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21576" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21576">(Sep 01 2016 at 23:08)</a>:</h4>
<p>cool... found the setting</p>



<a name="21577"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21577" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21577">(Sep 01 2016 at 23:08)</a>:</h4>
<p>thanks</p>



<a name="21578"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21578" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21578">(Sep 01 2016 at 23:08)</a>:</h4>
<p>and yeah, it is fairly new</p>



<a name="21579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21579">(Sep 01 2016 at 23:09)</a>:</h4>
<p>makes sense about people thinking messages will be unchanged</p>



<a name="21580"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21580" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21580">(Sep 01 2016 at 23:09)</a>:</h4>
<p>I think the new feature is probably fine once we address the confusion factor.</p>



<a name="21581"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21581" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21581">(Sep 01 2016 at 23:10)</a>:</h4>
<p>yep.</p>



<a name="21582"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21582" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21582">(Sep 01 2016 at 23:10)</a>:</h4>
<p>once I know that it is new behaviour and why it was set, it makes sense</p>



<a name="21583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21583">(Sep 01 2016 at 23:10)</a>:</h4>
<p>We can probably make the hover a little smarter and say "You can't edit this now.  Do this instead."</p>



<a name="21584"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21584" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21584">(Sep 01 2016 at 23:11)</a>:</h4>
<p>yeah, editing the hover seems like a good solution</p>



<a name="21585"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21585" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21585">(Sep 01 2016 at 23:11)</a>:</h4>
<p>or the question mark next to the timer</p>



<a name="21586"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21586" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21586">(Sep 01 2016 at 23:11)</a>:</h4>
<p>and maybe just tune the default a little bit...I don't know what the current default is, but I think it's fair game to edit a message within several hours, and let social pressures constrain abuse</p>



<a name="21587"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21587" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21587">(Sep 01 2016 at 23:13)</a>:</h4>
<p>I still have a couple other things to sort out.<br>
1. rabbitmq doesn't start after reboot, but starts fine with init scwipt manually<br>
2. twitter-bot items in my feed doesn't show images when using the zulip client... it does however when I log into my server with a browser.</p>
<p>I haven't done any debugging, looking for an issue yet, so not really looking for help tracking it down. Unless someone knows that this is an issue and already knows the answer.  <img alt=":smile:" class="emoji" src="/static/third/gemoji/images/emoji/smile.png" title=":smile:"> </p>



<a name="21588"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21588" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21588">(Sep 01 2016 at 23:14)</a>:</h4>
<p>so all of our client apps, besides the browser, are either highly deprecated or highly alpha</p>



<a name="21589"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21589" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21589">(Sep 01 2016 at 23:15)</a>:</h4>
<p>(1) is a known problem (though I unfortunately don't know the solution)</p>



<a name="21590"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21590" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21590">(Sep 01 2016 at 23:16)</a>:</h4>
<p>yep... but the images only stopped workingin the clients  post-upgrade</p>



<a name="21591"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21591" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21591">(Sep 01 2016 at 23:16)</a>:</h4>
<p>known issue = great.  :) <br>
I'll assume people smarter than me will sort it out</p>



<a name="21592"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21592" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21592">(Sep 01 2016 at 23:16)</a>:</h4>
<p>but given the choice between deprecated and alpha, I would definitely try to migrate toward the alpha</p>



<a name="21593"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21593" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21593">(Sep 01 2016 at 23:17)</a>:</h4>
<p>(full disclosure: I only use the browser, so anything I say about clients is mostly hearsay, although pretty good hearsay because of the people I talk to)</p>



<a name="21594"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21594" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21594">(Sep 01 2016 at 23:17)</a>:</h4>
<p>I'm running Electron version launched via a script that does a git pull prior to launching the client and the bundled alpha.</p>



<a name="21595"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21595" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21595">(Sep 01 2016 at 23:19)</a>:</h4>
<p>oh, good...and I see you're subscribed to the "electron" stream</p>



<a name="21596"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21596" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21596">(Sep 01 2016 at 23:21)</a>:</h4>
<p>I am sure the "electron" folks would like to know what's up with 1.4.  (Well, maybe their initial reaction will be ah, <img alt=":poop:" class="emoji" src="/static/third/gemoji/images/emoji/poop.png" title=":poop:">, but they'll thank you eventually, and maybe even respect you, haha.)</p>



<a name="21597"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21597" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21597">(Sep 01 2016 at 23:23)</a>:</h4>
<p>Sure... I'll open an issue... I only just noticed that the issue was only in the client this evening.<br>
I'll also go update the issue (non-issue) I reported about edit being broken.</p>



<a name="21598"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21598" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21598">(Sep 01 2016 at 23:23)</a>:</h4>
<p>sounds good</p>



<a name="21601"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21601" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21601">(Sep 01 2016 at 23:36)</a>:</h4>
<p>If we're emailing out to zulip-dev, it may also make sense to include the file uploads problem: <a href="https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found" target="_blank" title="https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found">https://zulip.tabbott.net/#narrow/near/20217/stream/installation.20help/topic/file.20uploads.20not.20found</a></p>



<a name="21603"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21603" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> GervaisdeM <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21603">(Sep 01 2016 at 23:49)</a>:</h4>
<p>One other thing... the upgrade overwrote /etc/nginx/sites-available/zulip-enterprise back to the default. I had edited the copy on my server to point to different cert/key. The original seems to point to a self signed cert. I fixed it again.Slightly differently this time.</p>



<a name="21604"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21604" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21604">(Sep 01 2016 at 23:55)</a>:</h4>
<p>I think it makes sense for us to collectively draft a message that we'll send to GG, either here on Zulip or maybe on Paper, and then one of us does the deed of sending it out.</p>



<a name="21608"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21608" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21608">(Sep 02 2016 at 00:00)</a>:</h4>
<p>can people see/edit <a href="https://paper.dropbox.com/doc/test-SqU6foVPiDSq7OxIlv3q9" target="_blank" title="https://paper.dropbox.com/doc/test-SqU6foVPiDSq7OxIlv3q9">https://paper.dropbox.com/doc/test-SqU6foVPiDSq7OxIlv3q9</a> ?</p>



<a name="21609"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21609" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21609">(Sep 02 2016 at 00:11)</a>:</h4>
<p>I can see that.  I was simultaneously working on my own draft...</p>



<a name="21610"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21610" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21610">(Sep 02 2016 at 00:12)</a>:</h4>
<p><a href="https://paper.dropbox.com/doc/Message-to-users-sXMlUnaatWkDY3seLKvfL" target="_blank" title="https://paper.dropbox.com/doc/Message-to-users-sXMlUnaatWkDY3seLKvfL">https://paper.dropbox.com/doc/Message-to-users-sXMlUnaatWkDY3seLKvfL</a></p>



<a name="21612"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21612" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21612">(Sep 02 2016 at 00:17)</a>:</h4>
<p>ah, haha</p>



<a name="21613"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21613" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21613">(Sep 02 2016 at 00:19)</a>:</h4>
<p>I think it might make sense to send a shortish version of this to zulip-announce</p>



<a name="21614"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21614" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21614">(Sep 02 2016 at 00:23)</a>:</h4>
<p>yeah, I think something something only a little more elaborate than "upgrade bug -&gt; find help here" will do the job</p>



<a name="21615"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21615" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21615">(Sep 02 2016 at 00:25)</a>:</h4>
<p>/me working on a zulip-announce version</p>



<a name="21616"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21616" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21616">(Sep 02 2016 at 00:25)</a>:</h4>
<p>sounds good</p>



<a name="21617"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21617" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21617">(Sep 02 2016 at 00:25)</a>:</h4>
<p>how serious is the file uploads directory path bug?</p>



<a name="21618"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21618" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21618">(Sep 02 2016 at 00:25)</a>:</h4>
<p>for the technical details that might help self-helpers we can alway reply</p>



<a name="21619"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21619" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21619">(Sep 02 2016 at 00:25)</a>:</h4>
<p>it also seems like something most people will run in to?</p>



<a name="21620"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21620" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21620">(Sep 02 2016 at 00:26)</a>:</h4>
<p>I think the file-uploads bug basically affects all messages with attachments, so I don't consider it catastrophic, but it's not trivial either</p>



<a name="21621"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21621" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21621">(Sep 02 2016 at 00:26)</a>:</h4>
<p>got it</p>



<a name="21622"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21622" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21622">(Sep 02 2016 at 01:43)</a>:</h4>
<p>okay, will send <a href="https://paper.dropbox.com/doc/Known-issues-with-upgrading-to-Zulip-server-1.4.0-SqU6foVPiDSq7OxIlv3q9" target="_blank" title="https://paper.dropbox.com/doc/Known-issues-with-upgrading-to-Zulip-server-1.4.0-SqU6foVPiDSq7OxIlv3q9">https://paper.dropbox.com/doc/Known-issues-with-upgrading-to-Zulip-server-1.4.0-SqU6foVPiDSq7OxIlv3q9</a> to zulip-announce in 30 minutes or so, modulo comments</p>



<a name="21623"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21623" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21623">(Sep 02 2016 at 01:51)</a>:</h4>
<p>I think we need to be a little more explicit that issue 1 is basically a show-stopper.</p>



<a name="21624"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21624" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21624">(Sep 02 2016 at 01:52)</a>:</h4>
<p>got it</p>



<a name="21625"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21625" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21625">(Sep 02 2016 at 02:51)</a>:</h4>
<p>it looks like Luke (from Dropbox) can in fact do server releases</p>



<a name="21626"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21626" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21626">(Sep 02 2016 at 02:52)</a>:</h4>
<p>I think we should just do a 1.4.1 release with this and the file uploads path fixed</p>



<a name="21627"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21627" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21627">(Sep 02 2016 at 02:54)</a>:</h4>
<p>I'll try to figure out how to create the tarballs, but <span class="user-mention" data-user-email="showell30@yahoo.com">@Steve Howell</span> if you come on-line let me know :)</p>



<a name="21628"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21628" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21628">(Sep 02 2016 at 02:56)</a>:</h4>
<p>It might be easiest to just point Luke to Christie's fix and let him take it from there, just so there are fewer moving parts, but I'll be online tomorrow.</p>



<a name="21629"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21629" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21629">(Sep 02 2016 at 02:56)</a>:</h4>
<p>cool, thanks!</p>



<a name="21630"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21630" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21630">(Sep 02 2016 at 02:58)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/pull/1746" target="_blank" title="https://github.com/zulip/zulip/pull/1746">#1746</a> rebased on 1.4.0 branch</p>



<a name="21631"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21631" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21631">(Sep 02 2016 at 02:59)</a>:</h4>
<p>one quick question for now: is tools/build-release-tarball all that needs to be done?</p>



<a name="21632"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21632" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21632">(Sep 02 2016 at 02:59)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/blob/master/tools/build-release-tarball" target="_blank" title="https://github.com/zulip/zulip/blob/master/tools/build-release-tarball">https://github.com/zulip/zulip/blob/master/tools/build-release-tarball</a></p>



<a name="21633"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21633" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21633">(Sep 02 2016 at 03:00)</a>:</h4>
<p>cool, thanks!</p>



<a name="21634"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21634" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21634">(Sep 02 2016 at 03:01)</a>:</h4>
<p><a href="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading">http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading</a></p>



<a name="21635"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21635" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21635">(Sep 02 2016 at 03:03)</a>:</h4>
<p>to answer your question, in a narrow context, yes, all we need to do is essentially publish a new tarball with Christie's change, and then when folks upgrade off the tarball, the stage-2 part of the upgrade will pick up her changes and do the right thing</p>



<a name="21636"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21636" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21636">(Sep 02 2016 at 03:14)</a>:</h4>
<p>cool! Also reverting <a href="https://github.com/zulip/zulip/commit/4d2cb3754c80605af3ec0494f95391b0f0025124" target="_blank" title="https://github.com/zulip/zulip/commit/4d2cb3754c80605af3ec0494f95391b0f0025124">https://github.com/zulip/zulip/commit/4d2cb3754c80605af3ec0494f95391b0f0025124</a> (the file uploads change), unless that seems like a bad idea</p>



<a name="21637"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21637" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21637">(Sep 02 2016 at 03:14)</a>:</h4>
<p>You might want to take a quick skim of the upgrade docs just to make sure the language in the upgrade docs doesn't conflict with a hot-fix kind of procedure.</p>



<a name="21638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21638">(Sep 02 2016 at 03:14)</a>:</h4>
<p>will do</p>



<a name="21639"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21639" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21639">(Sep 02 2016 at 03:15)</a>:</h4>
<p>Don't revert the uploads fix, because we made some changes afterward that depended on it.</p>



<a name="21640"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21640" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21640">(Sep 02 2016 at 03:17)</a>:</h4>
<p>ah, cool</p>



<a name="21641"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21641" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21641">(Sep 02 2016 at 03:18)</a>:</h4>
<p>I think the uploads thing should be a one-line fix to our nginx config, but I wasn't as deeply engaged in that issue as I was with the prod_settings symlink.</p>



<a name="21642"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21642" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21642">(Sep 02 2016 at 03:20)</a>:</h4>
<p><code>puppet/zulip/files/nginx/sites-available/zulip-enterprise</code></p>



<a name="21643"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21643" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21643">(Sep 02 2016 at 03:22)</a>:</h4>
<p>Hmmmmm...I don't know what our process was supposed to be to move those files during the upgrade.</p>



<a name="21644"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21644" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21644">(Sep 02 2016 at 03:24)</a>:</h4>
<p>I have one hint from Tim, who managed to pull a few minutes of phone service at the beginning of the week: <br>
"This seems like a regression worth doing a quick cherry pick release to fix, since it sounds like prod file uploads are broken, and I think it's kinda messy to fix after someone upgrades because their file uploads will be split between two directories.</p>
<p>I think we intended the path to have changed only in development. "</p>



<a name="21645"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21645" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21645">(Sep 02 2016 at 03:27)</a>:</h4>
<p>yeah, that makes sense...if you revert the "-&gt; var" change and break dev, it's not the end of the world, but it's probably better to figure out how to just limit it to dev with a new commit</p>



<a name="21646"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21646" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21646">(Sep 02 2016 at 03:29)</a>:</h4>
<p>makes sense</p>



<a name="21647"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21647" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21647">(Sep 02 2016 at 03:29)</a>:</h4>
<p>People who are doing upgrades should technically already have this in /etc/zulip/settings.py if I'm reading the code right</p>



<a name="21648"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21648" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21648">(Sep 02 2016 at 03:31)</a>:</h4>
<p>seems to be set to None in settings.py</p>



<a name="21649"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21649" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21649">(Sep 02 2016 at 03:31)</a>:</h4>
<p>I don't see how reverting the change you mentioned earlier will actually help most people...I am starting to think the upload problems might have been a strange side effect of the bigger problem of people not having prod_settings.py</p>



<a name="21650"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21650" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21650">(Sep 02 2016 at 03:31)</a>:</h4>
<p>ah</p>



<a name="21651"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21651" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21651">(Sep 02 2016 at 03:32)</a>:</h4>
<p>if you look at the change that you proposed to revert, it only touches dev stuff and <code>local_settings_template.py</code></p>



<a name="21652"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21652" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21652">(Sep 02 2016 at 03:33)</a>:</h4>
<p>take everything I say with a grain of salt, by the way...I don't know a ton about the upgrade procedure, and I'm kinda at the end of my day</p>



<a name="21653"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21653" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21653">(Sep 02 2016 at 03:33)</a>:</h4>
<p>is prod_settings_template the right place to look? There we do have <code>LOCAL_UPLOADS_DIR = "/home/zulip/var/uploads"</code></p>



<a name="21654"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21654" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21654">(Sep 02 2016 at 03:33)</a>:</h4>
<p>cool, and yeah</p>



<a name="21655"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21655" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21655">(Sep 02 2016 at 03:34)</a>:</h4>
<p>I'll just put Christie's change in for now</p>



<a name="21656"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21656" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21656">(Sep 02 2016 at 03:34)</a>:</h4>
<p>even that should be fine, I think, since for new installs, that's no problem</p>



<a name="21657"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21657" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21657">(Sep 02 2016 at 03:34)</a>:</h4>
<p>I see</p>



<a name="21658"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21658" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21658">(Sep 02 2016 at 03:38)</a>:</h4>
<p>I think re:uploads most people should be fine short-term, but we eventually want upgrade to coax people to put files into a "standard" upload directory...but as long as they're saving files somewhere in the FS that doesn't get overwritten and they don't muck with /etc/zulip/settings.py, I <strong>think</strong> they should be ok</p>



<a name="21659"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21659" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21659">(Sep 02 2016 at 03:42)</a>:</h4>
<p>though as long as it is coordinated with nginx?</p>



<a name="21660"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21660" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21660">(Sep 02 2016 at 03:43)</a>:</h4>
<p>(either way, I think it's fine to figure something out once Tim is back)</p>



<a name="21661"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21661" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21661">(Sep 02 2016 at 03:47)</a>:</h4>
<p>ugh, still getting differences between my 1.4.0 build and what's on the server</p>



<a name="21662"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21662" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21662">(Sep 02 2016 at 03:47)</a>:</h4>
<p>in the javascript</p>



<a name="21663"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21663" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21663">(Sep 02 2016 at 03:59)</a>:</h4>
<p>oh...actually, it looks like the nginx config will break fresh installs</p>



<a name="21664"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21664" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21664">(Sep 02 2016 at 03:59)</a>:</h4>
<p>but that's an easy retroactive fix</p>



<a name="21665"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21665" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21665">(Sep 02 2016 at 03:59)</a>:</h4>
<p>the javascript changes seem like they might just be due to the minimizer</p>



<a name="21666"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21666" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21666">(Sep 02 2016 at 04:02)</a>:</h4>
<p>though obviously not the easiest thing to tell :). Going to just go for it.</p>



<a name="21667"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21667" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21667">(Sep 02 2016 at 04:02)</a>:</h4>
<p>We really need to stop minifying our JS files. </p>



<a name="21668"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21668" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21668">(Sep 02 2016 at 04:02)</a>:</h4>
<p>the current nginx config?</p>



<a name="21669"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21669" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21669">(Sep 02 2016 at 04:03)</a>:</h4>
<p>the current nginx config seems to conflict with the settings template</p>



<a name="21670"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21670" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21670">(Sep 02 2016 at 04:05)</a>:</h4>
<p>although <code>prod_settings_template.py</code> has a super long comment about nginx, so a reasonably savvy Unix admin will figure it out</p>



<a name="21671"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21671" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21671">(Sep 02 2016 at 04:06)</a>:</h4>
<p>it seems like we could just change the value in prod_settings_template?</p>



<a name="21672"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21672" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21672">(Sep 02 2016 at 04:07)</a>:</h4>
<p>I think we should change the value on the nginx side, actually...switching to "var" is a good thing, we just need to manage the transition</p>



<a name="21673"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21673" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21673">(Sep 02 2016 at 04:07)</a>:</h4>
<p>got it</p>



<a name="21674"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21674" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21674">(Sep 02 2016 at 04:09)</a>:</h4>
<p>both of these files get managed "outside" of Zulip, so it's only during broken-upgrade situations that they get out of sync</p>



<a name="21675"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21675" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21675">(Sep 02 2016 at 04:09)</a>:</h4>
<p>ah, I was wondering how to get to /etc/nginx/sites-available/zulip-enterprise :)</p>



<a name="21676"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21676" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21676">(Sep 02 2016 at 04:11)</a>:</h4>
<p>puppet puts it out there originally...I'm not completely sure what happens during an upgrade...hopefully puppet is smart enough to leave it alone if it's already there, since a Zulip admin may have modified it during a previous release</p>



<a name="21677"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21677" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21677">(Sep 02 2016 at 04:12)</a>:</h4>
<p>got it</p>



<a name="21678"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21678" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21678">(Sep 02 2016 at 04:12)</a>:</h4>
<p>I am going to bed.  Hopefully I've given you the gist of what you need to look at, but I can track down things with more certainty tomorrow.</p>



<a name="21679"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21679" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21679">(Sep 02 2016 at 04:12)</a>:</h4>
<p>cool, thanks!</p>



<a name="21680"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21680" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21680">(Sep 02 2016 at 04:12)</a>:</h4>
<p>and sorry for pushing this way past the end of your day</p>



<a name="21681"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21681" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21681">(Sep 02 2016 at 04:13)</a>:</h4>
<p>haha, no prob, later</p>



<a name="21682"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21682" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21682">(Sep 02 2016 at 04:13)</a>:</h4>
<p>night!</p>



<a name="21708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21708">(Sep 02 2016 at 19:01)</a>:</h4>
<p>So I looked at var/uploads again, and I think now I understand what Tim was saying to <span class="user-mention" data-user-email="rishig@zulipchat.com">@Rishi Gupta</span> (based on Rishi's summary).  We should continue to have production hit <code>/home/zulip/uploads</code> with no "var".  The main purpose of the "var" convention is to make it easy to write stuff inside of our git repo when running a dev instance, and then "var" gets excluded from checkins.  For production, that's not as much of a concern.<br>
For upgrades we don't want to be changing the directory around and confusing matters, especially with the extra moving part of nginx configs (which have their own issues in terms of being overwritten by accident when admins go to S3).<br>
So, long story short...</p>



<a name="21709"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21709" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21709">(Sep 02 2016 at 19:02)</a>:</h4>
<p>We should do this:</p>
<div class="codehilite"><pre>$ git diff
diff --git a/zproject/prod_settings_template.py b/zproject/prod_settings_template.py
index 4a5750b..d0eef7f 100644
--- a/zproject/prod_settings_template.py
+++ b/zproject/prod_settings_template.py
@@ -155,7 +155,7 @@ INLINE_IMAGE_PREVIEW = True
 # https://github.com/zulip/zulip/issues/291 for discussion of a better
 # solution that won&#39;t be automatically reverted by the Zulip upgrade
 # script), and then restart nginx.
-LOCAL_UPLOADS_DIR = &quot;/home/zulip/var/uploads&quot;
+LOCAL_UPLOADS_DIR = &quot;/home/zulip/uploads&quot;
 #S3_AUTH_UPLOADS_BUCKET = &quot;&quot;
 #S3_AVATAR_BUCKET = &quot;&quot;
 ```
</pre></div>



<a name="21710"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21710" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21710">(Sep 02 2016 at 19:03)</a>:</h4>
<p>(That essentially reverts 1/3 of the commit that added "var/uploads", but keeps the good 2/3 of the commit that makes our dev setup less fragile.)</p>



<a name="21711"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21711" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21711">(Sep 02 2016 at 19:22)</a>:</h4>
<p>cool, makes sense</p>



<a name="21712"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21712" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21712">(Sep 02 2016 at 19:22)</a>:</h4>
<p>I think Luke has not done the deployment yet, so I'll sneak it in to the 1.4.1</p>



<a name="21713"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21713" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21713">(Sep 02 2016 at 19:38)</a>:</h4>
<p>added :)</p>



<a name="21714"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21714" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21714">(Sep 02 2016 at 19:38)</a>:</h4>
<p>nice detective work!</p>



<a name="21715"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21715" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21715">(Sep 02 2016 at 19:39)</a>:</h4>
<p>Thanks!</p>



<a name="21741"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21741" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21741">(Sep 03 2016 at 08:20)</a>:</h4>
<p>update: having trouble getting in touch with Luke, and looks like I don't have bits for zulip-announce (oops), so put it up at <a href="https://dl.dropboxusercontent.com/u/23782125/zulip-server-1.4.1.tar.gz" target="_blank" title="https://dl.dropboxusercontent.com/u/23782125/zulip-server-1.4.1.tar.gz">https://dl.dropboxusercontent.com/u/23782125/zulip-server-1.4.1.tar.gz</a> and sent out the link to zulip-devel</p>



<a name="21744"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20failing/near/21744" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20failing.html#21744">(Sep 03 2016 at 18:12)</a>:</h4>
<p>it's up!</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>