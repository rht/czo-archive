<html>
<head><meta charset="utf-8"><title>zulip 3 on ubuntu xenial · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html">zulip 3 on ubuntu xenial</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="970396"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970396" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970396">(Aug 03 2020 at 13:50)</a>:</h4>
<p>I just attempted an upgrade. I upgraded ubuntu first. Apparently the current postgres is 9, not 10. And during OS upgrade 9 gets upgraded to 10 but with a new empty database (i think). What's the correct order to upgrade to zulip 3 on xenial? Should I have used the upgrade-postgres script before upgrading the OS?</p>



<a name="970400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970400">(Aug 03 2020 at 14:00)</a>:</h4>
<p>I think i found the relevant doc.</p>



<a name="970453"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970453" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970453">(Aug 03 2020 at 16:25)</a>:</h4>
<p>"Upgrading from Ubuntu 16.04 Xenial to 18.04 Bionic"<br>
Step 4: starts with "touch /usr/share/postgresql/10/pgroonga_setup.sql.applied"  but /usr/share/postgresql/10 does not exist.<br>
Xenial to bionic still has postgres 9.5</p>



<a name="970455"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970455" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970455">(Aug 03 2020 at 16:26)</a>:</h4>
<p>Though there's a warning during OS upgrade that you have to install postgres 10 and upgrade cluster later. Maybe a little note in the documentation may be good there.</p>



<a name="970466"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970466" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970466">(Aug 03 2020 at 16:35)</a>:</h4>
<p>also step 5: (same as focal - reinstall zulip) exits with an error message:   "upgrade-zulip-stage-2: error: unrecognized arguments: --audit-fts-indexes" <br>
which i am assuming works in zulip 3 but we're still on 2.1 at this point</p>



<a name="970467"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970467" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970467">(Aug 03 2020 at 16:36)</a>:</h4>
<p>I am running stage-2 without the fts parameter. i am hoping the zulip 3 install will take care of that</p>



<a name="970475"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970475" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970475">(Aug 03 2020 at 16:45)</a>:</h4>
<p>Seems to work fine with the above caveats. I am on 3.1 now.</p>



<a name="970705"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970705" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970705">(Aug 03 2020 at 19:23)</a>:</h4>
<p>The ordering should be:</p>
<ol>
<li><a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-to-a-release">Upgrade to the latest Zulip 2.1</a></li>
<li><a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-from-ubuntu-16-04-xenial-to-18-04-bionic">Upgrade Xenial to Bionic</a>, which should get you Postgres 10, because Zulip 2.1.</li>
<li><a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-to-a-release">Upgrade Zulip to 3.1</a>.</li>
<li><a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-to-a-release">Upgrade Bionic to Focal</a> which will also upgrade you to PostgreSQL 12 in step 4.</li>
</ol>
<p>Can you be more specific about the order you did the zulip and OS upgrades, and which versions were involved in each step?</p>



<a name="970707"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970707" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970707">(Aug 03 2020 at 19:24)</a>:</h4>
<p>We absolutely should drop the <code>--audit-fts-indexes</code> for the non-3.0 OS upgrade instructions -- thanks for that catch!</p>



<a name="970709"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970709" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970709">(Aug 03 2020 at 19:25)</a>:</h4>
<p>But I'm surprised if 2.1 doesn't install PostgreSQL 10 as part of step 2, which _should_ get us a <code>/usr/share/postgresql/10</code></p>



<a name="970858"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970858" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970858">(Aug 03 2020 at 20:18)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> I've been thinking we should add a Step 6 in these instructions that is basically "<code>upgrade-zulip</code> to the latest 3.x release"</p>



<a name="970861"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970861" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970861">(Aug 03 2020 at 20:19)</a>:</h4>
<p>Well, you can't jump right to that after the Trusty -&gt; Xenial upgrade.</p>



<a name="970866"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970866" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970866">(Aug 03 2020 at 20:19)</a>:</h4>
<p>Yeah, for Xenial to Bionic (and Stretch =&gt; Buster)</p>



<a name="970867"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970867" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970867">(Aug 03 2020 at 20:19)</a>:</h4>
<p>For that one, we should just link to "Now do Xenial to Bionic", I think.</p>



<a name="970884"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/970884" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#970884">(Aug 03 2020 at 20:26)</a>:</h4>
<p>Tacked onto <a href="https://github.com/zulip/zulip/pull/16020">https://github.com/zulip/zulip/pull/16020</a></p>



<a name="983798"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/983798" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#983798">(Aug 12 2020 at 11:29)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> if I remember correctly xenial to bionic does give you Postgres 10 (if you read the notice and install it yourself after the fact) but I believe the database is empty with a new cluster at that point which makes the 3.1 update fail. There's a postgres migration script but that's only in 3.1 and after zulip is already upgraded. Unless I did something wrong this is the scenario I encountered.</p>



<a name="984438"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/984438" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#984438">(Aug 12 2020 at 19:49)</a>:</h4>
<p>Just merged that PR, BTW.</p>



<a name="984810"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/984810" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#984810">(Aug 12 2020 at 23:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="4703">Oktay X</span> <a href="#narrow/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial/near/983798">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> if I remember correctly xenial to bionic does give you Postgres 10 (if you read the notice and install it yourself after the fact)</p>
</blockquote>
<p>Can you clarify what you mean by "the notice"?</p>



<a name="1004592"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1004592" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1004592">(Aug 31 2020 at 16:34)</a>:</h4>
<p>The package installer (apt) shows a notice during the postgres install reminding that you need to create a new cluster (database).</p>



<a name="1004619"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1004619" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1004619">(Aug 31 2020 at 16:58)</a>:</h4>
<p>Was there something in the upgrade documentation that implied that you should do that, or were you trying to comply with both our documentation as well as apt's instructions?</p>
<p>I think our only options here are either to explicitly call out not to install the postgres cluster that apt might imply you should, or to make the the installer OK with dropping an empty postgres cluster, which seems potentially dangerous.</p>



<a name="1004633"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1004633" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1004633">(Aug 31 2020 at 17:01)</a>:</h4>
<p><span class="user-mention" data-user-id="4703">@Oktay X</span> can you post the specific text that confused you here?</p>



<a name="1005823"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1005823" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1005823">(Sep 01 2020 at 12:31)</a>:</h4>
<p>I wasn't really confused about the text. It's been a few weeks now since I've done it and i've listed the steps it took to get it working at the top of this thread. I don't remember every detail. But in short, the apt installer says to create the cluster because it won't touch the existing 9.x one. The next step in the zulip docs say to create the database (migrate it) with a script. But at that point the installation is not on 3.x yet and the referred script doesn't exist.</p>



<a name="1005825"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1005825" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1005825">(Sep 01 2020 at 12:33)</a>:</h4>
<p>I think I changed the order of the steps a bit. I installed 3.x,  then ran the database migration script.</p>



<a name="1005844"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1005844" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Oktay X <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1005844">(Sep 01 2020 at 13:03)</a>:</h4>
<p>Perhaps it's best to wait for someone else to report it too.</p>



<a name="1006195"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/zulip%203%20on%20ubuntu%20xenial/near/1006195" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/zulip.203.20on.20ubuntu.20xenial.html#1006195">(Sep 01 2020 at 18:35)</a>:</h4>
<p>OK, thanks for the follow-up!</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>