<html>
<head><meta charset="utf-8"><title>certbot error · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html">certbot error</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1019505"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019505" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019505">(Sep 17 2020 at 22:43)</a>:</h4>
<p>When trying to start up docker-zulip with the latest Zulip 3.2.0, I see this:</p>
<div class="codehilite"><pre><span></span><code>zulip_1       | Generating LetsEncrypt/certbot certificate ...
zulip_1       | + rm -f /data/certs/zulip.key /data/certs/zulip.combined-chain.crt
zulip_1       | + ZULIP_CERTBOT_DEPLOY_HOOK=/sbin/certbot-deploy-hook
zulip_1       | + /home/zulip/deployments/current/scripts/setup/setup-certbot --agree-tos --email=foo --deploy-hook /sbin/certbot-deploy-hook -- cha
t.foo.com
zulip_1       | + case &quot; $os_id $os_id_like &quot; in
zulip_1       | + apt-get install -y certbot
zulip_1       | Reading package lists...
zulip_1       | Building dependency tree...
zulip_1       | Reading state information...
zulip_1       | E: Unable to locate package certbot
zulip_1       | 2020-09-17 22:32:28,988 INFO reaped unknown pid 57
</code></pre></div>


<p>Did the Docker base image for Zulip change so that it doesn't have access to certbot?</p>



<a name="1019506"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019506" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019506">(Sep 17 2020 at 22:45)</a>:</h4>
<p>I've been running this instance just fine for a couple of years,  but now I can't renew the cert and thus the chat can't be used.</p>



<a name="1019507"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019507" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019507">(Sep 17 2020 at 22:46)</a>:</h4>
<p>What version were you running before?  3.1?</p>



<a name="1019508"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019508" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019508">(Sep 17 2020 at 22:49)</a>:</h4>
<p>3.0</p>



<a name="1019512"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019512" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019512">(Sep 17 2020 at 22:58)</a>:</h4>
<p>Oh, man. I added an <code>apt-get update</code> in <code>entrypoint.sh</code>, prior to certbot setup. Now it finds certbot, and my cert is generated properly, but I get internal server errors when I try to use Zulip.</p>
<div class="codehilite" data-codehilite-language="Bash"><pre><span></span><code>    <span class="c1"># Accept the terms of service automatically.</span>
    apt-get update
    /home/zulip/deployments/current/scripts/setup/setup-certbot <span class="se">\</span>
        --agree-tos <span class="se">\</span>
        --email<span class="o">=</span><span class="s2">"</span><span class="nv">$SETTING_ZULIP_ADMINISTRATOR</span><span class="s2">"</span> <span class="se">\</span>
        --deploy-hook <span class="s2">"</span><span class="nv">$ZULIP_CERTBOT_DEPLOY_HOOK</span><span class="s2">"</span> <span class="se">\</span>
        -- <span class="se">\</span>
        <span class="s2">"</span><span class="nv">$SETTING_EXTERNAL_HOST</span><span class="s2">"</span>
</code></pre></div>



<a name="1019521"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019521" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019521">(Sep 17 2020 at 23:05)</a>:</h4>
<p>Can you try 3.1?</p>



<a name="1019529"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019529" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019529">(Sep 17 2020 at 23:15)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> Ok, so downgrade the Zulip version in the docker file and rebuild everything?</p>



<a name="1019530"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019530" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019530">(Sep 17 2020 at 23:16)</a>:</h4>
<div class="codehilite"><pre><span></span><code>  zulip:
    image: &#39;zulip/docker-zulip:3.1-0&#39;
    build:
      context: .
      args:
        # Change these if you want to build zulip from a different repo/branch
        ZULIP_GIT_URL: https://github.com/zulip/zulip.git
        ZULIP_GIT_REF: 3.1
        # Set this up if you plan to use your own CA certificate bundle for building
        # CUSTOM_CA_CERTIFICATES:
</code></pre></div>



<a name="1019531"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019531" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019531">(Sep 17 2020 at 23:16)</a>:</h4>
<p>That should do it, right?</p>



<a name="1019533"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019533" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019533">(Sep 17 2020 at 23:16)</a>:</h4>
<p>Will Zulip handle the downgrade properly?</p>



<a name="1019534"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019534" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019534">(Sep 17 2020 at 23:17)</a>:</h4>
<p>In this case, there are no schema changes between 3.2 and 3.1, so I believe it to be safe.</p>



<a name="1019535"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019535" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019535">(Sep 17 2020 at 23:17)</a>:</h4>
<p>Take a backup just in case.  Never hurts to have on hand. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1019539"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019539" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019539">(Sep 17 2020 at 23:18)</a>:</h4>
<p>I don't see anything evident in 3.2 that would affect this -- but IO also don't see anything in 3.0 -&gt; 3.1 that might, either.</p>



<a name="1019544"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019544" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019544">(Sep 17 2020 at 23:19)</a>:</h4>
<p>The addition of the <code>apt-get update</code> fixed the certbot package not being found issue, but the internal server errors are more troubling.</p>



<a name="1019548"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019548" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019548">(Sep 17 2020 at 23:20)</a>:</h4>
<p>Can you pull up <code>/var/log/zulip/errors.log</code> from the container?</p>



<a name="1019550"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019550" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019550">(Sep 17 2020 at 23:21)</a>:</h4>
<p>Already spinning up 3.1</p>



<a name="1019552"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019552" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019552">(Sep 17 2020 at 23:22)</a>:</h4>
<p>Mostly I suggest 3.1 because we've not heard of any such reports on 3.1, but you may be the first to spin up 3.2 -- so rolling back to 3.1 may be the fastest route to being back in service.  We'll certainly want to get logs from the 3.2 instance regardless (eventually).</p>



<a name="1019564"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019564" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019564">(Sep 17 2020 at 23:29)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> Was there a schema update in 3.0 -&gt; 3.1?</p>



<a name="1019565"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019565" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019565">(Sep 17 2020 at 23:29)</a>:</h4>
<p>Maybe I should just go back to that.</p>



<a name="1019566"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019566" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019566">(Sep 17 2020 at 23:29)</a>:</h4>
<p>There was.</p>



<a name="1019567"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019567" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019567">(Sep 17 2020 at 23:29)</a>:</h4>
<p>Has 3.1 built yet?</p>



<a name="1019570"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019570" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019570">(Sep 17 2020 at 23:31)</a>:</h4>
<p>Still going.</p>



<a name="1019579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019579">(Sep 17 2020 at 23:42)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> Alright, it finished.</p>



<a name="1019580"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019580" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019580">(Sep 17 2020 at 23:42)</a>:</h4>
<p>Not positively, though.</p>



<a name="1019581"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019581" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019581">(Sep 17 2020 at 23:42)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Collecting coverage==5.2
  Using cached coverage-5.2-cp36-cp36m-manylinux1_x86_64.whl (229 kB)
Collecting cryptography==2.9.2
  Using cached cryptography-2.9.2-cp35-abi3-manylinux2010_x86_64.whl (2.7 MB)
Collecting cssselect2==0.3.0
  Using cached cssselect2-0.3.0-py3-none-any.whl (31 kB)
Collecting cssselect==1.1.0
  Using cached cssselect-1.1.0-py2.py3-none-any.whl (16 kB)
Collecting cssutils==1.0.2
  Using cached cssutils-1.0.2-py3-none-any.whl (406 kB)
Collecting dataclasses==0.7
  Using cached dataclasses-0.7-py3-none-any.whl (18 kB)
Collecting decorator==4.4.2
  Using cached decorator-4.4.2-py2.py3-none-any.whl (9.2 kB)
Collecting defusedxml==0.6.0
  Using cached defusedxml-0.6.0-py2.py3-none-any.whl (23 kB)
Collecting disposable-email-domains==0.0.64
  Using cached disposable_email_domains-0.0.64-py2.py3-none-any.whl (21 kB)
Collecting distro==1.5.0
  Using cached distro-1.5.0-py2.py3-none-any.whl (18 kB)
Collecting django-auth-ldap==2.0.0zulip1
  Using cached https://github.com/zulip/django-auth-ldap/archive/e26d0ef2a7ff77ab3fdd7b6578a76081f780778c.zip
  WARNING: Requested django-auth-ldap==2.0.0zulip1 from https://github.com/zulip/django-auth-ldap/archive/e26d0ef2a7ff77ab3fdd7b6578a76081f780778c.zip#egg=django-auth-ldap==2.0.0zulip1 (from -r /home/zulip/zulip/requirements/dev.txt (line 269)), but installing version 2.0.0
Collecting django-bitfield==2.0.1
  Using cached django_bitfield-2.0.1-py2.py3-none-any.whl (17 kB)
ERROR: Could not find a version that satisfies the requirement django-cookies-samesite==0.6.6 (from -r /home/zulip/zulip/requirements/dev.txt (line 276)) (from versions: 0.1.0, 0.1.1, 0.1.2, 0.2.0, 0.3.0, 0.4.0, 0.5.0, 0.5.1, 0.6.0, 0.6.1, 0.6.2, 0.6.3, 0.6.4, 0.6.5, 0.7.0)
ERROR: No matching distribution found for django-cookies-samesite==0.6.6 (from -r /home/zulip/zulip/requirements/dev.txt (line 276))
WARNING: You are using pip version 20.1.1; however, version 20.2.3 is available.
You should consider upgrading via the &#39;/srv/zulip-venv-cache/80dd17368e1c6223bec688e01247d651baa0abb2/zulip-py3-venv/bin/python3 -m pip install --upgrade pip&#39; command.

Error running a subcommand of ./lib/provision.py: /srv/zulip-venv-cache/80dd17368e1c6223bec688e01247d651baa0abb2/zulip-py3-venv/bin/pip install --no-deps --require-hashes --requirement /home/zulip/zulip/requirements/dev.txt
Actual error output for the subcommand is just above this.

Traceback (most recent call last):
  File &quot;/home/zulip/zulip/scripts/lib/setup_venv.py&quot;, line 335, in do_setup_virtualenv
    install_venv_deps(pip, requirements_file)
  File &quot;/home/zulip/zulip/scripts/lib/setup_venv.py&quot;, line 101, in install_venv_deps
    run([pip, &quot;install&quot;, &quot;--no-deps&quot;, &quot;--require-hashes&quot;, &quot;--requirement&quot;, requirements_file])
  File &quot;/home/zulip/zulip/scripts/lib/zulip_tools.py&quot;, line 198, in run
    subprocess.check_call(args, **kwargs)
  File &quot;/usr/lib/python3.6/subprocess.py&quot;, line 311, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/srv/zulip-venv-cache/80dd17368e1c6223bec688e01247d651baa0abb2/zulip-py3-venv/bin/pip&#39;, &#39;install&#39;, &#39;--no-deps&#39;, &#39;--require-hashes&#39;, &#39;--requirement&#39;, &#39;/home/zulip/zulip/requirements/dev.txt&#39;]&#39; returned non-zero exit status 1.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;./lib/provision.py&quot;, line 450, in &lt;module&gt;
    main(options)
  File &quot;./lib/provision.py&quot;, line 397, in main
    setup_venvs.main()
  File &quot;/home/zulip/zulip/tools/setup/setup_venvs.py&quot;, line 22, in main
    VENV_PATH, DEV_REQS_FILE, patch_activate_script=True)
  File &quot;/home/zulip/zulip/scripts/lib/setup_venv.py&quot;, line 294, in setup_virtualenv
    do_setup_virtualenv(cached_venv_path, requirements_file)
  File &quot;/home/zulip/zulip/scripts/lib/setup_venv.py&quot;, line 339, in do_setup_virtualenv
    install_venv_deps(pip, requirements_file)
  File &quot;/home/zulip/zulip/scripts/lib/setup_venv.py&quot;, line 101, in install_venv_deps
    run([pip, &quot;install&quot;, &quot;--no-deps&quot;, &quot;--require-hashes&quot;, &quot;--requirement&quot;, requirements_file])
  File &quot;/home/zulip/zulip/scripts/lib/zulip_tools.py&quot;, line 198, in run
    subprocess.check_call(args, **kwargs)
  File &quot;/usr/lib/python3.6/subprocess.py&quot;, line 311, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/srv/zulip-venv-cache/80dd17368e1c6223bec688e01247d651baa0abb2/zulip-py3-venv/bin/pip&#39;, &#39;install&#39;, &#39;--no-deps&#39;, &#39;--require-hashes&#39;, &#39;--requirement&#39;, &#39;/home/zulip/zulip/requirements/dev.txt&#39;]&#39; returned non-zero exit status 1.

Provisioning failed (exit code 1)!

* Look at the traceback(s) above to find more about the errors.
* Resolve the errors or get help on chat.
* If you can fix this yourself, you can re-run tools/provision at any time.
* Logs are here: zulip/var/log/provision.log

ERROR: Service &#39;zulip&#39; failed to build: The command &#39;/bin/sh -c ./tools/provision --build-release-tarball-only&#39; returned a non-zero code: 1
</code></pre></div>



<a name="1019582"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019582" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019582">(Sep 17 2020 at 23:42)</a>:</h4>
<p>So, I'm unable to even <code>docker-compose up</code> now, since the zulip container fails to build.</p>



<a name="1019585"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019585" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019585">(Sep 17 2020 at 23:43)</a>:</h4>
<p>Gah, right, this is the package we pinned that pulled itself from pypi.  Sorry, I should have known that wouldn't work.  That's one of the reasons we released 3.2</p>
<p>Well, let's look at at the 3.2 error logs.</p>



<a name="1019588"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019588" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019588">(Sep 17 2020 at 23:43)</a>:</h4>
<p>Ok, I'll spin up 3.2 again and then ping you.</p>



<a name="1019591"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019591" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019591">(Sep 17 2020 at 23:44)</a>:</h4>
<p>Thank you for the support.</p>



<a name="1019594"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019594" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019594">(Sep 17 2020 at 23:44)</a>:</h4>
<p>Sure thing.  Sorry for the trouble it's giving you!</p>



<a name="1019600"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019600" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019600">(Sep 17 2020 at 23:49)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> Ok, I'm back to seeing the internal server error.</p>



<a name="1019601"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019601" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019601">(Sep 17 2020 at 23:49)</a>:</h4>
<p>Is the error log mapped to a host directory, or only within the container?</p>



<a name="1019610"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019610" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019610">(Sep 17 2020 at 23:50)</a>:</h4>
<p>The docker logs for zulip don't have anything after the cert generation.</p>



<a name="1019611"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019611" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019611">(Sep 17 2020 at 23:51)</a>:</h4>
<p><code>docker-compose exec zulip bash</code> and looking in <code>/var/log/zulip</code> doesn't find anything of note?</p>



<a name="1019612"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019612" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019612">(Sep 17 2020 at 23:53)</a>:</h4>
<p>Is the 500 from nginx, or Django?</p>



<a name="1019613"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019613" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019613">(Sep 17 2020 at 23:53)</a>:</h4>
<div class="codehilite"><pre><span></span><code>bmemcached.exceptions.MemcachedException: (&quot;Code: 32 Message: b&#39;Auth failure.&#39;&quot;, 32)
2020-09-17 23:50:52.179 ERR  [django.request] Internal Server Error: /login/
Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/exception.py&quot;, line 34, in inner
    response = get_response(request)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 115, in _get_response
    response = self.process_exception_by_middleware(e, request)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 113, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;./zerver/lib/request.py&quot;, line 366, in _wrapped_view_func
    return view_func(request, *args, **kwargs)
  File &quot;./zerver/views/auth.py&quot;, line 717, in login_page
    extra_context.update(login_context(request))
  File &quot;./zerver/context_processors.py&quot;, line 160, in login_context
    realm_description = get_realm_rendered_description(realm)
  File &quot;./zerver/lib/cache.py&quot;, line 196, in func_with_caching
    val = func(*args, **kwargs)
  File &quot;./zerver/lib/realm_description.py&quot;, line 15, in get_realm_rendered_description
    no_previews=True)
  File &quot;./zerver/lib/markdown/__init__.py&quot;, line 2392, in markdown_convert
    no_previews=no_previews)
  File &quot;./zerver/lib/markdown/__init__.py&quot;, line 2270, in do_convert
    maybe_update_markdown_engines(realm_filters_key, email_gateway)
  File &quot;./zerver/lib/markdown/__init__.py&quot;, line 2084, in maybe_update_markdown_engines
    realm_filters = realm_filters_for_realm(realm_filters_key)
  File &quot;./zerver/models.py&quot;, line 761, in realm_filters_for_realm
    per_request_realm_filters_cache[realm_id] = realm_filters_for_realm_remote_cache(realm_id)
  File &quot;./zerver/lib/cache.py&quot;, line 173, in func_with_caching
    val = cache_get(ke
    value, cas = server.get(key)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 432, in get
    self._send(data)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 244, in _send
    self._open_connection()
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 158, in _open_connection
    self._send_authentication()
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 319, in _send_authentication
    raise MemcachedException(&#39;Code: %d Message: %s&#39; % (status, extra_content), status)
bmemcached.exceptions.MemcachedException: (&quot;Code: 32 Message: b&#39;Auth failure.&#39;&quot;, 32)
2020-09-17 23:51:47.805 ERR  [django.request] Internal Server Error: /
Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/sessions/backends/base.py&quot;, line 189, in _get_session
    return self._session_cache
AttributeError: &#39;SessionStore&#39; object has no attribute &#39;_session_cache&#39;

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/exception.py&quot;, line 34, in inner
    response = get_response(request)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/utils/deprecation.py&quot;, line 93, in __call__
    response = self.process_request(request)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/middleware/locale.py&quot;, line 21, in process_request
    language = translation.get_language_from_request(request, check_path=i18n_patterns_used)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/utils/translation/__init__.py&quot;, line 236, in get_language_from_request
    return _trans.get_language_from_request(request, check_path)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/utils/translation/trans_real.py&quot;, line 532, in get_language_from_request
    lang_code = request.session.get(LANGUAGE_SESSION_KEY)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/sessions/backends/base.py&quot;, line 65, in get
    return self._session.get(key, default)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/sessions/backends/base.py&quot;, line 194, in _get_session
    self._session_cache = self.load()
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/sessions/backends/cached_db.py&quot;, line 38, in load
    self._cache.set(self.cache_key, data, self.get_expiry_age(expiry=s.expire_date))
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/django/core/cache/backends/memcached.py&quot;, line 83, in set
    if not self._cache.set(key, value, self.get_backend_timeout(timeout)):
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/client/replicating.py&quot;, line 112, in set
    returns.append(server.set(key, value, time, compress_level=compress_level))
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 602, in set
    return self._set_add_replace(&#39;set&#39;, key, value, time, compress_level=compress_level)
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 569, in _set_add_replace
    time, keybytes, value))
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 244, in _send
    self._open_connection()
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 158, in _open_connection
    self._send_authentication()
  File &quot;/srv/zulip-venv-cache/dddfc59148762faff83805e2153db65fe18c6d3c/zulip-py3-venv/lib/python3.6/site-packages/bmemcached/protocol.py&quot;, line 319, in _send_authentication
    raise MemcachedException(&#39;Code: %d Message: %s&#39; % (status, extra_content), status)
bmemcached.exceptions.MemcachedException: (&quot;Code: 32 Message: b&#39;Auth failure.&#39;&quot;, 32)
</code></pre></div>



<a name="1019614"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019614" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019614">(Sep 17 2020 at 23:54)</a>:</h4>
<p>That's from <code>docker cp f4cc2127bd6f:/var/log/zulip/errors.log .</code></p>



<a name="1019620"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019620" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019620">(Sep 17 2020 at 23:54)</a>:</h4>
<p><span class="user-mention" data-user-id="699">@Anders Kaseorg</span>: This looks related to the libmemcached switch, I think?</p>



<a name="1019621"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019621" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019621">(Sep 17 2020 at 23:54)</a>:</h4>
<p>So, looks like memcached auth isn't working.</p>



<a name="1019623"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019623" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019623">(Sep 17 2020 at 23:55)</a>:</h4>
<p>3.2 switched the backend that we use to talk to memcached, to a pure-python one.</p>



<a name="1019624"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019624" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019624">(Sep 17 2020 at 23:55)</a>:</h4>
<p>I had a custom <code>SECRETS_memcached_password</code> set up prior to upgrading. Perhaps it wasn't migrated properly?</p>



<a name="1019625"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019625" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019625">(Sep 17 2020 at 23:55)</a>:</h4>
<p>There's a somewhat common failure mode with Docker where one ends up with a different password for memcached in the Zulip contained vs. memcached container; I'd investigate that possibility first.</p>



<a name="1019627"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019627" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019627">(Sep 17 2020 at 23:56)</a>:</h4>
<p>(I believe the upstream <code>memcached</code> container we use doesn't update if you change the value; I know at least the postgres one has that behavior)</p>



<a name="1019630"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019630" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019630">(Sep 17 2020 at 23:56)</a>:</h4>
<p>I have not changed any of my secrets.</p>



<a name="1019632"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019632" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019632">(Sep 17 2020 at 23:57)</a>:</h4>
<p>Well, worth double-checking that the passwords agree; I could also imagine some sort of character set issue with the new library encoding characters differently.</p>



<a name="1019633"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019633" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019633">(Sep 17 2020 at 23:57)</a>:</h4>
<p>Removing the memcached container and building it again should resolve that problem, if it is the problem, right?</p>



<a name="1019643"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019643" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019643">(Sep 18 2020 at 00:02)</a>:</h4>
<p>That doesn't seem to've solved anything. I did a <code>docker stop &lt;memcached&gt;; docker rm &lt;memcached&gt;</code> and then <code>docker-compose up</code> again to start it.</p>



<a name="1019644"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019644" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019644">(Sep 18 2020 at 00:02)</a>:</h4>
<p>Yeah, the secret isn't built into the image, so it should only come down to if it agrees in the two places in the docker-compose.yml file.</p>



<a name="1019646"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019646" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019646">(Sep 18 2020 at 00:03)</a>:</h4>
<p>Oh, I see.</p>



<a name="1019648"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019648" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019648">(Sep 18 2020 at 00:03)</a>:</h4>
<p>You can try switching the secret out for something simple in case it's an encoding problem of some sort.</p>



<a name="1019650"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019650" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019650">(Sep 18 2020 at 00:05)</a>:</h4>
<p>So, if I stop memcached, Zulip loads properly. That's good news, at least.</p>



<a name="1019652"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019652" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019652">(Sep 18 2020 at 00:07)</a>:</h4>
<p>I changed both of the secrets to be something else, and to be the same, and then rebuilt the stopped memcached service and I can still load Zulip now.</p>



<a name="1019653"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019653" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019653">(Sep 18 2020 at 00:07)</a>:</h4>
<p>So, hopefully we're all good.</p>



<a name="1019656"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019656" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019656">(Sep 18 2020 at 00:08)</a>:</h4>
<p>Thanks for the help. :)</p>



<a name="1019661"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019661" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019661">(Sep 18 2020 at 00:09)</a>:</h4>
<p>I still have a patch in there which was needed to get going, which is adding <code>apt-get update</code> before the certbot setup so the <code>certbot</code> package can be found.</p>



<a name="1019662"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019662" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019662">(Sep 18 2020 at 00:09)</a>:</h4>
<p>OK, so this does point to an escaping issue of some sort exposed by the new memcached library.  If your secret has now been changed, and you're not using it elsewhere, can you share it?</p>



<a name="1019663"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019663" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019663">(Sep 18 2020 at 00:09)</a>:</h4>
<p>Yeah.  I think that's likely because we clean out the apt directories at the end of the Dockerfile, but on an upgrade we might need to install things.  I'll make an issue for that.</p>



<a name="1019665"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019665" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019665">(Sep 18 2020 at 00:10)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> I've asked about this before, but will you guys <strong>please</strong> look into implementing certbot renewals? This whole thing started because the cert expired again and I have some manual hacks in my <code>entrypoint.sh</code> to force the renewal if I restart zulip.</p>



<a name="1019668"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019668" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019668">(Sep 18 2020 at 00:12)</a>:</h4>
<p>When I asked last, you said it's implemented, but it's not. I'm the one who added certbot to docker-zulip in the first place and the PR didn't include renewal support. <a href="https://github.com/zulip/docker-zulip/pull/139">https://github.com/zulip/docker-zulip/pull/139</a></p>



<a name="1019669"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019669" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019669">(Sep 18 2020 at 00:13)</a>:</h4>
<p>We run renewals in cron in normal Zulip; it's possible the bug is we're not installing that cron job properly?  Or is it more complex than that?</p>



<a name="1019671"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019671" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019671">(Sep 18 2020 at 00:14)</a>:</h4>
<p>I'm not sure. Every few months, my team tells me they can't connect anymore and I need to force the renewal of the certs.</p>



<a name="1019675"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019675" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019675">(Sep 18 2020 at 00:15)</a>:</h4>
<p>(On the secrets point, what I'd really like to us do is write a templating tool that uses the Zulip <code>generate_secrets.py</code> code to generate secrets and writes out a docker-compose.yml with valid values inserted for all the secrets, so we don't need to deal with users picking the wrong character set or whatnot.</p>



<a name="1019677"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019677" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019677">(Sep 18 2020 at 00:15)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> The pass was in this shape: <code>dd1ddddbddddddddddddddddddddddddddddddddddddd1dddddddddd8dd0dddd</code></p>



<a name="1019678"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019678" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019678">(Sep 18 2020 at 00:15)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> if you're interested in doing a mini-sprint to make our Docker system better, I think it'd have a lot of value.</p>



<a name="1019684"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019684" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019684">(Sep 18 2020 at 00:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="8742">Jeaye</span> <a href="#narrow/stream/31-production-help/topic/certbot.20error/near/1019677">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> The pass was in this shape: <code>dd1ddddbddddddddddddddddddddddddddddddddddddd1dddddddddd8dd0dddd</code></p>
</blockquote>
<p>Anything non <code>[a-zA-Z0-9]</code> in there?</p>



<a name="1019685"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019685" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019685">(Sep 18 2020 at 00:16)</a>:</h4>
<p>And is the new password shorter?  This may be truncation somewhere.</p>



<a name="1019687"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019687" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019687">(Sep 18 2020 at 00:17)</a>:</h4>
<p>Nope, only within that regex and the same length.</p>



<a name="1019688"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019688" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019688">(Sep 18 2020 at 00:17)</a>:</h4>
<p>Hm.</p>



<a name="1019689"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019689" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019689">(Sep 18 2020 at 00:18)</a>:</h4>
<p>Honestly, it's possible that I just had them mismatched and my upgrade to 3.2 accidentally changed one.</p>



<a name="1019690"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019690" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019690">(Sep 18 2020 at 00:18)</a>:</h4>
<p>I won't discount PEBKAC here.</p>



<a name="1019691"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019691" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019691">(Sep 18 2020 at 00:18)</a>:</h4>
<p>:nod:  Reducing that via templating or yaml references would certainly help here.</p>



<a name="1019692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019692">(Sep 18 2020 at 00:20)</a>:</h4>
<p>One thing Tim and I discussed back when I was adding certbot was that the secrets shouldn't be put into the docker compose file at all. They should be stored in some git ignored file, ideally, so that they don't conflict with pulling new changes from git.</p>



<a name="1019693"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019693" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019693">(Sep 18 2020 at 00:21)</a>:</h4>
<p>Right now, I need to stash, pull, stash apply, resolve conflicts, and probably end up mismatching my memcached passes.</p>



<a name="1019694"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1019694" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jeaye <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1019694">(Sep 18 2020 at 00:22)</a>:</h4>
<p>That would be my ideal case, anyway. I think docker compose has some support for this with .env files or something similar.</p>



<a name="1020525"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/certbot%20error/near/1020525" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/certbot.20error.html#1020525">(Sep 19 2020 at 03:14)</a>:</h4>
<p>@Jeaye Is it possible that you lost <a href="https://github.com/zulip/docker-zulip/commit/0810e2ba67ddf34f59f619cb07c60a40c08de235">https://github.com/zulip/docker-zulip/commit/0810e2ba67ddf34f59f619cb07c60a40c08de235</a> when resolving conflicts?</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>