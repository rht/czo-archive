<html>
<head><meta charset="utf-8"><title>Zulip thumbor error while restarting · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html">Zulip thumbor error while restarting</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="678016"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678016" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678016">(Jan 02 2019 at 21:18)</a>:</h4>
<p>Hi, zulip is showing this error -&gt; <code>zulip-thumbor: ERROR (spawn error)</code> while restarting.</p>



<a name="678021"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678021" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678021">(Jan 02 2019 at 21:21)</a>:</h4>
<p>Here, some trace while restarting the server.</p>
<div class="codehilite"><pre><span></span><span class="mi">2019</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span><span class="mi">441</span> <span class="n">restart</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="n">Stopping</span> <span class="n">server</span> <span class="n">core</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">django</span><span class="p">:</span> <span class="n">stopped</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">0</span><span class="p">:</span> <span class="n">stopped</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">stopped</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">stopped</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">stopped</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">thumbor</span><span class="p">:</span> <span class="n">ERROR</span> <span class="p">(</span><span class="ow">not</span> <span class="n">running</span><span class="p">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">59</span><span class="p">,</span><span class="mi">115</span> <span class="n">restart</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">server</span> <span class="n">core</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">django</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">0</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">senders</span><span class="p">:</span><span class="n">zulip_events_message_sender</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">thumbor</span><span class="p">:</span> <span class="n">ERROR</span> <span class="p">(</span><span class="n">spawn</span> <span class="n">error</span><span class="p">)</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">02</span> <span class="mi">21</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">02</span><span class="p">,</span><span class="mi">940</span> <span class="n">restart</span><span class="o">-</span><span class="n">server</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">workers</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span><span class="n">zulip_events_feedback_messages</span><span class="p">:</span> <span class="n">started</span>
<span class="n">zulip</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span><span class="n">zulip_events_slow_queries</span><span class="p">:</span> <span class="n">started</span>
</pre></div>



<a name="678022"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678022" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678022">(Jan 02 2019 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="10831">@Mani Sankar Nambaru</span> what's in <code>/var/log/zulip/thumbor.log</code>?</p>



<a name="678023"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678023" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678023">(Jan 02 2019 at 21:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/current/zulip-thumbor-venv/bin/thumbor&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">11</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
  <span class="n">File</span> <span class="s2">&quot;/srv/zulip-venv-cache/890ced270adac8406802ba25797517e3250e67d8/zulip-thumbor-venv/local/lib/python2.7/site-packages/thumbor/server.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">136</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">server_parameters</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="n">server_parameters</span><span class="o">.</span><span class="n">use_environment</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/srv/zulip-venv-cache/890ced270adac8406802ba25797517e3250e67d8/zulip-thumbor-venv/local/lib/python2.7/site-packages/thumbor/server.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">53</span><span class="p">,</span> <span class="ow">in</span> <span class="n">get_config</span>
    <span class="k">return</span> <span class="n">Config</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="n">conf_name</span><span class="o">=</span><span class="s1">&#39;thumbor.conf&#39;</span><span class="p">,</span> <span class="n">lookup_paths</span><span class="o">=</span><span class="n">lookup_paths</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/srv/zulip-venv-cache/890ced270adac8406802ba25797517e3250e67d8/zulip-thumbor-venv/local/lib/python2.7/site-packages/derpconf/config.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">75</span><span class="p">,</span> <span class="ow">in</span> <span class="n">load</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__load_from_path</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/srv/zulip-venv-cache/890ced270adac8406802ba25797517e3250e67d8/zulip-thumbor-venv/local/lib/python2.7/site-packages/derpconf/config.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">95</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__load_from_path</span>
    <span class="n">six</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/srv/zulip-venv-cache/890ced270adac8406802ba25797517e3250e67d8/zulip-thumbor-venv/local/lib/python2.7/site-packages/six.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">709</span><span class="p">,</span> <span class="ow">in</span> <span class="n">exec_</span>
    <span class="k">exec</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;exec _code_ in _globs_, _locs_&quot;&quot;&quot;</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">660</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">cannot</span> <span class="kn">import</span> <span class="nn">name</span> <span class="nn">S3_REGION</span>
</pre></div>



<a name="678027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678027">(Jan 02 2019 at 21:29)</a>:</h4>
<p>Interesting.</p>



<a name="678028"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678028" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678028">(Jan 02 2019 at 21:30)</a>:</h4>
<p><span class="user-mention" data-user-id="10831">@Mani Sankar Nambaru</span> did you by any chance upgrade this server from an older version of Zulip?</p>



<a name="678029"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678029" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678029">(Jan 02 2019 at 21:30)</a>:</h4>
<p>I think you just need to add <code>S3_REGION = ''</code> in <code>/etc/zulip/settings.py</code>  to fix this.</p>



<a name="678030"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678030" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678030">(Jan 02 2019 at 21:31)</a>:</h4>
<p>Okay I will try. I have added that in boto.cfg though.</p>



<a name="678031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678031">(Jan 02 2019 at 21:31)</a>:</h4>
<p>Yeah, that's not relevant to this specific issue.</p>



<a name="678032"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678032" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678032">(Jan 02 2019 at 21:31)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="10831">@Mani Sankar Nambaru</span> did you by any chance upgrade this server from an older version of Zulip?</p>
</blockquote>
<p>Yes, from 1.8.1 to the latest version.</p>



<a name="678033"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678033" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678033">(Jan 02 2019 at 21:31)</a>:</h4>
<p>(There's a bug in the code, which I'll fix,; my suggestion above is a workaround)</p>



<a name="678034"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678034" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678034">(Jan 02 2019 at 21:31)</a>:</h4>
<blockquote>
<p>(There's a bug in the code, which I'll fix,; my suggestion above is a workaround)</p>
</blockquote>
<p>Great!</p>



<a name="678035"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678035" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678035">(Jan 02 2019 at 21:32)</a>:</h4>
<p>I will add and let you know. Thanks!</p>



<a name="678038"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678038" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678038">(Jan 02 2019 at 21:34)</a>:</h4>
<p>Should be fixed for future users in <a href="https://github.com/zulip/zulip/commit/2e533f32c2e476a6ce1a53271f7801373ecccb2e" target="_blank" title="https://github.com/zulip/zulip/commit/2e533f32c2e476a6ce1a53271f7801373ecccb2e">2e533f32c2e476a6ce1a53271f7801373ecccb2e</a></p>



<a name="678041"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678041" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678041">(Jan 02 2019 at 21:34)</a>:</h4>
<p>I'm also getting mails from the server, maybe impotError was causing this:</p>
<div class="codehilite"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/django/core/handlers/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">185</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_get_response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">wrapped_callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">callback_args</span><span class="p">,</span> <span class="o">**</span><span class="n">callback_kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/django/views/decorators/csrf.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">58</span><span class="p">,</span> <span class="ow">in</span> <span class="n">wrapped_view</span>
    <span class="k">return</span> <span class="n">view_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/lib/rest.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">131</span><span class="p">,</span> <span class="ow">in</span> <span class="n">rest_dispatch</span>
    <span class="k">return</span> <span class="n">target_function</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/django/utils/decorators.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">149</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_view</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">view_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/decorator.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">669</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_wrapped_view_func</span>
    <span class="k">return</span> <span class="n">authenticate_log_and_execute_json</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">view_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/decorator.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">651</span><span class="p">,</span> <span class="ow">in</span> <span class="n">authenticate_log_and_execute_json</span>
    <span class="k">return</span> <span class="n">rate_limit</span><span class="p">()(</span><span class="n">view_func</span><span class="p">)(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/decorator.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">804</span><span class="p">,</span> <span class="ow">in</span> <span class="n">wrapped_func</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/views/upload.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">103</span><span class="p">,</span> <span class="ow">in</span> <span class="n">upload_file_backend</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">upload_message_image_from_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_file</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/lib/upload.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">669</span><span class="p">,</span> <span class="ow">in</span> <span class="n">upload_message_image_from_request</span>
    <span class="n">content_type</span><span class="p">,</span> <span class="n">user_file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">user_profile</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/lib/upload.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">645</span><span class="p">,</span> <span class="ow">in</span> <span class="n">upload_message_file</span>
    <span class="n">target_realm</span><span class="o">=</span><span class="n">target_realm</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/lib/upload.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">313</span><span class="p">,</span> <span class="ow">in</span> <span class="n">upload_message_file</span>
    <span class="n">file_data</span>
  <span class="n">File</span> <span class="s2">&quot;./zerver/lib/upload.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">231</span><span class="p">,</span> <span class="ow">in</span> <span class="n">upload_image_to_s3</span>
    <span class="n">key</span><span class="o">.</span><span class="n">set_contents_from_string</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>  <span class="c1"># type: ignore # https://github.com/python/typeshed/issues/1552</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/s3/key.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1442</span><span class="p">,</span> <span class="ow">in</span> <span class="n">set_contents_from_string</span>
    <span class="n">encrypt_key</span><span class="o">=</span><span class="n">encrypt_key</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/s3/key.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1309</span><span class="p">,</span> <span class="ow">in</span> <span class="n">set_contents_from_file</span>
    <span class="n">chunked_transfer</span><span class="o">=</span><span class="n">chunked_transfer</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/s3/key.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">762</span><span class="p">,</span> <span class="ow">in</span> <span class="n">send_file</span>
    <span class="n">chunked_transfer</span><span class="o">=</span><span class="n">chunked_transfer</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/s3/key.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">963</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_send_file_internal</span>
    <span class="n">query_args</span><span class="o">=</span><span class="n">query_args</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/s3/connection.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">671</span><span class="p">,</span> <span class="ow">in</span> <span class="n">make_request</span>
    <span class="n">retry_handler</span><span class="o">=</span><span class="n">retry_handler</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/connection.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1071</span><span class="p">,</span> <span class="ow">in</span> <span class="n">make_request</span>
    <span class="n">retry_handler</span><span class="o">=</span><span class="n">retry_handler</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/connection.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">927</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_mexe</span>
    <span class="n">request</span><span class="o">.</span><span class="n">authorize</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/connection.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">377</span><span class="p">,</span> <span class="ow">in</span> <span class="n">authorize</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">_auth_handler</span><span class="o">.</span><span class="n">add_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/auth.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">755</span><span class="p">,</span> <span class="ow">in</span> <span class="n">add_auth</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/auth.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">574</span><span class="p">,</span> <span class="ow">in</span> <span class="n">add_auth</span>
    <span class="n">string_to_sign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_to_sign</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">canonical_request</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/auth.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">514</span><span class="p">,</span> <span class="ow">in</span> <span class="n">string_to_sign</span>
    <span class="n">sts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credential_scope</span><span class="p">(</span><span class="n">http_request</span><span class="p">))</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/auth.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">496</span><span class="p">,</span> <span class="ow">in</span> <span class="n">credential_scope</span>
    <span class="n">region_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_region_name</span><span class="p">(</span><span class="n">http_request</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2018-12-31-18-39-43/zulip-py3-venv/lib/python3.5/site-packages/boto/auth.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">690</span><span class="p">,</span> <span class="ow">in</span> <span class="n">determine_region_name</span>
    <span class="k">return</span> <span class="n">region_name</span>
<span class="ne">UnboundLocalError</span><span class="p">:</span> <span class="n">local</span> <span class="n">variable</span> <span class="s1">&#39;region_name&#39;</span> <span class="n">referenced</span> <span class="n">before</span> <span class="n">assignment</span>


<span class="n">Deployed</span> <span class="n">code</span><span class="p">:</span>
<span class="o">-</span> <span class="n">ZULIP_VERSION</span><span class="p">:</span> <span class="mf">1.9</span><span class="o">.</span><span class="mi">1</span>
<span class="o">-</span> <span class="n">version</span><span class="p">:</span> <span class="mf">1.9</span><span class="o">.</span><span class="mi">1</span>
</pre></div>



<a name="678042"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678042" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678042">(Jan 02 2019 at 21:35)</a>:</h4>
<p>that could be related to your <code>boto.cfg</code> file.</p>



<a name="678044"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678044" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678044">(Jan 02 2019 at 21:36)</a>:</h4>
<div class="codehilite"><pre><span></span>[s3]
use-sigv4 = True
host = ec2.ap-south-1.amazonaws.com
</pre></div>



<a name="678045"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678045" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678045">(Jan 02 2019 at 21:37)</a>:</h4>
<p>It's not an exception I've seen before; kinda sound like a bug in boto itself?</p>



<a name="678046"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678046" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678046">(Jan 02 2019 at 21:37)</a>:</h4>
<p>And that's at <code>/etc/zulip/boto.cfg</code>?</p>



<a name="678047"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678047" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678047">(Jan 02 2019 at 21:37)</a>:</h4>
<blockquote>
<p>And that's at <code>/etc/zulip/boto.cfg</code>?</p>
</blockquote>
<p>Yes</p>



<a name="678048"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678048" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678048">(Jan 02 2019 at 21:37)</a>:</h4>
<p><a href="https://github.com/boto/boto/issues/3377" target="_blank" title="https://github.com/boto/boto/issues/3377">https://github.com/boto/boto/issues/3377</a></p>



<a name="678049"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678049" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678049">(Jan 02 2019 at 21:37)</a>:</h4>
<p><a href="https://github.com/boto/boto/issues/3377" target="_blank" title="https://github.com/boto/boto/issues/3377">https://github.com/boto/boto/issues/3377</a></p>



<a name="678050"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678050" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678050">(Jan 02 2019 at 21:38)</a>:</h4>
<p>Change the <code>ec2.</code> to <code>s3.</code>.</p>



<a name="678051"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678051" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678051">(Jan 02 2019 at 21:38)</a>:</h4>
<p>I bet that's your problem.</p>



<a name="678053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678053">(Jan 02 2019 at 21:39)</a>:</h4>
<p>Wow, You are correct.</p>



<a name="678056"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20thumbor%20error%20while%20restarting/near/678056" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mani Sankar <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20thumbor.20error.20while.20restarting.html#678056">(Jan 02 2019 at 21:45)</a>:</h4>
<p>Thank you very much <span class="user-mention" data-user-id="7">@Tim Abbott</span> it worked like a charm. I have made a mistake while copy and pasting the described region from aws ec2.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>