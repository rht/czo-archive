<html>
<head><meta charset="utf-8"><title>Issues upgrading from 1.36. to 1.6 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html">Issues upgrading from 1.36. to 1.6</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="279051"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279051" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279051">(Sep 11 2017 at 12:59)</a>:</h4>
<p>Hello, we are attempting to upgrade our 1.35 Zulip server to 1.5. We are testing this with a VMWare clone. When restarting the server after the upgrade with su zulip -c /home/zulip/deployments/current/scripts/restart-server<br>
we are seeing</p>
<p>zulip-tornado: ERROR (spawn error)<br>
zulip-django: ERROR (no such file)</p>
<p>and</p>
<p>Zulip isn't feeling too good.<br>
Internal server error.</p>



<a name="279052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279052">(Sep 11 2017 at 12:59)</a>:</h4>
<p>Ubuntu 14.04</p>



<a name="279053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279053">(Sep 11 2017 at 13:00)</a>:</h4>
<p>you might have to wait a little for the people to come online who can help you with this. <br>
Do you mean Zulip 1.36 (topic) or 1.35 (in your message)?</p>



<a name="279054"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279054" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279054">(Sep 11 2017 at 13:02)</a>:</h4>
<p>Sorry 1.35 I believe.</p>



<a name="279055"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279055" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279055">(Sep 11 2017 at 13:04)</a>:</h4>
<p>I was handed this server fully running so not sure if the original admin did any customizing beyond connecting it to Active Directory. No documentation available on how it was set up. I have been hunting through all the logs, there are many errors.</p>



<a name="279056"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279056" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279056">(Sep 11 2017 at 13:04)</a>:</h4>
<p>as I'm not Linux savvy enough to help you with details I would still recommend search through this stream for other similar topics around tornado and upgrading. Maybe you are lucky. <br>
pinging <span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span>  for further help when he comes online.</p>



<a name="279057"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279057" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279057">(Sep 11 2017 at 13:05)</a>:</h4>
<p>Sure thing, thanks. Grateful for any direction.</p>



<a name="279245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279245">(Sep 11 2017 at 21:54)</a>:</h4>
<p>Hi <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span>, I'm wondering if you can help here. Personally I don't know anything about Tornado myself so am interested about this part of Zulip.</p>



<a name="279331"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279331" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Umair Khan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279331">(Sep 12 2017 at 03:29)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span>, you shouldn't be able to upgrade from 1.36 to 1.5 directly. Didn't get you get this warning message?</p>
<div class="codehilite"><pre><span></span>Your current version is very old. Please first upgrade to version 1.4.3 and then upgrade to 1.5.
</pre></div>



<a name="279356"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279356" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Umair Khan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279356">(Sep 12 2017 at 03:50)</a>:</h4>
<p>I guess in your case this doesn't matter because 1.5.0 is still pretty old and Django Guardian removal code doesn't affect you.</p>



<a name="279494"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279494" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279494">(Sep 12 2017 at 09:23)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> sorry for the trouble!  Can you provide the output of <code>/var/log/zulip/upgrade.log</code> and any errors in <code>/var/log/zulip/django.log</code> or <code>/var/log/zulip/errors.log</code>?  We can use those to help you debug.</p>



<a name="279646"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279646" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279646">(Sep 12 2017 at 12:09)</a>:</h4>
<p>Hi - actually trying to go to latest 1.6, I have updated the thread title.  If we are upgrading from 1.36 what incremental installers should we be using, if we can't make that jump in one step?</p>



<a name="279722"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279722" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279722">(Sep 12 2017 at 13:21)</a>:</h4>
<p>I think just to 1.4.3 and then to 1.6.0</p>



<a name="279790"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279790" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279790">(Sep 12 2017 at 13:55)</a>:</h4>
<p>Ran the 1.4.3. upgrade - "500: Internal server error." even after rebooting the VM. Install did not seem to throw any errors, logs attached.<a href="/user_uploads/2/b1/2YkAPTwIcVQEhgMGPX8Fe6WH/django.log" target="_blank" title="django.log">django.log</a> <a href="/user_uploads/2/7d/mTFf3wQddPqcTXRRXSjEDsrN/errors.log" target="_blank" title="errors.log">errors.log</a> <a href="/user_uploads/2/63/j7rwf72Y8YJoPhj8PTF3cGBR/upgrade.log" target="_blank" title="upgrade.log">upgrade.log</a></p>



<a name="279791"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279791" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Baimai <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279791">(Sep 12 2017 at 14:02)</a>:</h4>
<p>Hello , my name is Baimai. I come from Thailand. I Study in THAMMASAT UNIVERSITY. My major id software Engineering. i am interesting Zulip.</p>



<a name="279792"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279792" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279792">(Sep 12 2017 at 14:03)</a>:</h4>
<p>Hi, you should probably post this in the New Members thread :-)</p>



<a name="279797"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279797" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279797">(Sep 12 2017 at 14:11)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> thanks for the logs!  Your issue is definitely RabbitMQ not behaving properly.</p>



<a name="279798"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279798" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279798">(Sep 12 2017 at 14:11)</a>:</h4>
<p>Yeah looks like it did not start up.</p>



<a name="279799"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279799" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279799">(Sep 12 2017 at 14:11)</a>:</h4>
<p>(In particular, other services aren't able to connect to it)</p>



<a name="279801"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279801" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279801">(Sep 12 2017 at 14:12)</a>:</h4>
<p>Is that the 127.0.0.1 thing?</p>



<a name="279802"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279802" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279802">(Sep 12 2017 at 14:12)</a>:</h4>
<p>Yeah</p>



<a name="279803"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279803" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279803">(Sep 12 2017 at 14:12)</a>:</h4>
<p>Last time I commented the 127.0.0.1 the server hung on next boot</p>



<a name="279805"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279805" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279805">(Sep 12 2017 at 14:13)</a>:</h4>
<p>So, we have a better solution to this than what we had N months ago.</p>



<a name="279814"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279814" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279814">(Sep 12 2017 at 14:19)</a>:</h4>
<p>Still means editing /etc/default/rabbitmq-server?</p>



<a name="279870"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279870" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279870">(Sep 12 2017 at 14:48)</a>:</h4>
<p>Just found your previous post on this:    service supervisor stop<br>
dpkg -P rabbitmq-server<br>
apt-get install rabbitmq-server<br>
/root/zulip/scripts/setup/configure-rabbitmq<br>
service supervisor start</p>
<p>Appears to have worked :-)      Moving on to applying 1.6 upgrade next.</p>



<a name="279885"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279885" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279885">(Sep 12 2017 at 14:54)</a>:</h4>
<p>1.4.3 was working, now after applying 1.6 (zulip-server-latest.tar.gz)  we're back to "Zulip isn't feeling too good. Internal server error. " Have re-attached the upgrade log as it looks like that's where the issue is now.<a href="/user_uploads/2/93/GYatd1lcRXca6gGJOwOpcGUi/upgrade.log" target="_blank" title="upgrade.log">upgrade.log</a></p>



<a name="279887"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279887" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279887">(Sep 12 2017 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> what's in the error logs?</p>



<a name="279888"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279888" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279888">(Sep 12 2017 at 14:56)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> <span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> This seems to be the problem:</p>
<div class="codehilite"><pre><span></span>1210 Cached version not found! Copying node modules.
1211 + rm -rf /srv/zulip-npm-cache/df2a70fb3159f4b09d262be71ccf650c9cd42315
1212 + mkdir -p /srv/zulip-npm-cache/df2a70fb3159f4b09d262be71ccf650c9cd42315
1213 + cp package.json /srv/zulip-npm-cache/df2a70fb3159f4b09d262be71ccf650c9cd42315
1214 + cp -rT prod-static/serve/node_modules /srv/zulip-npm-cache/df2a70fb3159f4b09d262be71ccf650c9cd42315/node_modul     es
1215 cp: cannot stat &#39;prod-static/serve/node_modules&#39;: No such file or directory
</pre></div>



<a name="279893"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279893" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279893">(Sep 12 2017 at 14:59)</a>:</h4>
<p>Error log does not seem to have anything occuring after the 1.6 upgrade - attached.<a href="/user_uploads/2/79/w_nDRy0IBuOUt3liNPGd_t3w/errors.log" target="_blank" title="errors.log">errors.log</a></p>



<a name="279905"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279905" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279905">(Sep 12 2017 at 15:04)</a>:</h4>
<p>Huh.</p>



<a name="279907"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279907" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279907">(Sep 12 2017 at 15:05)</a>:</h4>
<p>This path does exist - /home/zulip/prod-static/node_modules - is that the one it's looking for?</p>



<a name="279908"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279908" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279908">(Sep 12 2017 at 15:06)</a>:</h4>
<p>Also /home/zulip/deployments/current/prod-static</p>



<a name="279916"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279916" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279916">(Sep 12 2017 at 15:09)</a>:</h4>
<p>So, I believe it is trying to copy files from the release tarball (under deployments/current/prod-static<code>to the directory served by nginx (</code>/home/zulip/prod-static`)</p>



<a name="279917"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279917" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279917">(Sep 12 2017 at 15:09)</a>:</h4>
<p>So the mystery is why those files aren't in the release tarball that was unpacked.</p>



<a name="279918"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279918" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279918">(Sep 12 2017 at 15:09)</a>:</h4>
<p>You can try just installing the 1.6 release tarball again and seeing if that works?</p>



<a name="279927"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279927" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279927">(Sep 12 2017 at 15:19)</a>:</h4>
<p>Same result from the tar.gz using ./upgrade-zulip zulip-server-latest.tar.gz.  Is there a way to unzip the installer and run it manually that is worth trying? Or maybe the nginx setup is not standard on this server?</p>



<a name="279933"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279933" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279933">(Sep 12 2017 at 15:21)</a>:</h4>
<p>If you read the upgrade-zulip script, it just unzips it at a certain path and runs the script inside.</p>



<a name="279943"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279943" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279943">(Sep 12 2017 at 15:24)</a>:</h4>
<p>in /lib:  the upgrade-zulip script or the install script?</p>



<a name="279944"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279944" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279944">(Sep 12 2017 at 15:25)</a>:</h4>
<p>/home/zulip/deployments/current/scripts/zulip-server-1.6.0/scripts/lib     rather</p>



<a name="279956"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279956" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279956">(Sep 12 2017 at 15:29)</a>:</h4>
<p>Sorry, distracted</p>



<a name="279957"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279957" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279957">(Sep 12 2017 at 15:29)</a>:</h4>
<p><code>upgrade-zulip-stage-2</code> is the thing that does all the work</p>



<a name="279959"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279959" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279959">(Sep 12 2017 at 15:29)</a>:</h4>
<p>You may also find it useful for debugging to try using our upgrade-from-git tool to re-upgrade to 1.6.0; mostly because that generates the <code>prod-static</code> data directly</p>



<a name="279961"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279961" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279961">(Sep 12 2017 at 15:30)</a>:</h4>
<p>Oh, question, where are you getting your Zulip 1.6 tarball from <span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span>?</p>



<a name="279962"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279962" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279962">(Sep 12 2017 at 15:30)</a>:</h4>
<p>wget <a href="https://www.zulip.org/dist/releases/zulip-server-latest.tar.gz" target="_blank" title="https://www.zulip.org/dist/releases/zulip-server-latest.tar.gz">https://www.zulip.org/dist/releases/zulip-server-latest.tar.gz</a></p>



<a name="279963"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279963" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279963">(Sep 12 2017 at 15:30)</a>:</h4>
<p>Is it from <a href="https://www.zulip.org/dist/releases/" target="_blank" title="https://www.zulip.org/dist/releases/">https://www.zulip.org/dist/releases/</a> ?</p>



<a name="279965"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279965" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279965">(Sep 12 2017 at 15:30)</a>:</h4>
<p>OK</p>



<a name="279966"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279966" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279966">(Sep 12 2017 at 15:31)</a>:</h4>
<p>If you use <code>tar -tf</code> to inspect the tarball, grepping for <code>prod-static</code>, does it have it?</p>



<a name="279968"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279968" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279968">(Sep 12 2017 at 15:31)</a>:</h4>
<p>I'm really surprised by this, since the files being missing should affect either everyone or nobody, and hasn't come up.</p>



<a name="279970"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279970" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279970">(Sep 12 2017 at 15:31)</a>:</h4>
<p>Yes /home/zulip/deployments/current/scripts/zulip-server-1.6.0/prod-static</p>



<a name="279972"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279972" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279972">(Sep 12 2017 at 15:32)</a>:</h4>
<p>What is the correct command to run with upgrade-zulip-from-git?</p>



<a name="279983"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279983" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279983">(Sep 12 2017 at 15:38)</a>:</h4>
<p>master branch - running now.</p>



<a name="279984"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279984" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279984">(Sep 12 2017 at 15:38)</a>:</h4>
<p>It's discussed a few sections into: <a href="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading">http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html#upgrading</a></p>



<a name="279987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279987">(Sep 12 2017 at 15:38)</a>:</h4>
<p>Oh, you might want to upgrade to just v1.6.0 from Git, not master</p>



<a name="279994"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/279994" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#279994">(Sep 12 2017 at 15:39)</a>:</h4>
<p>K - I can roll it back in  the VM no trouble.</p>



<a name="280008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280008">(Sep 12 2017 at 15:52)</a>:</h4>
<p>I'll be offline for the next few hours (it's dinnertime where I am right now in Italy).</p>



<a name="280016"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280016" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280016">(Sep 12 2017 at 15:53)</a>:</h4>
<p>Notice: /Stage[main]/Zulip::Rabbit/File[/etc/rabbitmq/rabbitmq.config]/ensure: defined content as '{md5}2dd16948c9f36d8797732cb4c9e43bc8'<br>
Notice: /Stage[main]/Zulip::Rabbit/File[/etc/default/rabbitmq-server]/content: content changed '{md5}7cc5216f193f6be1cb32c45021197b39' to '{md5}d0d028b94fbee9c1f4ff98e109cce3f4'<br>
Notice: /Stage[main]/Zulip::Static_asset_compiler/Zulip::Static_asset_compiler::Safepackage[gettext]/Package[gettext]/ensure: ensure changed 'purged' to 'present'<br>
Notice: Finished catalog run in 48.33 seconds<br>
root@zulip:/home/zulip/deployments/current/scripts# ./upgrade-zulip-from-git Git<br>
2017-09-12 12:52:54,374 update-deployment: Cloning the repository<br>
2017-09-12 12:53:36,920 update-deployment: Fetching the latest commits<br>
fatal: Remote branch Git not found in upstream origin<br>
fatal: The remote end hung up unexpectedly<br>
Traceback (most recent call last):<br>
  File "./upgrade-zulip-from-git", line 61, in &lt;module&gt;<br>
    preexec_fn=su_to_zulip)<br>
  File "/usr/lib/python2.7/subprocess.py", line 540, in check_call<br>
    raise CalledProcessError(retcode, cmd)<br>
subprocess.CalledProcessError: Command '['git', 'clone', '-q', '-b', 'Git', '/srv/zulip.git', '/home/zulip/deployments/2017-09-12-12-52-54']' returned non-zero exit status 128</p>



<a name="280018"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280018" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280018">(Sep 12 2017 at 15:54)</a>:</h4>
<p>puppet-apply generated errors about dependencies</p>



<a name="280029"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280029" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280029">(Sep 12 2017 at 15:58)</a>:</h4>
<p>Puppet errors attached. Enjoy your dinner! No rush. Your help is much appreciated. <a href="/user_uploads/2/86/J_IY3gUaTAT6W5ZSpYdw00Oq/puppet-errors.txt" target="_blank" title="puppet-errors.txt">puppet-errors.txt</a></p>



<a name="280030"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280030" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Harshit Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280030">(Sep 12 2017 at 16:00)</a>:</h4>
<p>I think you need to run <code>./upgrade-zulip-from-git master</code> not <code>./upgrade-zulip-from-git Git</code>. The traceback is simply telling that it is not able to find the given refname <code>Git</code>.</p>



<a name="280031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280031">(Sep 12 2017 at 16:01)</a>:</h4>
<p>Yeah just figured that out, I'm a dummy :-)  Running now with 1.6.0 branch</p>



<a name="280032"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280032" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280032">(Sep 12 2017 at 16:02)</a>:</h4>
<p>In my position sadly some days I learn just enough about any one thing (today it's GIT) and then have to move on to the next disaster.</p>



<a name="280035"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280035" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280035">(Sep 12 2017 at 16:06)</a>:</h4>
<p>Different error after running ./upgrade-zulip-from-git 1.6.0 - txtfile attached. <a href="/user_uploads/2/1d/Nc4YKd3ajSOwVgXoHpwlxp-l/1.6-from-git-errors.txt" target="_blank" title="1.6-from-git-errors.txt">1.6-from-git-errors.txt</a></p>



<a name="280059"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280059" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280059">(Sep 12 2017 at 16:42)</a>:</h4>
<p>Issue seems to be 2017-09-12 13:42:13,773 upgrade-zulip-stage-2: Building static assets...<br>
Cached version not found! Installing node modules.<br>
+ rm -rf /srv/zulip-npm-cache/606d2902f69b76653573a47bef6ac20c16449d54<br>
+ mkdir -p /srv/zulip-npm-cache/606d2902f69b76653573a47bef6ac20c16449d54</p>
<p>Error running a subcommand of ./tools/update-prod-static: mkdir -p /srv/zulip-npm-cache/606d2902f69b76653573a47bef6ac20c16449d54<br>
Actual error output for the subcommand is just above this.</p>



<a name="280061"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280061" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280061">(Sep 12 2017 at 16:43)</a>:</h4>
<p>I'm able to create and remove the dir, wonder why the script can't.</p>



<a name="280074"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280074" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280074">(Sep 12 2017 at 17:04)</a>:</h4>
<p>Just a guess--I haven't been tracking this whole conversation--but it could be a permissions thing.   (We are working to make the instructions more clear about when to run stuff as "root".)</p>



<a name="280079"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280079" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280079">(Sep 12 2017 at 17:14)</a>:</h4>
<p>I was running it as root.</p>



<a name="280196"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280196" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280196">(Sep 12 2017 at 19:16)</a>:</h4>
<p>Got past the permissions error by changing the permissions on the target folder. Now getting traceback that I cannot decipher. txt attached. <a href="/user_uploads/2/96/srZ5EGrQaFlNGE91Ct62GYum/new-errors.txt" target="_blank" title="new-errors.txt">new-errors.txt</a></p>



<a name="280204"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280204" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280204">(Sep 12 2017 at 19:21)</a>:</h4>
<p>(deleted)</p>



<a name="280374"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280374" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Umair Khan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280374">(Sep 13 2017 at 04:17)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span>, can you please share the contents of this file <code>var/log/update-prod-static.log</code>?</p>



<a name="280471"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280471" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280471">(Sep 13 2017 at 13:15)</a>:</h4>
<p>update-prod-static.log attached. <a href="/user_uploads/2/12/f7AV4jc8IiIoFwxopJGuMgKn/update-prod-static.log" target="_blank" title="update-prod-static.log">update-prod-static.log</a></p>



<a name="280497"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280497" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280497">(Sep 13 2017 at 14:16)</a>:</h4>
<p>Got past new permissions errors again (by changing affected folders to 777 for now) - now a pile of dependency errors it seems. Log attached. <a href="/user_uploads/2/9b/0R6j7Ym5CrsJUC02Qw2aGaOC/update-prod-static2.log" target="_blank" title="update-prod-static2.log">update-prod-static2.log</a> - wondering now if this uBuntu 14.04 install is just too old to support Zulip 1.6?</p>



<a name="280502"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280502" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280502">(Sep 13 2017 at 14:26)</a>:</h4>
<p><a href="/user_uploads/2/d/j2xGsZ9MgOy6_swJUsefUjpR/dependency-errors.txt" target="_blank" title="dependency-errors.txt">dependency-errors.txt</a></p>



<a name="280815"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280815" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Umair Khan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280815">(Sep 14 2017 at 04:04)</a>:</h4>
<blockquote>
<p>wondering now if this uBuntu 14.04 install is just too old to support Zulip 1.6?</p>
</blockquote>
<p>Ubuntu 14.04 should not be a problem. We support both 14.04 and 16.04.</p>



<a name="280816"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280816" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Umair Khan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280816">(Sep 14 2017 at 04:05)</a>:</h4>
<blockquote>
<p>Got past new permissions errors again (by changing affected folders to 777 for now)</p>
</blockquote>
<p>Are you running the script as root?</p>



<a name="280913"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280913" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280913">(Sep 14 2017 at 10:39)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> yeah, we support 14.04, that's definitely not your problem</p>



<a name="280915"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280915" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280915">(Sep 14 2017 at 10:40)</a>:</h4>
<p>The dependency issues that you seem to be stuck on now look like they're some issue with your apt setup.  You can likely resolve it by manually installing/uninstalling things, but I suspect the root problem is that you have some third-party PPA added that means you have a <code>nodejs</code> version that's inconsistent with the <code>npm</code> version available.</p>



<a name="280996"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/280996" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#280996">(Sep 14 2017 at 12:27)</a>:</h4>
<p>Ok - what should my path forward be then, trying to fix the node-js? Not really sure what to do about that.</p>



<a name="281136"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/281136" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#281136">(Sep 14 2017 at 14:14)</a>:</h4>
<p>OK, following up on this for the thread, it turns out we've had some upgrade code path regressions, which I debugged with <span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span>'s help in PMs.  Huge thanks to <span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> for the help with investigating these.  There were 2 actual issues:</p>
<ul>
<li><a href="https://github.com/zulip/zulip/commit/e8f835d852370ac63b8327e0a9f6c957067ad956" target="_blank" title="https://github.com/zulip/zulip/commit/e8f835d852370ac63b8327e0a9f6c957067ad956">https://github.com/zulip/zulip/commit/e8f835d852370ac63b8327e0a9f6c957067ad956</a> fixes one of them for future users going to 1.7</li>
<li><a href="https://github.com/zulip/zulip/issues/6516" target="_blank" title="https://github.com/zulip/zulip/issues/6516">https://github.com/zulip/zulip/issues/6516</a> is the other issue, which was a regression in 1.6 (broke the upgrade starting from 1.4.x if you'd ever uploaded an avatar)</li>
</ul>



<a name="283604"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/283604" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#283604">(Sep 17 2017 at 16:20)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span>  From a working 1.4.3 install, I patched the 1.5.2 installer (on the production server this time) with the code for 0041_create_attachments_for_old_messages.py, found at <a href="https://github.com/zulip/zulip/blob/e8f835d852370ac63b8327e0a9f6c957067ad956/zerver/migrations/0041_create_attachments_for_old_messages.py" target="_blank" title="https://github.com/zulip/zulip/blob/e8f835d852370ac63b8327e0a9f6c957067ad956/zerver/migrations/0041_create_attachments_for_old_messages.py">https://github.com/zulip/zulip/blob/e8f835d852370ac63b8327e0a9f6c957067ad956/zerver/migrations/0041_create_attachments_for_old_messages.py</a></p>
<p>Sill getting errors - output attached. Perhaps I am misunderstanding how to apply the patched commit?  I replaced 0041_create_attachments_for_old_messages.py with that code and put it back in the tarball.</p>
<p><a href="/user_uploads/2/a3/Hycykw9UtKYxASfHCE464mN8/1.5.2.error.txt" target="_blank" title="1.5.2.error.txt">1.5.2.error.txt</a></p>



<a name="283638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/283638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#283638">(Sep 17 2017 at 18:05)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> I'm not sure I understand what you did: what did you change in 041_create_... ?</p>



<a name="283641"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/283641" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#283641">(Sep 17 2017 at 18:06)</a>:</h4>
<p>But you can try replacing this"<br>
<code>is_message_realm_public = not stream.invite_only and not stream.realm.is_zephyr_mirror_realm</code><br>
with <code>is_message_relam_public = not stream.invite_only</code>; <code>stream.realm.is_zephyr_mirror_realm</code> should be false for you.</p>



<a name="283722"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/283722" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> hb-it <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#283722">(Sep 17 2017 at 20:11)</a>:</h4>
<p>That fixed it, thanks - I'm better off to stay out of my own way next time. all upgraded, with the new client, looks great :-)</p>



<a name="284452"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Issues%20upgrading%20from%201.36.%20to%201.6/near/284452" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Issues.20upgrading.20from.201.2E36.2E.20to.201.2E6.html#284452">(Sep 20 2017 at 02:18)</a>:</h4>
<p><span class="user-mention" data-user-email="dylanh@hb-studios.com" data-user-id="3275">@hb-it</span> awesome, glad to hear it :)</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>