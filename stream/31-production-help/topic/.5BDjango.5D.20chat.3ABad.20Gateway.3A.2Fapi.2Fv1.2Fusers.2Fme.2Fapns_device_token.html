<html>
<head><meta charset="utf-8"><title>[Django] chat:Bad Gateway:/api/v1/users/me/apns_device_token · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html">[Django] chat:Bad Gateway:/api/v1/users/me/apns_device_token</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1246328"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1246328" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1246328">(Aug 11 2021 at 20:11)</a>:</h4>
<p>from day to day, i'm getting more and more errors from different users like this (via email to the admin). </p>
<p>does somebody know what this means or what is causing this ?</p>
<div class="codehilite"><pre><span></span><code>Logger django.request, from module django.utils.log line 230:
Error generated by &lt;**username**&gt; &lt;**user email**&gt; (Member) on &lt;**servername**&gt; deployment

No stack trace available

Deployed code:
- git: None
- ZULIP_VERSION: 4.3


Request info:
- path: /api/v1/users/me/apns_device_token
- POST: {&#39;token&#39;: [&#39;&lt;**token string**&gt;&#39;], &#39;appid&#39;: [&#39;org.zulip.Zulip&#39;]}
- REMOTE_ADDR: &quot;&lt;**IP**&gt;&quot;
- QUERY_STRING: &quot;&quot;
- SERVER_NAME: &quot;&quot;
</code></pre></div>



<a name="1246475"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1246475" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1246475">(Aug 12 2021 at 17:08)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token">#issues &gt; [Django] chat:Bad Gateway:/api/v1/users/me/apns_device_token</a> by <span class="user-mention silent" data-user-id="12178">Alex Vandiver</span></p>



<a name="1246486"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1246486" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1246486">(Aug 12 2021 at 17:39)</a>:</h4>
<p><span class="user-mention" data-user-id="11088">@RolandK</span>: I'm assuming the string you set as the topic was the subject of the email?</p>
<p>This looks like a failure to register new mobile devices.  Mobile notifications go through Zulip Cloud, so the "Bad Gateway" could conceivably be coming from the Zulip Cloud servers; we did have a short outage of push notifications on the 4th.</p>
<p>Are you still seeing those errors come in, with recent timestamps?  If so, can you tell me (via PMs, if you prefer) the IP address of your server?</p>



<a name="1246697"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1246697" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1246697">(Aug 13 2021 at 11:35)</a>:</h4>
<p>oh yes, i was not aware that this is about push notifications. i send you the ip via pn</p>



<a name="1247400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247400">(Aug 17 2021 at 04:36)</a>:</h4>
<p>I don't see any hits to Zulip Cloud's mobile push gateway (or anything else) from the IP you told me.</p>
<p>Did your server register for mobile push notifications, using <a href="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html">https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html</a> ?</p>



<a name="1247493"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247493" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247493">(Aug 17 2021 at 09:51)</a>:</h4>
<p>hello, thanks for helping and looking into it. </p>
<p>apparently there has been some problem with our firewall configuration and outgoing connection to the internet from our zulip server was blocked completely (policy:drop) and nobody complained that push notifications didnt work (and i didn't notice either), as many often disable those (me included). at least, from time to time.</p>
<p>anyway, if the server cannot send push notifications to <a href="http://push.zulipchat.com">push.zulipchat.com</a>, a more precise error message would be very helpful and would have pointed us to the real problem very quickly.</p>



<a name="1247494"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247494" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247494">(Aug 17 2021 at 09:51)</a>:</h4>
<p>should i open an RFE on github for this (if it doesn't exist) ?</p>



<a name="1247498"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247498" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247498">(Aug 17 2021 at 10:00)</a>:</h4>
<p>i did not notice the problem, because the django error emails we got, were mostly regarding the same two persons but we have 50+ users on that server and i don't believe, that these are the only ones who have push notifications active. so the question is, why we admins did not get spammed with "bad gateway" error-mails</p>



<a name="1247501"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247501" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247501">(Aug 17 2021 at 10:06)</a>:</h4>
<p>ok, in server.log apparently there IS a notification, so the question is why zulip server rarely sends email regarding an obscure django error for some few affected persons when push notification server was not reachable at all.</p>
<div class="codehilite"><pre><span></span><code>root@chat:/var/log/zulip# cat server.log |grep ConnectionError |tail
2021-08-17 00:14:59.285 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 01:06:19.380 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 02:05:03.906 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 03:05:38.147 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 04:05:05.230 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 05:05:13.697 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 06:05:21.932 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 07:05:10.122 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 08:05:04.193 WARN [] ConnectionError while trying to connect to push notification bouncer
2021-08-17 09:05:04.114 WARN [] ConnectionError while trying to connect to push notification bouncer
</code></pre></div>



<a name="1247502"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247502" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247502">(Aug 17 2021 at 10:11)</a>:</h4>
<p>(deleted)</p>



<a name="1247548"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247548" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247548">(Aug 17 2021 at 14:12)</a>:</h4>
<p><span class="user-mention" data-user-id="11088">@RolandK</span> yeah I think you should open an issue for adjusting the error reporting situation here; this should probably have sent emails.</p>



<a name="1247549"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247549" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247549">(Aug 17 2021 at 14:13)</a>:</h4>
<p>(Though we do need to be careful to distinguish totally broken from transient issues, since transient 1-2 minutes Internet connection interruptions happen all the time and one probably doesn't want emails about that)</p>



<a name="1247708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1247708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1247708">(Aug 17 2021 at 20:41)</a>:</h4>
<p>thanks. i will open a github issue</p>



<a name="1248150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1248150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> RolandK <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1248150">(Aug 19 2021 at 14:01)</a>:</h4>
<p>fyi:  <a href="https://github.com/zulip/zulip/issues/19596">https://github.com/zulip/zulip/issues/19596</a></p>



<a name="1248394"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20chat%3ABad%20Gateway%3A/api/v1/users/me/apns_device_token/near/1248394" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20chat.3ABad.20Gateway.3A.2Fapi.2Fv1.2Fusers.2Fme.2Fapns_device_token.html#1248394">(Aug 20 2021 at 14:00)</a>:</h4>
<p>Great, tagged it as a priority.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>