<html>
<head><meta charset="utf-8"><title>Upgrade from git · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html">Upgrade from git</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="125399"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125399" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125399">(Jan 12 2017 at 16:10)</a>:</h4>
<p>I ran an <code>upgrade-zulip-from-git</code> (starting from custom built tarball from yesterday) but I got this error:</p>
<div class="codehilite"><pre><span></span>subprocess.CalledProcessError: Command &#39;[&#39;./tools/minify-js&#39;, &#39;--prev-deploy&#39;, &#39;/home/zulip/deployments/current&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="125478"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125478" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Hönig <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125478">(Jan 12 2017 at 16:31)</a>:</h4>
<p>Hey <span class="user-mention" data-user-email="rwbarton@gmail.com">@Reid Barton</span> , can you try to run the command manually, so that we can see what exact error it is throwing?</p>



<a name="125480"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125480" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125480">(Jan 12 2017 at 16:31)</a>:</h4>
<div class="codehilite"><pre><span></span>root@zulip:/home/zulip/deployments/next# ./tools/minify-js &#39;--prev-deploy&#39; &#39;/home/zulip/deployments/current&#39;
module.js:457
    throw err;
    ^

Error: Cannot find module &#39;../lib&#39;
    at Function.Module._resolveFilename (module.js:455:15)
    at Function.Module._load (module.js:403:25)
    at Module.require (module.js:483:17)
    at require (internal/module.js:20:19)
    at Object.&lt;anonymous&gt; (/srv/zulip-npm-cache/736d292307af94230dc4e3c8ab63208d1bf2bb46/node_modules/.bin/handlebars:105:18)
    at Module._compile (module.js:556:32)
    at Object.Module._extensions..js (module.js:565:10)
    at Module.load (module.js:473:32)
    at tryModuleLoad (module.js:432:12)
    at Function.Module._load (module.js:424:3)
Traceback (most recent call last):
  File &quot;tools/compile-handlebars-templates&quot;, line 61, in &lt;module&gt;
    run()
  File &quot;tools/compile-handlebars-templates&quot;, line 30, in run
    &#39;--known&#39;, &#39;if,unless,each,with&#39;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;node&#39;, &#39;node_modules/.bin/handlebars&#39;, &#39;static/templates/admin_user_list.handlebars&#39;, &#39;static/templates/compose-invite-users.handlebars&#39;, &#39;static/templates/settings_tab.handlebars&#39;, &#39;static/templates/admin_default_streams_list.handlebars&#39;, &#39;static/templates/tutorial_reply.handlebars&#39;, &#39;static/templates/subscription_type.handlebars&#39;, &#39;static/templates/stream_sidebar_row.handlebars&#39;, &#39;static/templates/admin_streams_list.handlebars&#39;, &#39;static/templates/announce_stream_docs.handlebars&#39;, &#39;static/templates/notification.handlebars&#39;, &#39;static/templates/bankruptcy_modal.handlebars&#39;, &#39;static/templates/message_edit_form.handlebars&#39;, &#39;static/templates/message_reactions.handlebars&#39;, &#39;static/templates/subscription_table_body.handlebars&#39;, &#39;static/templates/tutorial_message.handlebars&#39;, &#39;static/templates/tutorial_home.handlebars&#39;, &#39;static/templates/user_presence_rows.handlebars&#39;, &#39;static/templates/tutorial_title.handlebars&#39;, &#39;static/templates/subscription_setting_icon.handlebars&#39;, &#39;static/templates/user_sidebar_actions.handlebars&#39;, &#39;static/templates/propagate_notification_change.handlebars&#39;, &#39;static/templates/admin_tab.handlebars&#39;, &#39;static/templates/message_info_popover_title.handlebars&#39;, &#39;static/templates/tab_bar.handlebars&#39;, &#39;static/templates/stream_sidebar_actions.handlebars&#39;, &#39;static/templates/invite_subscription.handlebars&#39;, &#39;static/templates/admin_filter_list.handlebars&#39;, &#39;static/templates/bot_avatar_row.handlebars&#39;, &#39;static/templates/alert_word_settings_item.handlebars&#39;, &#39;static/templates/auth-methods-settings-admin.handlebars&#39;, &#39;static/templates/recipient_row.handlebars&#39;, &#39;static/templates/compose_notification.handlebars&#39;, &#39;static/templates/emoji_popover_content.handlebars&#39;, &#39;static/templates/topic_sidebar_actions.handlebars&#39;, &#39;static/templates/stream_privacy.handlebars&#39;, &#39;static/templates/bookend.handlebars&#39;, &#39;static/templates/actions_popover_content.handlebars&#39;, &#39;static/templates/topic_list_item.handlebars&#39;, &#39;static/templates/tutorial_subject.handlebars&#39;, &#39;static/templates/change_stream_privacy.handlebars&#39;, &#39;static/templates/stream_member_list_entry.handlebars&#39;, &#39;static/templates/message_info_popover_content.handlebars&#39;, &#39;static/templates/subscription.handlebars&#39;, &#39;static/templates/admin_emoji_list.handlebars&#39;, &#39;static/templates/user_presence_row.handlebars&#39;, &#39;static/templates/tutorial_stream.handlebars&#39;, &#39;static/templates/subscription_settings.handlebars&#39;, &#39;static/templates/topic_edit_form.handlebars&#39;, &#39;static/templates/new_stream_users.handlebars&#39;, &#39;static/templates/email_address_hint.handlebars&#39;, &#39;static/templates/message_reaction.handlebars&#39;, &#39;static/templates/loader.handlebars&#39;, &#39;static/templates/group_pms.handlebars&#39;, &#39;static/templates/compose_all_everyone.handlebars&#39;, &#39;static/templates/subscription_creation_form.handlebars&#39;, &#39;static/templates/reaction_popover_content.handlebars&#39;, &#39;static/templates/sidebar_private_message_list.handlebars&#39;, &#39;static/templates/message_group.handlebars&#39;, &#39;static/templates/single_message.handlebars&#39;, &#39;static/templates/settings/streams-list-admin.handlebars&#39;, &#39;static/templates/settings/bot-list-admin.handlebars&#39;, &#39;static/templates/settings/deactivated-users-admin.handlebars&#39;, &#39;static/templates/settings/bot-settings.handlebars&#39;, &#39;static/templates/settings/admin_auth_methods_list.handlebars&#39;, &#39;static/templates/settings/alert-word-settings.handlebars&#39;, &#39;static/templates/settings/emoji-settings-admin.handlebars&#39;, &#39;static/templates/settings/account-settings.handlebars&#39;, &#39;static/templates/settings/default-streams-list-admin.handlebars&#39;, &#39;static/templates/settings/ui-settings.handlebars&#39;, &#39;static/templates/settings/notification-settings.handlebars&#39;, &#39;static/templates/settings/display-settings.handlebars&#39;, &#39;static/templates/settings/organization-settings-admin.handlebars&#39;, &#39;static/templates/settings/realm-filter-settings-admin.handlebars&#39;, &#39;static/templates/settings/admin_alias_list.handlebars&#39;, &#39;static/templates/settings/user-list-admin.handlebars&#39;, &#39;--output&#39;, &#39;static/templates/compiled.js&#39;, &#39;--known&#39;, &#39;if,unless,each,with&#39;]&#39; returned non-zero exit status 1
Traceback (most recent call last):
  File &quot;./tools/minify-js&quot;, line 34, in &lt;module&gt;
    subprocess.check_call([&#39;tools/compile-handlebars-templates&#39;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;tools/compile-handlebars-templates&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="125482"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125482" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125482">(Jan 12 2017 at 16:32)</a>:</h4>
<p>I'm not sure if I'm supposed to be in a specific directory for this steps</p>



<a name="125483"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125483" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125483">(Jan 12 2017 at 16:36)</a>:</h4>
<p>I'm guessing <code>cd zulip</code> might get you further.</p>



<a name="125485"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125485" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125485">(Jan 12 2017 at 16:36)</a>:</h4>
<p>I'm in <code>/home/zulip/deployments/next</code></p>



<a name="125487"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125487" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125487">(Jan 12 2017 at 16:38)</a>:</h4>
<p>what is <code>settings.DEPLOY_ROOT</code>?</p>



<a name="125490"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125490" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125490">(Jan 12 2017 at 16:39)</a>:</h4>
<p>probably <code>zulip</code>, hence the <code>cd zulip</code> suggestion :)</p>



<a name="125491"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125491" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125491">(Jan 12 2017 at 16:40)</a>:</h4>
<p>Can you do <code>ls</code> from your current working directory?</p>



<a name="125495"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125495" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125495">(Jan 12 2017 at 16:43)</a>:</h4>
<div class="codehilite"><pre><span></span>root@zulip:/home/zulip/deployments/next# ls
analytics     contrib_bots  frontend_tests  package.json  requirements  tools        zerver              zulip-venv
api           corporate     LICENSE         pgroonga      scripts       Vagrantfile  zilencer
bots          Dockerfile    manage.py       puppet        static        var          zproject
confirmation  docs          node_modules    README.md     templates     version.py   zulip-current-venv
</pre></div>



<a name="125496"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125496" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125496">(Jan 12 2017 at 16:43)</a>:</h4>
<p>there is no <code>zulip</code>, nor is there in my <code>deployments/current</code></p>



<a name="125498"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125498" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Hönig <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125498">(Jan 12 2017 at 16:44)</a>:</h4>
<p>You are inside a  subdirectory of zulip. Simply do <code>cd ..</code> twice now, and you'll be at the root of zulip.</p>



<a name="125501"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125501" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125501">(Jan 12 2017 at 16:44)</a>:</h4>
<p>okay, but the command was invoked by the installation process as <code>./tools/minify-js</code></p>



<a name="125502"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125502" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Robert Hönig <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125502">(Jan 12 2017 at 16:45)</a>:</h4>
<p>From where did you execute <code>upgrade-zulip-from-git</code>?</p>



<a name="125504"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125504" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125504">(Jan 12 2017 at 16:46)</a>:</h4>
<p>from <code>/root</code> I guess, I can try from <code>/root/zulip</code></p>



<a name="125506"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125506" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125506">(Jan 12 2017 at 16:47)</a>:</h4>
<p>same problem (unsurprisingly)</p>



<a name="125509"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125509" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125509">(Jan 12 2017 at 16:50)</a>:</h4>
<p>I see, <code>/root/zulip = /home/zulip/deployments/next</code></p>



<a name="125513"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125513" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125513">(Jan 12 2017 at 16:51)</a>:</h4>
<p>oh there is an issue about this already, <a href="https://github.com/zulip/zulip/issues/2377" target="_blank" title="https://github.com/zulip/zulip/issues/2377">https://github.com/zulip/zulip/issues/2377</a></p>



<a name="125517"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125517" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125517">(Jan 12 2017 at 16:52)</a>:</h4>
<p>so I guess it is just broken</p>



<a name="125519"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125519" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125519">(Jan 12 2017 at 16:53)</a>:</h4>
<p>/me does it the old-fashioned way</p>



<a name="125580"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125580" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125580">(Jan 12 2017 at 17:26)</a>:</h4>
<p><span class="user-mention" data-user-email="rwbarton@gmail.com">@Reid Barton</span> I'm a bit confused by this failure mode; I use upgrade-zulip-from-git all the time to upgrade our servers, and have never seen this</p>



<a name="125582"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125582" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125582">(Jan 12 2017 at 17:27)</a>:</h4>
<p>(At least, never been able to reproduce this; I had seen <span class="user-mention" data-user-email="andersk@mit.edu">@Anders Kaseorg</span>'s traceback)</p>



<a name="125583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125583">(Jan 12 2017 at 17:27)</a>:</h4>
<p>hm</p>



<a name="125587"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125587" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125587">(Jan 12 2017 at 17:27)</a>:</h4>
<p>oops I missed part of the instructions haha!</p>



<a name="125590"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125590" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125590">(Jan 12 2017 at 17:27)</a>:</h4>
<p>ahh, which part?</p>



<a name="125591"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125591" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125591">(Jan 12 2017 at 17:27)</a>:</h4>
<p>To configure this, you will need to add<br>
<code>zulip::static_asset_compiler</code> to your <code>/etc/zulip/zulip.conf</code> file's<br>
<code>puppet_classes</code> entry, like this:</p>



<a name="125592"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125592" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125592">(Jan 12 2017 at 17:27)</a>:</h4>
<p>:)</p>



<a name="125594"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125594" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125594">(Jan 12 2017 at 17:28)</a>:</h4>
<p>that's what I get for grepping for upgrade-zulip-from-git and reading backwards</p>



<a name="125597"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125597" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125597">(Jan 12 2017 at 17:28)</a>:</h4>
<p>ahh, yeah</p>



<a name="125598"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125598" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125598">(Jan 12 2017 at 17:28)</a>:</h4>
<p>We should quite possibly just move it into the default configuration</p>



<a name="125600"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125600" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125600">(Jan 12 2017 at 17:28)</a>:</h4>
<p>should maybe fail faster in this scenario</p>



<a name="125603"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125603" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125603">(Jan 12 2017 at 17:29)</a>:</h4>
<p>I recently rearranged things so that <code>upgrade-zulip-from-git</code> builds static assets before turning anything off</p>



<a name="125604"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125604" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125604">(Jan 12 2017 at 17:29)</a>:</h4>
<p>So that if it fails, it should be harmless</p>



<a name="125605"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125605" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125605">(Jan 12 2017 at 17:29)</a>:</h4>
<p>hm</p>



<a name="125610"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125610" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125610">(Jan 12 2017 at 17:30)</a>:</h4>
<p>it did fail very early but I'm almost certain the zulip server was not running (had the "We're trouble reaching etc." message in my zulip browser tab)</p>



<a name="125614"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125614" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125614">(Jan 12 2017 at 17:31)</a>:</h4>
<p>hmm.  You can read <code>scripts/lib/upgrade-zulip-stage-2</code>; as of last Friday it now does <code>update-prod-static</code> early</p>



<a name="125625"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/125625" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Reid Barton <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#125625">(Jan 12 2017 at 17:35)</a>:</h4>
<p>hm, I agree that it looks that way</p>



<a name="165404"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165404" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165404">(Mar 10 2017 at 13:04)</a>:</h4>
<p>was just trying the upgrade from git but got an error and nothing was in the log folder (here the terminal output only)<br>
What was the cause?<br>
<a href="/user_uploads/2/e3/CEmk7yugnVehtnhCQE1HWtf_/failed-upgrading-from-git.txt" target="_blank" title="failed-upgrading-from-git.txt">failed-upgrading-from-git.txt</a></p>



<a name="165405"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165405" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165405">(Mar 10 2017 at 13:07)</a>:</h4>
<p>retried with <code>sudo</code> but same result</p>



<a name="165410"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165410" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165410">(Mar 10 2017 at 13:17)</a>:</h4>
<p>how can I create a tarball straight from git. I've seen the script in a tools folder, but it's not there in my current zulip installation (1.5.1)</p>



<a name="165411"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165411" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165411">(Mar 10 2017 at 13:19)</a>:</h4>
<p>oh, it is there in the new folder from the failed git upgrade<br>
but <code>sudo build-release-tarball</code> isn't a known command</p>



<a name="165450"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165450" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165450">(Mar 10 2017 at 16:15)</a>:</h4>
<p>It should be in the <code>tools</code> directory.</p>



<a name="165488"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165488" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165488">(Mar 10 2017 at 17:45)</a>:</h4>
<p><span class="user-mention" data-user-email="showell30@yahoo.com" data-user-id="58">@Steve Howell</span> there should be additional log details for what that failed at some path like <code>/home/zulip/deployments/next/var/log/update-prod-static/log</code></p>



<a name="165489"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/165489" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#165489">(Mar 10 2017 at 17:46)</a>:</h4>
<p>Oops meant to mention <span class="user-mention" data-user-email="m.mueller@intercultural-elements.eu" data-user-id="1646">@Matthias Müller</span></p>



<a name="166583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166583">(Mar 12 2017 at 20:21)</a>:</h4>
<p>I already have succeeded in upgrading our production machine to 1.5.1 but that's almost 1000 commits away from current git master. Now it looks and feels much more consistent so unless you think the current git master is not mature enough for production use I would attempt the git upgrade tomorrow around 5pm CET/9am your time.</p>



<a name="166587"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166587" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166587">(Mar 12 2017 at 20:53)</a>:</h4>
<p>I am not aware of any major regressions on master, but of course it's a little less well tested than a full release.  I can be around 9am tomorrow.  Once you go through the process of deploying off of master, it should be easy to re-update off of master if you discover any issues, and we usually make pretty quick fixes, so I think you should proceed with the plan.</p>



<a name="166588"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166588" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166588">(Mar 12 2017 at 21:47)</a>:</h4>
<p>Fab, thanks a lot. Until then...</p>



<a name="166734"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166734" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166734">(Mar 13 2017 at 11:39)</a>:</h4>
<p>Testserver git upgrade: I just looked for the log <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> pointed out on March 10th. But the symlink <code>/next</code> didn't work. <br>
I had to manually click to <code>/home/zulip/deployments/2017-03-13-12-29-05/var/log</code></p>



<a name="166735"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166735" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166735">(Mar 13 2017 at 11:39)</a>:</h4>
<div class="codehilite"><pre><span></span>Using cached emojis from /srv/zulip-emoji-cache/f516920874fb980676d9c5a3c1e858ffd6284a0c/emoji
+ rm -rf /home/zulip/deployments/2017-03-10-14-04-37/tools/setup/emoji/../../../static/generated/emoji
Hash: 5ccb5f20f5ef7f649109
Version: webpack 1.12.2
Time: 797ms
    Asset    Size  Chunks             Chunk Names
bundle.js  106 kB       0  [emitted]  main
   [0] ./static/js/src/main.js 1.38 kB {0} [built]
    + 30 hidden modules
fatal: Not a git repository: &#39;/home/zulip/deployments/current/.git&#39;
Warning: git returned an error when comparing to the previous
deploy in /home/zulip/deployments/current. Will re-minify JavaScript instead of reusing
closure-compiler not installed; the Vagrant tools/provision installs it via apt or you can manually unpack http://dl.google.com/closure-compiler/compiler-latest.zip to tools/closure-compiler
</pre></div>



<a name="166736"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166736" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166736">(Mar 13 2017 at 11:39)</a>:</h4>
<p>I tried three times and every time the same log</p>



<a name="166740"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166740" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166740">(Mar 13 2017 at 12:40)</a>:</h4>
<p>I think I found the problem: <br>
after editing <code>/etc/zulip/zulip.conf</code> I can't successfully run <code>scripts/zulip-puppet-apply</code></p>



<a name="166741"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166741" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166741">(Mar 13 2017 at 12:42)</a>:</h4>
<p>instead I get this error </p>
<div class="codehilite"><pre><span></span>zulip@zulip:~/deployments/current$ scripts/zulip-puppet-apply
Error: Could not find class apt for zulip.domain.local on node zulip.domain.local
Error: Could not find class apt for zulip.domain.local on node zulip.domain.local
Traceback (most recent call last):
  File &quot;scripts/zulip-puppet-apply&quot;, line 36, in &lt;module&gt;
    subprocess.check_call(puppet_cmd + [&#39;--noop&#39;, &#39;--show_diff&#39;])
  File &quot;/usr/lib/python2.7/subprocess.py&quot;, line 541, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;puppet&#39;, &#39;apply&#39;, &#39;--modulepath=/root/zulip/puppet&#39;, &#39;-e&#39;, &#39;\nExec { path =&gt; &quot;/usr/sbin:/usr/bin:/sbin:/bin&quot; }\ninclude apt\ninclude zulip::voyager\ninclude zulip::static_asset_compiler\n&#39;, &#39;--noop&#39;, &#39;--show_diff&#39;]&#39; returned non-zero exit status 1
</pre></div>



<a name="166837"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166837" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166837">(Mar 13 2017 at 16:15)</a>:</h4>
<p>Is there an easy way to get back to your starting state this morning?  It would be good to know which steps you're following before you encounter the first error.</p>



<a name="166838"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166838" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166838">(Mar 13 2017 at 16:16)</a>:</h4>
<p>(er, afternoon for you)</p>



<a name="166840"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166840" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166840">(Mar 13 2017 at 16:18)</a>:</h4>
<p>hm, the first error that I posted today (starting with <code>Using cached emojis...</code> was on  the test server). let's ignore that one. <br>
on the production machine I haven't tried a git upgrade yet<br>
but did encounter the puppet error on both<br>
maybe because both hang in a Windows domain network (?)</p>



<a name="166841"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166841" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166841">(Mar 13 2017 at 16:22)</a>:</h4>
<p>It's possible that the Windows networking stuff is relevant here.</p>



<a name="166842"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166842" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166842">(Mar 13 2017 at 16:23)</a>:</h4>
<p>For your test server, it might be helpful to try to run the puppet command individually.  If you look at the last line of the output, you can infer what command it's trying to run.  Back in 5 minutes.</p>



<a name="166843"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166843" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166843">(Mar 13 2017 at 16:23)</a>:</h4>
<p>this really looks like it<code>Could not find class apt for zulip.domain.local on node zulip.domain.local</code><br>
ok, I'll wait<br>
do you have the list of puppet commands I have to run through?</p>



<a name="166844"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166844" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166844">(Mar 13 2017 at 16:28)</a>:</h4>
<p>I'm saying you can construct the puppet command based on the output you posted (see the last line).</p>



<a name="166845"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166845" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166845">(Mar 13 2017 at 16:28)</a>:</h4>
<p>But it might make sense to start over on a test server, and we  can try to do this very methodically, and you can tell us exactly which commands you are running.</p>



<a name="166846"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166846" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166846">(Mar 13 2017 at 16:29)</a>:</h4>
<p>uff, I don't even know what puppet really is. <br>
on the testserver I basically followed the instructions in the <a href="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-maintain-secure-upgrade.html">documentation</a></p>



<a name="166848"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166848" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166848">(Mar 13 2017 at 16:31)</a>:</h4>
<p>I would have to create a new VM for that.</p>



<a name="166853"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166853" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166853">(Mar 13 2017 at 16:35)</a>:</h4>
<p><code>puppet</code> is basically a tool that knows how to populate all of your directories with various files.  It would not surprise me if it's assuming Unix conventions.</p>



<a name="166854"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166854" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166854">(Mar 13 2017 at 16:36)</a>:</h4>
<p><a href="https://en.wikipedia.org/wiki/Puppet_(software)" target="_blank" title="https://en.wikipedia.org/wiki/Puppet_(software)">https://en.wikipedia.org/wiki/Puppet_(software)</a></p>
<p>The wiki page seems to indicate some level of Windows support, but I could still see hybrid environments being challenging.  Most Zulip production environments are pure Unix.</p>



<a name="166855"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166855" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166855">(Mar 13 2017 at 16:37)</a>:</h4>
<p>weird, but upgrading using the tarball worked fine</p>



<a name="166857"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166857" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166857">(Mar 13 2017 at 16:40)</a>:</h4>
<p>Can you post a brief history of what you've done on the two servers (test and production) so far, going back to the original install?  (An example would be something like "test server: original install 1.3 worked, normal upgrade to 1.5.1 worked w/some workarounds, upgrade using git tarball fails w/puppet error".</p>



<a name="166858"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166858" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166858">(Mar 13 2017 at 16:44)</a>:</h4>
<p>ok, Testserver: installed 1.5.1 worked<br>
attempting multiple git upgrades didn't work<br>
/deployment/next still pointed to an older git upgrade attempt <br>
tried again zulip-puppet-apply but it failed with above error</p>
<p>prod.server: installed 1.4.2 months ago<br>
upgrade to 1.5.1 from tarball worked fine (there were problems with ubuntu because I restored the VM from a backup so those things kind of never happened)</p>



<a name="166862"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166862" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166862">(Mar 13 2017 at 16:47)</a>:</h4>
<p>ok, give me a moment, I'm looking for some docs</p>



<a name="166864"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166864" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166864">(Mar 13 2017 at 16:48)</a>:</h4>
<p>forgot to mention: production server had the same <code>zulip-puppet-apply</code> error as test server</p>



<a name="166874"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166874" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166874">(Mar 13 2017 at 16:52)</a>:</h4>
<p>Ok, this does seem to be relevant:</p>
<div class="codehilite"><pre><span></span>Error: Could not find class apt for zulip.domain.local on node zulip.domain.local
</pre></div>



<a name="166876"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166876" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166876">(Mar 13 2017 at 16:53)</a>:</h4>
<p>I  unfortunately don't have much experience with puppet, but can you run this for a data point?</p>
<div class="codehilite"><pre><span></span> puppet module list
</pre></div>



<a name="166877"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166877" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166877">(Mar 13 2017 at 16:54)</a>:</h4>
<p>As an aside, it's 9:53 local time here, but it feels like 8:53, because our clocks moved forward this weekend.  So it may be a while till Tim comes online.  He'll know more here.</p>



<a name="166879"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166879" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166879">(Mar 13 2017 at 16:54)</a>:</h4>
<p>I googled your error and found this, but we should hold off on following their advice right away:</p>
<p><a href="http://stackoverflow.com/questions/26046550/puppet-error-could-not-find-class-apt" target="_blank" title="http://stackoverflow.com/questions/26046550/puppet-error-could-not-find-class-apt">http://stackoverflow.com/questions/26046550/puppet-error-could-not-find-class-apt</a></p>



<a name="166881"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166881" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166881">(Mar 13 2017 at 16:56)</a>:</h4>
<p>ok, I have a read in a moment... I restored a ubuntu VM export without Zulip but need to rename the user first<br>
then I can install Zulip 1.5.1 again for testing</p>



<a name="166885"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166885" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166885">(Mar 13 2017 at 16:57)</a>:</h4>
<p>sounds good</p>



<a name="166902"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166902" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166902">(Mar 13 2017 at 17:03)</a>:</h4>
<p>when I googled the problem I also found a lot of vagrant related issues. But I don't use vagrant. <br>
update: running <code>apt-get upgrade</code> on the test-server</p>



<a name="166926"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166926" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166926">(Mar 13 2017 at 17:16)</a>:</h4>
<p>test server: did sudo apt-get dist-upgrade<br>
created self-signed certificates <br>
installing zulip 1.5.1 from releases tarball now</p>



<a name="166936"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166936" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166936">(Mar 13 2017 at 17:25)</a>:</h4>
<p>could it be connected to this? <br>
<a href="/user_uploads/2/66/pqgWVtpr2nIArhTIIUmHpXtL/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/66/pqgWVtpr2nIArhTIIUmHpXtL/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/66/pqgWVtpr2nIArhTIIUmHpXtL/pasted_image.png"></a></div>



<a name="166937"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166937" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166937">(Mar 13 2017 at 17:26)</a>:</h4>
<p>Possibly.  What is the symptom now?</p>



<a name="166938"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166938" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166938">(Mar 13 2017 at 17:27)</a>:</h4>
<p>it's still installing zulip</p>



<a name="166940"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166940" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166940">(Mar 13 2017 at 17:32)</a>:</h4>
<p>ok</p>



<a name="166941"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166941" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166941">(Mar 13 2017 at 17:34)</a>:</h4>
<p>configured setting.py and zulip-secrets.conf<br>
initializing database now</p>



<a name="166955"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166955" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166955">(Mar 13 2017 at 17:44)</a>:</h4>
<p>ok, zulip up and running again<br>
fresh installation of 1.5.1 on test server</p>



<a name="166960"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166960" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166960">(Mar 13 2017 at 17:45)</a>:</h4>
<p>I will now edit the zulip.conf file to allow for git upgrades</p>



<a name="166965"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166965" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166965">(Mar 13 2017 at 17:46)</a>:</h4>
<p>interesting, the test server has this </p>
<div class="codehilite"><pre><span></span>[rabbitmq]
nodename = zulip@localhost
</pre></div>


<p>which is not in the production server's zulip.conf file</p>



<a name="166971"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166971" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166971">(Mar 13 2017 at 17:47)</a>:</h4>
<p>test server /etc/zulip/zulip.conf looks now like this </p>
<div class="codehilite"><pre><span></span>[machine]
puppet_classes = zulip::voyager, zulip::static_asset_compiler
deploy_type = voyager

[rabbitmq]
nodename = zulip@localhost

[deployment]
git_repo_url = https://github.com/zulip/zulip.git
</pre></div>



<a name="166974"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166974" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166974">(Mar 13 2017 at 17:48)</a>:</h4>
<p>Interesting!  <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> do you know why there'd be a <code>rabbitmq</code> section in <code>zulip.conf</code> for a fresh install, but not for an upgrade?</p>



<a name="166978"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166978" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166978">(Mar 13 2017 at 17:49)</a>:</h4>
<p>yep</p>



<a name="166979"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166979" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166979">(Mar 13 2017 at 17:49)</a>:</h4>
<p>shall I try to run the <code>zulip-puppet-apply</code> on test server?</p>



<a name="166981"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166981" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166981">(Mar 13 2017 at 17:49)</a>:</h4>
<p>Basically it's not super safe to migrate a machine to the new model without them doing manual work</p>



<a name="166982"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166982" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166982">(Mar 13 2017 at 17:49)</a>:</h4>
<p>But the <code>zulip@localhost</code> thing basically makes rabbitmq robust to hostname changes (but also force-changes your rabbitmq hostname)</p>



<a name="166983"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166983" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166983">(Mar 13 2017 at 17:50)</a>:</h4>
<p>So older systems can just stay with the default</p>



<a name="166985"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166985" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166985">(Mar 13 2017 at 17:50)</a>:</h4>
<p>We have a process for switching existing production systems if one's interested</p>



<a name="166986"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166986" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166986">(Mar 13 2017 at 17:51)</a>:</h4>
<p>with the 'new model' do you mean corporate / community ?</p>



<a name="166988"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166988" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166988">(Mar 13 2017 at 17:52)</a>:</h4>
<p>No, I just mean hardcoding the rabbitmq nodename of <code>zulip@localhost</code> rather than the default of <code>zulip@hostname</code> which breaks if your hostname changes</p>



<a name="166990"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166990" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166990">(Mar 13 2017 at 17:52)</a>:</h4>
<p>I see</p>



<a name="166992"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166992" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166992">(Mar 13 2017 at 17:53)</a>:</h4>
<p>I will try now the puppet apply</p>



<a name="166994"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166994" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166994">(Mar 13 2017 at 17:53)</a>:</h4>
<p>same problem with the error on the domain</p>



<a name="166996"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166996" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166996">(Mar 13 2017 at 17:54)</a>:</h4>
<div class="codehilite"><pre><span></span>Error: Could not find class apt for zuliptest.domain.local on node zuliptest.domain.local
Error: Could not find class apt for zuliptest.domain.local on node zuliptest.domain.local
</pre></div>



<a name="166997"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166997" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166997">(Mar 13 2017 at 17:54)</a>:</h4>
<p>OK so that error is caused by running the command in an unexpected way</p>



<a name="166998"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/166998" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#166998">(Mar 13 2017 at 17:55)</a>:</h4>
<p>There's a bug in 1.5.1 that means you need to run <code>./scripts/zulip-puppet-apply</code>, not e.g. <code>scripts/zulip-puppet-apply</code>; the way it finds the rest of the project depends on having the leading <code>./</code></p>



<a name="167000"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167000" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167000">(Mar 13 2017 at 17:55)</a>:</h4>
<p>just now i did actually ./script...</p>



<a name="167005"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167005" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167005">(Mar 13 2017 at 17:56)</a>:</h4>
<p>ah, but didn't sudo it</p>



<a name="167008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167008">(Mar 13 2017 at 17:56)</a>:</h4>
<p>it's doing something</p>



<a name="167011"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167011" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167011">(Mar 13 2017 at 17:56)</a>:</h4>
<p><img alt=":smile:" class="emoji" src="/static/generated/emoji/images/emoji/unicode/1f604.png" title=":smile:"></p>



<a name="167024"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167024" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167024">(Mar 13 2017 at 18:00)</a>:</h4>
<p>yes! <code>Notice: Finished catalog run in 238.54 seconds</code></p>



<a name="167027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167027">(Mar 13 2017 at 18:01)</a>:</h4>
<p>a simple ./ made all the difference</p>



<a name="167028"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167028" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167028">(Mar 13 2017 at 18:01)</a>:</h4>
<p>so now i can try again the git upgrade</p>



<a name="167040"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167040" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167040">(Mar 13 2017 at 18:04)</a>:</h4>
<p>this puppet apply command/script is really CPU intensive</p>



<a name="167046"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167046" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167046">(Mar 13 2017 at 18:08)</a>:</h4>
<p>ah, while running <code>zulip-puppet-apply</code> on the production machine I got this</p>
<div class="codehilite"><pre><span></span>Error: Could not start Service[rabbitmq-server]: Execution of &#39;/bin/systemctl start rabbitmq-server&#39; returned 1: Job for rabbitmq-server.service failed because a timeout was exceeded. See &quot;systemctl status rabbitmq-server.service&quot; and &quot;journalctl -xe&quot; for details.
Error: /Stage[main]/Zulip::Rabbit/Service[rabbitmq-server]/ensure: change from stopped to running failed: Could not start Service[rabbitmq-server]: Execution of &#39;/bin/systemctl start rabbitmq-server&#39; returned 1: Job for rabbitmq-server.service failed because a timeout was exceeded. See &quot;systemctl status rabbitmq-server.service&quot; and &quot;journalctl -xe&quot; for details.
Notice: /Stage[main]/Zulip::Static_asset_compiler/Zulip::Static_asset_compiler::Safepackage[gettext]/Package[gettext]/ensure: ensure changed &#39;purged&#39; to &#39;present&#39;
Notice: Finished catalog run in 413.41 seconds
</pre></div>



<a name="167052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167052">(Mar 13 2017 at 18:09)</a>:</h4>
<p>now the production machine is down :-(</p>



<a name="167055"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167055" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167055">(Mar 13 2017 at 18:10)</a>:</h4>
<p>and although it's finished whatever it did there is still a high CPU load caused by python</p>



<a name="167061"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167061" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167061">(Mar 13 2017 at 18:13)</a>:</h4>
<p>test server is done with upgrade - all went well<br>
production server is not quite down but still totally overloaded by python</p>



<a name="167064"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167064" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167064">(Mar 13 2017 at 18:14)</a>:</h4>
<p>Can you <code>supervisorctl status</code>?</p>



<a name="167065"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167065" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167065">(Mar 13 2017 at 18:14)</a>:</h4>
<p>the python processes will continuously restart themselves if rabbitmq is down</p>



<a name="167066"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167066" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167066">(Mar 13 2017 at 18:14)</a>:</h4>
<p>So that should show them all with uptimes &lt;10s</p>



<a name="167069"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167069" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167069">(Mar 13 2017 at 18:15)</a>:</h4>
<p>yes, exactly<br>
<a href="/user_uploads/2/62/3K5AD2WD5H7qKkTxjGoyYrKq/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/62/3K5AD2WD5H7qKkTxjGoyYrKq/pasted_image.png" target="_blank" title="pasted image"><img src="/user_uploads/2/62/3K5AD2WD5H7qKkTxjGoyYrKq/pasted_image.png"></a></div>



<a name="167072"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167072" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167072">(Mar 13 2017 at 18:15)</a>:</h4>
<p>how can i stop it? or start rabbitmq?</p>



<a name="167074"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167074" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167074">(Mar 13 2017 at 18:15)</a>:</h4>
<p>It might be reasonable to <code>supervisorctl stop all</code> and then start <code>rabbitmq-server</code> and then start supervisord processes again</p>



<a name="167075"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167075" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167075">(Mar 13 2017 at 18:16)</a>:</h4>
<p>(Just because the machine will be more responsive without the restart party)</p>



<a name="167077"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167077" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167077">(Mar 13 2017 at 18:16)</a>:</h4>
<p>Wait, did you change the <code>/etc/zulip/zulip.conf</code> to have the <code>rabbitmq</code> lines?</p>



<a name="167079"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167079" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167079">(Mar 13 2017 at 18:16)</a>:</h4>
<p>On your existing machine?</p>



<a name="167081"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167081" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167081">(Mar 13 2017 at 18:17)</a>:</h4>
<p>no, on the production machine that was upgrade from 1.4.2 to 1.5.1 using tarball I never added those lines in zulip.conf</p>



<a name="167082"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167082" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167082">(Mar 13 2017 at 18:17)</a>:</h4>
<p>k</p>



<a name="167084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167084">(Mar 13 2017 at 18:18)</a>:</h4>
<p>This is the process for doing that migration:<br>
<a href="https://chat.zulip.org/#narrow/near/152942/stream/production.20help/topic/Livezuliping.201.2E4-.3E1.2E5" target="_blank" title="https://chat.zulip.org/#narrow/near/152942/stream/production.20help/topic/Livezuliping.201.2E4-.3E1.2E5">https://chat.zulip.org/#narrow/near/152942/stream/production.20help/topic/Livezuliping.201.2E4-.3E1.2E5</a><br>
which is about as fast as debugging why rabbitmq isn't starting if it doesn't just start for you</p>



<a name="167086"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167086" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167086">(Mar 13 2017 at 18:18)</a>:</h4>
<p>I run <code>sudo rabbitmq-server</code> but it seems be stuck</p>



<a name="167103"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167103" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167103">(Mar 13 2017 at 18:22)</a>:</h4>
<p>ok added </p>
<div class="codehilite"><pre><span></span>[rabbitmq]
nodename = zulip@localhost
</pre></div>



<a name="167107"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167107" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167107">(Mar 13 2017 at 18:23)</a>:</h4>
<p>will follow those instructions now or do I follow the instructions first and after that add those two lines?</p>



<a name="167119"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167119" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167119">(Mar 13 2017 at 18:27)</a>:</h4>
<p>heck, all red on the screen</p>



<a name="167124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167124">(Mar 13 2017 at 18:28)</a>:</h4>
<p>I think <code>apt-get purge rabbitmq-server</code> removed rabbitmq completely<br>
Livezuliping 1.4-&gt;1.5</p>



<a name="167125"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167125" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167125">(Mar 13 2017 at 18:28)</a>:</h4>
<p>after you add the lines</p>



<a name="167127"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167127" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167127">(Mar 13 2017 at 18:28)</a>:</h4>
<p>Yep, that's the intent -- rabbitmq is bad at switching its nodename</p>



<a name="167128"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167128" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167128">(Mar 13 2017 at 18:29)</a>:</h4>
<p>So to make the migration reliable it's best to uninstall it</p>



<a name="167129"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167129" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167129">(Mar 13 2017 at 18:29)</a>:</h4>
<p>(It's really Erlang's fault, not rabbitmq's, but the conclusion is the same)</p>



<a name="167131"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167131" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167131">(Mar 13 2017 at 18:30)</a>:</h4>
<p>what's the next command I should run?</p>



<a name="167138"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167138" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167138">(Mar 13 2017 at 18:32)</a>:</h4>
<p>This stuff:</p>
<div class="codehilite"><pre><span></span>scripts/setup/zulip-puppet-apply -f
/etc/init.d/rabbitmq-server start # may not be needed
scripts/setup/configure-rabbitmq
supervisorctl start all
</pre></div>



<a name="167139"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167139" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167139">(Mar 13 2017 at 18:32)</a>:</h4>
<p>here the print from putty<a href="/user_uploads/2/7d/hSAcv_iqZbdgEYNh0BjBYPEi/rabbitmq-error-logs.txt" target="_blank" title="rabbitmq-error-logs.txt">rabbitmq-error-logs.txt</a></p>



<a name="167140"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167140" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167140">(Mar 13 2017 at 18:33)</a>:</h4>
<p><code>scripts/setup/zulip-puppet-apply -f</code> failed because rabbitmq seems to be purged from ubuntu</p>



<a name="167142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167142">(Mar 13 2017 at 18:33)</a>:</h4>
<p>hmm, that <code>puppet</code> command should install it</p>



<a name="167143"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167143" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167143">(Mar 13 2017 at 18:33)</a>:</h4>
<p>Looking at the logs, it appears to have been reinstalled</p>



<a name="167145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167145">(Mar 13 2017 at 18:34)</a>:</h4>
<p>Try starting it manually and rerunning the puppet thing?</p>



<a name="167148"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167148" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167148">(Mar 13 2017 at 18:34)</a>:</h4>
<p>ok</p>



<a name="167155"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167155" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167155">(Mar 13 2017 at 18:36)</a>:</h4>
<p>sorry, what should I start manually?</p>



<a name="167157"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167157" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167157">(Mar 13 2017 at 18:36)</a>:</h4>
<p>Try <code>/etc/init.d/rabbitmq-server start</code></p>



<a name="167160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167160">(Mar 13 2017 at 18:36)</a>:</h4>
<p>excuse my ignorance. rabbits, puppets I feel I'm in a Djangol etc. <img alt=":confused:" class="emoji" src="/static/generated/emoji/images/emoji/unicode/1f615.png" title=":confused:"></p>



<a name="167162"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167162" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167162">(Mar 13 2017 at 18:36)</a>:</h4>
<p>ok</p>



<a name="167163"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167163" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167163">(Mar 13 2017 at 18:37)</a>:</h4>
<div class="codehilite"><pre><span></span>zulip@zulip:~/deployments/current$ sudo /etc/init.d/rabbitmq-server start
[....] Starting rabbitmq-server (via systemctl): rabbitmq-server.serviceJob for rabbitmq-server.service failed because the control process exited with error code. See &quot;systemctl status rabbitmq-server.service&quot; and &quot;journalctl -xe&quot; for details.
 failed!
</pre></div>



<a name="167172"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167172" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167172">(Mar 13 2017 at 18:42)</a>:</h4>
<p>ugh, rabbitmq is the worst.  Can you post what's in <code>/etc/rabbitmq/</code>?  In particular <code>rabbitmq-env.conf</code>?</p>



<a name="167174"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167174" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167174">(Mar 13 2017 at 18:42)</a>:</h4>
<p>ok</p>



<a name="167183"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167183" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167183">(Mar 13 2017 at 18:44)</a>:</h4>
<div class="codehilite"><pre><span></span>[...]
NODENAME=zulip@localhost

# ....
#NODE_IP_ADDRESS=127.0.0.1

# Defaults to 5672.
#NODE_PORT=5672
</pre></div>



<a name="167185"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167185" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167185">(Mar 13 2017 at 18:45)</a>:</h4>
<p>there was only that one file</p>



<a name="167188"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167188" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167188">(Mar 13 2017 at 18:45)</a>:</h4>
<p>in the window world a reboot of the VM does miracles... would it here?</p>



<a name="167190"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167190" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167190">(Mar 13 2017 at 18:46)</a>:</h4>
<p>You can try it, certainly.  But first: <code>ps -ef | grep rabbitmq</code>?</p>



<a name="167200"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167200" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167200">(Mar 13 2017 at 18:48)</a>:</h4>
<p><a href="/user_uploads/2/73/JooZjTTa_rMsHrnmFjBH-4TK/ps-ef-grep-rabbitmq.txt" target="_blank" title="ps-ef-grep-rabbitmq.txt">ps-ef-grep-rabbitmq.txt</a></p>



<a name="167206"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167206" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167206">(Mar 13 2017 at 18:50)</a>:</h4>
<p>You can try <code>pkill -u rabbitmq</code> and then trying to start it again.</p>



<a name="167207"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167207" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167207">(Mar 13 2017 at 18:50)</a>:</h4>
<p>Those processes look like they were leaked by the uninstall process (must be an Ubuntu init script bug)</p>



<a name="167213"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167213" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167213">(Mar 13 2017 at 18:52)</a>:</h4>
<p>score! </p>
<div class="codehilite"><pre><span></span>root@zulip:~# /etc/init.d/rabbitmq-server start
[ ok ] Starting rabbitmq-server (via systemctl): rabbitmq-server.service.
</pre></div>



<a name="167214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167214">(Mar 13 2017 at 18:52)</a>:</h4>
<p>yay</p>



<a name="167216"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167216" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167216">(Mar 13 2017 at 18:53)</a>:</h4>
<p>OK now you need to continue with the <code>configure-rabbitmq</code> script (which basically creates the <code>zulip</code> user there and sets its password)</p>



<a name="167217"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167217" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167217">(Mar 13 2017 at 18:53)</a>:</h4>
<p>And then you should <code>zulip-puppet-apply</code> again and start the server</p>



<a name="167224"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167224" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167224">(Mar 13 2017 at 18:55)</a>:</h4>
<p>ah, I overlooked the <code>configure-rabbitmq</code> and already started the server with <code>supervisorctl start all</code></p>



<a name="167226"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167226" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167226">(Mar 13 2017 at 18:55)</a>:</h4>
<p>can i stop it again to go back to <code>configure-rabbitmq</code>?</p>



<a name="167241"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167241" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167241">(Mar 13 2017 at 18:59)</a>:</h4>
<p>yep</p>



<a name="167246"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167246" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167246">(Mar 13 2017 at 18:59)</a>:</h4>
<p>ah, great. back again</p>



<a name="167249"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167249" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167249">(Mar 13 2017 at 19:00)</a>:</h4>
<p>works again.<br>
is it now configured to run git upgrade?</p>



<a name="167255"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167255" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167255">(Mar 13 2017 at 19:01)</a>:</h4>
<p>yay</p>



<a name="167258"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167258" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167258">(Mar 13 2017 at 19:01)</a>:</h4>
<p>If you added the <code>static_asset_compiler</code> stuff and did a puppet apply, then yes</p>



<a name="167264"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167264" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167264">(Mar 13 2017 at 19:01)</a>:</h4>
<p>ok, do puppet apply now</p>



<a name="167273"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167273" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167273">(Mar 13 2017 at 19:04)</a>:</h4>
<p>OK I'm going to be AFK for 15; sorry that this was a somewhat rough upgrade <span class="user-mention" data-user-email="m.mueller@intercultural-elements.eu" data-user-id="1646">@Matthias Müller</span>!</p>



<a name="167286"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167286" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167286">(Mar 13 2017 at 19:07)</a>:</h4>
<p>this way would be clearer after having gone through</p>
<ul>
<li>Edit <code>/etc/zulip/zulip.conf</code> and add the below block to it.</li>
</ul>
<div class="codehilite"><pre><span></span>[rabbitmq]
nodename = zulip@localhost
</pre></div>


<ul>
<li><code>supervisorctl stop all</code></li>
<li><code>/etc/init.d/rabbitmq-server stop</code></li>
<li><code>apt-get purge rabbitmq-server</code> # may not be needed</li>
<li><code>cd /home/zulip/deployment/current</code></li>
<li><code>./scripts/zulip-puppet-apply -f</code></li>
<li><code>pkill -u rabbitmq</code></li>
<li><code>/etc/init.d/rabbitmq-server start</code> # may not be needed</li>
<li><code>./scripts/setup/configure-rabbitmq</code></li>
<li><code>supervisorctl start all</code></li>
</ul>



<a name="167292"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167292" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167292">(Mar 13 2017 at 19:08)</a>:</h4>
<p>I wonder if the compose box in the legacy desktop app is even small after the git upgrade</p>



<a name="167312"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167312" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167312">(Mar 13 2017 at 19:17)</a>:</h4>
<p>sweet. It's done and working. Thanks <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> and <span class="user-mention" data-user-email="showell30@yahoo.com" data-user-id="58">@Steve Howell</span> !!! (compose box still small, but not smaller ;-)</p>



<a name="167334"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167334" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167334">(Mar 13 2017 at 19:23)</a>:</h4>
<p>one second... after a restart of zulip it seems to have reverted back to 1.5.1 without git</p>



<a name="167335"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167335" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167335">(Mar 13 2017 at 19:24)</a>:</h4>
<p>did symlink current not get updated?</p>



<a name="167340"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167340" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167340">(Mar 13 2017 at 19:27)</a>:</h4>
<p>ok, restart-server from /current restarts the old 1.5.1 and restart-server from the todays upgrade starts desired version ... mh</p>



<a name="167368"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/167368" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#167368">(Mar 13 2017 at 20:02)</a>:</h4>
<p>Yeah, we use <code>/next</code> to point to the thing you were trying to upgrade to</p>



<a name="191213"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191213" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191213">(Apr 21 2017 at 20:17)</a>:</h4>
<p>cool, just upgraded the production VM from git again and it worked without problems even though almost 1000 commits have gone by since<br>
but it takes some 20 minutes to complete (most of that time after it has checked whether npm 6.6.0 exists</p>
<div class="codehilite"><pre><span></span>v6.6.0 is already installed.
Now using node v6.6.0 (npm v3.10.3)
default -&gt; 6.6.0 (-&gt; v6.6.0)
...
</pre></div>


<p><code>Cached version not found! Installing node modules.</code></p>
<p>deploys here seem to be much  quicker...</p>



<a name="191214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191214">(Apr 21 2017 at 20:18)</a>:</h4>
<p>how long deploying takes depends in part on how long it's been, since we have some pretty fancy caching</p>



<a name="191215"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191215" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191215">(Apr 21 2017 at 20:19)</a>:</h4>
<p>But still, for us, an <code>npm install</code> takes it from 1m to 2m</p>



<a name="191216"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191216" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191216">(Apr 21 2017 at 20:19)</a>:</h4>
<p>Do you have a good Internet connection?</p>



<a name="191218"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191218" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191218">(Apr 21 2017 at 20:19)</a>:</h4>
<p>I see, I suspected something like that</p>



<a name="191219"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191219" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191219">(Apr 21 2017 at 20:19)</a>:</h4>
<p>First time is also a bit slower, since it needs to do a git clone</p>



<a name="191220"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191220" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191220">(Apr 21 2017 at 20:20)</a>:</h4>
<p>Doing a <code>pip install</code> is also required if Python deps have changed significantly; that could add another few minutes</p>



<a name="191221"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191221" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191221">(Apr 21 2017 at 20:20)</a>:</h4>
<p>200 mbps downstream but only 100 mbps are used (network wiring needs fixing)</p>



<a name="191222"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191222" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191222">(Apr 21 2017 at 20:20)</a>:</h4>
<p>I guess you can test re-deploying the same version to see how that is :)</p>



<a name="191224"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191224" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191224">(Apr 21 2017 at 20:20)</a>:</h4>
<p>nah, not on production. another day on the test server that is only little behind the current state</p>



<a name="191239"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191239" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tommy Ip <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191239">(Apr 21 2017 at 20:32)</a>:</h4>
<p><code>Yarn</code> seems to be a lot faster than <code>npm</code> and it should be a simple drop in replacement</p>



<a name="191244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191244">(Apr 21 2017 at 20:34)</a>:</h4>
<p>200mbps should be more than plenty.  Hrm.</p>



<a name="191245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Upgrade%20from%20git/near/191245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Upgrade.20from.20git.html#191245">(Apr 21 2017 at 20:34)</a>:</h4>
<p>Does <code>/var/log/zulip/upgrade.log</code> have timestamps in it?</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>