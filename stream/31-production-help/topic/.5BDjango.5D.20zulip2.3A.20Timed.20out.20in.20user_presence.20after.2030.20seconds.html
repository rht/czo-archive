<html>
<head><meta charset="utf-8"><title>[Django] zulip2: Timed out in user_presence after 30 seconds · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html">[Django] zulip2: Timed out in user_presence after 30 seconds</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1443128"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1443128" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Panagiotis Famelis <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1443128">(Sep 30 2022 at 11:30)</a>:</h4>
<p>Hello, I have received the following error message on my email from a self hosted zulip.</p>
<blockquote>
<p>Logger root, from module zerver.worker.queue_processors line 381:<br>
Error generated by Anonymous user (not logged in) on zulip2 deployment</p>
<p>Traceback (most recent call last):<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/worker/queue_processors.py", line 316, in do_consume<br>
    consume_func(events)<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/worker/queue_processors.py", line 356, in &lt;lambda&gt;<br>
    consume_func = lambda events: self.consume(events[0])<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/worker/queue_processors.py", line 575, in consume<br>
    do_update_user_presence(user_profile, client, log_time, status)<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/decorator.py", line 873, in wrapped_func<br>
    ret = func(*args, **kwargs)<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/lib/actions.py", line 6132, in do_update_user_presence<br>
    presence.save(update_fields=update_fields)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py", line 739, in save<br>
    self.save_base(using=using, force_insert=force_insert,<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py", line 776, in save_base<br>
    updated = self._save_table(<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py", line 858, in _save_table<br>
    updated = self._do_update(base_qs, using, pk_val, values, update_fields,<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py", line 912, in _do_update<br>
    return filtered._update(values) &gt; 0<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py", line 802, in _update<br>
    return query.get_compiler(self.db).execute_sql(CURSOR)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/sql/compiler.py", line 1559, in execute_sql<br>
    cursor = super().execute_sql(result_type)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/sql/compiler.py", line 1175, in execute_sql<br>
    cursor.execute(sql, params)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 66, in execute<br>
    return self._execute_with_wrappers(sql, params, many=False, executor=self._execute)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 75, in _execute_with_wrappers<br>
    return executor(sql, params, many, context)<br>
  File "/srv/zulip-venv-cache/56ac6adf406011a100282dd526d03537be84d23e/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 84, in _execute<br>
    return self.cursor.execute(sql, params)<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/lib/db.py", line 46, in execute<br>
    return wrapper_execute(self, super().execute, query, vars)<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/lib/db.py", line 31, in wrapper_execute<br>
    return action(sql, params)<br>
  File "/usr/lib/python3.8/encodings/utf_8.py", line 15, in decode<br>
    def decode(input, errors='strict'):<br>
  File "/home/zulip/deployments/2022-03-18-15-56-00/zerver/worker/queue_processors.py", line 362, in timer_expired<br>
    raise WorkerTimeoutException(self.queue_name, limit, len(events))<br>
zerver.worker.queue_processors.WorkerTimeoutException: Timed out in user_presence after 30 seconds processing 1 events</p>
<p>Deployed code:</p>
<ul>
<li>git: None</li>
<li>ZULIP_VERSION: 5.0-rc1</li>
</ul>
<p>Request info: none</p>
</blockquote>
<p>Zulip instance is still up and running with full functionality atm.<br>
Searching around I checked the following issue that seems relevant:<br>
<a href="https://github.com/zulip/zulip/issues/21965">https://github.com/zulip/zulip/issues/21965</a><br>
However I didn't try to update anything in the machine running zulip.</p>
<p>Do you have any idea what this error message is about? Is it something to be worried about?</p>



<a name="1444596"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1444596" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1444596">(Oct 04 2022 at 19:55)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds">#issues &gt; [Django] zulip2: Timed out in user_presence after 30 seconds</a> by <span class="user-mention silent" data-user-id="19257">Alya Abbott</span>.</p>



<a name="1482281"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1482281" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aidan Dunlap <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1482281">(Dec 23 2022 at 02:14)</a>:</h4>
<p>Hi,</p>
<p>I keep getting those emails too. Did you ever figure out a fix?</p>



<a name="1484088"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484088" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484088">(Jan 02 2023 at 21:17)</a>:</h4>
<p><span class="user-mention" data-user-id="25524">@Aidan Dunlap</span> the operation that is timing out here is pretty cheap.</p>



<a name="1484089"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484089" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484089">(Jan 02 2023 at 21:17)</a>:</h4>
<p>So the likely causes for a timeout here are things like a networking issue in the connection between your Zulip server and its database, various forms of virtualization that might freeze execution on the Zulip server for a period of time, etc.</p>



<a name="1484090"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484090" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484090">(Jan 02 2023 at 21:18)</a>:</h4>
<p>Can you talk about how you're hosting your Zulip server? The details may be relevant.</p>



<a name="1484147"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484147" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aidan Dunlap <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484147">(Jan 02 2023 at 23:47)</a>:</h4>
<p>Thanks for the answer! We're hosting Zulip on a DigitalOcean VM running docker compose - everything should be on the same machine</p>



<a name="1484208"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484208" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484208">(Jan 03 2023 at 02:31)</a>:</h4>
<p><span class="user-mention" data-user-id="25524">@Aidan Dunlap</span> if you want to debug, try looking at the logs in <code>/var/log/zulip</code> as detailed in the Zulip server troubleshooting guide. </p>
<p>The most likely is something like "Your Digital Ocean machine is being moved between hosts in a way that's disruptive" if you're getting these like once every few months. If it's more regular than that, there's more potential to try to investigate.</p>



<a name="1484209"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%5BDjango%5D%20zulip2%3A%20Timed%20out%20in%20user_presence%20after%2030%20seconds/near/1484209" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.5BDjango.5D.20zulip2.3A.20Timed.20out.20in.20user_presence.20after.2030.20seconds.html#1484209">(Jan 03 2023 at 02:31)</a>:</h4>
<p>(I'd be surprised if the answer proved to be something we can do anything about it.)</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>