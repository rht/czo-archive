<html>
<head><meta charset="utf-8"><title>iOS Push Notifications · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html">iOS Push Notifications</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="667846"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/667846" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#667846">(Dec 04 2018 at 13:25)</a>:</h4>
<p>Wondering if its possible to reuse zulips push notification service for a modified version of the mobile app on iOS? It seems that apple requires an SSL certificate to be created for the notification server to connect to the apple servers. I suppose <a href="http://push.zulipchat.com" target="_blank" title="http://push.zulipchat.com">push.zulipchat.com</a> already has this certificate set on its server but I don't see a place to upload it in the apple developer console. Anyone have any ideas here? ccing <span class="user-mention" data-user-id="284">@Boris Yankov</span> <span class="user-mention" data-user-id="2187">@Greg Price</span> Would really like your expertise on this if possible.</p>



<a name="667853"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/667853" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#667853">(Dec 04 2018 at 14:22)</a>:</h4>
<p>Specifically, is my only option -- <a href="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html#sending-push-notifications-directly-from-your-server" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/mobile-push-notifications.html#sending-push-notifications-directly-from-your-server">sending notifications from my own server</a> ?</p>



<a name="667887"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/667887" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#667887">(Dec 04 2018 at 18:13)</a>:</h4>
<p>I think you need to do that, yeah.</p>



<a name="667888"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/667888" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#667888">(Dec 04 2018 at 18:13)</a>:</h4>
<p>(Because the server hardcodes which app ID it's sending notifications for)</p>



<a name="667921"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/667921" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#667921">(Dec 04 2018 at 19:12)</a>:</h4>
<p>Gotcha. Thanks</p>



<a name="668003"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668003" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668003">(Dec 04 2018 at 21:11)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>  Am I reading the following line correctly. The docs say to add the following:</p>
<div class="codehilite"><pre><span></span>Register for a mobile push notification certificate from Apple’s developer console. Set APNS_SANDBOX=False and APNS_CERT_FILE to be the path of your APNS certificate file in /etc/zulip/settings.py
</pre></div>


<p>When i look for a setting like that in /etc/zulip/settings.py I don't see anything that matches. The only option there is the <code>PUSH_NOTIFICATION_BOUNCER_URL</code> which I'm presuming one must turn off when the other settings are added?</p>



<a name="668004"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668004" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668004">(Dec 04 2018 at 21:13)</a>:</h4>
<p>I do see those settings in the Django settings.py file though. Is there a correlation between the two? Is one overridden by the other and the docs are just not clear enough?</p>



<a name="668005"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668005" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668005">(Dec 04 2018 at 21:17)</a>:</h4>
<p><a href="http://zulip.readthedocs.io/en/latest/subsystems/settings.html" target="_blank" title="http://zulip.readthedocs.io/en/latest/subsystems/settings.html">http://zulip.readthedocs.io/en/latest/subsystems/settings.html</a> covers what you need to know.</p>



<a name="668006"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668006" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668006">(Dec 04 2018 at 21:20)</a>:</h4>
<p>Cool. Might be useful to have those settings commented out ( But i can see that since its not a common use case you wanted to skip it )</p>



<a name="668007"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668007" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668007">(Dec 04 2018 at 21:20)</a>:</h4>
<p>Right, we have dozens of semi-internal settings that are not for common use cases, and we leave them out of <code>prod_settings_template.py</code> to avoid making that file more complex and overwhelming-feeling than it already is.</p>



<a name="668008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668008">(Dec 04 2018 at 21:21)</a>:</h4>
<p>Great thanks a ton for the speedy replies <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>



<a name="668031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668031">(Dec 04 2018 at 22:42)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Sorry to keep troubling you but I've updated those settings and its causing the server to 500. See the following stack trace </p>
<div class="codehilite"><pre><span></span>2018-12-04 22:37:11.882 ERR  [django.request] Internal Server Error: /
Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/exception.py&quot;, line 41, in inner
    response = get_response(request)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response
    response = self.process_exception_by_middleware(e, request)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;./zerver/views/home.py&quot;, line 87, in home
    return home_real(request)
  File &quot;./zerver/decorator.py&quot;, line 396, in _wrapped_view
    return view_func(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/decorators.py&quot;, line 23, in _wrapped_view
    return view_func(request, *args, **kwargs)
  File &quot;./zerver/decorator.py&quot;, line 449, in _wrapped_view_func
    return rate_limit()(view_func)(request, *args, **kwargs)
  File &quot;./zerver/decorator.py&quot;, line 818, in wrapped_func
    return func(request, *args, **kwargs)
  File &quot;./zerver/views/home.py&quot;, line 128, in home_real
    narrow=narrow)
  File &quot;./zerver/lib/events.py&quot;, line 688, in do_events_register
    include_subscribers=include_subscribers)
  File &quot;./zerver/lib/events.py&quot;, line 182, in fetch_initial_state_data
    state[&#39;realm_push_notifications_enabled&#39;] = push_notifications_enabled()
  File &quot;./zerver/lib/push_notifications.py&quot;, line 426, in push_notifications_enabled
    if apns_enabled() and gcm_enabled():  # nocoverage
  File &quot;./zerver/lib/push_notifications.py&quot;, line 74, in apns_enabled
    client = get_apns_client()
  File &quot;./zerver/lib/push_notifications.py&quot;, line 69, in get_apns_client
    use_sandbox=settings.APNS_SANDBOX)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/apns2/client.py&quot;, line 38, in __init__
    self.__credentials = CertificateCredentials(credentials, password)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/apns2/credentials.py&quot;, line 29, in __init__
    ssl_context = init_context(cert=cert_file, cert_password=password)
  File &quot;/home/zulip/deployments/2018-12-01-03-36-51/zulip-py3-venv/lib/python3.6/site-packages/hyper/tls.py&quot;, line 131, in init_context
    context.load_cert_chain(cert, password=cert_password)
ssl.SSLError: [SSL] PEM lib (_ssl.c:3486)
</pre></div>



<a name="668036"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668036" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668036">(Dec 05 2018 at 00:03)</a>:</h4>
<p><span class="user-mention" data-user-id="5837">@Armaan Ahluwalia</span> you're on your own for that one -- never seen that exception before.  I'm guessing you have the credentials wrong somehow.</p>



<a name="668183"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668183" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668183">(Dec 05 2018 at 12:05)</a>:</h4>
<p>Thanks that was exactly it. I was using a .p12 file instead of a pem file.</p>



<a name="668680"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668680" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668680">(Dec 06 2018 at 10:37)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> There seems to be no logging around or catching around actually sending the push notification.<br>
I feel like the actual call to send could be wrapped in a try catch with some logging here in <code>push_notifications.py</code></p>
<div class="codehilite"><pre><span></span>        def attempt_send() -&gt; Optional[str]:
            stream_id = client.send_notification_async(
                device.token, payload, topic=&#39;org.loopzero.loopzero&#39;,
                expiration=expiration)
            try:
                return client.get_notification_result(stream_id)
            except HTTP20Error as e:
                logging.warning(&quot;APNs: HTTP error sending for user %d to device %s: %s&quot;,
                                user_id, device.token, e.__class__.__name__)
                return None
</pre></div>


<p>Here <code>client.send_notification_async</code> is the call thats failing ( for some reason I have yet to find out, but what would be very useful here is to be able to log the device.token ( which is not easy to get to be able to push notifications from your local machine to test it out )</p>



<a name="668730"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668730" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668730">(Dec 06 2018 at 15:45)</a>:</h4>
<p><span class="user-mention" data-user-id="5837">@Armaan Ahluwalia</span> if that were throwing an exception, it'd appear in /var/log/zulip/errors.log.</p>



<a name="668731"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668731" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668731">(Dec 06 2018 at 15:45)</a>:</h4>
<p>client.get_notification_result is how you get the response from the APNS server.</p>



<a name="668749"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/iOS%20Push%20Notifications/near/668749" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Armaan Ahluwalia <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/iOS.20Push.20Notifications.html#668749">(Dec 06 2018 at 16:50)</a>:</h4>
<p>Ahh okay I just mwNt logging the details of the device token because it’s difficult to get but I just threw a log in manually</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>