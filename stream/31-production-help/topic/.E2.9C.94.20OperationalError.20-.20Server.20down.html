<html>
<head><meta charset="utf-8"><title>✔ OperationalError - Server down · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html">✔ OperationalError - Server down</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1531411"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531411" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531411">(Mar 23 2023 at 12:44)</a>:</h4>
<div class="codehilite"><pre><span></span><code>OperationalError
connection to server on socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot; failed: FATAL:  could not write init file
</code></pre></div>
<p>it seems the zulip NPM caches are using GBs of data. Any workaround to safely free up the space?</p>
<div class="codehilite"><pre><span></span><code>7.1 GiB [##########]  webhooks_unsupported_events.log.1
3.2 GiB [####      ]  webhooks_unsupported_events.log
</code></pre></div>

<p>It seems getting this a lot. I am using webhooks from sentry to add errors to zulip.</p>
<div class="codehilite"><pre><span></span><code>UnsupportedWebhookEventTypeError
The &#39;[&#39;error&#39;]&#39; event isn&#39;t currently supported by the Sentry webhook
</code></pre></div>
<div class="codehilite" data-code-language="JSON"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"installation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2e3fa7d3-d6dc-4d1d-8a26-fa6ac0902f88"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"event_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dcd0b4c115724ac4b20b66370befbf17"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"project"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"release"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6.0-874-ga2ea5e8598"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"dist"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"platform"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The '['error']' event isn't currently supported by the Sentry webhook"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"datetime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-03-23T12:53:33.184923Z"</span><span class="p">,</span>
<span class="w">      </span><span class="nt">"tags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"client"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"ZulipSentryWebhook"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"environment"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"production"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"handled"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"yes"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"level"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"error"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"logger"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"zulip.zerver.webhooks.unsupported"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"mechanism"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"logging"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"realm"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"root"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"runtime"</span><span class="p">,</span>
<span class="w">          </span><span class="s2">"CPython 3.8.10"</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="s2">"runtime.name"</span><span class="p">,</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>



<a name="1531415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531415">(Mar 23 2023 at 13:16)</a>:</h4>
<p>Worst is that server has 6GB ram</p>



<a name="1531416"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531416" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531416">(Mar 23 2023 at 13:16)</a>:</h4>
<p>and is seems not enough</p>



<a name="1531417"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531417" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531417">(Mar 23 2023 at 13:16)</a>:</h4>
<p>PLus now it seems to kill all nginx procs: <a href="/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png" title="image.png"><img src="/user_uploads/2/a1/IQ-F-L9gFzmxqVU8QE2ALoQF/image.png"></a></div>



<a name="1531418"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531418" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531418">(Mar 23 2023 at 13:18)</a>:</h4>
<p>You guys have some serious memory leak unadressed it seems.</p>



<a name="1531419"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531419" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531419">(Mar 23 2023 at 13:19)</a>:</h4>
<p>I am the only user using the server, and few incoming webhooks.</p>



<a name="1531420"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531420" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531420">(Mar 23 2023 at 13:20)</a>:</h4>
<p>To have 6 GB and8 CPU cores not plenty to run it, then we think of finding some other solutions. Even mattermost worked great with 4 GB. with 6 seems to cause all memory to be used...</p>



<a name="1531421"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531421" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531421">(Mar 23 2023 at 13:20)</a>:</h4>
<p>I assigned now 8 GB RAM see how this works.</p>



<a name="1531423"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531423" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531423">(Mar 23 2023 at 13:23)</a>:</h4>
<p>Thats a lot of ressources to be used: <a href="/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png" title="image.png"><img src="/user_uploads/2/f1/nv2O-IxuPfjUtjLKNm6Ot5LF/image.png"></a></div>



<a name="1531424"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531424" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531424">(Mar 23 2023 at 13:25)</a>:</h4>
<p>I believe this to be some serious memory leak, yet dont have now time to trace it, if are any good practices to investigate this forward, let me know. thanks</p>



<a name="1531425"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531425" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531425">(Mar 23 2023 at 13:26)</a>:</h4>
<p>At least 2 GB RAM, and 10 GB disk space. If you expect 100+ users: 4 GB RAM, and 2 CPUs. ...  this is so not true. I am only user, server wont even start it started recently to kill nginx  after 6 GB were. used, not after last upgrade it jumped to 7 GB usage.</p>



<a name="1531430"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531430" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531430">(Mar 23 2023 at 13:32)</a>:</h4>
<p>Zulip will expand to fill the available RAM on the server -- it adjusts the memory allocations for memcached and PostgreSQL based on the total system RAM.  So it is not unexpected that it will take more RAM if you give it more RAM.</p>
<p>That said, we have had a few reports recently of OOMs -- presumably your PostgreSQL was the victim of such, at the start of the thread.</p>



<a name="1531431"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531431" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531431">(Mar 23 2023 at 13:33)</a>:</h4>
<p>Debugging memory leaks is difficult, but seeing which processes you see out of proportion memory gains in would help point the finger.</p>



<a name="1531432"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531432" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531432">(Mar 23 2023 at 13:34)</a>:</h4>
<p>That was caused by the total space taken by the huge log files. Yet removing those and rebooting server leaded to nginx beying killed as above.</p>



<a name="1531433"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531433" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531433">(Mar 23 2023 at 13:34)</a>:</h4>
<p>The killing of nginx stopped once i mived ram to 8 gb and seems to work again now.</p>



<a name="1531434"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531434" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531434">(Mar 23 2023 at 13:34)</a>:</h4>
<p>PostgreSQL stopped because you ran out of disk space?</p>



<a name="1531435"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531435" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531435">(Mar 23 2023 at 13:35)</a>:</h4>
<p>Thats what I concluded</p>



<a name="1531436"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531436" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531436">(Mar 23 2023 at 13:35)</a>:</h4>
<p>According to logs</p>



<a name="1531437"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531437" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531437">(Mar 23 2023 at 13:35)</a>:</h4>
<p>Only the space could had been issue at that point</p>



<a name="1531438"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531438" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531438">(Mar 23 2023 at 13:36)</a>:</h4>
<p>On the topic of the NPM caches -- do you use <code>upgrade-zulip-from-git</code>, or are you using packaged releases?</p>



<a name="1531439"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531439" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531439">(Mar 23 2023 at 13:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531438">said</a>:</p>
<blockquote>
<p>On the topic of the NPM caches -- do you use <code>upgrade-zulip-from-git</code>, or are you using packaged releases?</p>
</blockquote>
<p>Yes i use that to upgrade.</p>



<a name="1531440"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531440" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531440">(Mar 23 2023 at 13:53)</a>:</h4>
<p>That response is kinda ambiguous, but I'm going to assume you mean you upgrade from git. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>
<p>Latest <code>main</code> switches to using <code>pnpm</code>, which means we use hardlinks to reduce the footprint on disk -- and the old <code>/srv/zulip-npm-cache</code> is unnecessary.  If you've upgraded to <a href="https://github.com/zulip/zulip/commit/3a27b12a7dc9580e565946d3252720cbdce08934">3a27b12a7dc9580e565946d3252720cbdce08934</a> or later, you can safely remove <code>/srv/zulip-npm-cache</code>.</p>



<a name="1531444"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531444" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531444">(Mar 23 2023 at 13:55)</a>:</h4>
<p>Let's tackle the <code>sentry</code> errors.  It looks like you're feeding Sentry errors from Zulip back into Zulip by way of the Sentry webhook, and that may have led to a recursive loop</p>



<a name="1531445"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531445" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531445">(Mar 23 2023 at 13:55)</a>:</h4>
<p>Can you show one of the <em>full</em> JSON payloads?</p>



<a name="1531450"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531450" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531450">(Mar 23 2023 at 14:27)</a>:</h4>
<p>It looks like you may have checked the <code>error</code> box on the <a href="https://docs.sentry.io/product/integrations/integration-platform/webhooks/">webhook configuration for Sentry</a>:<br>
<a href="https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png">https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png</a></p>
<div class="message_inline_image"><a href="https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png"><img src="/external_content/00f7de3925f117d05b66a4d99a41e76efbe3f3b4/68747470733a2f2f646f63732e73656e7472792e696f2f7374617469632f33313366626438396436353630393838306365333965356463623865396561332f61383866362f776562686f6f6b2d636865636b626f782e706e67"></a></div><p>Unchecking that box should remove the loop.  Zulip will only parse the <code>issue</code> events.</p>



<a name="1531462"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531462" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531462">(Mar 23 2023 at 14:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531450">said</a>:</p>
<blockquote>
<p>It looks like you may have checked the <code>error</code> box on the <a href="https://docs.sentry.io/product/integrations/integration-platform/webhooks/">webhook configuration for Sentry</a>:<br>
<a href="https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png">https://docs.sentry.io/static/313fbd89d65609880ce39e5dcb8e9ea3/a88f6/webhook-checkbox.png</a></p>
<p>Unchecking that box should remove the loop.  Zulip will only parse the <code>issue</code> events.</p>
</blockquote>
<p>That is correct. I used that. Was thinking will work out of the box since its also a payload.</p>



<a name="1531463"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531463" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531463">(Mar 23 2023 at 15:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/OperationalError.20-.20Server.20down/near/1531440">said</a>:</p>
<blockquote>
<p>That response is kinda ambiguous, but I'm going to assume you mean you upgrade from git. :)</p>
<p>Latest <code>main</code> switches to using <code>pnpm</code>, which means we use hardlinks to reduce the footprint on disk -- and the old <code>/srv/zulip-npm-cache</code> is unnecessary.  If you've upgraded to <a href="https://github.com/zulip/zulip/commit/3a27b12a7dc9580e565946d3252720cbdce08934">3a27b12a7dc9580e565946d3252720cbdce08934</a> or later, you can safely remove <code>/srv/zulip-npm-cache</code>.</p>
</blockquote>
<p>Now im mobile.  When i reach home will check it out</p>



<a name="1531497"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531497" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531497">(Mar 23 2023 at 16:12)</a>:</h4>
<p>now its on 6.0-1202-gffcdc13819</p>



<a name="1531500"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531500" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531500">(Mar 23 2023 at 16:14)</a>:</h4>
<p>That's current <code>main</code> so <code>/srv/zulip-npm-cache</code> is not in use.  Note that removing that directory will free up space but will prevent you from failing back to earlier versions without some additional work.  That's probably not likely to be a thing you do, just noting it.</p>



<a name="1531518"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531518" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531518">(Mar 23 2023 at 16:30)</a>:</h4>
<p>wow that was quite big it seems</p>



<a name="1531519"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531519" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531519">(Mar 23 2023 at 16:31)</a>:</h4>
<p>I do have backups, so i could restore the folder from there if would be needed.</p>



<a name="1531535"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531535" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531535">(Mar 23 2023 at 16:42)</a>:</h4>
<p>withh 4 GB ram,  <a href="/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png" title="image.png"><img src="/user_uploads/2/ea/RdHrl0tFPKqhAXQZRxS_hMS6/image.png"></a></div>



<a name="1531557"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531557" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531557">(Mar 23 2023 at 17:01)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>●<span class="w"> </span>nginx.service<span class="w"> </span>-<span class="w"> </span>A<span class="w"> </span>high<span class="w"> </span>performance<span class="w"> </span>web<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>reverse<span class="w"> </span>proxy<span class="w"> </span>server
<span class="w">     </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/lib/systemd/system/nginx.service<span class="p">;</span><span class="w"> </span>enabled<span class="p">;</span><span class="w"> </span>vendor<span class="w"> </span>preset:<span class="w"> </span>enabled<span class="o">)</span>
<span class="w">     </span>Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span><span class="w"> </span>since<span class="w"> </span>Thu<span class="w"> </span><span class="m">2023</span>-03-23<span class="w"> </span><span class="m">16</span>:55:29<span class="w"> </span>UTC<span class="p">;</span><span class="w"> </span>4min<span class="w"> </span>51s<span class="w"> </span>ago
<span class="w">       </span>Docs:<span class="w"> </span>man:nginx<span class="o">(</span><span class="m">8</span><span class="o">)</span>
<span class="w">   </span>Main<span class="w"> </span>PID:<span class="w"> </span><span class="m">896</span><span class="w"> </span><span class="o">(</span>nginx<span class="o">)</span>
<span class="w">      </span>Tasks:<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">(</span>limit:<span class="w"> </span><span class="m">1051</span><span class="o">)</span>
<span class="w">     </span>Memory:<span class="w"> </span><span class="m">3</span>.1G
<span class="w">     </span>CGroup:<span class="w"> </span>/system.slice/nginx.service
<span class="w">             </span>├─<span class="w"> </span><span class="m">896</span><span class="w"> </span>nginx:<span class="w"> </span>master<span class="w"> </span>process<span class="w"> </span>/usr/sbin/nginx<span class="w"> </span>-g<span class="w"> </span>daemon<span class="w"> </span>on<span class="p">;</span><span class="w"> </span>master_process<span class="w"> </span>on<span class="p">;</span>
<span class="w">             </span>├─<span class="w"> </span><span class="m">898</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">899</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">901</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">904</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">906</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">911</span><span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─<span class="w"> </span><span class="m">912</span><span class="w"> </span>nginx:<span class="w"> </span>cache<span class="w"> </span>manager<span class="w"> </span>process
<span class="w">             </span>├─3444<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>└─3468<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
</code></pre></div>



<a name="1531559"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531559" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531559">(Mar 23 2023 at 17:01)</a>:</h4>
<p>Even with 7 GB, seems to be chaotical. Seems to be some issues with the nginx configs ? or some conflicts not sure, using the standard settings.</p>



<a name="1531576"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531576" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531576">(Mar 23 2023 at 17:19)</a>:</h4>
<p>So here is a step by step of my actions, the difference of running nginx with default nginx.conf in RAM usage, and look at the RAM jump when using the nginx config that is recommended with zulip:</p>
<p><a href="https://bin.uhl.cloud/?5db3958746a6563e#3CkrU5v35UdV2knhpWTZETVGPBTH4stU2NgYUyeJxES4">pastebin</a></p>



<a name="1531585"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531585" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531585">(Mar 23 2023 at 17:30)</a>:</h4>
<p>tried to move also from. nginx-full to mainstream nginx, results are same.</p>



<a name="1531649"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531649" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531649">(Mar 23 2023 at 18:21)</a>:</h4>
<p>I would not expect nginx to be the memory hog.</p>
<p>Are you using the S3 file upload backend?</p>



<a name="1531673"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531673" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531673">(Mar 23 2023 at 18:40)</a>:</h4>
<p>Not using the s3</p>



<a name="1531707"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531707" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531707">(Mar 23 2023 at 19:08)</a>:</h4>
<p>Is there anything else running on this nginx instance other than Zulip?</p>



<a name="1531708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531708">(Mar 23 2023 at 19:08)</a>:</h4>
<p>Only zulip nothing else</p>



<a name="1531709"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531709" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531709">(Mar 23 2023 at 19:09)</a>:</h4>
<p>It was a clean machine dedicated to zulip only from start</p>



<a name="1531712"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531712" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531712">(Mar 23 2023 at 19:15)</a>:</h4>
<p>Here's chat.zulip.org's <code>nginx</code>:</p>
<div class="codehilite"><pre><span></span><code>● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2023-03-08 15:51:40 UTC; 2 weeks 1 days ago
       Docs: man:nginx(8)
   Main PID: 3143550 (nginx)
      Tasks: 8 (limit: 19142)
     Memory: 159.5M
     CGroup: /system.slice/nginx.service
             ├─3143550 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
             ├─3143551 nginx: worker process
             ├─3143552 nginx: worker process
             ├─3143553 nginx: worker process
             ├─3143554 nginx: worker process
             ├─3143555 nginx: worker process
             ├─3143556 nginx: worker process
             └─3143557 nginx: cache manager process
</code></pre></div>
<p>I don't have a ready explanation for how nginx could balloon to 3G with a small worker load.</p>
<p>How many connections are you handling?</p>
<div class="codehilite"><pre><span></span><code>lsof -n | grep &#39;^nginx&#39; | grep :https | grep ESTABLISHED | wc -l
</code></pre></div>



<a name="1531723"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531723" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531723">(Mar 23 2023 at 19:20)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@post:/opt/postal/config#<span class="w"> </span>lsof<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">'^nginx'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:https<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ESTABLISHED<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="m">1</span>
</code></pre></div>



<a name="1531724"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531724" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531724">(Mar 23 2023 at 19:22)</a>:</h4>
<p>its 1 that was from another server, my bad.</p>



<a name="1531725"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531725" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531725">(Mar 23 2023 at 19:22)</a>:</h4>
<p>...nginx is taking 3GB to talk to one HTTP connection?</p>



<a name="1531726"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531726" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531726">(Mar 23 2023 at 19:22)</a>:</h4>
<p>so it seems</p>



<a name="1531728"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531728" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531728">(Mar 23 2023 at 19:22)</a>:</h4>
<p>thats why i said its weird</p>



<a name="1531732"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531732" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531732">(Mar 23 2023 at 19:22)</a>:</h4>
<p>I agree that's very weird.</p>



<a name="1531733"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531733" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531733">(Mar 23 2023 at 19:22)</a>:</h4>
<p>I just use 2 clients mobile app and desktop</p>



<a name="1531735"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531735" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531735">(Mar 23 2023 at 19:23)</a>:</h4>
<p>with default nginx.conf is not taking that much</p>



<a name="1531739"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531739" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531739">(Mar 23 2023 at 19:23)</a>:</h4>
<p>yet wont load all needed for zulip to work</p>



<a name="1531742"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531742" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531742">(Mar 23 2023 at 19:23)</a>:</h4>
<p>What do you mean "with default nginx.conf"?  Are you not using the nginx.conf that Zulip installs?</p>



<a name="1531748"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531748" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531748">(Mar 23 2023 at 19:27)</a>:</h4>
<p>No, i just made a test, but returned to normal</p>



<a name="1531751"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531751" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531751">(Mar 23 2023 at 19:27)</a>:</h4>
<p>where i run and installed nginx package</p>



<a name="1531752"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531752" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531752">(Mar 23 2023 at 19:27)</a>:</h4>
<p>over nginx-full, and there i had made a backup of the configss</p>



<a name="1531753"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531753" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531753">(Mar 23 2023 at 19:28)</a>:</h4>
<p>following i did rerun an upgrade procedure, that reseted all nginx back to its original settings.</p>



<a name="1531754"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531754" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531754">(Mar 23 2023 at 19:28)</a>:</h4>
<p>So it seems something is affecting nginx since last few updates</p>



<a name="1531755"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531755" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531755">(Mar 23 2023 at 19:29)</a>:</h4>
<p>in past worked fine the server with 4 GB ram</p>



<a name="1531756"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531756" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531756">(Mar 23 2023 at 19:29)</a>:</h4>
<p>i dont have high usage</p>



<a name="1531761"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531761" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531761">(Mar 23 2023 at 19:37)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zulip<span class="w">      </span><span class="m">21489</span><span class="w">  </span><span class="m">2</span>.5<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21490</span><span class="w">  </span><span class="m">2</span>.9<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21491</span><span class="w">  </span><span class="m">2</span>.4<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21492</span><span class="w">  </span><span class="m">2</span>.5<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21493</span><span class="w">  </span><span class="m">2</span>.3<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21494</span><span class="w">  </span><span class="m">2</span>.5<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21495</span><span class="w">  </span><span class="m">2</span>.6<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">425868</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21496</span><span class="w">  </span><span class="m">2</span>.3<span class="w">  </span><span class="m">5</span>.1<span class="w"> </span><span class="m">525148</span><span class="w"> </span><span class="m">424036</span><span class="w"> </span>?<span class="w">       </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
zulip<span class="w">      </span><span class="m">21497</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.1<span class="w"> </span><span class="m">111080</span><span class="w"> </span><span class="m">10036</span><span class="w"> </span>?<span class="w">        </span>S<span class="w">    </span><span class="m">19</span>:35<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>nginx:<span class="w"> </span>cache<span class="w"> </span>manager<span class="w"> </span>process
</code></pre></div>



<a name="1531765"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531765" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531765">(Mar 23 2023 at 19:40)</a>:</h4>
<p>Ok so it seems that lowering worker_connections from 100000 to 10240 its taking of a lot of RAM. usage.</p>



<a name="1531767"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531767" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531767">(Mar 23 2023 at 19:41)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>worker_rlimit_nofile<span class="w"> </span><span class="m">1000000</span><span class="p">;</span>
events<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>worker_connections<span class="w"> </span><span class="m">1000000</span><span class="p">;</span>
</code></pre></div>
<p>this is default, I made it to 10240 each values, and now</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@chat:/etc/nginx#<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
●<span class="w"> </span>nginx.service<span class="w"> </span>-<span class="w"> </span>A<span class="w"> </span>high<span class="w"> </span>performance<span class="w"> </span>web<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>reverse<span class="w"> </span>proxy<span class="w"> </span>server
<span class="w">     </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/lib/systemd/system/nginx.service<span class="p">;</span><span class="w"> </span>enabled<span class="p">;</span><span class="w"> </span>vendor<span class="w"> </span>preset:<span class="w"> </span>enabled<span class="o">)</span>
<span class="w">     </span>Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span><span class="w"> </span>since<span class="w"> </span>Thu<span class="w"> </span><span class="m">2023</span>-03-23<span class="w"> </span><span class="m">19</span>:39:02<span class="w"> </span>UTC<span class="p">;</span><span class="w"> </span>2min<span class="w"> </span>7s<span class="w"> </span>ago
<span class="w">       </span>Docs:<span class="w"> </span>man:nginx<span class="o">(</span><span class="m">8</span><span class="o">)</span>
<span class="w">    </span>Process:<span class="w"> </span><span class="m">21766</span><span class="w"> </span><span class="nv">ExecStartPre</span><span class="o">=</span>/usr/sbin/nginx<span class="w"> </span>-t<span class="w"> </span>-q<span class="w"> </span>-g<span class="w"> </span>daemon<span class="w"> </span>on<span class="p">;</span><span class="w"> </span>master_process<span class="w"> </span>on<span class="p">;</span><span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
<span class="w">    </span>Process:<span class="w"> </span><span class="m">21778</span><span class="w"> </span><span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/nginx<span class="w"> </span>-g<span class="w"> </span>daemon<span class="w"> </span>on<span class="p">;</span><span class="w"> </span>master_process<span class="w"> </span>on<span class="p">;</span><span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
<span class="w">   </span>Main<span class="w"> </span>PID:<span class="w"> </span><span class="m">21780</span><span class="w"> </span><span class="o">(</span>nginx<span class="o">)</span>
<span class="w">      </span>Tasks:<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">(</span>limit:<span class="w"> </span><span class="m">1051</span><span class="o">)</span>
<span class="w">     </span>Memory:<span class="w"> </span><span class="m">45</span>.3M
<span class="w">     </span>CGroup:<span class="w"> </span>/system.slice/nginx.service
<span class="w">             </span>├─21780<span class="w"> </span>nginx:<span class="w"> </span>master<span class="w"> </span>process<span class="w"> </span>/usr/sbin/nginx<span class="w"> </span>-g<span class="w"> </span>daemon<span class="w"> </span>on<span class="p">;</span><span class="w"> </span>master_process<span class="w"> </span>on<span class="p">;</span>
<span class="w">             </span>├─21781<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21782<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21783<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21784<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21785<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21786<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21787<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>├─21788<span class="w"> </span>nginx:<span class="w"> </span>worker<span class="w"> </span>process
<span class="w">             </span>└─21789<span class="w"> </span>nginx:<span class="w"> </span>cache<span class="w"> </span>manager<span class="w"> </span>process

Mar<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">19</span>:39:02<span class="w"> </span>chat<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Starting<span class="w"> </span>A<span class="w"> </span>high<span class="w"> </span>performance<span class="w"> </span>web<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>reverse<span class="w"> </span>proxy<span class="w"> </span>server...
Mar<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">19</span>:39:02<span class="w"> </span>chat<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Started<span class="w"> </span>A<span class="w"> </span>high<span class="w"> </span>performance<span class="w"> </span>web<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>a<span class="w"> </span>reverse<span class="w"> </span>proxy<span class="w"> </span>server.
</code></pre></div>



<a name="1531769"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531769" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531769">(Mar 23 2023 at 19:42)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@chat:/etc/nginx#<span class="w"> </span>grep<span class="w"> </span>-Rn<span class="w"> </span>worker_connections
nginx.conf:9:<span class="w">    </span>worker_connections<span class="w"> </span><span class="m">10240</span><span class="p">;</span>
nginx.conf.dpkg-dist:7:<span class="w"> </span>worker_connections<span class="w"> </span><span class="m">768</span><span class="p">;</span>
nginx.conf.zulip:9:<span class="w">    </span>worker_connections<span class="w"> </span><span class="m">1000000</span><span class="p">;</span>
</code></pre></div>



<a name="1531773"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531773" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531773">(Mar 23 2023 at 19:42)</a>:</h4>
<p>default its 768, I made it to 10240, yet with the more I increase the more RAM will be used.</p>



<a name="1531774"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531774" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531774">(Mar 23 2023 at 19:43)</a>:</h4>
<p>Aha, great.  That's a recent change, and I can see how it would increase the memory usage.</p>



<a name="1531775"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531775" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531775">(Mar 23 2023 at 19:43)</a>:</h4>
<p>Is there anything else I should be aware of, change?</p>



<a name="1531777"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531777" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531777">(Mar 23 2023 at 19:44)</a>:</h4>
<p><a href="/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png" title="image.png"><img src="/user_uploads/2/e4/zsge3hiGeB_9sNustoXPQmpv/image.png"></a></div>



<a name="1531778"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531778" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531778">(Mar 23 2023 at 19:44)</a>:</h4>
<p>thats more likely to what im used to have in usage.</p>



<a name="1531779"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531779" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531779">(Mar 23 2023 at 19:44)</a>:</h4>
<p>so it seems for me works for now to change those values.</p>



<a name="1531781"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531781" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531781">(Mar 23 2023 at 19:45)</a>:</h4>
<p>Maybe you can make required changes on your side to get this somehow fixed, could cause issues to other users too, and cloud based users could be paying a lot more if they run into same issue.</p>



<a name="1531783"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531783" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531783">(Mar 23 2023 at 19:46)</a>:</h4>
<p>Lucky i run own kvms so I can change all on the fly.</p>



<a name="1531785"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531785" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531785">(Mar 23 2023 at 19:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="20576">Cosmic Sound</span> has marked this topic as resolved.</p>



<a name="1531863"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531863" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531863">(Mar 23 2023 at 20:27)</a>:</h4>
<p>Yes, we likely need to revert some of <a href="https://github.com/zulip/zulip/commit/1c76036c61d86d4fc6a574b734e1d04ad0ab43a3">1c76036c61d86d4fc6a574b734e1d04ad0ab43a3</a>.</p>



<a name="1531864"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531864" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531864">(Mar 23 2023 at 20:28)</a>:</h4>
<p>Maybe just the <code>worker_connections</code> line needs to be turned into an option? I think the fd limit parts of it shouldn't consume memory.</p>



<a name="1531867"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531867" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531867">(Mar 23 2023 at 20:31)</a>:</h4>
<p>Yeah, I think that's accurate.</p>



<a name="1531906"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531906" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531906">(Mar 23 2023 at 21:16)</a>:</h4>
<p>worker_connections 1000000; its just too much :D doubt someone would need that, if so, then surely server wont have 4. GB RAM :D</p>



<a name="1531907"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531907" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531907">(Mar 23 2023 at 21:17)</a>:</h4>
<p>even 40000 initial value was big enough, but to go million :D :D thats just bad config</p>



<a name="1531910"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531910" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531910">(Mar 23 2023 at 21:18)</a>:</h4>
<p>At least problem solved, you guys, can easily patch that for later updates</p>



<a name="1531946"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1531946" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1531946">(Mar 23 2023 at 21:43)</a>:</h4>
<p>Pushed <a href="https://github.com/zulip/zulip/pull/24846">#24846</a>.</p>
<p>Thanks for helping track that down!</p>



<a name="1532473"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1532473" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1532473">(Mar 24 2023 at 08:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down/near/1531946">said</a>:</p>
<blockquote>
<p>Pushed <a href="https://github.com/zulip/zulip/pull/24846">#24846</a>.</p>
<p>Thanks for helping track that down!</p>
</blockquote>
<p>I Was just thinking, if the tests from CI/CD could had prevented such a push, if the test would inquire GB Ram used, aren't these values reflected in the tests?</p>



<a name="1532592"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20OperationalError%20-%20Server%20down/near/1532592" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20OperationalError.20-.20Server.20down.html#1532592">(Mar 24 2023 at 13:34)</a>:</h4>
<p>It's probable that the "production" CI suite did see changes in its memory footprint.  We could put some guardrails on the memory consumption of the final steady-state running instance, though I worry that unless we make them very loose, they're going to trigger spuriously due to slow changes or random variance.  Though in this case, the change was probably drastic enough to trip a loose guardrail.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>