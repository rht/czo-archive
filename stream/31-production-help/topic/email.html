<html>
<head><meta charset="utf-8"><title>email · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html">email</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1071212"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071212" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071212">(Nov 28 2020 at 12:12)</a>:</h4>
<p>I enabled email gateway integration, and it works nicely. The "Reply-To" header is set correctly, and email replies are routed into the correct zulip dialogues. :-)<br>
However, the "From:" header is still set to the configured <a href="mailto:noreply@zulip.domain.com">noreply@zulip.domain.com</a>, which is confusing: you either CAN reply to an email, or you CAN'T.<br>
And a noreply@ indicates that you can't, but in fact now you CAN.<br>
Is this expected..?</p>



<a name="1071217"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071217" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Bannack <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071217">(Nov 28 2020 at 13:25)</a>:</h4>
<p>Indeed, in notification emails such as about logins from new devices, <code>From:</code>and <code>Reply-To:</code>are equally set to "noreply@..." (in <code>From:</code>with envelope). I don't think it's not expected. Technically you always "can" reply to any reply@ email address.</p>



<a name="1071218"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071218" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071218">(Nov 28 2020 at 13:40)</a>:</h4>
<p>Well... I'm saying the reply-to is NOT set to noreply@ but to the zulip+stuff@domain.com, so that replies via email ARE routed into zulip.</p>



<a name="1071219"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071219" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071219">(Nov 28 2020 at 13:41)</a>:</h4>
<p>so, replies via email ARE handled correctly. Meaning: the email should NOT come from <a href="mailto:noreply@domain.com">noreply@domain.com</a>, as that basically says: please don't reply to this email...</p>



<a name="1071257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071257">(Nov 28 2020 at 15:26)</a>:</h4>
<p>You can reply to it, to the address specified in the <code>Reply-To</code> field. <code>noreply@domain.com</code> merely says "please don't reply to this ADDRESS" (not "don't reply to this MESSAGE at all"). It's standard for <code>Reply-To</code> to specify the intended recipient of the reply:<br>
(<a href="https://www.ietf.org/rfc/rfc2822.txt">https://www.ietf.org/rfc/rfc2822.txt</a>)</p>
<blockquote>
<p>The originator fields also provide the information required when<br>
   replying to a message.  When the "Reply-To:" field is present, it<br>
   indicates the mailbox(es) to which the author of the message suggests<br>
   that replies be sent.</p>
</blockquote>



<a name="1071279"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071279" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071279">(Nov 28 2020 at 16:01)</a>:</h4>
<p>Yes. I understand that you CAN reply to it. As I said: it works nicely also. I am just saying that users are trained NOT to reply to a message that comes from <a href="mailto:noreply@domain.com">noreply@domain.com</a>.</p>



<a name="1071280"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071280" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071280">(Nov 28 2020 at 16:04)</a>:</h4>
<p>If you consider this no problem, then fine. I am just pointing out that our users find it counter-intuitive, and perhaps both Reply-To and From should be set to  zulip+stuff@domain.com in the case of these "missed messages" notifications.</p>



<a name="1071363"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071363" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Bannack <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071363">(Nov 28 2020 at 23:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="16223">mouk</span> <a href="#narrow/stream/31-production-help/topic/email/near/1071218">said</a>:</p>
<blockquote>
<p>Well... I'm saying the reply-to is NOT set to noreply@ but to the zulip+stuff@domain.com, so that replies via email ARE routed into zulip.</p>
</blockquote>
<p>In login notifications, <code>Reply-to</code> is set to <code>noreply@domain.com</code> as well, f.e.:</p>
<div class="codehilite"><pre><span></span><code>Subject: Neuer Login von Firefox unter Linux
From: Zulip Account-Sicherheitsdienst &lt;noreply@team.xxxxxxx&gt;
To: Roman Bannack &lt;xxxxxxx&gt;
Reply-To: noreply@team.xxxxxxx
</code></pre></div>



<a name="1071622"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071622" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071622">(Nov 29 2020 at 16:25)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="14475">@Roman Bannack</span>  yes, and it makes complete sense to us. :-) However, we're talking about the zulip email notifications on missed messages, with subject "PMs with zulip_username". Those emails <em>are</em> reply-able. You CAN reply to them, and those replies go back into the zulip system.<br>
And we feel those should NOT com from the <a href="mailto:noreply@zulip.domain.com">noreply@zulip.domain.com</a> (because you CAN reply to them!)</p>



<a name="1071624"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071624" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Bannack <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071624">(Nov 29 2020 at 16:36)</a>:</h4>
<p>Alright <span class="user-mention" data-user-id="16223">@mouk</span>, why don't you adjust <code>NOREPLY_EMAIL_ADDRESS</code>, etc., in <code>/etc/zulip/settings.py</code> to your liking?</p>



<a name="1071625"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071625" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Bannack <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071625">(Nov 29 2020 at 16:38)</a>:</h4>
<p>Since this seems to be a misunderstanding that just comes from the word "noreply", am I right?</p>



<a name="1071627"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071627" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071627">(Nov 29 2020 at 17:14)</a>:</h4>
<p>Because I think that will also change the address for those "Neuer Login von Firefox unter Linux" messages, that you really CANNOT reply to.</p>
<p>There are two types of emails sent from zulip:</p>
<ul>
<li>
<p>those that you CANNOT reply to ("Neuer Login von Firefox unter Linux")<br>
and</p>
</li>
<li>
<p>those that you CAN reply to ("PMs with zulip_username")</p>
</li>
</ul>
<p>We think that only the first type should come from the <a href="mailto:noreply@zulip.server.com">noreply@zulip.server.com</a> (as you CANNOT reply to them) and the second type should come from zulip+stuff@zulip.server.com, as you CAN reply to them. (and in fact: we welcome users to reply to those messages, as they will route back into zulip)<br>
(and for this second type, there should NOT be any mention of <a href="mailto:noreply@zulip.server.com">noreply@zulip.server.com</a>, as that will of course discourage people from replying to those emails)</p>



<a name="1071628"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071628" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071628">(Nov 29 2020 at 17:16)</a>:</h4>
<p>As I seem to struggle getting my message across here, perhaps our users are the only ones being confused by the "From: <a href="mailto:noreply@zulip.server.com">noreply@zulip.server.com</a>"  address for the second type of emails.</p>



<a name="1071633"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071633" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Roman Bannack <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071633">(Nov 29 2020 at 17:46)</a>:</h4>
<p>Yes, that would change the sender in both types.</p>
<p>Don't you and your users think that, within the given frame of what's possible, something like <code>robot@zulip.domain.com</code> could be more convenient?  Technically, you always "can" reply to an email. "robot" could be a hint that there's nothing to expect from it when sending any mail to that endpoint, while as a sender email address, it's plausible enough.</p>



<a name="1071636"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071636" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> mouk <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071636">(Nov 29 2020 at 17:49)</a>:</h4>
<p>Yes, that is a good suggestion yes. We will do that. :-) Thank you!</p>



<a name="1071638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1071638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Neil Pilgrim (neiljp) <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1071638">(Nov 29 2020 at 17:59)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> What do you think about treating these two cases differently?</p>



<a name="1073724"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1073724" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1073724">(Dec 02 2020 at 14:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="2406">Neil Pilgrim</span> <a href="#narrow/stream/31-production-help/topic/email/near/1071638">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="10349">Mateusz Mandera</span> What do you think about treating these two cases differently?</p>
</blockquote>
<p>I  think it would make sense, though I'm curious what were the reason for using the noreply address originally (seems it was done that way since the original implementation in <a href="https://github.com/zulip/zulip/commit/23ef278d2951b2ad2a0ced8b100d69811044f1e8">23ef278d2951b2ad2a0ced8b100d69811044f1e8</a>). Changing this seems trivial, this would be enough I believe (besides tweaking tests):</p>
<div class="codehilite"><pre><span></span><code>diff --git a/zerver/lib/email_notifications.py b/zerver/lib/email_notifications.py
index 001d92381b..68978c0187 100644
--- a/zerver/lib/email_notifications.py
+++ b/zerver/lib/email_notifications.py
@@ -464,7 +464,7 @@ def do_send_missedmessage_events_reply_in_zulip(user_profile: UserProfile,

     with override_language(user_profile.default_language):
         from_name: str = _(&quot;Zulip missed messages&quot;)
-    from_address = FromAddress.NOREPLY
+    from_address = reply_to_address
     if len(senders) == 1 and settings.SEND_MISSED_MESSAGE_EMAILS_AS_USER:
         # If this setting is enabled, you can reply to the Zulip
         # missed message emails directly back to the original sender.
</code></pre></div>



<a name="1082157"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1082157" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1082157">(Dec 16 2020 at 23:40)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> hmm, good question.  I don't recall the context, and I suspect Jason doesn't either, but I think that effort was something of a hack during the time at Dropbox when Zulip was not actively developed.</p>



<a name="1082158"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1082158" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1082158">(Dec 16 2020 at 23:42)</a>:</h4>
<p>One thing we need to be careful about in thinking about this reply-to area is avoiding polluting email client address books.</p>



<a name="1082159"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1082159" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1082159">(Dec 16 2020 at 23:44)</a>:</h4>
<p>I do notice that GitHub and other tools with a similar model use a common From address for their automated email notifications that are compatible with replying to emails (though different from the noreply address, probably to make filtering convenient!).  This is likely intentional; I'm not sure if that's the case for anti-spam reasons or something else.</p>



<a name="1082160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/email/near/1082160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/email.html#1082160">(Dec 16 2020 at 23:44)</a>:</h4>
<p>This does remind me that we should probably add a section to our docs on what headers we recommend using for filtering missed-message notification emails in an email client; I'm not sure we do right now.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>