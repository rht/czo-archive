<html>
<head><meta charset="utf-8"><title>✔ Missing topics and messages in upgrade to 6.0-rc1 from 5.2 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html">✔ Missing topics and messages in upgrade to 6.0-rc1 from 5.2</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1462233"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462233" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462233">(Nov 10 2022 at 16:09)</a>:</h4>
<p>Today, I went to 'more topics' in my general stream. There weren't more topics. There were only 3 topics. Each of those topics had just a message or two.</p>
<p>I looked in other streams with similar results.</p>
<p>Um, where did all my messages and topics go?</p>



<a name="1462234"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462234" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462234">(Nov 10 2022 at 16:09)</a>:</h4>
<p>I am running a Docker instance of Zulip. I was running Zulip 5.2 until yesterday when I upgraded to Zulip 6.0-rc1. Things appeared to be running fine, but I didn't look closely.</p>



<a name="1462236"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462236" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462236">(Nov 10 2022 at 16:09)</a>:</h4>
<p>My upgrade was fairly simple.</p>



<a name="1462237"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462237" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462237">(Nov 10 2022 at 16:09)</a>:</h4>
<p>I backed up all of the data and then upgraded PostgreSQL from 10 to 14 per the instructions at <a href="https://github.com/zulip/docker-zulip">https://github.com/zulip/docker-zulip</a>.</p>



<a name="1462238"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462238" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462238">(Nov 10 2022 at 16:09)</a>:</h4>
<p>At a glance, my Zulip 5.2 instance with PostgreSQL 14 seemed to work fine. Things could have fallen over here, though. I didn't click 'more topics'.</p>



<a name="1462239"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462239" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462239">(Nov 10 2022 at 16:10)</a>:</h4>
<p>If you search for a topic you know should be there, do you see results?</p>



<a name="1462240"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462240" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462240">(Nov 10 2022 at 16:10)</a>:</h4>
<p>I then changed to Zulip 6.0-rc1 and did the docker-compose build zulip step.</p>
<p>I ran it.</p>
<p>I saw a bunch of database migrations in the log output.</p>



<a name="1462241"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462241" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462241">(Nov 10 2022 at 16:10)</a>:</h4>
<p>Zulip showed me its initial view, and everything looked fine. It was, again, just an initial glance.</p>



<a name="1462242"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462242" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462242">(Nov 10 2022 at 16:14)</a>:</h4>
<p>Okay, actually having accessed these and scrolling up, I am seeing a Zulip icon spinning, and then after a long wait, messages and topics fill in.</p>
<p>Clicking on 'more topics' gives me an animated ellipsis, and after a long wait, it fills in.</p>



<a name="1462243"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462243" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462243">(Nov 10 2022 at 16:14)</a>:</h4>
<p>This is after restarting the Docker service multiple times.</p>



<a name="1462244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462244">(Nov 10 2022 at 16:15)</a>:</h4>
<p>This is fine. I'll take it. But still...</p>



<a name="1462245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462245">(Nov 10 2022 at 16:15)</a>:</h4>
<p>(CPU on the machine is virtually 0%.)</p>



<a name="1462246"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462246" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462246">(Nov 10 2022 at 16:16)</a>:</h4>
<p>Can you determine if the bad performance is due to cold-caches, or if it persists if, now that it has filled in at least once, you reload the client multiple times?</p>



<a name="1462247"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462247" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462247">(Nov 10 2022 at 16:17)</a>:</h4>
<p>(to be clear, a bad cold-cache performance is also not expected or acceptable -- just trying to determine where we should be looking at the moment)</p>



<a name="1462248"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462248" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462248">(Nov 10 2022 at 16:17)</a>:</h4>
<p>Reloading the client is showing just a few topics and messages and then very slowly filling them in. This happens every time.</p>



<a name="1462249"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462249" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462249">(Nov 10 2022 at 16:18)</a>:</h4>
<p>I'm going to reboot the machine. I did this already, but I want that eliminated anyway.</p>



<a name="1462250"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462250" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462250">(Nov 10 2022 at 16:19)</a>:</h4>
<p>I don't expect that to make a difference, particularly if you're running Zulip in a Docker container.</p>



<a name="1462251"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462251" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462251">(Nov 10 2022 at 16:19)</a>:</h4>
<p>Me either, but give me a minute or two and the machine will be back.</p>



<a name="1462252"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462252" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462252">(Nov 10 2022 at 16:20)</a>:</h4>
<p>Once it does:  if you open a request inspector in the browser, can you show which requests are taking a long time?</p>



<a name="1462257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462257">(Nov 10 2022 at 16:33)</a>:</h4>
<p>Ugh. I can no longer reproduce this after the full machine reboot. I mean, it feels slower than my Zulip 5.2 instance, but it is quick enough that I barely notice.</p>
<p>To be clear, the upgrade process was taking Zulip 5.2 down, building Zulip 6.0-rc1, and starting it back up. That instance appears to never have filled in topics and messages.</p>
<p>Thereafter, I rebooted the machine before posting here, and Zulip very, very slowly filled in topics and messages.</p>
<p>And then I rebooted the machine again, and it is fast enough.</p>



<a name="1462260"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462260" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462260">(Nov 10 2022 at 16:34)</a>:</h4>
<p>At this point, we can just mark this topic resolved. If it goes slow again, I will grab the information from the request inspector in the browser and post it here.</p>



<a name="1462262"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462262" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Josh Jensen <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462262">(Nov 10 2022 at 16:35)</a>:</h4>
<p>My apologies for taking your time.</p>



<a name="1462263"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462263" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462263">(Nov 10 2022 at 16:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="18157">Josh Jensen</span> has marked this topic as resolved.</p>



<a name="1462362"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462362" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462362">(Nov 10 2022 at 19:17)</a>:</h4>
<p><span class="user-mention" data-user-id="18157">@Josh Jensen</span> I'd be interested in your doing some looking at <code>/var/log/zulip/errors.log</code> and <code>server.log</code> in the same directory; for the former, I'd look for any requests taking several seconds, and we're interested in any errors your server was logging.</p>



<a name="1462387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/%E2%9C%94%20Missing%20topics%20and%20messages%20in%20upgrade%20to%206.0-rc1%20from%205.2/near/1462387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2.html#1462387">(Nov 10 2022 at 19:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="18157">Josh Jensen</span> <a href="#narrow/stream/31-production-help/topic/.E2.9C.94.20Missing.20topics.20and.20messages.20in.20upgrade.20to.206.2E0-rc1.20from.205.2E2/near/1462262">said</a>:</p>
<blockquote>
<p>My apologies for taking your time.</p>
</blockquote>
<p>Also, you needn't to apologize for coming to report the app misbehaving!  Maybe it was a stray cosmic ray -- but maybe it wasn't.  If someone else reports a similar problem, we would now have two datapoints.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>