<html>
<head><meta charset="utf-8"><title>manage.py send_test_email · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html">manage.py send_test_email</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="154900"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/154900" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#154900">(Feb 21 2017 at 10:22)</a>:</h4>
<p>Here there, <br>
I've signed up because I'm hoping to find help here. <br>
Here is my situation: We have been using Zulip 1.4.2 for a few months now (Hyper-V VM with Ubuntu 16.04.1). Setting it up was bumpy but we got there in the end. <br>
Now we are really looking forward to Zulip 2.0 (by the way, is this Zulip 1.5 here?). <br>
To gain a bit of experience with Zulip I wanted to set up a second VM (Ubuntu 16.04.2, Zulip 1.5.1). <br>
All the settings are the same as with the first working server but when I run the email test: <br>
su zulip /home/zulip/deployments/current/manage.py send_test_email <a href="mailto:myemail@intercultural-elements.eu" title="mailto:myemail@intercultural-elements.eu">myemail@intercultural-elements.eu</a><br>
I get this: </p>
<div class="codehilite"><pre><span></span><span class="n">zulip</span><span class="nd">@ZulipTesting</span><span class="p">:</span><span class="o">~/</span><span class="n">deployments</span><span class="o">/</span><span class="n">current</span><span class="err">$</span> <span class="o">./</span><span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">send_test_email</span> <span class="n">myemail</span><span class="nd">@intercultural</span><span class="o">-</span><span class="n">elements</span><span class="o">.</span><span class="n">eu</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;./manage.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">29</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">367</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute_from_command_line</span>
    <span class="n">utility</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/management/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">359</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fetch_command</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span><span class="o">.</span><span class="n">run_from_argv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">294</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run_from_argv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">cmd_options</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/management/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">345</span><span class="p">,</span> <span class="ow">in</span> <span class="n">execute</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zerver/management/commands/send_test_email.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="n">handle</span>
    <span class="n">send_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="p">[</span><span class="n">to</span><span class="p">])</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/mail/__init__.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">62</span><span class="p">,</span> <span class="ow">in</span> <span class="n">send_mail</span>
    <span class="k">return</span> <span class="n">mail</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/mail/message.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">342</span><span class="p">,</span> <span class="ow">in</span> <span class="n">send</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="n">fail_silently</span><span class="p">)</span><span class="o">.</span><span class="n">send_messages</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/mail/backends/smtp.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">100</span><span class="p">,</span> <span class="ow">in</span> <span class="n">send_messages</span>
    <span class="n">new_conn_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
  <span class="n">File</span> <span class="s2">&quot;/home/zulip/deployments/2017-02-20-15-58-11/zulip-venv/lib/python2.7/site-packages/django/core/mail/backends/smtp.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">67</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">open</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/usr/lib/python2.7/smtplib.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">622</span><span class="p">,</span> <span class="ow">in</span> <span class="n">login</span>
    <span class="k">raise</span> <span class="n">SMTPAuthenticationError</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">resp</span><span class="p">)</span>
<span class="n">smtplib</span><span class="o">.</span><span class="n">SMTPAuthenticationError</span><span class="p">:</span> <span class="p">(</span><span class="mi">535</span><span class="p">,</span> <span class="s1">&#39;5.7.8 Error: authentication failed:&#39;</span><span class="p">)</span>
</pre></div>


<p>What am I doing wrong? With the other Zulip 1.4.2 server it worked fine. </p>
<p>Thank you</p>



<a name="154936"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/154936" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#154936">(Feb 21 2017 at 12:53)</a>:</h4>
<p>This issues has solved 'itself' but there is still a mystery. <br>
I copied the email smtp password from the old Zulip settings.py file to the new Zulip 1.5.1 instance. But the password was wrong. After entering the correct password and restarting the Zulip 1.5.1 server it worked. The question now is how the old zulip server (v1.4.2) can run with the wrong smtp ..password. But it's running for 91 days now and probably fails when we restart it.</p>



<a name="155072"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155072" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155072">(Feb 21 2017 at 18:33)</a>:</h4>
<p><span class="user-mention" data-user-email="m.mueller@intercultural-elements.eu" data-user-id="1646">@Matthias Müller</span> welcome!  This server is running off of <code>master</code>, so somewhere between 1.5 and 1.6 :)</p>



<a name="155073"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155073" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155073">(Feb 21 2017 at 18:34)</a>:</h4>
<p>Check /var/log/zulip/errors.log on the old server.  It's possible that it can't send email but is otherwise working?</p>



<a name="155074"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155074" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155074">(Feb 21 2017 at 18:35)</a>:</h4>
<p>I'm not really sure how that failure mode is possible otherwise; Zulip restarts the server every ~week as a protection in case we start having memory leaks, so I don't think the wrong password can have been in the file that whole time without email sending failing</p>



<a name="155455"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155455" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155455">(Feb 22 2017 at 09:26)</a>:</h4>
<p>Hm, if Zulip restarts itself periodically then I'm all the more puzzled. It's clearly the wrong password because once I had to correct password on the test server it all worked. But we still get emails from the Zulip 1.4.2 so I won't touch it. Could the correct password be cached somewhere?</p>



<a name="155618"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155618" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155618">(Feb 22 2017 at 18:04)</a>:</h4>
<p>I looked at the code, and I don't see how it could be being cached.  I assume you're just comparing /etc/zulip/zulip-secrets.conf ?</p>



<a name="155619"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155619" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155619">(Feb 22 2017 at 18:04)</a>:</h4>
<p>Maybe the two servers are using different usernames?</p>



<a name="155684"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/155684" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#155684">(Feb 22 2017 at 20:19)</a>:</h4>
<p>the two servers have an identical smtp setup bar the email password. I'm back at work on Monday and will to a manual reboot of the entire Ubuntu-VM and check again. But with the first Zulip upgrade at the very latest this should play up I guess.</p>



<a name="160002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160002">(Mar 02 2017 at 06:45)</a>:</h4>
<p>Did a new install for testing zulip at home in virtual box. All good up to creating a realm. I use my gmail address and its password in zulip-secrets.conf. <br>
Get similar error from send_test_email as above.<br>
Do I have to have my own mail server for this?</p>



<a name="160004"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160004" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160004">(Mar 02 2017 at 06:50)</a>:</h4>
<p>you can use something like mailgun to get a free outgoing transactional email system</p>



<a name="160005"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160005" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160005">(Mar 02 2017 at 06:51)</a>:</h4>
<p>We could in theory support direct sendmail, but unauthenticated email from a cloud host IP address gets spam filtered so often these days that it's arguably worse than not supporting it</p>



<a name="160006"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160006" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160006">(Mar 02 2017 at 06:51)</a>:</h4>
<p>For gmail in particular, there's some special instructions you need to follow to support sending email from a server using a gmail account</p>



<a name="160007"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160007" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160007">(Mar 02 2017 at 06:52)</a>:</h4>
<p>See <a href="http://zulip.readthedocs.io/en/latest/prod-email.html#free-outgoing-smtp" target="_blank" title="http://zulip.readthedocs.io/en/latest/prod-email.html#free-outgoing-smtp">http://zulip.readthedocs.io/en/latest/prod-email.html#free-outgoing-smtp</a></p>



<a name="160008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160008">(Mar 02 2017 at 06:52)</a>:</h4>
<p>(which is new documentation; it's be linked in the /etc/zulip/settings.py instructions in master so will be easier to find in our next release)</p>



<a name="160020"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160020" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160020">(Mar 02 2017 at 08:16)</a>:</h4>
<p>my virtual box instance doesn't have a domain name but runs under LAN only. Same applies to our production server of Zulip but there we have it working with the company mail server. I guess I have no other option than making my gmail 'less secure' for testing. I'll never hit the limit of 100 mails /day anyway</p>



<a name="160021"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160021" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160021">(Mar 02 2017 at 08:19)</a>:</h4>
<p>You could sign up for a new gmail account for it</p>



<a name="160229"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/manage.py%20send_test_email/near/160229" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/manage.2Epy.20send_test_email.html#160229">(Mar 02 2017 at 18:34)</a>:</h4>
<p><span class="user-mention" data-user-email="m.mueller@intercultural-elements.eu" data-user-id="1646">@Matthias Müller</span> I'd also recommend a fresh Gmail account if you don't have a better option. When I first set it up, I had to turn "less secure" on and off a couple times before it worked. Maybe I just needed to wait longer, I don't know. But it did work after some initial problems. (Hence the new doc suggesting alternatives.)</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>