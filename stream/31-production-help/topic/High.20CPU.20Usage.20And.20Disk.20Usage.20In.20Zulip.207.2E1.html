<html>
<head><meta charset="utf-8"><title>High CPU Usage And Disk Usage In Zulip 7.1 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html">High CPU Usage And Disk Usage In Zulip 7.1</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1599221"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599221" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> wc j <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599221">(Jun 27 2023 at 03:37)</a>:</h4>
<p>Hi,guys.When testing Zulip version 7.1, I encountered an issue: when I click the data export button, the CPU and disk usage rates become abnormally high, and often last for a considerable amount of time. (In fact, there are very few streams on the server at this time, and there is not much content in the streams.) During this time, I am even unable to connect to my server via SSH. I would like to know if there is a problem with my hardware configuration or if it could be caused by other issues?</p>
<p>Here are some configurations of my server and monitoring charts of its performance after clicking data export:<br>
<a href="/user_uploads/2/2c/pfEIu_wPdMfZPjclLlgdUeNN/image.png">image.png</a><br>
<a href="/user_uploads/2/7a/WKmgfuxV94c6aCfxeXkKWfjQ/image.png">image.png</a><br>
<a href="/user_uploads/2/91/IuDFKStjYTjmODJPmRu2iEvK/image.png">image.png</a><br>
<a href="/user_uploads/2/70/4EfhLDYcRlxcEK1Lqkk7xuHs/image.png">image.png</a><br>
<a href="/user_uploads/2/9a/ChJbZEFf2G9PRm8QhBNgdQvv/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/2c/pfEIu_wPdMfZPjclLlgdUeNN/image.png" title="image.png"><img src="/user_uploads/2/2c/pfEIu_wPdMfZPjclLlgdUeNN/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/7a/WKmgfuxV94c6aCfxeXkKWfjQ/image.png" title="image.png"><img src="/user_uploads/2/7a/WKmgfuxV94c6aCfxeXkKWfjQ/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/91/IuDFKStjYTjmODJPmRu2iEvK/image.png" title="image.png"><img src="/user_uploads/2/91/IuDFKStjYTjmODJPmRu2iEvK/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/70/4EfhLDYcRlxcEK1Lqkk7xuHs/image.png" title="image.png"><img src="/user_uploads/2/70/4EfhLDYcRlxcEK1Lqkk7xuHs/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/9a/ChJbZEFf2G9PRm8QhBNgdQvv/image.png" title="image.png"><img src="/user_uploads/2/9a/ChJbZEFf2G9PRm8QhBNgdQvv/image.png"></a></div>



<a name="1599458"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599458" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599458">(Jun 27 2023 at 15:28)</a>:</h4>
<p><span class="user-mention" data-user-id="27238">@wc j</span>: Depending how large your Zulip instance is, it may take some time, and disk throughput, to export.</p>
<p>However, 3 hours is longer than I'd expect except for large-ish instances.  How many messages (and attachments) are in your instance?  You can check by accessing <code>/stats</code> on your server.</p>



<a name="1599600"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599600" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Jussi Talaskivi <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599600">(Jun 27 2023 at 18:19)</a>:</h4>
<p>The server might be low on memory during the export and be using swap heavily.</p>



<a name="1599605"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599605" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599605">(Jun 27 2023 at 18:22)</a>:</h4>
<p>Possible, though Zulip doesn't configure any swap by default, and most servers don't have any to begin with these days.</p>



<a name="1599673"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599673" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599673">(Jun 27 2023 at 18:57)</a>:</h4>
<p>If the issue is memory pressure, which is plausible, one can probably shut down the Zulip server with <code>scripts/stop-server</code> and then run <code>manage.py export</code> on the command-line and it should finish fine.</p>



<a name="1599674"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599674" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599674">(Jun 27 2023 at 18:58)</a>:</h4>
<p>The system has 4GiB of memory, which is pretty close to the minimum for running a Zulip server in the multi-process mode, so I think memory pressure is a very plausible explanation.</p>



<a name="1599974"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1599974" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> wc j <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1599974">(Jun 28 2023 at 01:15)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> <br>
here is what /stats show:<br>
<a href="/user_uploads/2/69/OHHcSECvv3XaNy1LlYIH1uSD/image.png">stats.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/69/OHHcSECvv3XaNy1LlYIH1uSD/image.png" title="stats.png"><img src="/user_uploads/2/69/OHHcSECvv3XaNy1LlYIH1uSD/image.png"></a></div><p>Besides,I got a email from the server:<br>
<a href="/user_uploads/2/ca/8GWAflmOrc9cooAxYOoH8g6a/image.png">email.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/ca/8GWAflmOrc9cooAxYOoH8g6a/image.png" title="email.png"><img src="/user_uploads/2/ca/8GWAflmOrc9cooAxYOoH8g6a/image.png"></a></div><p>Currently, after doubling the RAM, the server RAM become 8GB, and everything seems works fine. However, what confuses me is that according to the installation document, 4GB RAM should be enough for a small number of users. Has the minimum RAM requirement for Zulip 7.1 changed, but the document has not been updated?</p>



<a name="1600117"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1600117" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1600117">(Jun 28 2023 at 07:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27238">wc j</span> has marked this topic as resolved.</p>



<a name="1600118"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1600118" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1600118">(Jun 28 2023 at 07:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27238">wc j</span> has marked this topic as unresolved.</p>



<a name="1600119"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1600119" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1600119">(Jun 28 2023 at 07:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27238">wc j</span> has marked this topic as resolved.</p>



<a name="1600120"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1600120" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1600120">(Jun 28 2023 at 07:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="27238">wc j</span> has marked this topic as unresolved.</p>



<a name="1601206"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/High%20CPU%20Usage%20And%20Disk%20Usage%20In%20Zulip%207.1/near/1601206" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/High.20CPU.20Usage.20And.20Disk.20Usage.20In.20Zulip.207.2E1.html#1601206">(Jun 29 2023 at 18:56)</a>:</h4>
<p><span class="user-mention" data-user-id="27238">@wc j</span> thanks for confirming the issue was RAM usage. I expect the  story is that 4GB of RAM is sufficient for running the Zulip server on all versions, but apparently not sufficient to run the Zulip server as well as the export tool at the same time starting with 7.0.</p>
<p>I think there's a good chance that 8.0 will consume less memory than 7.0, since I think there's at least one queue worker process that we'll be removing; in the meantime, you can probably use 7.x with 4GB of RAM if you just make your backups cron job stop the Zulip server and then restart it once the export is complete.</p>
<p>(Or just do like 5GB of RAM)</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>