<html>
<head><meta charset="utf-8"><title>upgrade from 2.1.2 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html">upgrade from 2.1.2</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="938548"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938548" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938548">(Jul 16 2020 at 05:30)</a>:</h4>
<p>I just tried to run the upgrade to the latest release on our production server (2.1.2) and got 2 errors<br>
Collecting talon==1.2.10.zulip1<br>
  Using cached <a href="https://github.com/zulip/talon/archive/7d8bdc4dbcfcc5a73298747293b99fe53da55315.zip">https://github.com/zulip/talon/archive/7d8bdc4dbcfcc5a73298747293b99fe53da55315.zip</a><br>
    ERROR: Command errored out with exit status 1:<br>
     command: /srv/zulip-venv-cache/6176a52fab8737c09656fc8ad0352547e9801c07/zulip-py3-venv/bin/python3 -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/tmp/pip-install-uwbslaie/talon/setup.py'"'"'; __file__='"'"'/tmp/pip-install-uwbslaie/talon/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' egg_info --egg-base /tmp/pip-install-uwbslaie/talon/pip-egg-info<br>
         cwd: /tmp/pip-install-uwbslaie/talon/<br>
    Complete output (7 lines):<br>
    Traceback (most recent call last):<br>
      File "&lt;string&gt;", line 1, in &lt;module&gt;<br>
      File "/tmp/pip-install-uwbslaie/talon/setup.py", line 9, in &lt;module&gt;<br>
        long_description=open("README.rst").read(),<br>
      File "/srv/zulip-venv-cache/6176a52fab8737c09656fc8ad0352547e9801c07/zulip-py3-venv/lib/python3.6/encodings/ascii.py", line 26, in decode<br>
        return codecs.ascii_decode(input, self.errors)[0]<br>
    UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 475: ordinal not in range(128)<br>
    ----------------------------------------<br>
ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.<br>
WARNING: You are using pip version 19.3.1; however, version 20.1.1 is available.<br>
You should consider upgrading via the 'pip install --upgrade pip' command.</p>
<p>Error running a subcommand of /home/zulip/deployments/2020-07-16-05-09-40/scripts/lib/create-production-venv: /srv/zulip-venv-cache/6176a52fab8737c09656fc8ad0352547e9801c07/zulip-py3-venv/bin/pip install --no-deps --require-hashes --requirement /home/zulip/deployments/2020-07-16-05-09-40/requirements/prod.txt<br>
Actual error output for the subcommand is just above this.</p>



<a name="938558"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938558" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938558">(Jul 16 2020 at 05:31)</a>:</h4>
<p>Here is the full log for more info <a href="/user_uploads/2/d5/TV8Ci-et_PJ-Y5EWCEvpKy3c/ZulipUpgradeLog.txt">ZulipUpgradeLog.txt</a></p>



<a name="938563"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938563" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938563">(Jul 16 2020 at 05:31)</a>:</h4>
<p>The production server seems fine and still running the 2.1.2 version however I would like to be able to upgrade it.</p>



<a name="938566"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938566" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938566">(Jul 16 2020 at 05:32)</a>:</h4>
<p>any help is appreciated</p>



<a name="938570"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938570" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938570">(Jul 16 2020 at 05:32)</a>:</h4>
<p>Yeah this is sort of known; it was triggered by Ubuntu releasing a glibc security upgrade, but I think the actual problem is that we’re doing some buggy manual manipulation of locales in the installer script.</p>



<a name="938572"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938572" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938572">(Jul 16 2020 at 05:33)</a>:</h4>
<p>If you just run the upgrade again I think it will work.</p>



<a name="938583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938583">(Jul 16 2020 at 05:34)</a>:</h4>
<p>ok I will attempt and report back</p>



<a name="938586"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938586" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938586">(Jul 16 2020 at 05:34)</a>:</h4>
<p>Great, I’m interested to hear what happens.</p>



<a name="938604"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938604" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938604">(Jul 16 2020 at 05:37)</a>:</h4>
<p>same result as the first log, 2 errors the same as the first time.. Now I see apt-get updated the kernel as well and I have not done a reboot. I'm wondering if I need to reboot the server and try the upgrade again?</p>



<a name="938638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938638">(Jul 16 2020 at 05:42)</a>:</h4>
<p>Hmm okay. Run <code>dpkg-reconfigure locales</code> and enable the <code>en_US.UTF-8</code> locale, that should fix it for good.</p>



<a name="938641"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938641" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938641">(Jul 16 2020 at 05:42)</a>:</h4>
<p>ok will try and report back</p>



<a name="938658"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938658" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938658">(Jul 16 2020 at 05:44)</a>:</h4>
<p>(Rebooting at some point is a good idea so the kernel security upgrade takes effect, but shouldn’t be needed to get the installer working.)</p>



<a name="938699"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938699" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938699">(Jul 16 2020 at 05:50)</a>:</h4>
<p>The setting of the locales seems to have done the trick!</p>



<a name="938702"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938702" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938702">(Jul 16 2020 at 05:51)</a>:</h4>
<p>TY.. I will schedule a reboot over the weekend however for now everything seems to be running and upgraded</p>



<a name="938703"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938703" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steven <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938703">(Jul 16 2020 at 05:51)</a>:</h4>
<p>Thank you for your great and prompt assistance</p>



<a name="938704"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938704" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938704">(Jul 16 2020 at 05:51)</a>:</h4>
<p>No problem!</p>



<a name="938834"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/938834" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#938834">(Jul 16 2020 at 06:05)</a>:</h4>
<p>Filed <a href="https://github.com/zulip/zulip/pull/15819">#15819</a> for what I think is going on here.</p>



<a name="955271"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade%20from%202.1.2/near/955271" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthias <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2.html#955271">(Jul 26 2020 at 08:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="699">Anders Kaseorg</span> <a href="#narrow/stream/31-production-help/topic/upgrade.20from.202.2E1.2E2/near/938638">said</a>:</p>
<blockquote>
<p>Hmm okay. Run <code>dpkg-reconfigure locales</code> and enable the <code>en_US.UTF-8</code> locale, that should fix it for good.</p>
</blockquote>
<p>This helped me as well to upgrade form 2.0.2</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>