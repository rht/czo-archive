<html>
<head><meta charset="utf-8"><title>Zulip can&#x27;t boot · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html">Zulip can&#x27;t boot</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1016901"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016901" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016901">(Sep 15 2020 at 06:31)</a>:</h4>
<p>More fun with the server not booting.<br>
<a href="/user_uploads/2/61/sgGe5PiF0xdWDyvREJQIQAeo/Screenshot-from-2020-09-12-13-52-49.png">Screenshot-from-2020-09-12-13-52-49.png</a><br>
Am I not giving it enough memory? This error is coming from memcache so is that the issue?</p>
<div class="message_inline_image"><a href="/user_uploads/2/61/sgGe5PiF0xdWDyvREJQIQAeo/Screenshot-from-2020-09-12-13-52-49.png" title="Screenshot-from-2020-09-12-13-52-49.png"><img src="/user_uploads/2/61/sgGe5PiF0xdWDyvREJQIQAeo/Screenshot-from-2020-09-12-13-52-49.png"></a></div>



<a name="1016910"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016910" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman (amanagr) <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016910">(Sep 15 2020 at 06:39)</a>:</h4>
<p><span class="user-mention" data-user-id="16534">@ReCore</span> can you give details on your ram size and cpu?</p>



<a name="1016911"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016911" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016911">(Sep 15 2020 at 06:41)</a>:</h4>
<p>At the time of that message it had 3GB. I ran it again with 4GB and it still failed. I can't go too much higher without slowing down the rest of my pc.</p>



<a name="1016912"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016912" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aman (amanagr) <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016912">(Sep 15 2020 at 06:41)</a>:</h4>
<p>4gb is more than sufficient, I think the issue might be something else. Not sure what.</p>



<a name="1016916"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016916" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016916">(Sep 15 2020 at 06:43)</a>:</h4>
<p>The error is coming from <code>scripts/setup/flush-memcache</code></p>



<a name="1016918"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016918" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016918">(Sep 15 2020 at 06:44)</a>:</h4>
<p>A memcached authentication failure doesn’t indicate running out of memory.</p>



<a name="1016922"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016922" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016922">(Sep 15 2020 at 06:45)</a>:</h4>
<p>it's a base install from the 3.x branch 3 days ago</p>



<a name="1016944"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016944" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016944">(Sep 15 2020 at 06:51)</a>:</h4>
<p>If you run</p>
<div class="codehilite"><pre><span></span><code>systemctl restart memcached
/home/recore/zulip-server-get/scripts/setup/flush-memcached
</code></pre></div>


<p>do you get any errors?</p>



<a name="1016950"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016950" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016950">(Sep 15 2020 at 06:53)</a>:</h4>
<p>Same error</p>



<a name="1016954"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016954" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016954">(Sep 15 2020 at 06:54)</a>:</h4>
<p>Anything in <code>systemctl status memcached</code>?</p>



<a name="1016964"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016964" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016964">(Sep 15 2020 at 06:57)</a>:</h4>
<p>my VM crashed when I ran it. So that's great. Give me a min or so and I'll get it back</p>



<a name="1016999"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1016999" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1016999">(Sep 15 2020 at 07:17)</a>:</h4>
<p><a href="/user_uploads/2/5d/Q6M4PcwnaPk_7VShimfLphC2/Screenshot-from-2020-09-15-16-46-30.png">Screenshot-from-2020-09-15-16-46-30.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/5d/Q6M4PcwnaPk_7VShimfLphC2/Screenshot-from-2020-09-15-16-46-30.png" title="Screenshot-from-2020-09-15-16-46-30.png"><img src="/user_uploads/2/5d/Q6M4PcwnaPk_7VShimfLphC2/Screenshot-from-2020-09-15-16-46-30.png"></a></div>



<a name="1017002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017002">(Sep 15 2020 at 07:18)</a>:</h4>
<p>turns out, gnome boxes does not like the ubuntu screenshot tool</p>



<a name="1017005"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017005" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017005">(Sep 15 2020 at 07:18)</a>:</h4>
<p>Oh well. That's the memcached status <span class="user-mention" data-user-id="699">@Anders Kaseorg</span></p>



<a name="1017008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017008">(Sep 15 2020 at 07:20)</a>:</h4>
<p>Run the <code>flush-memcached</code> command to reproduce the authentication error, and then check the status again.</p>



<a name="1017011"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017011" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017011">(Sep 15 2020 at 07:21)</a>:</h4>
<p><a href="/user_uploads/2/a2/JOdqQKGZ0X1pGwsX1oqQ3nIH/Screenshot-from-2020-09-15-16-51-25.png">Screenshot-from-2020-09-15-16-51-25.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/a2/JOdqQKGZ0X1pGwsX1oqQ3nIH/Screenshot-from-2020-09-15-16-51-25.png" title="Screenshot-from-2020-09-15-16-51-25.png"><img src="/user_uploads/2/a2/JOdqQKGZ0X1pGwsX1oqQ3nIH/Screenshot-from-2020-09-15-16-51-25.png"></a></div>



<a name="1017033"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017033" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017033">(Sep 15 2020 at 07:34)</a>:</h4>
<p><span class="user-mention" data-user-id="699">@Anders Kaseorg</span></p>



<a name="1017046"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017046" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017046">(Sep 15 2020 at 07:55)</a>:</h4>
<p>Would launching the server to 127.0.0.1 (Which i did) cause this error?</p>



<a name="1017047"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017047" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017047">(Sep 15 2020 at 08:01)</a>:</h4>
<p>This doesn’t match a problem I’ve seen or that our users have run into before, so you’re going to need to apply debugging skills at this point.</p>



<a name="1017048"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017048" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017048">(Sep 15 2020 at 08:03)</a>:</h4>
<p>well that's gunna be fun since its on ubuntu server so imma have to do it in nano</p>



<a name="1017052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017052">(Sep 15 2020 at 08:07)</a>:</h4>
<p>One thing you can try is start from scratch with a fresh VM and carefully document every step you perform <em>exactly</em> so that someone else can reproduce an identical setup. A problem that can be reproduced has a much better chance of being solved.</p>



<a name="1017053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017053">(Sep 15 2020 at 08:10)</a>:</h4>
<p>What VM is recommended? I'm using gnome boxes but it is mostly designed for using work OSs inside another, not running a server.</p>



<a name="1017059"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017059" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017059">(Sep 15 2020 at 08:21)</a>:</h4>
<p>GNOME Boxes should work if that’s what you’re familiar with. But you might find that an LXD container works more efficiently than a full-fledged VM.</p>



<a name="1017060"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017060" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017060">(Sep 15 2020 at 08:24)</a>:</h4>
<p>GNOME boxes is a GUI one but I would prefer a command line one if I'm using a non-graphical distro (Ubuntu server) so I'll look into LXD</p>



<a name="1017072"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017072" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017072">(Sep 15 2020 at 08:38)</a>:</h4>
<p>Ok well I got LXD working so I will document what I do in case I get the error again</p>



<a name="1017145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017145">(Sep 15 2020 at 10:02)</a>:</h4>
<div class="codehilite"><pre><span></span><code>Error running a subcommand of /root/zulip-server-3.1/scripts/lib/create-production-venv: /srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip install --no-deps --require-hashes --requirement /root/zulip-server-3.1/requirements/prod.txt
Actual error output for the subcommand is just above this.

`pip install` failed; retrying...
+ /srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip install --force-reinstall --require-hashes --requirement /root/zulip-server-3.1/requirements/pip.txt
+ /srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip install --no-deps --require-hashes --requirement /root/zulip-server-3.1/requirements/prod.txt

Error running a subcommand of /root/zulip-server-3.1/scripts/lib/create-production-venv: /srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip install --no-deps --require-hashes --requirement /root/zulip-server-3.1/requirements/prod.txt
Actual error output for the subcommand is just above this.

Traceback (most recent call last):
  File &quot;/root/zulip-server-3.1/scripts/lib/setup_venv.py&quot;, line 335, in do_setup_virtualenv
    install_venv_deps(pip, requirements_file)
  File &quot;/root/zulip-server-3.1/scripts/lib/setup_venv.py&quot;, line 101, in install_venv_deps
    run([pip, &quot;install&quot;, &quot;--no-deps&quot;, &quot;--require-hashes&quot;, &quot;--requirement&quot;, requirements_file])
  File &quot;/root/zulip-server-3.1/scripts/lib/zulip_tools.py&quot;, line 198, in run
    subprocess.check_call(args, **kwargs)
  File &quot;/usr/lib/python3.8/subprocess.py&quot;, line 364, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip&#39;, &#39;install&#39;, &#39;--no-deps&#39;, &#39;--require-hashes&#39;, &#39;--requirement&#39;, &#39;/root/zulip-server-3.1/requirements/prod.txt&#39;]&#39; returned non-zero exit status 1.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;/root/zulip-server-3.1/scripts/lib/create-production-venv&quot;, line 35, in &lt;module&gt;
    cached_venv_path = setup_virtualenv(
  File &quot;/root/zulip-server-3.1/scripts/lib/setup_venv.py&quot;, line 294, in setup_virtualenv
    do_setup_virtualenv(cached_venv_path, requirements_file)
  File &quot;/root/zulip-server-3.1/scripts/lib/setup_venv.py&quot;, line 339, in do_setup_virtualenv
    install_venv_deps(pip, requirements_file)
  File &quot;/root/zulip-server-3.1/scripts/lib/setup_venv.py&quot;, line 101, in install_venv_deps
    run([pip, &quot;install&quot;, &quot;--no-deps&quot;, &quot;--require-hashes&quot;, &quot;--requirement&quot;, requirements_file])
  File &quot;/root/zulip-server-3.1/scripts/lib/zulip_tools.py&quot;, line 198, in run
    subprocess.check_call(args, **kwargs)
  File &quot;/usr/lib/python3.8/subprocess.py&quot;, line 364, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command &#39;[&#39;/srv/zulip-venv-cache/b4a27188142d80b2eeb64f5d5c05b1d94cc6b7b9/zulip-py3-venv/bin/pip&#39;, &#39;install&#39;, &#39;--no-deps&#39;, &#39;--require-hashes&#39;, &#39;--requirement&#39;, &#39;/root/zulip-server-3.1/requirements/prod.txt&#39;]&#39; returned non-zero exit status 1.

Zulip installation failed (exit code 1)!

The install process is designed to be idempotent, so you can retry after resolving whatever issue caused the failure (there should be a traceback above). A log of this installation is available in /var/log/zulip/install.log
root@xakuserver:~#
</code></pre></div>


<p><a href="/user_uploads/2/2a/Ma317EP6ieOttLGrRIoYkkwj/installing-stuff">installing-stuff</a></p>



<a name="1017154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> ReCore <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017154">(Sep 15 2020 at 10:20)</a>:</h4>
<p>I mean, it's a different error. That's good, right?</p>



<a name="1017858"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Zulip%20can%27t%20boot/near/1017858" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Zulip.20can.27t.20boot.html#1017858">(Sep 16 2020 at 00:28)</a>:</h4>
<p>I’m assuming this is the issue we fixed in 3.2 (just released) by removing <code>django-cookies-samesite</code>. Try again with 3.2.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>