<html>
<head><meta charset="utf-8"><title>messages do not load for some users · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html">messages do not load for some users</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="256137"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256137" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256137">(Jul 24 2017 at 07:27)</a>:</h4>
<p>Some users were inactive for a while on my server. And now when they try to open Zulip, it will login, and the page will load, but no messages are loaded and the page looks like <a href="/user_uploads/2/25/jRuNK783aiq61vPE2jT4VGVe/pasted_image.png" target="_blank" title="pasted_image.png">this</a>.</p>
<div class="message_inline_image"><a href="/user_uploads/2/25/jRuNK783aiq61vPE2jT4VGVe/pasted_image.png" target="_blank" title="this"><img src="/user_uploads/2/25/jRuNK783aiq61vPE2jT4VGVe/pasted_image.png"></a></div>



<a name="256138"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256138" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256138">(Jul 24 2017 at 07:27)</a>:</h4>
<p>No errors were logged at <code>/var/log/zulip/errors.log</code>.</p>



<a name="256139"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256139" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256139">(Jul 24 2017 at 07:28)</a>:</h4>
<p>And this was on Chrome's developer console:</p>
<div class="codehilite"><pre><span></span>common.660b50449286.js:228 Uncaught TypeError: Cannot read property &#39;name&#39; of undefined
    at Object.g.initialize_from_page_params (app.ce15f184e2e6.js:1469)
    at HTMLDocument.&lt;anonymous&gt; (app.ce15f184e2e6.js:1524)
    at HTMLDocument.h (common.660b50449286.js:228)
    at u (common.660b50449286.js:96)
    at Object.fireWith [as resolveWith] (common.660b50449286.js:98)
    at Function.ready (common.660b50449286.js:101)
    at HTMLDocument.z (common.660b50449286.js:25)
g.initialize_from_page_params @ app.ce15f184e2e6.js:1469
(anonymous) @ app.ce15f184e2e6.js:1524
h @ common.660b50449286.js:228
u @ common.660b50449286.js:96
fireWith @ common.660b50449286.js:98
ready @ common.660b50449286.js:101
z @ common.660b50449286.js:25
common.660b50449286.js:226 Socket connected [transport=websocket]
common.660b50449286.js:226 SockJS connection lost.  Attempting to reconnect soon. (3000, Go away!)
common.660b50449286.js:226 Attempting socket reconnect.
common.660b50449286.js:226 Socket connected [transport=websocket]
</pre></div>



<a name="256159"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256159" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256159">(Jul 24 2017 at 08:08)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span></p>



<a name="256213"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256213" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256213">(Jul 24 2017 at 11:29)</a>:</h4>
<p>Can you look at these vars in the console and see if anything seems unusual:</p>
<ul>
<li><code>page_params.realm_default_streams</code></li>
<li><code>page_params.realm_notifications_stream_id</code></li>
</ul>
<p>Did you install off of master?</p>



<a name="256233"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256233" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256233">(Jul 24 2017 at 14:26)</a>:</h4>
<p><span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span> <code>page_params.realm_notifications_stream_id</code> is <code>1</code>. The other one was as expected.<br>
And I have installed 1.6.</p>



<a name="256244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256244">(Jul 24 2017 at 15:39)</a>:</h4>
<p>Another thing to check:</p>
<div class="codehilite"><pre><span></span>$ ./manage.py dbshell
psql (9.3.15)
SSL connection (cipher: DHE-RSA-AES256-GCM-SHA384, bits: 256)
Type &quot;help&quot; for help.

zulip=&gt; select * from zerver_stream where id = 1;
</pre></div>



<a name="256245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256245">(Jul 24 2017 at 15:40)</a>:</h4>
<p>I am thinking we have a bug here that gets triggered by some stream deactivation scenario.  My guess is that the notifications stream no longer exists, but that's just a guess.</p>



<a name="256428"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256428" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256428">(Jul 24 2017 at 19:51)</a>:</h4>
<p>Here is the result:</p>
<div class="codehilite"><pre><span></span>zulip@S1:~/deployments/2017-06-15-15-54-15$ ./manage.py dbshell
psql (9.5.7)
Type &quot;help&quot; for help.

zulip=&gt; select * from zerver_stream where id = 1;
 id |   name   | invite_only |           email_token            | description |         date_created          | deactivated | realm_id
----+----------+-------------+----------------------------------+-------------+-------------------------------+-------------+----------
  1 | announce | t           | 5d407f02eaa8e5b9179fdccfe8df7eac |             | 2017-01-05 00:03:56.679142+00 | f           |        2
(1 row)

zulip=&gt;
</pre></div>


<p><span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span></p>



<a name="256463"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256463" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256463">(Jul 24 2017 at 20:55)</a>:</h4>
<p>What's in <code>page_params.realm_default_streams</code>?</p>



<a name="256464"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256464" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256464">(Jul 24 2017 at 20:56)</a>:</h4>
<p>It's not clear to me which of the sections of <code>exports.initialize_from_page_params</code> is the source of the issue; <span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span> did you check the source map?</p>



<a name="256466"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256466" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256466">(Jul 24 2017 at 20:58)</a>:</h4>
<p>I didn't.</p>



<a name="256473"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256473" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256473">(Jul 24 2017 at 21:03)</a>:</h4>
<p>Regardless of what this bug turns out to be, I think we need to have a debug protocol for this that involves getting a real exception using the source maps.</p>



<a name="256474"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256474" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256474">(Jul 24 2017 at 21:04)</a>:</h4>
<p>One idea would be to have <code>blueslip.report_error</code> and friends end up logging all the frontend tracebacks to a file on systems that aren't having them emailed, so we can tell the user to get the full, sourcemap-powered traceback from the file.</p>



<a name="256475"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256475" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256475">(Jul 24 2017 at 21:04)</a>:</h4>
<p>That would be pretty quick to do, I think</p>



<a name="256476"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256476" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256476">(Jul 24 2017 at 21:06)</a>:</h4>
<p>Okay, what should I do now?</p>



<a name="256477"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256477" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256477">(Jul 24 2017 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> can you post <code>page_params.realm_default_streams</code>?  That's one of the 3 possibilities.</p>



<a name="256478"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256478" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256478">(Jul 24 2017 at 21:08)</a>:</h4>
<p>You can also try running <code>exports.get_sub_by_id(page_params.realm_notifications_stream_id).name</code> in the JS console and see what that returns.</p>



<a name="256483"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256483" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256483">(Jul 24 2017 at 21:14)</a>:</h4>
<div class="codehilite"><pre><span></span>page_params.realm_default_streams
(4) [Object, Object, Object, Object]
    0: Object
        description:&quot;&quot;
        invite_only:false
        name:&quot;اعلام‌ها&quot;
        stream_id:14
        __proto__:Object
    1:Object
        description:&quot;&quot;
        invite_only:false
        name:&quot;امتحانی&quot;
        stream_id:6
        __proto__:Object
    2:Object
        description:&quot;&quot;
        invite_only:false
        name:&quot;متفرقه&quot;
        stream_id:17
        __proto__:Object
    3:Object
        description:&quot;&quot;
        invite_only:false
        name:&quot;کار با زولیپ&quot;
        stream_id:8
        __proto__:Object
    length:4
    __proto__:Array(0)
</pre></div>



<a name="256484"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256484" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256484">(Jul 24 2017 at 21:14)</a>:</h4>
<div class="codehilite"><pre><span></span>exports.get_sub_by_id(page_params.realm_notifications_stream_id).name
VM77:1 Uncaught ReferenceError: exports is not defined
    at &lt;anonymous&gt;:1:1
(anonymous) @ VM77:1
</pre></div>



<a name="256486"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256486" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256486">(Jul 24 2017 at 21:16)</a>:</h4>
<p>I think that I have deleted or done something similar to the initial default streams.</p>



<a name="256487"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256487" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256487">(Jul 24 2017 at 21:16)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span></p>



<a name="256488"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256488" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256488">(Jul 24 2017 at 21:21)</a>:</h4>
<p>try replacing <code>exports.</code> with <code>stream_data.</code></p>



<a name="256490"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256490" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256490">(Jul 24 2017 at 21:22)</a>:</h4>
<div class="codehilite"><pre><span></span>stream_data.get_sub_by_id(page_params.realm_notifications_stream_id).name
VM78:1 Uncaught TypeError: Cannot read property &#39;name&#39; of undefined
    at &lt;anonymous&gt;:1:69
(anonymous) @ VM78:1
</pre></div>



<a name="256495"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256495" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256495">(Jul 24 2017 at 21:28)</a>:</h4>
<p>OK, so it is indeed an issue with <code>get_sub_by_id</code> not working on the notifications stream.  Hmm.</p>



<a name="256499"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256499" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256499">(Jul 24 2017 at 21:42)</a>:</h4>
<p>So, what should I do?? <span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span></p>



<a name="256557"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256557" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256557">(Jul 24 2017 at 23:10)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> sorry for the slow reply; was AFK</p>



<a name="256559"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256559" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256559">(Jul 24 2017 at 23:12)</a>:</h4>
<p>Oh, I bet I know what happened</p>



<a name="256560"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256560" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256560">(Jul 24 2017 at 23:12)</a>:</h4>
<p>Your "notifications stream" is marked as invite-only</p>



<a name="256562"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256562" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256562">(Jul 24 2017 at 23:12)</a>:</h4>
<p>And probably the user having the problem isn't subscribed.</p>



<a name="256563"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256563" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256563">(Jul 24 2017 at 23:12)</a>:</h4>
<p>You should use the streams management UI to make that stream not invite-only</p>



<a name="256564"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256564" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256564">(Jul 24 2017 at 23:13)</a>:</h4>
<p>Making the "notifications stream" invite-only isn't supported.  We should think about changing that, though; <span class="user-mention" data-user-email="showell@zulipchat.com" data-user-id="58">@Steve Howell</span> what do you think about making this block just set <code>page_params.notifications_stream = ""</code> if it can't find the stream?</p>
<div class="codehilite"><pre><span></span>    if (page_params.realm_notifications_stream_id !== -1) {
        page_params.notifications_stream =
            exports.get_sub_by_id(page_params.realm_notifications_stream_id).name;
    } else {
        page_params.notifications_stream = &quot;&quot;;
</pre></div>



<a name="256566"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256566" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256566">(Jul 24 2017 at 23:16)</a>:</h4>
<p>I wonder if we even use that client-side for non-admins in any significant way.  I'd be up for a quick fix here, and it's possible that for the invite-only cases, it should actually be the backend that just doesn't even set the <code>realm_notifications_stream_id</code> for folks that can't access the stream.</p>



<a name="256571"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256571" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256571">(Jul 24 2017 at 23:23)</a>:</h4>
<p>I think we display it only.</p>



<a name="256572"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256572" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256572">(Jul 24 2017 at 23:24)</a>:</h4>
<div class="codehilite"><pre><span></span> <span class="o">~</span><span class="err">/zulip (showell-unread-msg-ids) $ git grep page_params.notifications_stream</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">invite</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>        <span class="kd">var</span> <span class="nx">is_notifications_stream</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">;</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_create</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">)</span> <span class="p">{</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_create</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>    <span class="kd">var</span> <span class="nx">announce</span> <span class="o">=</span> <span class="p">(</span><span class="o">!!</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span> <span class="o">&amp;&amp;</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_create</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>    <span class="k">if</span> <span class="p">(</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">)</span> <span class="p">{</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_data</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>    <span class="c1">// TODO: add page_params.notifications_stream_id</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_data</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>    <span class="k">return</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">name_in_home_view</span><span class="p">(</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">);</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_data</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>        <span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span> <span class="o">=</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_data</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>        <span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">stream_data</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>        <span class="k">return</span> <span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">;</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">tutorial</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>                <span class="k">return</span> <span class="p">(</span><span class="nx">stream_name</span> <span class="o">!==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">stream_name</span> <span class="o">!==</span> <span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">);</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">tutorial</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>            <span class="nx">send_delayed_stream_message</span><span class="p">(</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">,</span> <span class="s2">&quot;welcome&quot;</span><span class="p">,</span> <span class="s2">&quot;Practice sending sending some messages here, or starting a new topic.&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">tutorial</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>            <span class="nx">send_delayed_stream_message</span><span class="p">(</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">,</span> <span class="s2">&quot;Zulip tips&quot;</span><span class="p">,</span> <span class="s2">&quot;Here&#39;s a message on a new topic: `Zulip tips`.\n\nAs you settle into Zulip, customize your account and notifications on your [Settings page](#settings).&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="kr">static</span><span class="o">/</span><span class="nx">js</span><span class="o">/</span><span class="nx">tutorial</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>            <span class="nx">send_delayed_stream_message</span><span class="p">(</span><span class="nx">page_params</span><span class="p">.</span><span class="nx">notifications_stream</span><span class="p">,</span> <span class="s2">&quot;Zulip tips&quot;</span><span class="p">,</span> <span class="s2">&quot;You might also enjoy:\n\n* Our lightweight !modal_link(#markdown-help, message formatting) (including emoji! :thumbsup:)\n* !modal_link(#keyboard-shortcuts, Keyboard shortcuts)\n* [Desktop and mobile apps](/apps)&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</pre></div>



<a name="256574"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256574" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256574">(Jul 24 2017 at 23:25)</a>:</h4>
<p>Ahh, I guess the settings code uses <code>page_params.realm_notifications_stream_id</code></p>



<a name="256575"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256575" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256575">(Jul 24 2017 at 23:25)</a>:</h4>
<p>In <code>static/js/settings_org.js</code></p>



<a name="256576"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256576" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256576">(Jul 24 2017 at 23:26)</a>:</h4>
<p>Probably the best thing to do here is just sweep all the code that uses name instead of id, and make all the code use ids instead and be defensive about the stream not being there.</p>



<a name="256578"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256578" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256578">(Jul 24 2017 at 23:26)</a>:</h4>
<p>And then any glitches are local to something like the tutorial, rather than happening at startup time.</p>



<a name="256579"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256579" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256579">(Jul 24 2017 at 23:27)</a>:</h4>
<p>tutorial is at startup :)</p>



<a name="256580"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256580" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256580">(Jul 24 2017 at 23:27)</a>:</h4>
<p>But I bet that tutorial code is for the first user in the realm, and thus not subject to issues here.</p>



<a name="256581"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256581" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256581">(Jul 24 2017 at 23:27)</a>:</h4>
<p>And is probably being deleted anyway.</p>



<a name="256582"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256582" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256582">(Jul 24 2017 at 23:27)</a>:</h4>
<p>I mean not screw up page load.</p>



<a name="256583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Howell <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256583">(Jul 24 2017 at 23:27)</a>:</h4>
<p>but, yeah, tutorial.js hopefully just goes away soon</p>



<a name="256584"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256584" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256584">(Jul 24 2017 at 23:27)</a>:</h4>
<p>Yeah, I think sweeping those to access the ID where possible makes sense to me.</p>



<a name="256708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256708">(Jul 25 2017 at 03:40)</a>:</h4>
<p>I was thinking... Can I change <code>realm_notifications_stream_id</code>?</p>



<a name="256710"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256710" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256710">(Jul 25 2017 at 04:21)</a>:</h4>
<p>Or I think I can say, can I change the notification stream of my realm?</p>



<a name="256719"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256719" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256719">(Jul 25 2017 at 05:29)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> yep, you can change it in the organization settings page.</p>



<a name="256739"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256739" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256739">(Jul 25 2017 at 06:15)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> I went through the organization settings, and cannot find something similar. Where is it?</p>



<a name="256769"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/256769" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#256769">(Jul 25 2017 at 09:45)</a>:</h4>
<p>Okay, I did that by hand from <code>manage.py shell</code>. But was there any better way?</p>



<a name="257103"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/257103" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#257103">(Jul 25 2017 at 20:32)</a>:</h4>
<p><span class="user-mention" data-user-email="Shayan.To@hotmail.com" data-user-id="1073">@Shayan Toqraee</span> I bet it's a new feature since 1.6</p>



<a name="257462"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/257462" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#257462">(Jul 26 2017 at 12:17)</a>:</h4>
<p>Thanks.<br>
And BTW, that solved the problem as well, thanks for the help.</p>



<a name="257553"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/messages%20do%20not%20load%20for%20some%20users/near/257553" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/messages.20do.20not.20load.20for.20some.20users.html#257553">(Jul 26 2017 at 16:21)</a>:</h4>
<p>Great!  We'll fix that bug in the next release.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>