<html>
<head><meta charset="utf-8"><title>images · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html">images</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="488748"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/488748" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#488748">(Feb 08 2018 at 19:01)</a>:</h4>
<p>Are images in user_uploads intended to be available to users without login?</p>



<a name="489032"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489032" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489032">(Feb 08 2018 at 20:41)</a>:</h4>
<p><span class="user-mention" data-user-email="shidarin@gmail.com" data-user-id="3733">@Sean Wallitsch</span> currently, if you use the S3 backend, they are not, but otherwise, they are with just the URL.  We plan to make them both work the way the S3 backend works.  Of course, you need a (secret) URL regardless.</p>



<a name="489033"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489033" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489033">(Feb 08 2018 at 20:42)</a>:</h4>
<p>This is a project which requires a bit of activation energy to complete, but is actually pretty close to being done.</p>



<a name="489035"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489035" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489035">(Feb 08 2018 at 20:42)</a>:</h4>
<p><span class="user-mention" data-user-email="adi.bansal241996@gmail.com" data-user-id="1113">@Aditya Bansal</span> I have a question for you on this: If we wanted to change to the new model here only on Ubuntu Xenial (so that we don't have to deal with the <code>nginx</code> version mismatch issue), how hard would that be?</p>



<a name="489036"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489036" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489036">(Feb 08 2018 at 20:43)</a>:</h4>
<p>Assuming that we have a conveniently available variable in <code>settings</code> for whether that's the case.</p>



<a name="489150"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489150" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489150">(Feb 08 2018 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-email="tabbott@zulipchat.com" data-user-id="7">@Tim Abbott</span> I think that will be interesting thing to do because if we were to drop solving NGINX version mismatch issue (which is something which actually translates to whether URL which is to be put into <code>X-Accel-Redirect headers</code> is to be quoted or not) django sendfile will just work. I think it will be not at all hard to get this project finished then.</p>



<a name="489154"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489154" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489154">(Feb 08 2018 at 21:06)</a>:</h4>
<p>Maybe we can also go with your suggestion of shipping newer version of NGINX with Trusty</p>



<a name="489160"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489160" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489160">(Feb 08 2018 at 21:07)</a>:</h4>
<p>Trusty is going to reach EOL before too long, but I think that's a viable option for that use case.</p>



<a name="489174"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489174" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489174">(Feb 08 2018 at 21:09)</a>:</h4>
<p>if we are to drop trusty support soon I guess it makes sense to move forward and have it for Xenial onwards.</p>



<a name="489178"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489178" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489178">(Feb 08 2018 at 21:09)</a>:</h4>
<p>I think it'd be great to ship a version of this that doesn't change anything on Trusty and just fixes the issue on Xenial.</p>



<a name="489181"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489181" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489181">(Feb 08 2018 at 21:10)</a>:</h4>
<p>Then later we can do something about Trusty; most likely just drop support.</p>



<a name="489214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489214">(Feb 08 2018 at 21:15)</a>:</h4>
<p>how should the setting look like</p>
<ul>
<li>We can have ubuntu version detected and stored in settings</li>
<li>We can have user specify in /etc/zulip/setting.py which ubuntu version they are on</li>
</ul>



<a name="489225"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489225" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489225">(Feb 08 2018 at 21:17)</a>:</h4>
<p>We can detect it ourselves in <code>zproject/settings.py</code>, if we need it inside Django code.</p>



<a name="489229"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489229" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489229">(Feb 08 2018 at 21:18)</a>:</h4>
<p>We're currently on trusty but will be moving to Xenial as we do our production server. Greg's proposal makes sense.</p>



<a name="489232"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489232" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sean Wallitsch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489232">(Feb 08 2018 at 21:18)</a>:</h4>
<p>Are there any github issues for this I can link to?</p>



<a name="489236"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489236" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489236">(Feb 08 2018 at 21:19)</a>:</h4>
<p>here you go <span class="user-mention" data-user-email="shidarin@gmail.com" data-user-id="3733">@Sean Wallitsch</span> <br>
<a href="https://github.com/zulip/zulip/pull/320" target="_blank" title="https://github.com/zulip/zulip/pull/320">#320</a></p>



<a name="489242"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489242" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489242">(Feb 08 2018 at 21:21)</a>:</h4>
<p><span class="user-mention" data-user-email="adi.bansal241996@gmail.com" data-user-id="1113">@Aditya Bansal</span> For identifying the OS release, we can use the shell command <code>lsb_release -cs</code>. We shouldn't make the user specify it.</p>
<p>(And if we need it in any code inside Django, then put that in <code>zproject/settings.py</code> and get it from settings)</p>



<a name="489255"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489255" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489255">(Feb 08 2018 at 21:25)</a>:</h4>
<p>though I see a problem here with keeping the behaviour with Trusty installs. Like for making requests reach Django we will remove <br>
NGINX direct file serving capability and have a new redirect route which will get hit from internal redirected request.</p>
<p>Thing is this will work great for Xenial but for Trusty uploads will be broken.</p>



<a name="489257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489257">(Feb 08 2018 at 21:26)</a>:</h4>
<p>Unless we start shipping new NGINX for Trusty</p>



<a name="489270"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489270" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489270">(Feb 08 2018 at 21:28)</a>:</h4>
<p>can we have conditionals in <code>puppet/zulip/files/nginx/sites-available/zulip-enterprise</code> and detect platform here <span class="user-mention" data-user-email="greg@zulipchat.com" data-user-id="2187">@Greg Price</span></p>



<a name="489272"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489272" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489272">(Feb 08 2018 at 21:28)</a>:</h4>
<p>The goal would be</p>
<ul>
<li>on trusty, everything works the same as now</li>
<li>on xenial, everything works like in your patch</li>
</ul>
<p>I haven't looked at the details of the changes so can't say how, but this should be a solvable problem :)</p>



<a name="489276"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489276" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489276">(Feb 08 2018 at 21:29)</a>:</h4>
<p>Let's take this to another stream for detailed implementation discussion -- maybe <a class="stream" data-stream-id="3" href="/#narrow/stream/backend">#backend</a> ?</p>



<a name="489277"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/images/near/489277" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Aditya Bansal <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/images.html#489277">(Feb 08 2018 at 21:29)</a>:</h4>
<p>sure</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>