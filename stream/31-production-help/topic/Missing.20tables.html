<html>
<head><meta charset="utf-8"><title>Missing tables · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html">Missing tables</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1371428"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1371428" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1371428">(Apr 21 2022 at 20:48)</a>:</h4>
<p>Hello,<br>
I have a general question about an issue that I have encountered. <br>
The issue is unable to render message.<br>
When I  enabled "show previews of linked website" under organization settings which is under manage organization. <br>
I noticed if I tried to embed a link to my message, I got "Error sending message: Unable to render message". </p>
<p><a href="/user_uploads/2/32/89-EJ96UzVDch6nxOYm9oB45/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/32/89-EJ96UzVDch6nxOYm9oB45/image.png" title="image.png"><img src="/user_uploads/2/32/89-EJ96UzVDch6nxOYm9oB45/image.png"></a></div><p>Ps: if I disable "show previews of linked website", I can post message. <br>
It would display text with hyperlink no preview image. </p>
<p>Do you have any suggestions to resolve this issue?</p>
<p>Ps: I am using zulip docker container. </p>
<p>Thank you so much for your help. :)</p>



<a name="1371527"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1371527" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1371527">(Apr 21 2022 at 22:24)</a>:</h4>
<p><span class="user-mention" data-user-id="22988">@jcheng</span>: That's interesting -- since that's a failure at initial-render time, not in the async worker as <span class="user-mention silent" data-user-id="21924">Maarten</span> was running into above.</p>
<p>Can you check for errors in <code>/var/log/zulip/errors.log</code> in the container?</p>



<a name="1377041"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377041" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377041">(May 02 2022 at 21:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1371527">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="22988">jcheng</span>: That's interesting -- since that's a failure at initial-render time, not in the async worker as <span class="user-mention silent" data-user-id="21924">Maarten</span> was running into above.</p>
<p>Can you check for errors in <code>/var/log/zulip/errors.log</code> in the container?</p>
</blockquote>
<p>Alex,<br>
My apologize. I didn't reply to your response. </p>
<p>The issue is that the feature of "show previews of linked websites" under organization settings is not working. </p>
<p>if I enable the feature of show previews of linked websites, I can't post any messages which contain URLs. <br>
For example, if I can try to send a short message which includes <a href="http://yahoo.com">yahoo.com</a>, the message will never get sent. </p>
<p><a href="/user_uploads/2/69/-yLRY4Ga4d88nE8SeIFyzUcL/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/69/-yLRY4Ga4d88nE8SeIFyzUcL/image.png" title="image.png"><img src="/user_uploads/2/69/-yLRY4Ga4d88nE8SeIFyzUcL/image.png"></a></div><p>You can see that on the far right, zulip tries to send out the message, but the message never gets send. <br>
However, if I disable that feature, zulip sends out the message without any issue. </p>
<p>The second issue is that show previews of linked websites doesn't display any "previews of linked website" at all. <br>
No matter I enable "show previews of linked websites" or not.<br>
Is this normal or this feature only displays embed image URLs? </p>
<p>These are the two main issues for the feature of "show previews of linked websites". <br>
Thank you so much for taking the time to read my message.</p>
<p>Ps: we are using zulip docker container.</p>



<a name="1377045"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377045" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377045">(May 02 2022 at 22:14)</a>:</h4>
<p><span class="user-mention" data-user-id="22988">@jcheng</span>: Can you show <code>/var/log/zulip/errors.log</code> from inside the container?</p>



<a name="1377052"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377052" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377052">(May 02 2022 at 22:35)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1377045">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="22988">jcheng</span>: Can you show <code>/var/log/zulip/errors.log</code> from inside the container?</p>
</blockquote>
<p>Hi Alex,<br>
the following is the output error when I tried to send a message with show previews of linked websites feature enabled. <br>
Thank you so much. <br>
John</p>
<p>=======<br>
2022-05-02 22:33:34.769 ERR  [] Exception in Markdown parser; input (sanitized) was: 'xxxx xxx xxxx.\nxxxxx://xxxxxx.xxx'<br>
 (message unknown)<br>
Traceback (most recent call last):<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 84, in _execute<br>
    return self.cursor.execute(sql, params)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/db.py", line 34, in execute<br>
    return wrapper_execute(self, super().execute, query, vars)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/db.py", line 19, in wrapper_execute<br>
    return action(sql, params)<br>
psycopg2.errors.UndefinedTable: relation "third_party_api_results" does not exist<br>
LINE 1: SELECT "cache_key", "value", "expires" FROM "third_party_api...<br>
                                                    ^</p>
<p>The above exception was the direct cause of the following exception:</p>
<p>Traceback (most recent call last):<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/markdown/__init__.py", line 2651, in do_convert<br>
    rendered_content = timeout(5, lambda: _md_engine.convert(content))<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/timeout.py", line 94, in timeout<br>
    raise thread.exc_info[1].with_traceback(thread.exc_info[2])<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/timeout.py", line 53, in run<br>
    self.result = func()<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/markdown/__init__.py", line 2651, in &lt;lambda&gt;<br>
    rendered_content = timeout(5, lambda: _md_engine.convert(content))<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/markdown/core.py", line 268, in convert<br>
    newRoot = treeprocessor.run(root)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/markdown/__init__.py", line 1350, in run<br>
    extracted_data = link_preview.link_embed_data_from_cache(url)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/cache.py", line 147, in func_with_caching<br>
    val = cache_get(key, cache_name=cache_name)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/cache.py", line 263, in cache_get<br>
    ret = cache_backend.get(final_key)<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/core/cache/backends/db.py", line 51, in get<br>
    return self.get_many([key], version).get(key, default)<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/core/cache/backends/db.py", line 68, in get_many<br>
    cursor.execute(<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 66, in execute<br>
    return self._execute_with_wrappers(sql, params, many=False, executor=self._execute)<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 75, in _execute_with_wrappers<br>
    return executor(sql, params, many, context)<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 84, in _execute<br>
    return self.cursor.execute(sql, params)<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/utils.py", line 90, in __exit__<br>
    raise dj_exc_value.with_traceback(traceback) from exc_value<br>
  File "/srv/zulip-venv-cache/ef8185333fe34441fea907c58f8eb02e5dd5a85a/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py", line 84, in _execute<br>
    return self.cursor.execute(sql, params)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/db.py", line 34, in execute<br>
    return wrapper_execute(self, super().execute, query, vars)<br>
  File "/home/zulip/deployments/2022-04-15-19-17-46/./zerver/lib/db.py", line 19, in wrapper_execute<br>
    return action(sql, params)<br>
django.db.utils.ProgrammingError: relation "third_party_api_results" does not exist<br>
LINE 1: SELECT "cache_key", "value", "expires" FROM "third_party_api...<br>
                                                    ^</p>



<a name="1377053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377053">(May 02 2022 at 22:36)</a>:</h4>
<p>Can you edit your message and use <a href="https://zulip.com/help/format-your-message-using-markdown#code">code blocks</a>, by placing three backticks above and below it, like so:</p>
<div class="codehilite"><pre><span></span><code>```
2022-05-02 22:33:34.769 ERR [] Exception in Markdown parser; input (sanitized) was: &#39;xxxx xxx xxxx.\nxxxxx://xxxxxx.xxx&#39;
...
django.db.utils.ProgrammingError: relation &quot;third_party_api_results&quot; does not exist
LINE 1: SELECT &quot;cache_key&quot;, &quot;value&quot;, &quot;expires&quot; FROM &quot;third_party_api...
^
```
</code></pre></div>
<p>That keeps it much more readable!</p>



<a name="1377054"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377054" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377054">(May 02 2022 at 22:37)</a>:</h4>
<p>So the error says:</p>
<div class="codehilite"><pre><span></span><code>relation &quot;third_party_api_results&quot; does not exist
</code></pre></div>
<p>That means that part of the database is missing.  What's the history of this instance?  Was it upgraded from an earlier version, or have you ever modified the database by hand in any way?</p>



<a name="1377447"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377447" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377447">(May 03 2022 at 20:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1377054">said</a>:</p>
<blockquote>
<p>So the error says:</p>
<div class="codehilite"><pre><span></span><code>relation &quot;third_party_api_results&quot; does not exist
</code></pre></div>
<p>That means that part of the database is missing.  What's the history of this instance?  Was it upgraded from an earlier version, or have you ever modified the database by hand in any way?</p>
</blockquote>
<p>Hi Alex,<br>
Thank you so much for the tips. I will remember use code blocks next time. <br>
I am not sure about your question since I didn't setup the zulip docker container initially. <br>
I need to check with my co-workers to find out more. <br>
One thing that I know for sure is that no one has modified the database by hand because I am the only one who manages the zulip. <br>
Since error message is about part of database is missing, do you know which part of database is missing?<br>
Any suggestions that I can resolve this issue?<br>
By the way, I also notice that it won't display preview window when I insert a URL. However, it will if I copy the image link from Snipping Tool that comes with Windows OS. Does zulip display preview window when inserts a regular website URL? <br>
Is this issue also related to third party api results does not exist?<br>
Thank you so much. :)</p>



<a name="1377459"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377459" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377459">(May 03 2022 at 20:07)</a>:</h4>
<p>Your issue is caused by one table in the database, <code>third_party_api_results</code>, not existing.</p>
<p>Image previews use a different codepath, so it's not surprising that those work while bare website URLs don't.</p>



<a name="1377460"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377460" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377460">(May 03 2022 at 20:08)</a>:</h4>
<p>Without knowing how the <code>third_party_api_results</code> table went missing, it's hard to suggest how to proceed -- there may also be other tables missing.</p>



<a name="1377462"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377462" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377462">(May 03 2022 at 20:09)</a>:</h4>
<p>Can you try the following -- as the <code>zulip</code> user, run:</p>
<div class="codehilite"><pre><span></span><code>psql -c &#39;\dt&#39;
</code></pre></div>
<p>...and paste the output?</p>



<a name="1377467"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377467" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377467">(May 03 2022 at 20:11)</a>:</h4>
<p>AndI guess the other question is -- when did this start?  Did anything change right around when the errors started happening?</p>



<a name="1377525"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377525" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377525">(May 03 2022 at 21:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1377467">said</a>:</p>
<blockquote>
<p>AndI guess the other question is -- when did this start?  Did anything change right around when the errors started happening?</p>
</blockquote>
<p>Hi Alex, <br>
We didn't notice those issues until my co-worker tried to invite me to attend a meeting. <br>
He discovered that he couldn't send out the message that contained URLs.</p>
<p>One thing I remembered that our admin system made a change was on the permission of zulip-secrets.conf.<br>
Somehow the file had my co-worker's username.<br>
-rw-r----- 1 root  MYCOWORKER-USERNAME  618 Dec 21 09:04 zulip-secrets.conf</p>
<p>Then, he changed it to zulip</p>
<p>-rw-r----- 1 root  zulip  618 Dec 21 09:04 zulip-secrets.conf</p>
<p>I tried to access the database, but I got the following errors.  </p>
<p>zulip@humzulip:/srv/docker-zulip$ psql -c '\dt'<br>
psql: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: No such file or directory<br>
        Is the server running locally and accepting connections on that socket?</p>



<a name="1377527"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1377527" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1377527">(May 03 2022 at 22:07)</a>:</h4>
<p>OK, do this instead:</p>
<div class="codehilite"><pre><span></span><code>cd ~/deployments/docker
./manage.py dbshell
</code></pre></div>
<p>...and once that starts up:</p>
<div class="codehilite"><pre><span></span><code>\dt
</code></pre></div>



<a name="1379584"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1379584" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1379584">(May 09 2022 at 22:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1377527">said</a>:</p>
<blockquote>
<p>OK, do this instead:</p>
<div class="codehilite"><pre><span></span><code>cd ~/deployments/docker
./manage.py dbshell
</code></pre></div>
<p>...and once that starts up:</p>
<p><div class="codehilite"><pre><span></span><code>\dt
</code></pre></div><br>
</p>
</blockquote>
<p>Hi Alex,<br>
Sorry for the late response. <br>
I finally got a chance to access to zulip database. It is true that Third_party_api_results table  is not in the database. <br>
The following is part of tables in the database, but there is no Third_party_api_results table. </p>
<p>zulip  | social_auth_partial                                           | table | zulip<br>
 zulip  | social_auth_usersocialauth                          | table | zulip<br>
 zulip  | two_factor_phonedevice                               | table | zulip<br>
 zulip  | zerver_alertword                                               | table | zulip<br>
 zulip  | zerver_archivedattachment                         | table | zulip<br>
 zulip  | zerver_archivedattachment_messages  | table | zulip</p>
<p>Since Third_party_api_results table is not in the database, what should I resolve this issue?<br>
Thank you so much for taking your time to read my message. </p>
<p>John</p>



<a name="1379586"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1379586" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1379586">(May 09 2022 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="22988">@jcheng</span>: Can you show the full output?  I was asking to try to find out if any <em>other</em> tables were also missing.</p>



<a name="1380307"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1380307" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1380307">(May 11 2022 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Unable.20to.20render.20message/near/1379586">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="22988">jcheng</span>: Can you show the full output?  I was asking to try to find out if any <em>other</em> tables were also missing.</p>
</blockquote>
<p>Hi Alex,<br>
The attachment contains the output of our database tables. <br>
Thank you so much for taking the time to help us. <br>
John</p>
<p><a href="/user_uploads/2/e9/h7Ns3cEUVazMZVLPdq5zS9Pp/zulip-database-table.txt">zulip-database-table.txt</a></p>



<a name="1381182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381182">(May 16 2022 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="22988">@jcheng</span>: Assuming you're on Zulip 4.x, then <code>third_party_api_results</code> is the only table you're missing.</p>
<p>You can re-create it via:</p>
<div class="codehilite"><pre><span></span><code>cd ~/deployments/docker
./manage.py dbshell
</code></pre></div>
<p>...and once that starts up, pasting in:</p>
<div class="codehilite" data-code-language="SQL"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">zulip</span><span class="p">.</span><span class="n">third_party_api_results</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">cache_key</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">expires</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>We also suggest you upgrade to the latest release, 5.2.</p>



<a name="1381229"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381229" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381229">(May 16 2022 at 21:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Missing.20tables/near/1381182">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="22988">jcheng</span>: Assuming you're on Zulip 4.x, then <code>third_party_api_results</code> is the only table you're missing.</p>
<p>You can re-create it via:</p>
<div class="codehilite"><pre><span></span><code>cd ~/deployments/docker
./manage.py dbshell
</code></pre></div>
<p>...and once that starts up, pasting in:</p>
<div class="codehilite" data-code-language="SQL"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">zulip</span><span class="p">.</span><span class="n">third_party_api_results</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">cache_key</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">expires</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>We also suggest you upgrade to the latest release, 5.2.</p>
</blockquote>
<p>Hi Alex,<br>
Yes, our current docker image version is 4.8-1. <br>
If we upgrade the docker image, do we still need to create the table?<br>
Also, how do people usually upgrade their zulip docker image? <br>
Do they just simply go to docker-compose.yml file and change image version?<br>
For example, </p>
<p>zulip:<br>
    image: "zulip/docker-zulip:5.2"<br>
    build:<br>
      context: .</p>
<p>Thank you so much for taking the time to reply to my message. <br>
John</p>



<a name="1381287"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381287" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381287">(May 16 2022 at 22:30)</a>:</h4>
<p><span class="user-mention" data-user-id="22988">@jcheng</span> you need to create that table regardless, yes.</p>



<a name="1381288"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381288" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381288">(May 16 2022 at 22:30)</a>:</h4>
<p>You should re-create the table before upgrading; upgrading will not fix the missing table.</p>
<p>And yes, I believe updating to the new docker image is all that's necessary to do the upgrade -- the docker image has logic inside of it to do the required database upgrade steps, etc.</p>



<a name="1381521"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381521" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381521">(May 17 2022 at 14:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/31-production-help/topic/Missing.20tables/near/1381287">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="22988">jcheng</span> you need to create that table regardless, yes.</p>
</blockquote>
<p>Thank you so much Tim. :)</p>



<a name="1381522"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Missing%20tables/near/1381522" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jcheng <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Missing.20tables.html#1381522">(May 17 2022 at 14:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="12178">Alex Vandiver</span> <a href="#narrow/stream/31-production-help/topic/Missing.20tables/near/1381288">said</a>:</p>
<blockquote>
<p>You should re-create the table before upgrading; upgrading will not fix the missing table.</p>
<p>And yes, I believe updating to the new docker image is all that's necessary to do the upgrade -- the docker image has logic inside of it to do the required database upgrade steps, etc.</p>
</blockquote>
<p>Thank you so much again Alex for your help. :)</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>