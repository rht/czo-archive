<html>
<head><meta charset="utf-8"><title>Migration between servers · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html">Migration between servers</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1529630"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529630" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529630">(Mar 21 2023 at 20:43)</a>:</h4>
<p>Hi!<br>
I'm having issues migrating from one server to another. Both servers are exactly the same version. However, once I've exported the tarball from the first server, the second server fails to import it. Specifically, I get this error:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>ValueError:<span class="w"> </span>Cannot<span class="w"> </span>assign<span class="w"> </span><span class="s2">"2999"</span>:<span class="w"> </span><span class="s2">"UserProfile.recipient"</span><span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>a<span class="w"> </span><span class="s2">"Recipient"</span><span class="w"> </span>instance.
</code></pre></div>



<a name="1529632"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529632" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529632">(Mar 21 2023 at 20:44)</a>:</h4>
<p>I did a test run of the migration the other day, which went fine, but stupidly, after the test run, I deleted some users with the <code>./manage.py delete_user</code> command <span aria-label="face palm" class="emoji emoji-1f926" role="img" title="face palm">:face_palm:</span></p>



<a name="1529636"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529636" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529636">(Mar 21 2023 at 20:45)</a>:</h4>
<p>I've trued a number of things to resolve this. The users that were deleted appear in realm.json under the <code>zerver_userprofile_mirrordummy</code> key. I tried to move them back to <code>zerver_userprofile</code> which didn't work.</p>



<a name="1529638"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529638" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529638">(Mar 21 2023 at 20:46)</a>:</h4>
<p>I even tried restoring our server from a tape backup (its been about a week since my test run and subsequent deleting of users), re-exported the old server, and then went through the old realm.json and tried to copy across each of the deleted users to the newly exported realm.json; which then gives this error:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>django.db.utils.IntegrityError:<span class="w"> </span>duplicate<span class="w"> </span>key<span class="w"> </span>value<span class="w"> </span>violates<span class="w"> </span>unique<span class="w"> </span>constraint<span class="w"> </span><span class="s2">"zerver_huddle_huddle_hash_key"</span>
DETAIL:<span class="w">  </span>Key<span class="w"> </span><span class="o">(</span>huddle_hash<span class="o">)=(</span>c8e88913e0eae335f418f3778d606350ee81627a<span class="o">)</span><span class="w"> </span>already<span class="w"> </span>exists.
</code></pre></div>



<a name="1529651"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529651" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529651">(Mar 21 2023 at 20:53)</a>:</h4>
<p>Any help would be very much appreciated. I've spent nearly 20 hours straight working on this issue... and was hoping to have this server back up and running in the next 2 hours, which is starting to feel very unlikely.</p>



<a name="1529690"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529690" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529690">(Mar 21 2023 at 21:23)</a>:</h4>
<p><span class="user-mention" data-user-id="26556">@Matthew Strachan</span> the full tracebacks would be helpful. I kinda suspect the issue might have to do with the server you're importing into not having an empty database. (Though to be clear, that should not be an impediment to doing an import).</p>



<a name="1529691"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529691" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529691">(Mar 21 2023 at 21:24)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="7">@Tim Abbott</span> </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@34d969bd7a0e:/home/zulip/deployments/current#<span class="w"> </span>su<span class="w"> </span>-c<span class="w"> </span><span class="s2">"./manage.py import '' /transfer/zulip"</span><span class="w"> </span>zulip
Processing<span class="w"> </span>dump:<span class="w"> </span>/transfer/zulip<span class="w"> </span>...
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.103<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Importing<span class="w"> </span>realm<span class="w"> </span>dump<span class="w"> </span>/transfer/zulip
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.104<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Importing<span class="w"> </span>realm<span class="w"> </span>data<span class="w"> </span>from<span class="w"> </span>/transfer/zulip/realm.json
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.403<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.UserGroup'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_usergroup.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.508<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.Stream'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_stream.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.517<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span>
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.520<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span>
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:15.522<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span>
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.115<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.DefaultStream'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_defaultstream.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.128<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.RealmEmoji'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_realmemoji.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.132<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.RealmDomain'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_realmdomain.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.135<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.RealmFilter'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_realmfilter.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.136<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.RealmPlayground'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_realmplayground.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:20.341<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.Recipient'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_recipient.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:23.000<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.Subscription'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_subscription.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:05:24.626<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.RealmAuditLog'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_realmauditlog.
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">89</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_execute
<span class="w">    </span><span class="k">return</span><span class="w"> </span>self.cursor.execute<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">34</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span>wrapper_execute<span class="o">(</span>self,<span class="w"> </span>super<span class="o">()</span>.execute,<span class="w"> </span>query,<span class="w"> </span>vars<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>wrapper_execute
<span class="w">    </span>action<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
psycopg2.errors.UniqueViolation:<span class="w"> </span>duplicate<span class="w"> </span>key<span class="w"> </span>value<span class="w"> </span>violates<span class="w"> </span>unique<span class="w"> </span>constraint<span class="w"> </span><span class="s2">"zerver_huddle_huddle_hash_key"</span>
DETAIL:<span class="w">  </span>Key<span class="w"> </span><span class="o">(</span>huddle_hash<span class="o">)=(</span>2fba7615d64f80e43e162acab6645abe065e6a30<span class="o">)</span><span class="w"> </span>already<span class="w"> </span>exists.


The<span class="w"> </span>above<span class="w"> </span>exception<span class="w"> </span>was<span class="w"> </span>the<span class="w"> </span>direct<span class="w"> </span>cause<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>exception:

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"./manage.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">151</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>execute_from_command_line<span class="o">(</span>sys.argv<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"./manage.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">116</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute_from_command_line
<span class="w">    </span>utility.execute<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">440</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span>self.fetch_command<span class="o">(</span>subcommand<span class="o">)</span>.run_from_argv<span class="o">(</span>self.argv<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">402</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run_from_argv
<span class="w">    </span>self.execute<span class="o">(</span>*args,<span class="w"> </span>**cmd_options<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">448</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.handle<span class="o">(</span>*args,<span class="w"> </span>**options<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/management/commands/import.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">99</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>handle
<span class="w">    </span>do_import_realm<span class="o">(</span>path,<span class="w"> </span>subdomain,<span class="w"> </span>num_processes<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1160</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_import_realm
<span class="w">    </span>bulk_import_model<span class="o">(</span>data,<span class="w"> </span>Huddle<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">686</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>bulk_import_model
<span class="w">    </span>model.objects.bulk_create<span class="o">(</span>model<span class="o">(</span>**item<span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span>data<span class="o">[</span>table<span class="o">])</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/manager.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">85</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>manager_method
<span class="w">    </span><span class="k">return</span><span class="w"> </span>getattr<span class="o">(</span>self.get_queryset<span class="o">()</span>,<span class="w"> </span>name<span class="o">)(</span>*args,<span class="w"> </span>**kwargs<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">798</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>bulk_create
<span class="w">    </span><span class="nv">returned_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self._batched_insert<span class="o">(</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1816</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_batched_insert
<span class="w">    </span>self._insert<span class="o">(</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/query.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1790</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_insert
<span class="w">    </span><span class="k">return</span><span class="w"> </span>query.get_compiler<span class="o">(</span><span class="nv">using</span><span class="o">=</span>using<span class="o">)</span>.execute_sql<span class="o">(</span>returning_fields<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/sql/compiler.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1660</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute_sql
<span class="w">    </span>cursor.execute<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">67</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span><span class="k">return</span><span class="w"> </span>self._execute_with_wrappers<span class="o">(</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">80</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_execute_with_wrappers
<span class="w">    </span><span class="k">return</span><span class="w"> </span>executor<span class="o">(</span>sql,<span class="w"> </span>params,<span class="w"> </span>many,<span class="w"> </span>context<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">89</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_execute
<span class="w">    </span><span class="k">return</span><span class="w"> </span>self.cursor.execute<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">91</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__exit__
<span class="w">    </span>raise<span class="w"> </span>dj_exc_value.with_traceback<span class="o">(</span>traceback<span class="o">)</span><span class="w"> </span>from<span class="w"> </span>exc_value
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/utils.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">89</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_execute
<span class="w">    </span><span class="k">return</span><span class="w"> </span>self.cursor.execute<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">34</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span>wrapper_execute<span class="o">(</span>self,<span class="w"> </span>super<span class="o">()</span>.execute,<span class="w"> </span>query,<span class="w"> </span>vars<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/db.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>wrapper_execute
<span class="w">    </span>action<span class="o">(</span>sql,<span class="w"> </span>params<span class="o">)</span>
django.db.utils.IntegrityError:<span class="w"> </span>duplicate<span class="w"> </span>key<span class="w"> </span>value<span class="w"> </span>violates<span class="w"> </span>unique<span class="w"> </span>constraint<span class="w"> </span><span class="s2">"zerver_huddle_huddle_hash_key"</span>
DETAIL:<span class="w">  </span>Key<span class="w"> </span><span class="o">(</span>huddle_hash<span class="o">)=(</span>2fba7615d64f80e43e162acab6645abe065e6a30<span class="o">)</span><span class="w"> </span>already<span class="w"> </span>exists.
</code></pre></div>



<a name="1529692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529692">(Mar 21 2023 at 21:24)</a>:</h4>
<p>(I've never seen this class of issue when doing an import before).</p>



<a name="1529693"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529693" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529693">(Mar 21 2023 at 21:24)</a>:</h4>
<p>That is a full dump from importing with my modified <code>realm.json</code>... Where I have moved the deleted users back in....</p>



<a name="1529694"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529694" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529694">(Mar 21 2023 at 21:26)</a>:</h4>
<p>There's two possible explanations for that last exception. One is that you have multiple <code>zerver_huddle</code> objects with the same set of user IDs in them in your <code>realm.json</code>; can you try checking that theory?</p>



<a name="1529695"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529695" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529695">(Mar 21 2023 at 21:27)</a>:</h4>
<p>Actually I'm not sure I have another theory that would manifest like that.</p>



<a name="1529697"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529697" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529697">(Mar 21 2023 at 21:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/9-issues/topic/Migration.20between.20servers/near/1529694">said</a>:</p>
<blockquote>
<p>There's two possible explanations for that last exception. One is that you have multiple <code>zerver_huddle</code> objects with the same set of user IDs in them in your <code>realm.json</code>; can you try checking that theory?</p>
</blockquote>
<p><a href="/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png">image.png</a> user ID would be this key pair?</p>
<div class="message_inline_image"><a href="/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png" title="image.png"><img src="/user_uploads/2/24/u0qSakncbKTJs9GxbU-ZWh0t/image.png"></a></div>



<a name="1529700"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529700" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529700">(Mar 21 2023 at 21:29)</a>:</h4>
<p>OK I think actually my theory is that the issue is that your new server doesn't have an empty database.</p>



<a name="1529702"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529702" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529702">(Mar 21 2023 at 21:29)</a>:</h4>
<p>BTW, is there a reason you're not using the backup tool for this migration?</p>



<a name="1529703"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529703" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529703">(Mar 21 2023 at 21:30)</a>:</h4>
<p>The new server is a fresh docker...</p>



<a name="1529704"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529704" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529704">(Mar 21 2023 at 21:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="7">Tim Abbott</span> <a href="#narrow/stream/9-issues/topic/Migration.20between.20servers/near/1529702">said</a>:</p>
<blockquote>
<p>BTW, is there a reason you're not using the backup tool for this migration?</p>
</blockquote>
<p>The backup tool? I am using this command from the docs<br>
<code>./manage.py export -r ''</code></p>



<a name="1529705"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529705" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529705">(Mar 21 2023 at 21:30)</a>:</h4>
<p><span class="user-mention" data-user-id="26556">@Matthew Strachan</span> this is the backup tool: <a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html#backups">https://zulip.readthedocs.io/en/latest/production/export-and-import.html#backups</a></p>



<a name="1529706"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529706" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529706">(Mar 21 2023 at 21:31)</a>:</h4>
<p>You only need to do this logical export if you're adjusting the set of realms being hosted together (E.g. moving a realm to or from Zulip Cloud).</p>



<a name="1529707"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529707" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529707">(Mar 21 2023 at 21:31)</a>:</h4>
<p>Ah.... Should I be using that instead of <code>./manage.py export</code>?</p>



<a name="1529708"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529708" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529708">(Mar 21 2023 at 21:31)</a>:</h4>
<p>If you're just switching the hardware for your Zulip server, you want the backup tool.</p>



<a name="1529710"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529710" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529710">(Mar 21 2023 at 21:32)</a>:</h4>
<p>I'm moving from directly installed on a ubuntu VM to using zulip-docker....</p>



<a name="1529712"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529712" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529712">(Mar 21 2023 at 21:32)</a>:</h4>
<p>(We should debug why you're getting duplicate huddles in your export object, since the export tool should Just Work too)</p>



<a name="1529713"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529713" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529713">(Mar 21 2023 at 21:33)</a>:</h4>
<p>Yeah, for that you want to use the backup tool -- it has many fewer moving parts since it's doing a fundamentally much simpler thing.</p>



<a name="1529714"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529714" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529714">(Mar 21 2023 at 21:33)</a>:</h4>
<p>I can show you the error received without any modifications to <code>realm.json</code>too....</p>



<a name="1529715"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529715" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529715">(Mar 21 2023 at 21:33)</a>:</h4>
<p>This is directly using export -&gt; import.... No changes to anything</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@34d969bd7a0e:/home/zulip/deployments/current#<span class="w"> </span>su<span class="w"> </span>-c<span class="w"> </span><span class="s2">"./manage.py import '' /transfer/zulip"</span><span class="w"> </span>zulip
Processing<span class="w"> </span>dump:<span class="w"> </span>/transfer/zulip<span class="w"> </span>...
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:11.987<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Importing<span class="w"> </span>realm<span class="w"> </span>dump<span class="w"> </span>/transfer/zulip
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:11.988<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Importing<span class="w"> </span>realm<span class="w"> </span>data<span class="w"> </span>from<span class="w"> </span>/transfer/zulip/realm.json
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:12.288<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.UserGroup'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_usergroup.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:12.393<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>imported<span class="w"> </span>&lt;class<span class="w"> </span><span class="s1">'zerver.models.Stream'</span>&gt;<span class="w"> </span>from<span class="w"> </span>zerver_stream.
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:12.403<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span>
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:12.406<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">6</span>
<span class="m">2023</span>-03-21<span class="w"> </span><span class="m">21</span>:26:12.408<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Adding<span class="w"> </span>to<span class="w"> </span>ID<span class="w"> </span>map:<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span>
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"./manage.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">151</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>execute_from_command_line<span class="o">(</span>sys.argv<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"./manage.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">116</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute_from_command_line
<span class="w">    </span>utility.execute<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">440</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span>self.fetch_command<span class="o">(</span>subcommand<span class="o">)</span>.run_from_argv<span class="o">(</span>self.argv<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">402</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run_from_argv
<span class="w">    </span>self.execute<span class="o">(</span>*args,<span class="w"> </span>**cmd_options<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/core/management/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">448</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>execute
<span class="w">    </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.handle<span class="o">(</span>*args,<span class="w"> </span>**options<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/management/commands/import.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">99</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>handle
<span class="w">    </span>do_import_realm<span class="o">(</span>path,<span class="w"> </span>subdomain,<span class="w"> </span>num_processes<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1049</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_import_realm
<span class="w">    </span><span class="nv">user_profiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>UserProfile<span class="o">(</span>**item<span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span>data<span class="o">[</span><span class="s2">"zerver_userprofile"</span><span class="o">]]</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/zerver/lib/import_realm.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">1049</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;listcomp&gt;
<span class="w">    </span><span class="nv">user_profiles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>UserProfile<span class="o">(</span>**item<span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>item<span class="w"> </span><span class="k">in</span><span class="w"> </span>data<span class="o">[</span><span class="s2">"zerver_userprofile"</span><span class="o">]]</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">541</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__init__
<span class="w">    </span>_setattr<span class="o">(</span>self,<span class="w"> </span>field.name,<span class="w"> </span>rel_obj<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/django/db/models/fields/related_descriptors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">235</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__set__
<span class="w">    </span>raise<span class="w"> </span>ValueError<span class="o">(</span>
ValueError:<span class="w"> </span>Cannot<span class="w"> </span>assign<span class="w"> </span><span class="s2">"2999"</span>:<span class="w"> </span><span class="s2">"UserProfile.recipient"</span><span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>a<span class="w"> </span><span class="s2">"Recipient"</span><span class="w"> </span>instance.
</code></pre></div>



<a name="1529717"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529717" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529717">(Mar 21 2023 at 21:34)</a>:</h4>
<p>I had started messing around with <code>realm.json</code> after I found this post... <a href="https://github.com/zulip/zulip/issues/19912">https://github.com/zulip/zulip/issues/19912</a></p>



<a name="1529719"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529719" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529719">(Mar 21 2023 at 21:34)</a>:</h4>
<p>which lead to the issue with duplicate huddles</p>



<a name="1529730"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529730" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529730">(Mar 21 2023 at 21:38)</a>:</h4>
<p>I don't recommend modifying <code>realm.json</code> manually at all; it has a very complex set of invariants that it expects and being impossible to import is a quite likely failure mode from doing so.</p>



<a name="1529733"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529733" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529733">(Mar 21 2023 at 21:40)</a>:</h4>
<p>Understandable! In that case, what ever happened when the <code>./manage.py delete_user</code> command was run, it caused the error: <code>ValueError: Cannot assign "2999": "UserProfile.recipient" must be a "Recipient" instance.</code> and prevents the import.</p>



<a name="1529734"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529734" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529734">(Mar 21 2023 at 21:40)</a>:</h4>
<p>I've just started a backup using the backup command too... Hopefully this will work vs the export command!</p>



<a name="1529740"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529740" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529740">(Mar 21 2023 at 21:41)</a>:</h4>
<p>What version are you on? A previous version of the <code>delete_user</code> management command didn't handle cleaning up <code>Recipient</code> objects properly.</p>



<a name="1529744"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529744" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529744">(Mar 21 2023 at 21:43)</a>:</h4>
<p>6.1</p>



<a name="1529745"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529745" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529745">(Mar 21 2023 at 21:43)</a>:</h4>
<p>Updated last saturday (just hours before I did the export)</p>



<a name="1529746"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529746" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529746">(Mar 21 2023 at 21:44)</a>:</h4>
<p>(sorry I can't be more specific about the version. I've stopped the server to do this backup)</p>



<a name="1529750"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529750" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529750">(Mar 21 2023 at 21:45)</a>:</h4>
<p>6.1 is a precise version, so that's all there is to know.</p>



<a name="1529751"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529751" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529751">(Mar 21 2023 at 21:46)</a>:</h4>
<p>OK maybe as a follow-up, <span class="user-mention" data-user-id="10349">@Mateusz Mandera</span> can look at whether we can reproduce an issue doing an export/import sequence after deleting a user with <code>manage.py delete_user</code> -- that seems like something we should be able to reproduce in a development environment if it's broken.</p>



<a name="1529752"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529752" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529752">(Mar 21 2023 at 21:47)</a>:</h4>
<p>Ok. Do you think the backup command will work versus the export?</p>



<a name="1529756"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529756" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529756">(Mar 21 2023 at 21:50)</a>:</h4>
<p>..... or an undelete command :P :D</p>



<a name="1529819"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529819" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529819">(Mar 21 2023 at 22:34)</a>:</h4>
<p>The backup command transfers a SQL database dump, so yes it will work if the original server works.</p>



<a name="1529850"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529850" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529850">(Mar 21 2023 at 23:01)</a>:</h4>
<p>Just waiting on the final step now......... fingers crossed!!!</p>



<a name="1529851"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529851" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529851">(Mar 21 2023 at 23:01)</a>:</h4>
<p><a href="/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png" title="image.png"><img src="/user_uploads/2/81/34fzg90Kgs9m_Rrp0qYv67Ch/image.png"></a></div>



<a name="1529954"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529954" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529954">(Mar 21 2023 at 23:58)</a>:</h4>
<p>Not sure if I did something wrong or if the restore-backup script just isn't compatible with a dockerised version of Zulip</p>



<a name="1529955"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529955" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529955">(Mar 21 2023 at 23:59)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@a1a408393315:/home/zulip/deployments/current#<span class="w"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup<span class="w"> </span>--keep-settings<span class="w"> </span>/transfer/backup.tar.gz
+<span class="w"> </span>tar<span class="w"> </span>--directory<span class="o">=</span>/etc/zulip<span class="w"> </span>--exclude<span class="o">=</span>settings.py<span class="w"> </span>--strip-components<span class="o">=</span><span class="m">2</span><span class="w"> </span>-xz<span class="w"> </span>zulip-backup/settings
+<span class="w"> </span>tar<span class="w"> </span>-C<span class="w"> </span>/tmp/zulip-restore-backup-h4__7d79<span class="w"> </span><span class="s1">'--transform=s|^zulip-backup/zproject(/.*)?$|/home/zulip/deployments/2023-01-23-18-51-59/zproject\1|x'</span><span class="w"> </span><span class="s1">'--transform=s|^zulip-backup/uploads(/.*)?$|/home/zulip/uploads\1|x'</span><span class="w"> </span>-xPz
+<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>zulip<span class="w"> </span>--<span class="w"> </span>/tmp/zulip-restore-backup-h4__7d79
+<span class="w"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/setup/terminate-psql-sessions<span class="w"> </span>zulip
Password<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span>zulip:
<span class="w"> </span>pg_terminate_backend
----------------------
<span class="o">(</span><span class="m">0</span><span class="w"> </span>rows<span class="o">)</span>

+<span class="w"> </span>dropdb<span class="w"> </span>--if-exists<span class="w"> </span>--<span class="w"> </span>zulip
Password:
+<span class="w"> </span>createdb<span class="w"> </span>--owner<span class="o">=</span>zulip<span class="w"> </span>--template<span class="o">=</span>template0<span class="w"> </span>--<span class="w"> </span>zulip
Password:
+<span class="w"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/setup/generate_secrets.py<span class="w"> </span>--production
generate_secrets:<span class="w"> </span>No<span class="w"> </span>new<span class="w"> </span>secrets<span class="w"> </span>to<span class="w"> </span>generate.
+<span class="w"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/zulip-puppet-apply<span class="w"> </span>-f
Notice:<span class="w"> </span>Compiled<span class="w"> </span>catalog<span class="w"> </span><span class="k">for</span><span class="w"> </span>a1a408393315.ap-southeast-2.compute.internal<span class="w"> </span><span class="k">in</span><span class="w"> </span>environment<span class="w"> </span>production<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.38<span class="w"> </span>seconds
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Supervisor/File<span class="o">[</span>/etc/supervisor/conf.d/zulip/cron.conf<span class="o">]</span>/ensure:<span class="w"> </span>removed
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Supervisor/File<span class="o">[</span>/etc/supervisor/conf.d/zulip/nginx.conf<span class="o">]</span>/ensure:<span class="w"> </span>removed
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Tornado_sharding/File<span class="o">[</span>/etc/zulip/nginx_sharding_map.conf<span class="o">]</span>/owner:<span class="w"> </span>owner<span class="w"> </span>changed<span class="w"> </span><span class="s1">'zulip'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'root'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Tornado_sharding/File<span class="o">[</span>/etc/zulip/nginx_sharding_map.conf<span class="o">]</span>/group:<span class="w"> </span>group<span class="w"> </span>changed<span class="w"> </span><span class="s1">'zulip'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'root'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::App_frontend_base/File<span class="o">[</span>/etc/supervisor/conf.d/zulip/zulip.conf<span class="o">]</span>/content:<span class="w"> </span>content<span class="w"> </span>changed<span class="w"> </span><span class="s1">'{md5}8e41b39279b57e6632a2770bab4a4146'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'{md5}c7e9a57790ae9fa768c3c3cfa389c226'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::App_frontend_base/File<span class="o">[</span>/etc/zulip/uwsgi.ini<span class="o">]</span>/owner:<span class="w"> </span>owner<span class="w"> </span>changed<span class="w"> </span><span class="s1">'zulip'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'root'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::App_frontend_base/File<span class="o">[</span>/etc/zulip/uwsgi.ini<span class="o">]</span>/group:<span class="w"> </span>group<span class="w"> </span>changed<span class="w"> </span><span class="s1">'zulip'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'root'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::App_frontend/File<span class="o">[</span>/etc/nginx/sites-available/zulip-enterprise<span class="o">]</span>/content:<span class="w"> </span>content<span class="w"> </span>changed<span class="w"> </span><span class="s1">'{md5}900cbcd59f54369f384db7529dd08383'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'{md5}43727fea292bfbeac7bab6a419ad7d95'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Exec<span class="o">[</span>disable_logrotate<span class="o">]</span>/returns:<span class="w"> </span>executed<span class="w"> </span>successfully
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_base/File<span class="o">[</span>/usr/lib/nagios/plugins/zulip_postgresql<span class="o">]</span>/ensure:<span class="w"> </span>created
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_base/File<span class="o">[</span>/usr/lib/nagios/plugins/zulip_postgresql/check_postgresql_replication_lag<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}8ec134e6719bd7d6248e591a31a38241'</span>
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install redis-server'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>redis-server
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/Package<span class="o">[</span>redis-server<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install redis-server'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>redis-server
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/File<span class="o">[</span>/etc/redis/zulip-redis.conf<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>redis-server<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/File<span class="o">[</span>/etc/redis/zulip-redis.conf<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/Exec<span class="o">[</span>redis<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/File<span class="o">[</span>/run/redis<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Redis/Service<span class="o">[</span>redis-server<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install memcached'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>memcached
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Package<span class="o">[</span>memcached<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install memcached'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>memcached
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install sasl2-bin'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>sasl2-bin
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Package<span class="o">[</span>sasl2-bin<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install sasl2-bin'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>sasl2-bin
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/etc/sasl2<span class="o">]</span>/ensure:<span class="w"> </span>created
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/etc/sasl2/memcached-zulip-password<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}b20cf040abea69dbb0d0cd2cdb5a1aed'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/var/lib/zulip/memcached-sasldb2.stamp<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}c4ca4238a0b923820dcc509a6f75849b'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Exec<span class="o">[</span>generate_memcached_sasldb2<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>memcached<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Exec<span class="o">[</span>generate_memcached_sasldb2<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>sasl2-bin<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Exec<span class="o">[</span>generate_memcached_sasldb2<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/etc/sasl2/memcached-sasldb2<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/etc/sasl2/memcached.conf<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}a7ef879b65cf344ca84245ca49173a7f'</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/etc/memcached.conf<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/File<span class="o">[</span>/run/memcached<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Memcached/Service<span class="o">[</span>memcached<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/File<span class="o">[</span>/etc/rabbitmq<span class="o">]</span>/ensure:<span class="w"> </span>created
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/File<span class="o">[</span>/etc/rabbitmq/rabbitmq.config<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}78b67e45b7a3518c4c3956473edcfaa2'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/File<span class="o">[</span>/etc/rabbitmq/rabbitmq-env.conf<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}93682ee251846935ce4d49e2cadda3f3'</span>
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install erlang-base'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>erlang-base
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Package<span class="o">[</span>erlang-base<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install erlang-base'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>erlang-base
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install rabbitmq-server'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>rabbitmq-server
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Package<span class="o">[</span>rabbitmq-server<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install rabbitmq-server'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>rabbitmq-server
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Exec<span class="o">[</span>epmd<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>erlang-base<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Exec<span class="o">[</span>epmd<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Service<span class="o">[</span>rabbitmq-server<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>rabbitmq-server<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Service<span class="o">[</span>rabbitmq-server<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Rabbitmq/Exec<span class="o">[</span>configure-rabbitmq<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Localhost_sso/File<span class="o">[</span>/etc/nginx/zulip-include/app.d/external-sso.conf<span class="o">]</span>/ensure:<span class="w"> </span>defined<span class="w"> </span>content<span class="w"> </span>as<span class="w"> </span><span class="s1">'{md5}35316c9a5bcad7fd7b24fd9c14760567'</span>
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Nginx/Service<span class="o">[</span>nginx<span class="o">]</span>:<span class="w"> </span>Triggered<span class="w"> </span><span class="s1">'refresh'</span><span class="w"> </span>from<span class="w"> </span><span class="m">4</span><span class="w"> </span>events
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install apache2'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
Package<span class="w"> </span>apache2<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available,<span class="w"> </span>but<span class="w"> </span>is<span class="w"> </span>referred<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>another<span class="w"> </span>package.
This<span class="w"> </span>may<span class="w"> </span>mean<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>is<span class="w"> </span>missing,<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>obsoleted,<span class="w"> </span>or
is<span class="w"> </span>only<span class="w"> </span>available<span class="w"> </span>from<span class="w"> </span>another<span class="w"> </span><span class="nb">source</span>

E:<span class="w"> </span>Package<span class="w"> </span><span class="s1">'apache2'</span><span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>installation<span class="w"> </span>candidate
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Package<span class="o">[</span>apache2<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install apache2'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
Package<span class="w"> </span>apache2<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available,<span class="w"> </span>but<span class="w"> </span>is<span class="w"> </span>referred<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>another<span class="w"> </span>package.
This<span class="w"> </span>may<span class="w"> </span>mean<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>is<span class="w"> </span>missing,<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>obsoleted,<span class="w"> </span>or
is<span class="w"> </span>only<span class="w"> </span>available<span class="w"> </span>from<span class="w"> </span>another<span class="w"> </span><span class="nb">source</span>
</code></pre></div>



<a name="1529956"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529956" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529956">(Mar 21 2023 at 23:59)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>E:<span class="w"> </span>Package<span class="w"> </span><span class="s1">'apache2'</span><span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>installation<span class="w"> </span>candidate
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install libapache2-mod-wsgi-py3'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>libapache2-mod-wsgi-py3
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Package<span class="o">[</span>libapache2-mod-wsgi-py3<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install libapache2-mod-wsgi-py3'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>libapache2-mod-wsgi-py3
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>headers<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>apache2<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>headers<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>proxy<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>proxy_http<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>rewrite<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>ssl<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/Apache2mod<span class="o">[</span>wsgi<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/File<span class="o">[</span>/etc/apache2/ports.conf<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/File<span class="o">[</span>/etc/apache2/sites-available/<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Apache_sso/File<span class="o">[</span>/etc/apache2/sites-available/zulip-sso.example<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install ssl-cert'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
Package<span class="w"> </span>ssl-cert<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available,<span class="w"> </span>but<span class="w"> </span>is<span class="w"> </span>referred<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>another<span class="w"> </span>package.
This<span class="w"> </span>may<span class="w"> </span>mean<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>is<span class="w"> </span>missing,<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>obsoleted,<span class="w"> </span>or
is<span class="w"> </span>only<span class="w"> </span>available<span class="w"> </span>from<span class="w"> </span>another<span class="w"> </span><span class="nb">source</span>

E:<span class="w"> </span>Package<span class="w"> </span><span class="s1">'ssl-cert'</span><span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>installation<span class="w"> </span>candidate
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Snakeoil/Zulip::Safepackage<span class="o">[</span>ssl-cert<span class="o">]</span>/Package<span class="o">[</span>ssl-cert<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install ssl-cert'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
Package<span class="w"> </span>ssl-cert<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>available,<span class="w"> </span>but<span class="w"> </span>is<span class="w"> </span>referred<span class="w"> </span>to<span class="w"> </span>by<span class="w"> </span>another<span class="w"> </span>package.
This<span class="w"> </span>may<span class="w"> </span>mean<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>is<span class="w"> </span>missing,<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>obsoleted,<span class="w"> </span>or
is<span class="w"> </span>only<span class="w"> </span>available<span class="w"> </span>from<span class="w"> </span>another<span class="w"> </span><span class="nb">source</span>

E:<span class="w"> </span>Package<span class="w"> </span><span class="s1">'ssl-cert'</span><span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>installation<span class="w"> </span>candidate
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Snakeoil/Exec<span class="o">[</span>generate-default-snakeoil<span class="o">]</span>:<span class="w"> </span>Dependency<span class="w"> </span>Package<span class="o">[</span>ssl-cert<span class="o">]</span><span class="w"> </span>has<span class="w"> </span>failures:<span class="w"> </span><span class="nb">true</span>
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Snakeoil/Exec<span class="o">[</span>generate-default-snakeoil<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>postgresql-14<span class="o">]</span>/Package<span class="o">[</span>postgresql-14<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/User<span class="o">[</span>postgres<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_base/File<span class="o">[</span>/usr/share/postgresql/14/tsearch_data/en_us.dict<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_base/File<span class="o">[</span>/usr/share/postgresql/14/tsearch_data/en_us.affix<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_base/File<span class="o">[</span>/usr/share/postgresql/14/tsearch_data/zulip_english.stop<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Postgresql/File<span class="o">[</span>/etc/postgresql/14<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Postgresql/File<span class="o">[</span>/etc/postgresql/14/main<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Postgresql/File<span class="o">[</span>/etc/postgresql/14/main/postgresql.conf<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Profile::Postgresql/Exec<span class="o">[</span>pg_ctlcluster<span class="w"> </span><span class="m">14</span><span class="w"> </span>main<span class="w"> </span>restart<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>pgtop<span class="o">]</span>/Package<span class="o">[</span>pgtop<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>hunspell-en-us<span class="o">]</span>/Package<span class="o">[</span>hunspell-en-us<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>check-postgres<span class="o">]</span>/Package<span class="o">[</span>check-postgres<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Warning:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>python3-dateutil<span class="o">]</span>/Package<span class="o">[</span>python3-dateutil<span class="o">]</span>:<span class="w"> </span>Skipping<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>failed<span class="w"> </span>dependencies
Error:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install gettext'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>gettext
Error:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Static_asset_compiler/Zulip::Safepackage<span class="o">[</span>gettext<span class="o">]</span>/Package<span class="o">[</span>gettext<span class="o">]</span>/ensure:<span class="w"> </span>change<span class="w"> </span>from<span class="w"> </span><span class="s1">'purged'</span><span class="w"> </span>to<span class="w"> </span><span class="s1">'present'</span><span class="w"> </span>failed:<span class="w"> </span>Execution<span class="w"> </span>of<span class="w"> </span><span class="s1">'/usr/bin/apt-get -q -y -o DPkg::Options::=--force-confold install gettext'</span><span class="w"> </span>returned<span class="w"> </span><span class="m">100</span>:<span class="w"> </span>Reading<span class="w"> </span>package<span class="w"> </span>lists...
Building<span class="w"> </span>dependency<span class="w"> </span>tree...
Reading<span class="w"> </span>state<span class="w"> </span>information...
E:<span class="w"> </span>Unable<span class="w"> </span>to<span class="w"> </span>locate<span class="w"> </span>package<span class="w"> </span>gettext
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Supervisor/Service<span class="o">[</span>supervisor<span class="o">]</span>:<span class="w"> </span>Triggered<span class="w"> </span><span class="s1">'refresh'</span><span class="w"> </span>from<span class="w"> </span><span class="m">4</span><span class="w"> </span>events
Notice:<span class="w"> </span>Applied<span class="w"> </span>catalog<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.66<span class="w"> </span>seconds

Error<span class="w"> </span>running<span class="w"> </span>a<span class="w"> </span>subcommand<span class="w"> </span>of<span class="w"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup:<span class="w"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/zulip-puppet-apply<span class="w"> </span>-f
Actual<span class="w"> </span>error<span class="w"> </span>output<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>subcommand<span class="w"> </span>is<span class="w"> </span>just<span class="w"> </span>above<span class="w"> </span>this.
</code></pre></div>



<a name="1529962"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529962" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529962">(Mar 22 2023 at 00:00)</a>:</h4>
<p>Run <code>apt-get update</code> and try again.</p>



<a name="1529971"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529971" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529971">(Mar 22 2023 at 00:05)</a>:</h4>
<p>is there a way to "resume" the restore without needing to completely restart the backup? It takes over half a hour to untar and move the uploads directory (I think that's what the bulk of the work is)</p>



<a name="1529975"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529975" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529975">(Mar 22 2023 at 00:08)</a>:</h4>
<p>ah, never mind. Something caused the container to restart, and now the container wont stay up. So I think I will need to rebuild the stack.</p>



<a name="1529995"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1529995" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1529995">(Mar 22 2023 at 00:37)</a>:</h4>
<p>Nope. Still no dice. This time the script failed to restore the database backup using the pg_restore command.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Postgresql_common/Zulip::Safepackage<span class="o">[</span>python3-dateutil<span class="o">]</span>/Package<span class="o">[</span>python3-dateutil<span class="o">]</span>/ensure:<span class="w"> </span>created
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Static_asset_compiler/Zulip::Safepackage<span class="o">[</span>gettext<span class="o">]</span>/Package<span class="o">[</span>gettext<span class="o">]</span>/ensure:<span class="w"> </span>created
Notice:<span class="w"> </span>/Stage<span class="o">[</span>main<span class="o">]</span>/Zulip::Supervisor/Service<span class="o">[</span>supervisor<span class="o">]</span>:<span class="w"> </span>Triggered<span class="w"> </span><span class="s1">'refresh'</span><span class="w"> </span>from<span class="w"> </span><span class="m">4</span><span class="w"> </span>events
Notice:<span class="w"> </span>Applied<span class="w"> </span>catalog<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">224</span>.08<span class="w"> </span>seconds
+<span class="w"> </span>pg_restore<span class="w"> </span>--dbname<span class="o">=</span>zulip<span class="w"> </span>--<span class="w"> </span>/tmp/zulip-restore-backup-iev1kb_u/zulip-backup/database
Password:
pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"postgres"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>ALTER<span class="w"> </span>SCHEMA<span class="w"> </span>public<span class="w"> </span>OWNER<span class="w"> </span>TO<span class="w"> </span>postgres<span class="p">;</span>

pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>USAGE<span class="w"> </span>ON<span class="w"> </span>SCHEMA<span class="w"> </span>zulip<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.analytics_fillstate<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.analytics_installationcount<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.analytics_realmcount<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.analytics_streamcount<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.analytics_usercount<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.auth_group<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.auth_group_permissions<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.auth_permission<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.confirmation_confirmation<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.confirmation_realmcreationkey<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.django_content_type<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.django_migrations<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.django_session<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.django_site<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.fts_update_log<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.otp_static_staticdevice<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.otp_static_statictoken<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.otp_totp_totpdevice<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.social_auth_association<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.social_auth_code<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.social_auth_nonce<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.social_auth_partial<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.social_auth_usersocialauth<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.third_party_api_results<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.two_factor_phonedevice<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_archivedattachment<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_archivedattachment_messages<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_archivedmessage<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_archivedusermessage<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_attachment<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_attachment_messages<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_botconfigdata<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_botstoragedata<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_client<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_customprofilefield<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_customprofilefieldvalue<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_defaultstream<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_defaultstreamgroup<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_defaultstreamgroup_streams<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_emailchangestatus<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_huddle<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_message<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_multiuseinvite<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_multiuseinvite_streams<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_usertopic<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_preregistrationuser<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_preregistrationuser_streams<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_pushdevicetoken<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_reaction<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_realm<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_realmdomain<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_realmauditlog<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_realmemoji<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_realmfilter<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_recipient<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_scheduledemail<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_scheduledmessage<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_service<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_stream<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>


pg_restore:<span class="w"> </span>error:<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>execute<span class="w"> </span>query:<span class="w"> </span>ERROR:<span class="w">  </span>role<span class="w"> </span><span class="s2">"zdata"</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>exist
Command<span class="w"> </span>was:<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>ON<span class="w"> </span>TABLE<span class="w"> </span>zulip.zerver_submessage<span class="w"> </span>TO<span class="w"> </span>zdata<span class="p">;</span>
</code></pre></div>



<a name="1530014"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530014" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530014">(Mar 22 2023 at 01:01)</a>:</h4>
<p>Should the script create <code>postgres</code> and <code>zdata</code> roles? Perhaps I can create them manually prior to running the backup restore script?</p>



<a name="1530054"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530054" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530054">(Mar 22 2023 at 02:52)</a>:</h4>
<p>OK. so, manually creating the postgres and zdata role seems to prevent the pg_restore from failing.</p>
<p>But now the last step of the restart script crashes.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>zulip-workers:zulip_events_user_presence:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:16,166<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip_deliver_scheduled_emails
zulip_deliver_scheduled_emails:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:17,974<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip_deliver_scheduled_messages
zulip_deliver_scheduled_messages:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:19,564<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>process-fts-updates
process-fts-updates:<span class="w"> </span>ERROR<span class="w"> </span><span class="o">(</span>spawn<span class="w"> </span>error<span class="o">)</span>
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">140</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>restart_or_start<span class="o">(</span>worker<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">124</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>restart_or_start
<span class="w">    </span>subprocess.check_call<span class="o">([</span><span class="s2">"supervisorctl"</span>,<span class="w"> </span>our_verb,<span class="w"> </span>service<span class="o">])</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3.8/subprocess.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">364</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>check_call
<span class="w">    </span>raise<span class="w"> </span>CalledProcessError<span class="o">(</span>retcode,<span class="w"> </span>cmd<span class="o">)</span>
subprocess.CalledProcessError:<span class="w"> </span>Command<span class="w"> </span><span class="s1">'['</span>supervisorctl<span class="s1">', '</span>start<span class="s1">', '</span>process-fts-updates<span class="s1">']'</span><span class="w"> </span>returned<span class="w"> </span>non-zero<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>status<span class="w"> </span><span class="m">7</span>.

Error<span class="w"> </span>running<span class="w"> </span>a<span class="w"> </span>subcommand<span class="w"> </span>of<span class="w"> </span>/home/zulip/deployments/current/scripts/setup/restore-backup:<span class="w"> </span>/home/zulip/deployments/2023-01-23-18-51-59/scripts/restart-server
Actual<span class="w"> </span>error<span class="w"> </span>output<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>subcommand<span class="w"> </span>is<span class="w"> </span>just<span class="w"> </span>above<span class="w"> </span>this.
</code></pre></div>



<a name="1530057"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530057" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530057">(Mar 22 2023 at 02:52)</a>:</h4>
<p>Manually triggering the script gives the same result</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@04dd98b7274b:/#<span class="w"> </span>su<span class="w"> </span>-c<span class="w"> </span><span class="s1">'/home/zulip/deployments/current/scripts/restart-server'</span><span class="w"> </span>zulip
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:52,841<span class="w"> </span>restart-server:<span class="w"> </span>Running<span class="w"> </span>syntax<span class="w"> </span>and<span class="w"> </span>database<span class="w"> </span>checks
System<span class="w"> </span>check<span class="w"> </span>identified<span class="w"> </span>no<span class="w"> </span>issues<span class="w"> </span><span class="o">(</span><span class="m">15</span><span class="w"> </span>silenced<span class="o">)</span>.
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:55,982<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_deferred_work
zulip-workers:zulip_events_deferred_work:<span class="w"> </span>stopped
zulip-workers:zulip_events_deferred_work:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:57,735<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_digest_emails
zulip-workers:zulip_events_digest_emails:<span class="w"> </span>stopped
zulip-workers:zulip_events_digest_emails:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:48:59,549<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_email_mirror
zulip-workers:zulip_events_email_mirror:<span class="w"> </span>stopped
zulip-workers:zulip_events_email_mirror:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:01,341<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_email_senders
zulip-workers:zulip_events_email_senders:<span class="w"> </span>stopped
zulip-workers:zulip_events_email_senders:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:03,627<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_embed_links
zulip-workers:zulip_events_embed_links:<span class="w"> </span>stopped
zulip-workers:zulip_events_embed_links:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:05,046<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_embedded_bots
zulip-workers:zulip_events_embedded_bots:<span class="w"> </span>stopped
zulip-workers:zulip_events_embedded_bots:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:06,483<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_error_reports
zulip-workers:zulip_events_error_reports:<span class="w"> </span>stopped
zulip-workers:zulip_events_error_reports:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:08,597<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_invites
zulip-workers:zulip_events_invites:<span class="w"> </span>stopped
zulip-workers:zulip_events_invites:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:10,017<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_missedmessage_emails
zulip-workers:zulip_events_missedmessage_emails:<span class="w"> </span>stopped
zulip-workers:zulip_events_missedmessage_emails:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:11,459<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_missedmessage_mobile_notifications
zulip-workers:zulip_events_missedmessage_mobile_notifications:<span class="w"> </span>stopped
zulip-workers:zulip_events_missedmessage_mobile_notifications:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:12,863<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_outgoing_webhooks
zulip-workers:zulip_events_outgoing_webhooks:<span class="w"> </span>stopped
zulip-workers:zulip_events_outgoing_webhooks:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:14,267<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_user_activity
zulip-workers:zulip_events_user_activity:<span class="w"> </span>stopped
zulip-workers:zulip_events_user_activity:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:16,222<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_user_activity_interval
zulip-workers:zulip_events_user_activity_interval:<span class="w"> </span>stopped
zulip-workers:zulip_events_user_activity_interval:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:18,420<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip-workers:zulip_events_user_presence
zulip-workers:zulip_events_user_presence:<span class="w"> </span>stopped
zulip-workers:zulip_events_user_presence:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:20,584<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip_deliver_scheduled_emails
zulip_deliver_scheduled_emails:<span class="w"> </span>stopped
zulip_deliver_scheduled_emails:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:22,570<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>zulip_deliver_scheduled_messages
zulip_deliver_scheduled_messages:<span class="w"> </span>stopped
zulip_deliver_scheduled_messages:<span class="w"> </span>started
<span class="m">2023</span>-03-22<span class="w"> </span><span class="m">02</span>:49:24,352<span class="w"> </span>restart-server:<span class="w"> </span>Restarting<span class="w"> </span>process-fts-updates
process-fts-updates:<span class="w"> </span>ERROR<span class="w"> </span><span class="o">(</span>spawn<span class="w"> </span>error<span class="o">)</span>
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/current/scripts/restart-server"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">140</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>restart_or_start<span class="o">(</span>worker<span class="o">)</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/current/scripts/restart-server"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">124</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>restart_or_start
<span class="w">    </span>subprocess.check_call<span class="o">([</span><span class="s2">"supervisorctl"</span>,<span class="w"> </span>our_verb,<span class="w"> </span>service<span class="o">])</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/usr/lib/python3.8/subprocess.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">364</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>check_call
<span class="w">    </span>raise<span class="w"> </span>CalledProcessError<span class="o">(</span>retcode,<span class="w"> </span>cmd<span class="o">)</span>
subprocess.CalledProcessError:<span class="w"> </span>Command<span class="w"> </span><span class="s1">'['</span>supervisorctl<span class="s1">', '</span>start<span class="s1">', '</span>process-fts-updates<span class="s1">']'</span><span class="w"> </span>returned<span class="w"> </span>non-zero<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>status<span class="w"> </span><span class="m">7</span>.
</code></pre></div>



<a name="1530058"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530058" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530058">(Mar 22 2023 at 02:54)</a>:</h4>
<p>And the last step of the restore-backup script, the flush memcached also seems to fail (run manually. would need to rerun whole script otherise). Looks like an auth failure, which is likely due to the way I am calling the command, but haven't looked too much into it yet.</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@04dd98b7274b:/#<span class="w"> </span>/home/zulip/deployments/current/scripts/setup/flush-memcached
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/current/scripts/setup/flush-memcached"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">18</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">    </span>bmemcached.Client<span class="o">((</span>cache<span class="o">[</span><span class="s2">"LOCATION"</span><span class="o">]</span>,<span class="o">)</span>,<span class="w"> </span>**cache<span class="o">[</span><span class="s2">"OPTIONS"</span><span class="o">])</span>.flush_all<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/client/mixin.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">95</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>flush_all
<span class="w">    </span>returns.append<span class="o">(</span>server.flush_all<span class="o">(</span><span class="nb">time</span><span class="o">))</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">894</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>flush_all
<span class="w">    </span>self._send<span class="o">(</span>struct.pack<span class="o">(</span>self.HEADER_STRUCT<span class="w"> </span>+
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">247</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_send
<span class="w">    </span>self._open_connection<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">161</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_open_connection
<span class="w">    </span>self._send_authentication<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/b2cdd20dd55ad18cd1e512082a3ec530e6b6ece9/zulip-py3-venv/lib/python3.8/site-packages/bmemcached/protocol.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">322</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_send_authentication
<span class="w">    </span>raise<span class="w"> </span>MemcachedException<span class="o">(</span><span class="s1">'Code: %d Message: %s'</span><span class="w"> </span>%<span class="w"> </span><span class="o">(</span>status,<span class="w"> </span>extra_content<span class="o">)</span>,<span class="w"> </span>status<span class="o">)</span>
bmemcached.exceptions.MemcachedException:<span class="w"> </span><span class="o">(</span><span class="s2">"Code: 32 Message: b'Auth failure.'"</span>,<span class="w"> </span><span class="m">32</span><span class="o">)</span>
</code></pre></div>



<a name="1530059"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530059" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530059">(Mar 22 2023 at 02:54)</a>:</h4>
<p>(did try that last one with both the root and the zulip user. same result...)</p>



<a name="1530060"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530060" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530060">(Mar 22 2023 at 02:56)</a>:</h4>
<p>But the server does actually come up and can be navigated to. But it seems to be a bit glitchy. Off the bat, one of the most obvious issues is that no attachments or images (like the site logo) are loading</p>



<a name="1530061"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530061" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530061">(Mar 22 2023 at 02:57)</a>:</h4>
<p>"Opening" a picture attachment results in a 404</p>



<a name="1530062"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530062" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530062">(Mar 22 2023 at 02:58)</a>:</h4>
<p>It appears the <code>/home/zulip/uploads</code> directory is empty</p>



<a name="1530084"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530084" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530084">(Mar 22 2023 at 04:20)</a>:</h4>
<p><span class="user-mention" data-user-id="26556">@Matthew Strachan</span> the memcached issue is most likely an issue with your Docker configuration -- likely an inconsisnent password given to the two containers for that service.</p>



<a name="1530233"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530233" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530233">(Mar 22 2023 at 08:56)</a>:</h4>
<p>Between the memcached container and the zulip container? I've got it configured to use a password from an .env for those...</p>
<p><a href="/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png">image.png</a> <br>
<a href="/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png" title="image.png"><img src="/user_uploads/2/fe/BNQ8uNTUj6wTFaubcBN6-NUI/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png" title="image.png"><img src="/user_uploads/2/b4/2bs2ve_wKpYVOE_Q5omkZBb0/image.png"></a></div><p>Or is there another location that I've missed?</p>



<a name="1530234"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530234" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530234">(Mar 22 2023 at 08:56)</a>:</h4>
<p>Or does the backup-restore from the old server import a password that I need to change/bring accross?</p>



<a name="1530755"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1530755" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1530755">(Mar 22 2023 at 18:51)</a>:</h4>
<p><span class="user-mention" data-user-id="26556">@Matthew Strachan</span> it might, depending what options you specified to the restore tool; the password does appear in <code>zulip-secrets.conf</code> in the backup tarball.</p>



<a name="1531152"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1531152" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1531152">(Mar 23 2023 at 01:44)</a>:</h4>
<p>Ok, I'll take a look at that. I had specified <code>--keep-settings</code> on the restore tool, as I had already configured settings.py on the new server. I'll take a look at the secrets.conf file incase its pulled in the old memcached creds</p>



<a name="1531182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1531182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1531182">(Mar 23 2023 at 03:51)</a>:</h4>
<p>zulip-secrets.conf looked fine. I just restarted the docker stack, and was able to run the <code>./scripts/setup/flush-memcached</code> script fine.</p>



<a name="1531183"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1531183" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1531183">(Mar 23 2023 at 03:54)</a>:</h4>
<p>Interestingly, the missing attachments and images seems to be related to the way the restore script extracts those from the tarball. It puts them into /home/zulip/uploads, but that doesn't persist with docker. I suspect <code>/home/zulip/uploads</code>might be a symlink of <code>/data/uploads</code> and maybe the tar tool doesn't honor the symlink?? That is purely a guess and I have no evidence to that.</p>



<a name="1531184"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1531184" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1531184">(Mar 23 2023 at 03:57)</a>:</h4>
<p>From within the zulip container, if I manually create a file in /home/zulip/uploads, I can see if reflected in both the /data/uploads directory on the container, and within the zulip/uploads directory in the docker volume. However, when I run the tar tool, it only appears in /home/zulip/uploads in the container. Modifying the tar command seems to fix this:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>tar<span class="w"> </span>-v<span class="w"> </span>-C<span class="w"> </span>/tmp/zulip-backup<span class="w"> </span><span class="s1">'--transform=s|^zulip-backup/uploads(/.*)?$|/data/uploads\1|x'</span><span class="w"> </span>-xPz<span class="w"> </span>-f<span class="w"> </span>/transfer/backup.tar.gz
</code></pre></div>



<a name="1531185"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1531185" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Matthew Strachan <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1531185">(Mar 23 2023 at 03:58)</a>:</h4>
<p>Long story short... I've now been able to manage half a dozen successful backups and restores in a staging environment, and have a process down pat that seems to work each time...</p>



<a name="1532112"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1532112" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1532112">(Mar 23 2023 at 23:57)</a>:</h4>
<p>This topic was moved here from <a class="stream-topic" data-stream-id="9" href="/#narrow/stream/9-issues/topic/Migration.20between.20servers">#issues &gt; Migration between servers</a> by <span class="user-mention silent" data-user-id="7">Tim Abbott</span>.</p>



<a name="1532115"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Migration%20between%20servers/near/1532115" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Migration.20between.20servers.html#1532115">(Mar 23 2023 at 23:58)</a>:</h4>
<p><span class="user-mention" data-user-id="26556">@Matthew Strachan</span> moved this here since that's where we usually track production issues, but that symlink issue sounds like a very plausible issue that might exist.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>