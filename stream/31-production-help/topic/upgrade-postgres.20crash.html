<html>
<head><meta charset="utf-8"><title>upgrade-postgres crash · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html">upgrade-postgres crash</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1207647"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207647" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207647">(Jun 12 2021 at 07:25)</a>:</h4>
<p>On Ubuntu 18.04 <code>upgrade-postgres</code> is crashing as  it <code>E: Unable to locate package postgresql-12-pgroonga</code></p>



<a name="1207648"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207648" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207648">(Jun 12 2021 at 07:25)</a>:</h4>
<p>I seen this <a href="https://github.com/zulip/zulip/issues/16058">https://github.com/zulip/zulip/issues/16058</a></p>



<a name="1207649"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207649" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207649">(Jun 12 2021 at 07:26)</a>:</h4>
<p>Running Zulip 3.4.</p>



<a name="1207650"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207650" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207650">(Jun 12 2021 at 07:29)</a>:</h4>
<p>I would presume that is connected with a fact that builds in groonda ppa failed and debs are not available</p>



<a name="1207656"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207656" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207656">(Jun 12 2021 at 07:59)</a>:</h4>
<p>"Fixed" it by bumping system to 20.04</p>



<a name="1207662"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1207662" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1207662">(Jun 12 2021 at 08:41)</a>:</h4>
<p>I have feeling that 18.04&gt;20.04, 10-&gt;12 psql update combo (Zulip is still using 3.4 version) broken something with search. No errors anywhere but quality of search results dropped like the stone.</p>



<a name="1208329"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1208329" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1208329">(Jun 14 2021 at 05:38)</a>:</h4>
<p><span class="user-mention" data-user-id="2617">@Paweł Jastrzębski</span> the last step in <a href="https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-from-ubuntu-18-04-bionic-to-20-04-focal">https://zulip.readthedocs.io/en/latest/production/upgrade-or-modify.html#upgrading-from-ubuntu-18-04-bionic-to-20-04-focal</a> is important to make sure the full-text search indexes are working after an upgrade.  (Note the <code>--audit-fts-indexes</code> option.)</p>



<a name="1208333"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1208333" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1208333">(Jun 14 2021 at 05:45)</a>:</h4>
<p>I did it.</p>



<a name="1208652"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1208652" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1208652">(Jun 14 2021 at 16:22)</a>:</h4>
<p><span class="user-mention" data-user-id="2617">@Paweł Jastrzębski</span> ok; I think the next step here is for you to isolate a specific example of a search result that is not working as expected.</p>



<a name="1210212"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1210212" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1210212">(Jun 16 2021 at 06:25)</a>:</h4>
<p>It looks like it started to work correctly after some time. No idea what caused this issue. Thanks for support anyway.</p>



<a name="1210213"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1210213" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1210213">(Jun 16 2021 at 06:25)</a>:</h4>
<p>But I got additional question about psql upgrade.</p>



<a name="1210214"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1210214" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1210214">(Jun 16 2021 at 06:26)</a>:</h4>
<p>If I understand correctly in Zulip 4.x <code>upgrade-postgresql</code> script will try to upgrade to psql 13?</p>



<a name="1210215"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1210215" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1210215">(Jun 16 2021 at 06:27)</a>:</h4>
<p>If yes process  will crash too as <code>postgresql-13-pgroonga</code> don't exist yet.</p>



<a name="1211837"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1211837" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1211837">(Jun 16 2021 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="2617">@Paweł Jastrzębski</span> yes, it will.  How are you checking whether that package exists?  The package you need, with <code>-pgdg</code> in the name, definitely does exist:</p>
<div class="codehilite"><pre><span></span><code>apotzulip@zulip:~$ apt search pgroonga
Sorting... Done
Full Text Search... Done
postgresql-10-pgdg-pgroonga/bionic 2.3.0-1 amd64 [upgradable from: 2.2.8-1]
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-10-pgroonga/bionic 2.3.0-1.ubuntu18.04.1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-11-pgdg-pgroonga/bionic 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-12-pgdg-pgroonga/bionic 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-13-pgdg-pgroonga/bionic 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-9.3-pgroonga/now 2.1.8-2~trusty1 amd64 [residual-config]
  (none)

postgresql-9.5-pgroonga/now 2.2.5-1.ubuntu16.04.1 amd64 [installed,local]
  Fast full-text search plugin for PostgreSQL based on Groonga
</code></pre></div>



<a name="1211838"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1211838" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1211838">(Jun 16 2021 at 21:33)</a>:</h4>
<p>(Though maybe it isn't built for your platform?)</p>



<a name="1211845"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1211845" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1211845">(Jun 16 2021 at 21:38)</a>:</h4>
<p>Probably checked wrong repo. Is Zulip still use Groonga PPA?</p>



<a name="1211853"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1211853" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1211853">(Jun 16 2021 at 21:52)</a>:</h4>
<p>Also I'm talking about <code>focal</code> not <code>bionic</code></p>



<a name="1211960"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1211960" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1211960">(Jun 16 2021 at 23:33)</a>:</h4>
<p>I suspect it should be available for <code>focal</code> as well; that was just the system I had handy.  Note the <code>-pgdg</code> name in the packages -- Zulip now uses Postgres distributed by the Postgres Development Group, not Ubuntu.</p>



<a name="1212110"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212110" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212110">(Jun 17 2021 at 06:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>deb http://apt.postgresql.org/pub/repos/apt/ focal-pgdg main
deb-src http://apt.postgresql.org/pub/repos/apt/ focal-pgdg main

deb http://ppa.launchpad.net/groonga/ppa/ubuntu focal main
deb-src http://ppa.launchpad.net/groonga/ppa/ubuntu focal main
</code></pre></div>



<a name="1212111"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212111" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212111">(Jun 17 2021 at 06:15)</a>:</h4>
<div class="codehilite"><pre><span></span><code>root@balin:/etc/apt/sources.list.d# apt search pgroonga
Sorting... Done
Full Text Search... Done
postgresql-10-pgroonga/now 2.3.0-1.ubuntu18.04.1 amd64 [residual-config]
  (none)

postgresql-12-pgroonga/focal,now 2.3.0-1.ubuntu20.04.1 amd64 [installed]
  Fast full-text search plugin for PostgreSQL based on Groonga
</code></pre></div>



<a name="1212377"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212377" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212377">(Jun 17 2021 at 16:27)</a>:</h4>
<p><span class="user-mention" data-user-id="2617">@Paweł Jastrzębski</span> puzzling; on one of my <code>focal</code> systems, I see this for <code>apt search pgroonga</code>:</p>
<div class="codehilite"><pre><span></span><code>postgresql-10-pgdg-pgroonga/focal 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-11-pgdg-pgroonga/focal,now 2.3.0-1 amd64 [installed]
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-12-pgdg-pgroonga/focal 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-12-pgroonga/focal 2.3.0-1.ubuntu20.04.1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga

postgresql-13-pgdg-pgroonga/focal 2.3.0-1 amd64
  Fast full-text search plugin for PostgreSQL based on Groonga
</code></pre></div>



<a name="1212378"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212378" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212378">(Jun 17 2021 at 16:27)</a>:</h4>
<p>Try doing an <code>apt update</code>?</p>



<a name="1212379"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212379" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212379">(Jun 17 2021 at 16:27)</a>:</h4>
<p>It looks to be the same architecture, which is the other common variable.</p>



<a name="1212394"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212394" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Paweł Jastrzębski <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212394">(Jun 17 2021 at 16:33)</a>:</h4>
<p>If <code>apt update</code> would fix this issue I would not waste your time :-P Anyway it is clearly problem on my end and this issue is out-of-scope for Zulip project so I will not waste more of your time.</p>



<a name="1212398"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212398" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212398">(Jun 17 2021 at 16:34)</a>:</h4>
<p>Yeah, fair enough -- it's just pretty mysterious.</p>



<a name="1212399"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212399" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212399">(Jun 17 2021 at 16:35)</a>:</h4>
<p>One possibility we should consider is that <code>pgroonga</code> upstream removed the package from their repository's registry for unknown reasons and the system I have has it cached?</p>



<a name="1212400"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/upgrade-postgres%20crash/near/1212400" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/upgrade-postgres.20crash.html#1212400">(Jun 17 2021 at 16:35)</a>:</h4>
<p>But I don't have a theory for why they'd do that.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>