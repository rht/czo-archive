<html>
<head><meta charset="utf-8"><title>Error when trying to create first organization · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html">Error when trying to create first organization</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="192173"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192173" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Civilian <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192173">(Apr 24 2017 at 12:46)</a>:</h4>
<p>Hello everyone,<br>
I followed the steps of the Production Installation Guide on a Xenial VM. I had some problem with the SMTP configurations I managed to resolve (I tried to do the organization creation process when the smtp conf was wrong).<br>
Now that I fixed it, I tried to do it again:</p>
<div class="codehilite"><pre><span></span>/home/zulip/deployments/current/manage.py generate_realm_creation_link
One time organization creation link generated
=&gt; Please visit https://[redacted]/create_realm/c33c2194eb962b45a38e9087cc78cf83fcfa7c0f to create the organization
</pre></div>


<p>I opened the link, filled the form with my email and clicked "Create Organization" and I received the following:</p>
<div class="codehilite"><pre><span></span>Hello there.
You recently signed up for Zulip. Awesome!
To complete signup, visit this link below:
    &lt;https://[redacted]/accounts/do_confirm/b0f1159323a7dd99966689b85c8e4fe399193015&gt;
</pre></div>


<p>I clicked on the link and it opened with a 500 internal error from zulip and with the following email sent (I only redacted the IPs):</p>
<div class="codehilite"><pre><span></span>Error generated by Anonymous user (not logged in) on [redacted] deployment

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/exception.py&quot;, line 39, in inner
    response = get_response(request)
  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 249, in _legacy_get_response
    response = self._get_response(request)
  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response
    response = self.process_exception_by_middleware(e, request)
  File &quot;/home/zulip/deployments/2017-04-21-15-49-00/zulip-venv/lib/python2.7/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;./zerver/decorator.py&quot;, line 107, in wrapper
    return func(request, *args, **kwargs)
  File &quot;./zerver/views/registration.py&quot;, line 189, in accounts_register
    org_type = int(form.cleaned_data[&#39;realm_org_type&#39;])
ValueError: invalid literal for int() with base 10: &#39;&#39;

Request info:
- path: /accounts/register/
- POST: {u&#39;full_name&#39;: [u&#39;&#39;], u&#39;csrfmiddlewaretoken&#39;: [u&#39;**********&#39;], u&#39;from_confirmation&#39;: [u&#39;1&#39;], u&#39;key&#39;: [u&#39;**********&#39;]}
- REMOTE_ADDR: &quot;[redacted]&quot;
- QUERY_STRING: &quot;&quot;
- SERVER_NAME: &quot;&quot;
</pre></div>


<p>I have no idea how to troubleshoot that error.<br>
I tried to restart all the services with the same result, the errors.log shows me only this:</p>
<div class="codehilite"><pre><span></span>2017-04-24 03:43:59,969 WARNING  TornadoQueueClient lost connection to RabbitMQ, reconnecting...
2017-04-24 05:37:24,979 WARNING  TornadoQueueClient lost connection to RabbitMQ, reconnecting...
2017-04-24 05:37:26,983 CRITICAL Failed to reconnect to RabbitMQ, retrying...
</pre></div>


<p>But the command <code>supervisorctl status</code> shows that everything is running:</p>
<div class="codehilite"><pre><span></span>process-fts-updates                                             RUNNING   pid 1599, uptime 4:56:52
zulip-django                                                    RUNNING   pid 3390, uptime 0:19:51
zulip-senders:zulip-events-message_sender-0                     RUNNING   pid 3401, uptime 0:19:50
zulip-senders:zulip-events-message_sender-1                     RUNNING   pid 3402, uptime 0:19:50
zulip-senders:zulip-events-message_sender-2                     RUNNING   pid 3403, uptime 0:19:50
zulip-senders:zulip-events-message_sender-3                     RUNNING   pid 3404, uptime 0:19:50
zulip-senders:zulip-events-message_sender-4                     RUNNING   pid 3400, uptime 0:19:50
zulip-tornado                                                   RUNNING   pid 3383, uptime 0:19:53
zulip-workers:zulip-deliver-enqueued-emails                     RUNNING   pid 3432, uptime 0:19:49
zulip-workers:zulip-events-confirmation-emails                  RUNNING   pid 3430, uptime 0:19:49
zulip-workers:zulip-events-digest_emails                        RUNNING   pid 3436, uptime 0:19:49
zulip-workers:zulip-events-email_mirror                         RUNNING   pid 3434, uptime 0:19:49
zulip-workers:zulip-events-embed_links                          RUNNING   pid 3437, uptime 0:19:49
zulip-workers:zulip-events-error_reports                        RUNNING   pid 3431, uptime 0:19:49
zulip-workers:zulip-events-feedback_messages                    RUNNING   pid 3439, uptime 0:19:49
zulip-workers:zulip-events-missedmessage_mobile_notifications   RUNNING   pid 3435, uptime 0:19:49
zulip-workers:zulip-events-missedmessage_reminders              RUNNING   pid 3438, uptime 0:19:49
zulip-workers:zulip-events-signups                              RUNNING   pid 3429, uptime 0:19:49
zulip-workers:zulip-events-slowqueries                          RUNNING   pid 3433, uptime 0:19:49
zulip-workers:zulip-events-user-activity                        RUNNING   pid 3428, uptime 0:19:49
zulip-workers:zulip-events-user-activity-interval               RUNNING   pid 3427, uptime 0:19:49
zulip-workers:zulip-events-user-presence                        RUNNING   pid 3426, uptime 0:19:49
</pre></div>


<p>Thanks in advance for your help.</p>
<p>Best regards, <br>
Civilian</p>



<a name="192200"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192200" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192200">(Apr 24 2017 at 16:22)</a>:</h4>
<p><span class="user-mention" data-user-email="jbevieux@alteca.fr" data-user-id="2268">@Civilian</span> I've never seen this before!  It would appear that the problem relates to not having selected an organization type option in the new organization creation form.  I wouldn't expect the form to submit in that case, but it could be a bug I suppose.  Can you try selecting an organization type explicitly?</p>



<a name="192536"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192536" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192536">(Apr 25 2017 at 05:43)</a>:</h4>
<p>That's rather odd, I can't think of ever seeing it not have something selected when I've installed. I could have missed something the couple times I know I messed up the auth, I'll have to pay attention next time. They are standard radio buttons, yes? Which (presumably) would result in one or the other selected.</p>



<a name="192541"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192541" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Civilian <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192541">(Apr 25 2017 at 07:45)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-email="jbevieux@alteca.fr" data-user-id="2268">@Civilian</span> I've never seen this before!  It would appear that the problem relates to not having selected an organization type option in the new organization creation form.  I wouldn't expect the form to submit in that case, but it could be a bug I suppose.  Can you try selecting an organization type explicitly?</p>
<p>That's rather odd, I can't think of ever seeing it not have something selected when I've installed. I could have missed something the couple times I know I messed up the auth, I'll have to pay attention next time. They are standard radio buttons, yes? Which (presumably) would result in one or the other selected.</p>
</blockquote>
<p>Thanks for the replies, <br>
No I don't see any radio button and I can't select an organization type:<br>
<a href="https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png" target="_blank" title="https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png">https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png</a></p>
<p>Here is the DOM for the form I have:</p>
<div class="codehilite"><pre><span></span>&lt;form class=&quot;form-inline&quot; id=&quot;send_confirm&quot; name=&quot;email_form&quot; action=&quot;/create_realm/9e8cf05bc67e7df7a165a80c401369cec5ca9c9c&quot; method=&quot;post&quot; novalidate=&quot;novalidate&quot; _lpchecked=&quot;1&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot; value=&quot;OFSeDqMONtSnSunXLt1qwGCqwwlQPec6hqu1ixsCabBMInWCUAcKbJQiiYbKM4BK&quot;&gt;
    &lt;input type=&quot;text&quot; class=&quot;email required&quot; placeholder=&quot;Enter your work email address&quot; id=&quot;email&quot; name=&quot;email&quot; aria-required=&quot;true&quot;&gt;
    &lt;input type=&quot;submit&quot; class=&quot;new-organization-button btn btn-primary btn-large register-button&quot; value=&quot;Create organization&quot;&gt;
&lt;/form&gt;
</pre></div>


<p>I get the error after typing my email and submitting this form.<br>
I can attach the install.log if needed (production install on xenial vm, auto-signed cert, only ip address (no domain yet) and using ldap auth).</p>
<div class="message_inline_image"><a href="https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png" target="_blank" title="https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png"><img src="https://i.gyazo.com/d56af16bd160b5baf29e8f84bb349a12.png"></a></div>



<a name="192581"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192581" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192581">(Apr 25 2017 at 15:27)</a>:</h4>
<p>The first page, you should see the field to enter your email and the button. The next one, where you fill in your name, password, is where there are organization types. The link for that is in the email you should have gotten after providing your email. If everything were working correctly, at any rate.<br>
<a href="/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png" target="_blank" title="Screen-Shot-2017-04-25-at-8.24.13.png">Screen-Shot-2017-04-25-at-8.24.13.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png" target="_blank" title="Screen-Shot-2017-04-25-at-8.24.13.png"><img src="/user_uploads/2/e9/KsvBNCa3HELnWV7R21MaRe5w/Screen-Shot-2017-04-25-at-8.24.13.png"></a></div>



<a name="192582"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192582" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192582">(Apr 25 2017 at 15:33)</a>:</h4>
<p>The status should show all the processes up for about the same time (at least until the scheduled restart that happens once a week.) That most (but not all) of yours have very small uptime seems unexpected. I get that sometimes when rabbitmq is misbehaving. It goes away after I restart it. (<code>/etc/init.d/rabbitmq-server restart</code>)</p>



<a name="192583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/192583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#192583">(Apr 25 2017 at 15:35)</a>:</h4>
<p>I don't have a test environment set up without a proper domain name, so maybe it's something there. (I do have a current task to test something with a self-signed cert, so actually am going to get to it shortly.)</p>



<a name="193198"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193198" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Civilian <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193198">(Apr 26 2017 at 17:20)</a>:</h4>
<p>Thanks but the problem occurs after the 1st page when I try to confirm my account from the link sent by mail.<br>
I created a new xenial VM and did the whole setup process again but again with the same problem.<br>
I just found that I have the exact same issue than: <a href="https://github.com/zulip/zulip/issues/96" target="_blank" title="https://github.com/zulip/zulip/issues/96">https://github.com/zulip/zulip/issues/96</a></p>
<p>By inspecting the install.log (attached) I can see there are permissions error but the install script didn't report them at the end of it.<br>
in the guide it says I had to do this: <br>
<code>su zulip -c /home/zulip/deployments/current/scripts/setup/initialize-database</code><br>
But it was asking me for the zulip user's password but I don't know what it is.<br>
So for that step I instead did:</p>
<div class="codehilite"><pre><span></span>su zulip
/home/zulip/deployments/current/scripts/setup/initialize-database
</pre></div>


<p>And it worked (said ok for every steps).</p>
<p>I tried to fix the rabbitmq permissions like suggested in the issue:</p>
<div class="codehilite"><pre><span></span>scripts/setup/configure-rabbitmq
</pre></div>


<p>But it asked me for the zulip user's password again (tried the rabbitmq_password value from secrets but didn't work).</p>
<p>Thanks in advance.<br>
Best regards,<br>
Civilian</p>
<p><a href="/user_uploads/2/ff/lcgzMPzVK925a4287acNI8fz/install.log" target="_blank" title="install.log">install.log</a></p>



<a name="193241"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193241" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193241">(Apr 26 2017 at 18:25)</a>:</h4>
<p>Hmm, the install log looks to be a clear install</p>



<a name="193242"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193242" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193242">(Apr 26 2017 at 18:25)</a>:</h4>
<p>I can't really help debug the commands you're posting, since you don't show what use you're running them as</p>



<a name="193243"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193243" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193243">(Apr 26 2017 at 18:25)</a>:</h4>
<p>If you get prompted for a user's password, that's probably because you ran something not as root that you should have run as root</p>



<a name="193244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193244">(Apr 26 2017 at 18:26)</a>:</h4>
<p>The <code>zulip</code> user doesn't have a password; it's only accessed via <code>su</code></p>



<a name="193245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193245">(Apr 26 2017 at 18:26)</a>:</h4>
<p>from the root user</p>



<a name="193246"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/193246" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#193246">(Apr 26 2017 at 18:26)</a>:</h4>
<p><a href="https://github.com/zulip/zulip/pull/96" target="_blank" title="https://github.com/zulip/zulip/pull/96">#96</a> has a few issues discussed; are you having the rabbitmq one or the email one <span class="user-mention" data-user-email="jbevieux@alteca.fr" data-user-id="2268">@Civilian</span>?</p>



<a name="194558"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Error%20when%20trying%20to%20create%20first%20organization/near/194558" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Andrea  Longo <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Error.20when.20trying.20to.20create.20first.20organization.html#194558">(May 01 2017 at 03:48)</a>:</h4>
<p>Prod is working fine on my 14.04 VM with only an ip address (and also a self-signed cert.) I don't have 16.04 or LDAP conveniently available for testing.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>