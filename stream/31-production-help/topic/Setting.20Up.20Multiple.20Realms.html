<html>
<head><meta charset="utf-8"><title>Setting Up Multiple Realms · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html">Setting Up Multiple Realms</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="637085"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637085" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637085">(Aug 22 2018 at 12:56)</a>:</h4>
<p>Hi! I've setup Zulip 1.8.1 on a DigitalOcean droplet and so far, the root-Realm is working perfectly with my domain. However, I'd like to add a few more organizations/realms now (they should be subdomains of my main domain), but I can't quite figure out how to do it.</p>
<p>The documentation doesn't really help, as it points to using LetsEncrypt commands, which I'm unfamiliar with since I just use the --certbot command in the Install Script.</p>
<p>I tried generating a new server URL via manage.py, and although I was able to go through the form, when it came time to redirect to the new organization's interface, I get a 'Server Not Found' error.</p>
<p>Any help?</p>



<a name="637404"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637404" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637404">(Aug 22 2018 at 19:07)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> this isn't a flow a lot of folks do (most users just run one organization), but I'd be happy to work with you on clearing this up and updating the documentation.  The main tricky bit for this is that you need to get SSL certificates covering the domains you're going to use.</p>



<a name="637405"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637405" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637405">(Aug 22 2018 at 19:07)</a>:</h4>
<p>Do you have a fixed list of &lt;5 domains you want?</p>



<a name="637406"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637406" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637406">(Aug 22 2018 at 19:08)</a>:</h4>
<p>If so, you should be able to run something like <code>certbot -d example.com -d a.example.com -d b.example.com -d c.example.com certonly</code> to get the certificate.</p>



<a name="637415"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637415" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637415">(Aug 22 2018 at 19:14)</a>:</h4>
<p>Thanks! What would you suggest I do? I mean, I'm fine with running a few scripts and commands so I can add the subdomains to my saved certificate. I just don't know how to go about that.</p>



<a name="637416"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637416" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637416">(Aug 22 2018 at 19:14)</a>:</h4>
<p>I think it's good to point out that Lets Encrypt now supports wild card certificates with the release of second version. And I am now using it for my server (I have 3 Zulip realms and a few other servers).</p>



<a name="637418"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637418" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637418">(Aug 22 2018 at 19:15)</a>:</h4>
<p>What would be the best way to do so via let's encrypt?</p>



<a name="637419"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637419" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637419">(Aug 22 2018 at 19:16)</a>:</h4>
<p>I think you can just do <code>certbot -d example.com -d *.example.com certonly</code>.</p>



<a name="637424"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637424" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637424">(Aug 22 2018 at 19:17)</a>:</h4>
<p>Ok, I'll try the cerbot command. Using Root, I assume?</p>



<a name="637429"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637429" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637429">(Aug 22 2018 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> yep, you run it as root.</p>



<a name="637430"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637430" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637430">(Aug 22 2018 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="1073">@Shayan Toqraee</span> LetsEncrypt wildcard certs are a pain to get setup still; you have to do this 4-step dance involving your DNS provider.</p>



<a name="637431"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637431" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637431">(Aug 22 2018 at 19:20)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> I keep getting a <em>certbot: command not found</em> error</p>



<a name="637432"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637432" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637432">(Aug 22 2018 at 19:20)</a>:</h4>
<p>So I wouldn't recommend that to someone who has a fixed set of domains they want and can just use the normal certbot.</p>



<a name="637433"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637433" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637433">(Aug 22 2018 at 19:21)</a>:</h4>
<p>I do have a fixed set of domains, so I don't really need wildcards for now</p>



<a name="637434"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637434" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637434">(Aug 22 2018 at 19:21)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> I guess it's installed at this path these days: <code>/usr/local/sbin/certbot-auto</code></p>



<a name="637435"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637435" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637435">(Aug 22 2018 at 19:21)</a>:</h4>
<p>Thanks for the suggestion, though, <span class="user-mention" data-user-id="1073">@Shayan Toqraee</span></p>



<a name="637436"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637436" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Shayan Toqraee <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637436">(Aug 22 2018 at 19:22)</a>:</h4>
<p>I agree <span class="user-mention" data-user-id="7">@Tim Abbott</span> , but I used <a href="http://acme.sh" target="_blank" title="http://acme.sh">acme.sh</a> instead of certbot and it did the DNS check automatically. I don't know whether certbot can also do that.</p>



<a name="637440"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637440" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637440">(Aug 22 2018 at 19:25)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Ok, now I'm feeling really dumb. I did find the certbot-auto file inside /usr/local/sbin , but when I run "certbot-auto" I get an error. When I try to run the command you gave above, I still get command not found</p>



<a name="637442"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637442" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637442">(Aug 22 2018 at 19:26)</a>:</h4>
<p><a href="/user_uploads/2/40/pzuz6IRs0u_yfaPWCgajxghZ/pasted_image.png" target="_blank" title="pasted_image.png">pasted image</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/40/pzuz6IRs0u_yfaPWCgajxghZ/pasted_image.png" target="_blank" title="pasted image"><img data-src-fullsize="/thumbnail?url=user_uploads%2F2%2F40%2Fpzuz6IRs0u_yfaPWCgajxghZ%2Fpasted_image.png&amp;size=full" src="/thumbnail?url=user_uploads%2F2%2F40%2Fpzuz6IRs0u_yfaPWCgajxghZ%2Fpasted_image.png&amp;size=thumbnail"></a></div>



<a name="637455"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637455" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637455">(Aug 22 2018 at 19:34)</a>:</h4>
<p>I don't know how to proceed from there, though. Certbot-auto is a script or program, right? When I ran it, I got an error. And I still don't know where I should be to run the certbot - d <a href="http://subdomain.domain.com" target="_blank" title="http://subdomain.domain.com">subdomain.domain.com</a> certonly command.</p>



<a name="637456"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637456" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637456">(Aug 22 2018 at 19:36)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> I think you need to pass the right mode to it; something like:<br>
<code>./certbot-auto certonly --webroot --webroot-path=/var/lib/zulip/certbot-webroot/ --deploy-hook 'service nginx reload' -d ...</code></p>



<a name="637457"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637457" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637457">(Aug 22 2018 at 19:36)</a>:</h4>
<p>We should probably tweak our <code>scripts/setup/setup-certbot</code> script to support multiple domains, since it sorta handles this for you.</p>



<a name="637472"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637472" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637472">(Aug 22 2018 at 19:41)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="7">@Tim Abbott</span>, I'm sorry but you lost me there. A bit too advanced for me. Is that supposed to be a single command? When do I input my subdomains? Apologies for the no-doubt dumb questions, I'm learning as I go along.</p>



<a name="637476"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637476" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637476">(Aug 22 2018 at 19:43)</a>:</h4>
<p>Yes, a single command.  You put your subdomains as a series of <code>-d</code> arguments at the end (the <code>...</code> was meant to indicate that).</p>



<a name="637480"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637480" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637480">(Aug 22 2018 at 19:47)</a>:</h4>
<p>Ok, thanks. After that, everything should work hunky-dory? Or do I need to do additional steps?</p>



<a name="637488"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637488" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637488">(Aug 22 2018 at 19:51)</a>:</h4>
<p>Ok, the script ran correctly. The only problem is now when I try to open the subdomain (vividhouse.vmgnet.work) I get an error on my browser since it says that the certificate was issued only for 'vmgnet.work', not for 'vividhouse.vmgnet.work'.</p>



<a name="637490"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637490" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637490">(Aug 22 2018 at 19:52)</a>:</h4>
<p>Right, so now following <a href="https://zulip.readthedocs.io/en/latest/production/multiple-organizations.html" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/multiple-organizations.html">https://zulip.readthedocs.io/en/latest/production/multiple-organizations.html</a>, you need to edit the file in <code>/etc/nginx/sites-enabled</code> to make sure it points to your new certificates, and then reload <code>nginx</code></p>



<a name="637492"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637492" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637492">(Aug 22 2018 at 19:53)</a>:</h4>
<p>(I think you should be able to just make some appropriate symlinks and not edit the file at all)</p>



<a name="637508"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637508" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637508">(Aug 22 2018 at 20:02)</a>:</h4>
<p>I actually don't know how to do that (symlinking). Weirdly, it seems only 1 of my subdomains was saved? I mean, under  /etc/letsencrypt/live, I only have /vividhouse.vmgnet.work and /vmgnet.work . None of the other subdomains.</p>
<p>I don't know if this means the other subdomains weren't processed or it's because I had incorrectly created an organization using that subdomain yesterday (and I got the server not found error afterwards).</p>
<p>I thought using something like <code>ln -s /etc/letsencrypt/live/vividhouse.vmgnet.work/privkey.pem /etc/ssl/private/zulip.key</code> from <a href="https://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html" target="_blank" title="https://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html">https://zulip.readthedocs.io/en/1.7.1/ssl-certificates.html</a>, but I got an <code>ln: failed to create symbolic link '/etc/ssl/private/zulip.key': File exists</code></p>



<a name="637532"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637532" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637532">(Aug 22 2018 at 20:11)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> certbot makes single certificate with multiple domains on it in a single file.</p>



<a name="637533"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637533" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637533">(Aug 22 2018 at 20:12)</a>:</h4>
<p>If you do <code>certbot-auto certificates</code> you'll see what each one contains.</p>



<a name="637535"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637535" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637535">(Aug 22 2018 at 20:12)</a>:</h4>
<p>I think one is the one the installer made, and the other is your new one.</p>



<a name="637536"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637536" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637536">(Aug 22 2018 at 20:12)</a>:</h4>
<p><code>ln -nsf</code> is what you want for overwriting a symlink.</p>



<a name="637542"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637542" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637542">(Aug 22 2018 at 20:14)</a>:</h4>
<div class="codehilite"><pre><span></span>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Found the following certs:
  Certificate Name: vividhouse.vmgnet.work
    Domains: vividhouse.vmgnet.work dexeno.vmgnet.work haptic.vmgnet.work tadaima.vmgnet.work
    Expiry Date: 2018-11-20 18:48:15+00:00 (VALID: 89 days)
    Certificate Path: /etc/letsencrypt/live/vividhouse.vmgnet.work/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/vividhouse.vmgnet.work/privkey.pem
  Certificate Name: vmgnet.work
    Domains: vmgnet.work
    Expiry Date: 2018-11-19 11:28:24+00:00 (VALID: 88 days)
    Certificate Path: /etc/letsencrypt/live/vmgnet.work/fullchain.pem
    Private Key Path: /etc/letsencrypt/live/vmgnet.work/privkey.pem
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</pre></div>



<a name="637546"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637546" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637546">(Aug 22 2018 at 20:15)</a>:</h4>
<p>This is what I got. I assume I did it wrong when I did the cerbot command earlier and should have included my root domain as well? So that root-domain + subdomains are all in one cert?</p>



<a name="637549"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637549" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637549">(Aug 22 2018 at 20:16)</a>:</h4>
<p>that I'll overwrite and syslink the cert and pKey of that new certificate to zulip.key?</p>



<a name="637551"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637551" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637551">(Aug 22 2018 at 20:16)</a>:</h4>
<p>Still not sure how I'll be 'telling' nginx about these new certificate, though</p>



<a name="637572"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637572" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637572">(Aug 22 2018 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> , Ok so I ran the certbot-auto command again, and this time expanded it to include my 'root domain'. Then I replaced the symlink to zulip.key and zulip.combined-chain.crt. Then reloaded nginx.</p>
<p>After that, it seems like the subdomains are now working. If I go to 'haptic.vmgnet.work', I get sent to a new page that says "Organization does not exist…" So far so good.</p>
<p>However, when I go to vividhouse.vmgnet.work, I don't get anymore errors, but I get auto-redirected to vmgnet.work.</p>
<p>This might have something to do with the fact that I tried creating a new organization yesterday (using the one-time realm-creation-link), but that process got stuck when I would get an error due to SSL. </p>
<p>Is there any way to 'purge' any records of that aborted organization/realm-creation so I can start from scratch? And that all of our sub-organizations behave similarly?</p>



<a name="637583"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637583" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637583">(Aug 22 2018 at 20:45)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> yep, I think we have docs somewhere on how to purge, but I think it's roughly  running these two as root:</p>
<div class="codehilite"><pre><span></span>scripts/setup/postgres-init-db
su zulip -c /home/zulip/deployments/current/scripts/setup/initialize-database
</pre></div>



<a name="637620"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637620" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Justin Exito <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637620">(Aug 22 2018 at 23:36)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> sorry, I'm stuck again. How does the first command work? I went to <code>/home/zulip/deployments/current/scripts/setup/</code> and then tried <code>postgres-init-db</code>, but I got a command not found</p>



<a name="637621"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637621" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Greg Price <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637621">(Aug 22 2018 at 23:45)</a>:</h4>
<p><span class="user-mention" data-user-id="9271">@Justin Exito</span> In general when you type a command without a <code>/</code> in the name, the shell won't look in the current directory to find the program; it'll only look in the normal places in your <code>$PATH</code>.</p>
<p>That's so that if you happen to have a file with a name like <code>ls</code> or <code>su</code>, you won't get surprised by running that file.</p>
<p>Try <code>./postgres-init-db</code> from that directory. Or <code>/home/zulip/deployments/current/scripts/setup/postgres-init-db</code>, from anywhere.</p>



<a name="637804"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637804" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637804">(Aug 23 2018 at 09:14)</a>:</h4>
<p>I'm struggling a bit with the same issue here - we've got two realms running (one being the root and other being a subdomain mapped to a differend actual domain name) and it indeed seems this isn't really considered in the current configuration scripts; so basically I think I'll have to introduce the different hostnames to nginx and tell it where to find the correct ssl_certificate and ssl_certificate_key for each instead of just having the one 'global' ssl setup in nginx/sites-enabled/zulip-enterprise</p>



<a name="637806"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637806" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637806">(Aug 23 2018 at 09:28)</a>:</h4>
<p>Ok I got ours working so far with a bit of manual editing of the nginx configuration files - I moved the :80 part into one file, the common configuration directives of the SSL site definition into another to be included and then set up two differerent sites with server_name and the ssl_certificate and ssl_certificate_keys corresponding to their hostnames and it seems to work.<br>
I guess I'll next go ahead and just do a little script that will automate this work; call the certbot script with the new hostname and then create the new site entry into the nginx configuration directory for it and voilá I'm all set.</p>



<a name="637999"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/637999" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#637999">(Aug 23 2018 at 17:39)</a>:</h4>
<p><span class="user-mention" data-user-id="9287">@Antti Kanes</span> I think you should be able to do this without changing the <code>nginx</code> config, if you have a single SSL cert that covers all the domains...</p>



<a name="638001"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638001" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638001">(Aug 23 2018 at 17:39)</a>:</h4>
<p>How could I possibly have a single cert that cover all the domains (unless they would be a single domain with subdomains/hosts under it, which would be covered with a wildcard certificate)?</p>



<a name="638002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638002">(Aug 23 2018 at 17:40)</a>:</h4>
<p><span class="user-mention" data-user-id="9287">@Antti Kanes</span> read the discussion above about passing multiple <code>-d</code> options to <code>certbot-auto</code>.</p>



<a name="638004"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638004" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638004">(Aug 23 2018 at 17:40)</a>:</h4>
<p>hmm. true,  that'd indeed create a certificate with all those domains. Interesting thought!</p>



<a name="638006"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638006" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638006">(Aug 23 2018 at 17:41)</a>:</h4>
<p>that's what we do on our web/development servers, but as I tried configuring zulip according to the manuals I ended up creating the certificates with the certbot script provided with zulip - which doesn't support multiple domains as argument</p>



<a name="638008"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638008" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638008">(Aug 23 2018 at 17:42)</a>:</h4>
<p>I guess I could revert back to the original configuration and just replace the certificates with a new combined package.</p>



<a name="638010"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638010" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638010">(Aug 23 2018 at 17:42)</a>:</h4>
<p>lets see.</p>



<a name="638012"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638012" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Antti Kanes <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638012">(Aug 23 2018 at 17:58)</a>:</h4>
<p>well, that did the trick. Thanks !<br>
My mind was just so derailed with the provided script that I didn't see the forest for the trees :). <br>
Also as I set up jitsi on the same server but under yet different host/domain I had to add<br>
 listen 443 default_server;<br>
   server_name _;<br>
into the default configuration so that the zulip server would catch all the other hosts (I recall the original configuration didn't have a server_name set at all; as I'm not familiar with nginx I'm not sure if that's needed or if the default_server just did the trick already, but anyway)</p>



<a name="638017"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/638017" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#638017">(Aug 23 2018 at 18:18)</a>:</h4>
<p>Yeah, we don't set a <code>server_name</code> so the <code>nginx</code> configuration doesn't need to know the hostname.</p>



<a name="818445"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818445" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818445">(Feb 19 2020 at 12:24)</a>:</h4>
<p>Hey guys. I have </p>
<ul>
<li><code>foo</code>.example.com as <code>EXTERNAL_HOST</code></li>
</ul>
<p>and want to add further realms on <em>example.com</em>, like </p>
<ul>
<li><code>bar</code>.example.com.</li>
</ul>
<p>Can I update EXTERNAL_HOST to <code>example.com</code> and add(?) <code>foo</code> as subdomain for <a href="http://example.com" target="_blank" title="http://example.com">example.com</a> without losing data (e.g. database)?</p>



<a name="818451"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818451" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818451">(Feb 19 2020 at 12:41)</a>:</h4>
<p>Doesn't seem to work :/</p>



<a name="818452"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818452" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818452">(Feb 19 2020 at 12:43)</a>:</h4>
<p>Reconfigured EXTERNAL_HOST, restarted zulip, and the foo realm wasn't configured: There is no organisation configured for this subdomain :/</p>



<a name="818454"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818454" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818454">(Feb 19 2020 at 13:03)</a>:</h4>
<p><span class="user-mention" data-user-id="10462">@Mark Kusch</span> Can you show output of <code>manage.py list_realms</code>?</p>



<a name="818455"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818455" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818455">(Feb 19 2020 at 13:04)</a>:</h4>
<p>Oh, and I <em>think</em> you should be able to find your <code>foo</code> realm on <code>example.com</code> now.</p>



<a name="818460"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818460" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818460">(Feb 19 2020 at 13:37)</a>:</h4>
<p>Ah, I see, "string_id" for <a href="http://foo.example.com" target="_blank" title="http://foo.example.com">foo.example.com</a> is empty.</p>



<a name="818461"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818461" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818461">(Feb 19 2020 at 13:39)</a>:</h4>
<p>And the zulipinternal realm has <a href="http://foo.example.com" target="_blank" title="http://foo.example.com">foo.example.com</a> in domain. This would be something I'd have to "fix", I guess.</p>



<a name="818462"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818462" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818462">(Feb 19 2020 at 13:39)</a>:</h4>
<div class="codehilite"><pre><span></span>id    string_id            name                           domain
--    ---------            ----                           ------
1     zulipinternal        None                           https://zulipinternal.foo.example.com
2     &#39;&#39;                   Some foo realm                 https://foo.example.com
</pre></div>



<a name="818464"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818464" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818464">(Feb 19 2020 at 14:02)</a>:</h4>
<p>This is with the <code>EXTERNAL_HOST</code> set to <code>example.com</code>? Can you check <code>/home/zulip/deployments/current/scripts/get-django-setting EXTERNAL_HOST</code>?</p>



<a name="818467"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818467" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818467">(Feb 19 2020 at 15:05)</a>:</h4>
<p>No, this is with EXTERNAL_HOST set to <code>foo.example.com</code>. I'll update the configuration again and check these commands. (Right now the guys are using the chat service and I don't want to interrupt their communication tool...)</p>



<a name="818469"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818469" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818469">(Feb 19 2020 at 15:33)</a>:</h4>
<p><span class="user-mention" data-user-id="10349">@Mateusz Mandera</span>: Thanks a lot for pointing out a few things. A simple </p>
<div class="codehilite"><pre><span></span><span class="k">update</span> <span class="n">zulip</span><span class="mf">.</span><span class="n">zerver_realm</span> <span class="k">SET</span> <span class="n">string_id</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mf">2</span><span class="p">;</span>
</pre></div>


<p>was enough to "fix" my issue.</p>



<a name="818470"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818470" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818470">(Feb 19 2020 at 15:35)</a>:</h4>
<p>Yeah, that should work, I was going to suggest it but was confused by the list_realm result, since I assumed EXTERNAL_HOST=example.com. In general, it's <strong>much</strong> safer to do these manual interventions using the Django ORM rather than direct database queries, but in this case this should be completely fine.</p>



<a name="818477"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/Setting%20Up%20Multiple%20Realms/near/818477" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mark Kusch <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/Setting.20Up.20Multiple.20Realms.html#818477">(Feb 19 2020 at 15:50)</a>:</h4>
<p>Only issue now is cookies, I guess. But zulip now behaves exactly like I wanted. &lt;3</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>