<html>
<head><meta charset="utf-8"><title>user_presence timeouts · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html">user_presence timeouts</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="1557917"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557917" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557917">(Apr 28 2023 at 18:22)</a>:</h4>
<p>Hi,</p>
<p>Lately I got this error: [Django] chat: Timed out in user_presence after 30 seconds processing 1 events</p>



<a name="1557918"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557918" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557918">(Apr 28 2023 at 18:23)</a>:</h4>
<p>Deployed code:</p>
<ul>
<li>git: 6.0-1907-ga03dca93ca</li>
<li>ZULIP_VERSION: 6.0-1907-ga03dca93ca</li>
</ul>



<a name="1557925"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557925" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557925">(Apr 28 2023 at 18:30)</a>:</h4>
<p>That's not on <code>main</code>.  Can you show <code>/home/zulip/deployments/current/zulip-git-version</code> ?</p>



<a name="1557927"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557927" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557927">(Apr 28 2023 at 18:30)</a>:</h4>
<p>Oh, it's the current tip, I needed to fetch, nevermind.</p>



<a name="1557928"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557928" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557928">(Apr 28 2023 at 18:31)</a>:</h4>
<p>Do you see a stacktrace in <code>/var/log/zulip/errors.log</code> for that?</p>



<a name="1557981"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557981" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557981">(Apr 28 2023 at 19:17)</a>:</h4>
<p>I got even more errors since:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Logger<span class="w"> </span>root,<span class="w"> </span>from<span class="w"> </span>module<span class="w"> </span>zerver.lib.markdown<span class="w"> </span>line<span class="w"> </span><span class="m">2618</span>:
Error<span class="w"> </span>generated<span class="w"> </span>by<span class="w"> </span>Anonymous<span class="w"> </span>user<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="o">)</span><span class="w"> </span>on<span class="w"> </span>chat<span class="w"> </span>deployment

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/markdown/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">2602</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_convert
<span class="w">   </span>rendering_result.rendered_content<span class="w"> </span><span class="o">=</span><span class="w"> </span>timeout<span class="o">(</span><span class="m">5</span>,<span class="w"> </span>lambda:<span class="w"> </span>_md_engine.convert<span class="o">(</span>content<span class="o">))</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/timeout.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">82</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>timeout
<span class="w">   </span>raise<span class="w"> </span>thread.exc_info<span class="o">[</span><span class="m">1</span><span class="o">]</span>.with_traceback<span class="o">(</span>thread.exc_info<span class="o">[</span><span class="m">2</span><span class="o">])</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/timeout.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">54</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run
<span class="w">   </span>self.result<span class="w"> </span><span class="o">=</span><span class="w"> </span>func<span class="o">()</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/markdown/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">2602</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;lambda&gt;
<span class="w">   </span>rendering_result.rendered_content<span class="w"> </span><span class="o">=</span><span class="w"> </span>timeout<span class="o">(</span><span class="m">5</span>,<span class="w"> </span>lambda:<span class="w"> </span>_md_engine.convert<span class="o">(</span>content<span class="o">))</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/core.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">258</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>convert
<span class="w">   </span><span class="nv">newRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>treeprocessor.run<span class="o">(</span>root<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/treeprocessors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">367</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run
<span class="w">   </span>self.__handleInline<span class="o">(</span>text<span class="o">)</span>,<span class="w"> </span>child
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/treeprocessors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">127</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__handleInline
<span class="w">   </span>data,<span class="w"> </span>matched,<span class="w"> </span><span class="nv">startIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.__applyPattern<span class="o">(</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/treeprocessors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">267</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__applyPattern
<span class="w">   </span><span class="k">for</span><span class="w"> </span>match<span class="w"> </span><span class="k">in</span><span class="w"> </span>pattern.getCompiledRegExp<span class="o">()</span>.finditer<span class="o">(</span>data,<span class="w"> </span>startIndex<span class="o">)</span>:
zerver.lib.timeout.TimeoutExpiredError:<span class="w"> </span>Function<span class="w"> </span>call<span class="w"> </span>timed<span class="w"> </span>out.


Deployed<span class="w"> </span>code:
-<span class="w"> </span>git:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca
-<span class="w"> </span>ZULIP_VERSION:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca


Request<span class="w"> </span>info:<span class="w"> </span>none
</code></pre></div>



<a name="1557982"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557982" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557982">(Apr 28 2023 at 19:18)</a>:</h4>
<p>and </p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Logger<span class="w"> </span>root,<span class="w"> </span>from<span class="w"> </span>module<span class="w"> </span>zerver.worker.queue_processors<span class="w"> </span>line<span class="w"> </span><span class="m">380</span>:
Error<span class="w"> </span>generated<span class="w"> </span>by<span class="w"> </span>Anonymous<span class="w"> </span>user<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="o">)</span><span class="w"> </span>on<span class="w"> </span>chat<span class="w"> </span>deployment

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/asgiref/local.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">70</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_get_context_id
<span class="w">   </span><span class="nv">context_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SyncToAsync.launch_map<span class="o">[</span>context_id<span class="o">]</span>
KeyError:<span class="w"> </span>&lt;_MainThread<span class="o">(</span>MainThread,<span class="w"> </span>started<span class="w"> </span><span class="m">139716367423296</span><span class="o">)</span>&gt;

During<span class="w"> </span>handling<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>above<span class="w"> </span>exception,<span class="w"> </span>another<span class="w"> </span>exception<span class="w"> </span>occurred:

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">315</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_consume
<span class="w">   </span>consume_func<span class="o">(</span>events<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">355</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;lambda&gt;
<span class="w">   </span><span class="nv">consume_func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lambda<span class="w"> </span>events:<span class="w"> </span>self.consume<span class="o">(</span>events<span class="o">[</span><span class="m">0</span><span class="o">])</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">564</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>consume
<span class="w">   </span>do_update_user_presence<span class="o">(</span>user_profile,<span class="w"> </span>client,<span class="w"> </span>log_time,<span class="w"> </span>status<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/actions/presence.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">172</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_update_user_presence
<span class="w">   </span>transaction.on_commit<span class="o">(</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/django/db/transaction.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">134</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>on_commit
<span class="w">   </span>get_connection<span class="o">(</span>using<span class="o">)</span>.on_commit<span class="o">(</span>func,<span class="w"> </span>robust<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/django/db/backends/base/base.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">760</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>on_commit
<span class="w">   </span>func<span class="o">()</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/actions/presence.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">173</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;lambda&gt;
<span class="w">   </span>lambda:<span class="w"> </span>send_presence_changed<span class="o">(</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/actions/presence.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">30</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>send_presence_changed
<span class="w">   </span><span class="nv">user_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>active_user_ids<span class="o">(</span>user_profile.realm_id<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/lib/cache.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">146</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>func_with_caching
<span class="w">   </span><span class="nv">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cache_get<span class="o">(</span>key,<span class="w"> </span><span class="nv">cache_name</span><span class="o">=</span>cache_name<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/lib/cache.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">220</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>cache_get
<span class="w">   </span><span class="nv">cache_backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>get_cache_backend<span class="o">(</span>cache_name<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/lib/cache.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">125</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>get_cache_backend
<span class="w">   </span><span class="k">return</span><span class="w"> </span>caches<span class="o">[</span>cache_name<span class="o">]</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/django/utils/connection.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">58</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__getitem__
<span class="w">   </span><span class="k">return</span><span class="w"> </span>getattr<span class="o">(</span>self._connections,<span class="w"> </span><span class="nb">alias</span><span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/asgiref/local.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">101</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__getattr__
<span class="w">   </span><span class="nv">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self._get_storage<span class="o">()</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/asgiref/local.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">81</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_get_storage
<span class="w">   </span><span class="nv">context_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self._get_context_id<span class="o">()</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/asgiref/local.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">70</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_get_context_id
<span class="w">   </span><span class="nv">context_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SyncToAsync.launch_map<span class="o">[</span>context_id<span class="o">]</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">361</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>timer_expired
<span class="w">   </span>raise<span class="w"> </span>WorkerTimeoutError<span class="o">(</span>self.queue_name,<span class="w"> </span>limit,<span class="w"> </span>len<span class="o">(</span>events<span class="o">))</span>
zerver.worker.queue_processors.WorkerTimeoutError:<span class="w"> </span>Timed<span class="w"> </span>out<span class="w"> </span><span class="k">in</span><span class="w"> </span>user_presence<span class="w"> </span>after<span class="w"> </span><span class="m">30</span><span class="w"> </span>seconds<span class="w"> </span>processing<span class="w"> </span><span class="m">1</span><span class="w"> </span>events


Deployed<span class="w"> </span>code:
-<span class="w"> </span>git:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca
-<span class="w"> </span>ZULIP_VERSION:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca


Request<span class="w"> </span>info:<span class="w"> </span>none
</code></pre></div>



<a name="1557984"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557984" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557984">(Apr 28 2023 at 19:20)</a>:</h4>
<p>Respectively: <code>[Django] chat: Timed out in user_presence after 30 seconds processing 1 events</code><br>
and <code>[Django] chat: Function call timed out. </code></p>



<a name="1557986"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557986" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557986">(Apr 28 2023 at 19:20)</a>:</h4>
<p>and this is the details from first error:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Logger<span class="w"> </span>root,<span class="w"> </span>from<span class="w"> </span>module<span class="w"> </span>zerver.worker.queue_processors<span class="w"> </span>line<span class="w"> </span><span class="m">380</span>:
Error<span class="w"> </span>generated<span class="w"> </span>by<span class="w"> </span>Anonymous<span class="w"> </span>user<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="o">)</span><span class="w"> </span>on<span class="w"> </span>chat<span class="w"> </span>deployment

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">315</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_consume
<span class="w">   </span>consume_func<span class="o">(</span>events<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">355</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;lambda&gt;
<span class="w">   </span><span class="nv">consume_func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lambda<span class="w"> </span>events:<span class="w"> </span>self.consume<span class="o">(</span>events<span class="o">[</span><span class="m">0</span><span class="o">])</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">564</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>consume
<span class="w">   </span>do_update_user_presence<span class="o">(</span>user_profile,<span class="w"> </span>client,<span class="w"> </span>log_time,<span class="w"> </span>status<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/actions/presence.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">132</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_update_user_presence
<span class="w">   </span><span class="nv">seconds</span><span class="o">=</span>settings.OFFLINE_THRESHOLD_SECS
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/django/utils/functional.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">292</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__getattribute__
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"_wrapped"</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/zerver/worker/queue_processors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">361</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>timer_expired
<span class="w">   </span>raise<span class="w"> </span>WorkerTimeoutError<span class="o">(</span>self.queue_name,<span class="w"> </span>limit,<span class="w"> </span>len<span class="o">(</span>events<span class="o">))</span>
zerver.worker.queue_processors.WorkerTimeoutError:<span class="w"> </span>Timed<span class="w"> </span>out<span class="w"> </span><span class="k">in</span><span class="w"> </span>user_presence<span class="w"> </span>after<span class="w"> </span><span class="m">30</span><span class="w"> </span>seconds<span class="w"> </span>processing<span class="w"> </span><span class="m">1</span><span class="w"> </span>events


Deployed<span class="w"> </span>code:
-<span class="w"> </span>git:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca
-<span class="w"> </span>ZULIP_VERSION:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca


Request<span class="w"> </span>info:<span class="w"> </span>none
</code></pre></div>



<a name="1557987"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557987" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557987">(Apr 28 2023 at 19:21)</a>:</h4>
<p>How big is this deployment?</p>



<a name="1557988"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557988" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557988">(Apr 28 2023 at 19:22)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span>: Just highlighting this, since it seems like a potential release blocker with the new presence code.</p>



<a name="1557989"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557989" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557989">(Apr 28 2023 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="12178">@Alex Vandiver</span> not big at all, we have maybe 30 users while active 2, and like 10 bots.</p>



<a name="1557990"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557990" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557990">(Apr 28 2023 at 19:24)</a>:</h4>
<p>It was an import from mattermost some years ago</p>



<a name="1557991"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557991" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557991">(Apr 28 2023 at 19:24)</a>:</h4>
<p>was working fine until recently these errors started to pop out</p>



<a name="1557992"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557992" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557992">(Apr 28 2023 at 19:25)</a>:</h4>
<p>Yup, we merged a change to how presence data is calculated recently, which is what I suspect is being the problem.</p>



<a name="1557993"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557993" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557993">(Apr 28 2023 at 19:25)</a>:</h4>
<p>could be, as I see some notifications delayed</p>



<a name="1557994"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557994" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557994">(Apr 28 2023 at 19:26)</a>:</h4>
<p>Well, that's where the timouts are coming from. <span aria-label="smile" class="emoji emoji-1f642" role="img" title="smile">:smile:</span></p>



<a name="1557995"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557995" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557995">(Apr 28 2023 at 19:26)</a>:</h4>
<p>If anything else I can provide to help debug this, let me know.</p>



<a name="1557997"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557997" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557997">(Apr 28 2023 at 19:28)</a>:</h4>
<p>Do you have graphs of CPU load over time?  Any recent regressions in those?</p>



<a name="1557999"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1557999" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1557999">(Apr 28 2023 at 19:29)</a>:</h4>
<p>Yes I do, let me check</p>



<a name="1558000"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558000" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558000">(Apr 28 2023 at 19:30)</a>:</h4>
<p><a href="/user_uploads/2/82/Y7dEOH41b0H7XKM7b0kVfxuI/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/82/Y7dEOH41b0H7XKM7b0kVfxuI/image.png" title="image.png"><img src="/user_uploads/2/82/Y7dEOH41b0H7XKM7b0kVfxuI/image.png"></a></div>



<a name="1558001"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558001" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558001">(Apr 28 2023 at 19:30)</a>:</h4>
<p><a href="/user_uploads/2/8f/w4fsJaH3Q889ukV1_ZlaEBmM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/8f/w4fsJaH3Q889ukV1_ZlaEBmM/image.png" title="image.png"><img src="/user_uploads/2/8f/w4fsJaH3Q889ukV1_ZlaEBmM/image.png"></a></div>



<a name="1558002"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558002" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558002">(Apr 28 2023 at 19:30)</a>:</h4>
<p>Corresponds also to network and disk IO</p>



<a name="1558003"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558003" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558003">(Apr 28 2023 at 19:31)</a>:</h4>
<p>Sure -- how often do you upgrade to latest <code>main</code>?</p>



<a name="1558005"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558005" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558005">(Apr 28 2023 at 19:34)</a>:</h4>
<p>Alternately, can you show:</p>
<div class="codehilite"><pre><span></span><code>grep -C5 &#39;Applying zerver.0443&#39; /var/log/zulip/upgrade.log
</code></pre></div>



<a name="1558007"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558007" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558007">(Apr 28 2023 at 19:35)</a>:</h4>
<p>1 a month or so</p>



<a name="1558010"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558010" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558010">(Apr 28 2023 at 19:36)</a>:</h4>
<p>Hm, OK.  Can you show that grep output?</p>



<a name="1558011"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558011" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558011">(Apr 28 2023 at 19:37)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@chat:/home/ubuntu#<span class="w"> </span>grep<span class="w"> </span>-C5<span class="w"> </span><span class="s1">'Applying zerver.0443'</span><span class="w"> </span>/var/log/zulip/upgrade.log
<span class="w">  </span>Applying<span class="w"> </span>zerver.0438_add_web_mark_read_on_scroll_policy_setting...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0439_fix_deleteduser_email...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0440_realmfilter_url_template...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0441_backfill_realmfilter_url_template...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0442_remove_realmfilter_url_format_string...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0443_userpresence_new_table_schema...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0444_userpresence_fill_data...<span class="w"> </span>OK
<span class="w">  </span>Applying<span class="w"> </span>zerver.0445_drop_userpresenceold...<span class="w"> </span>OK
<span class="m">2023</span>-04-28<span class="w"> </span><span class="m">16</span>:24:27,519<span class="w"> </span>upgrade-zulip-stage-2:<span class="w"> </span>Restarting<span class="w"> </span>Zulip...
<span class="m">2023</span>-04-28<span class="w"> </span><span class="m">16</span>:24:27,572<span class="w"> </span>start-server:<span class="w"> </span>Filling<span class="w"> </span>memcached<span class="w"> </span>caches
<span class="m">2023</span>-04-28<span class="w"> </span><span class="m">16</span>:24:28.256<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span>Successfully<span class="w"> </span>populated<span class="w"> </span>user<span class="w"> </span>cache!<span class="w">  </span>Consumed<span class="w"> </span><span class="m">1</span><span class="w"> </span>remote<span class="w"> </span>cache<span class="w"> </span>queries<span class="w"> </span><span class="o">(</span><span class="m">0</span>.03<span class="w"> </span><span class="nb">time</span><span class="o">)</span>
root@chat:/home/ubuntu#
</code></pre></div>



<a name="1558020"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558020" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558020">(Apr 28 2023 at 19:39)</a>:</h4>
<p>OK, so you <em>just</em> upgraded (3 hours ago) into the version with the new presence code.</p>



<a name="1558024"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558024" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558024">(Apr 28 2023 at 19:40)</a>:</h4>
<p>So showing the last ~6 hours of CPU graph might be helpful, to compare the before and after -- though from what you showed already, I don't think that's smoking gun</p>



<a name="1558025"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558025" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558025">(Apr 28 2023 at 19:40)</a>:</h4>
<p>Yes</p>



<a name="1558026"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558026" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558026">(Apr 28 2023 at 19:40)</a>:</h4>
<p>I do not have longer CPU graph than the one shared</p>



<a name="1558027"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558027" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558027">(Apr 28 2023 at 19:40)</a>:</h4>
<p>Ah, OK</p>



<a name="1558029"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558029" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558029">(Apr 28 2023 at 19:42)</a>:</h4>
<p>In future I will, working on a new monitoring deployment</p>



<a name="1558031"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558031" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558031">(Apr 28 2023 at 19:42)</a>:</h4>
<p>Yet thats the basic from proxmox</p>



<a name="1558032"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558032" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558032">(Apr 28 2023 at 19:42)</a>:</h4>
<p>I just got another timeout</p>



<a name="1558034"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558034" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558034">(Apr 28 2023 at 19:43)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>Logger<span class="w"> </span>root,<span class="w"> </span>from<span class="w"> </span>module<span class="w"> </span>zerver.lib.markdown<span class="w"> </span>line<span class="w"> </span><span class="m">2618</span>:
Error<span class="w"> </span>generated<span class="w"> </span>by<span class="w"> </span>Anonymous<span class="w"> </span>user<span class="w"> </span><span class="o">(</span>not<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="o">)</span><span class="w"> </span>on<span class="w"> </span>chat<span class="w"> </span>deployment

Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/markdown/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">2602</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>do_convert
<span class="w">   </span>rendering_result.rendered_content<span class="w"> </span><span class="o">=</span><span class="w"> </span>timeout<span class="o">(</span><span class="m">5</span>,<span class="w"> </span>lambda:<span class="w"> </span>_md_engine.convert<span class="o">(</span>content<span class="o">))</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/timeout.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">82</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>timeout
<span class="w">   </span>raise<span class="w"> </span>thread.exc_info<span class="o">[</span><span class="m">1</span><span class="o">]</span>.with_traceback<span class="o">(</span>thread.exc_info<span class="o">[</span><span class="m">2</span><span class="o">])</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/timeout.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">54</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run
<span class="w">   </span>self.result<span class="w"> </span><span class="o">=</span><span class="w"> </span>func<span class="o">()</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/home/zulip/deployments/2023-04-28-16-21-09/./zerver/lib/markdown/__init__.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">2602</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;lambda&gt;
<span class="w">   </span>rendering_result.rendered_content<span class="w"> </span><span class="o">=</span><span class="w"> </span>timeout<span class="o">(</span><span class="m">5</span>,<span class="w"> </span>lambda:<span class="w"> </span>_md_engine.convert<span class="o">(</span>content<span class="o">))</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/core.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">258</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>convert
<span class="w">   </span><span class="nv">newRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>treeprocessor.run<span class="o">(</span>root<span class="o">)</span>
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/treeprocessors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">367</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>run
<span class="w">   </span>self.__handleInline<span class="o">(</span>text<span class="o">)</span>,<span class="w"> </span>child
<span class="w"> </span>File<span class="w"> </span><span class="s2">"/srv/zulip-venv-cache/9f78492dcdea0cfa09952b3a23e82955fafa3ea7/zulip-py3-venv/lib/python3.8/site-packages/markdown/treeprocessors.py"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">131</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__handleInline
<span class="w">   </span><span class="nv">patternIndex</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m">1</span>
zerver.lib.timeout.TimeoutExpiredError:<span class="w"> </span>Function<span class="w"> </span>call<span class="w"> </span>timed<span class="w"> </span>out.


Deployed<span class="w"> </span>code:
-<span class="w"> </span>git:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca
-<span class="w"> </span>ZULIP_VERSION:<span class="w"> </span><span class="m">6</span>.0-1907-ga03dca93ca


Request<span class="w"> </span>info:<span class="w"> </span>none
</code></pre></div>



<a name="1558036"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558036" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558036">(Apr 28 2023 at 19:43)</a>:</h4>
<p>Not sure why is sayingg always user Anonymous...</p>



<a name="1558041"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558041" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558041">(Apr 28 2023 at 19:44)</a>:</h4>
<p>Backend processes which time out don't have a user.</p>



<a name="1558045"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558045" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558045">(Apr 28 2023 at 19:45)</a>:</h4>
<p>Right</p>



<a name="1558047"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558047" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558047">(Apr 28 2023 at 19:45)</a>:</h4>
<p>Having things time out left and right is weird if you're not looking CPU-bound.  How's memory consumption?</p>



<a name="1558048"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558048" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558048">(Apr 28 2023 at 19:46)</a>:</h4>
<p>Memory is almost full</p>



<a name="1558049"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558049" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558049">(Apr 28 2023 at 19:46)</a>:</h4>
<p><a href="/user_uploads/2/42/qGW8qOY_Upq8UkTBg1PhOKpE/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/42/qGW8qOY_Upq8UkTBg1PhOKpE/image.png" title="image.png"><img src="/user_uploads/2/42/qGW8qOY_Upq8UkTBg1PhOKpE/image.png"></a></div>



<a name="1558050"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558050" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558050">(Apr 28 2023 at 19:46)</a>:</h4>
<p>These are all from today</p>



<a name="1558053"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558053" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558053">(Apr 28 2023 at 19:46)</a>:</h4>
<p>Do you have swap enabled on the host?  Is any in use?</p>



<a name="1558054"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558054" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558054">(Apr 28 2023 at 19:46)</a>:</h4>
<p><a href="/user_uploads/2/28/B0sEv3hmoBRwUQh5uG7Bfnag/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/28/B0sEv3hmoBRwUQh5uG7Bfnag/image.png" title="image.png"><img src="/user_uploads/2/28/B0sEv3hmoBRwUQh5uG7Bfnag/image.png"></a></div>



<a name="1558055"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558055" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558055">(Apr 28 2023 at 19:47)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>root@chat:/home/ubuntu#<span class="w"> </span>free<span class="w"> </span>-m
<span class="w">              </span>total<span class="w">        </span>used<span class="w">        </span>free<span class="w">      </span>shared<span class="w">  </span>buff/cache<span class="w">   </span>available
Mem:<span class="w">           </span><span class="m">3982</span><span class="w">        </span><span class="m">3619</span><span class="w">         </span><span class="m">125</span><span class="w">         </span><span class="m">135</span><span class="w">         </span><span class="m">238</span><span class="w">          </span><span class="m">46</span>
Swap:<span class="w">             </span><span class="m">0</span><span class="w">           </span><span class="m">0</span><span class="w">           </span><span class="m">0</span>
root@chat:/home/ubuntu#
</code></pre></div>



<a name="1558056"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558056" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558056">(Apr 28 2023 at 19:47)</a>:</h4>
<p>I guess is disabled</p>



<a name="1558057"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558057" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558057">(Apr 28 2023 at 19:47)</a>:</h4>
<p>The server was always fine with 4GB ram, since we do not have much traffic.</p>



<a name="1558085"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558085" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558085">(Apr 28 2023 at 19:55)</a>:</h4>
<p>Since you're seeing timouts from things that aren't the presence codepath, I don't think that's actually to blame.  And slow timeouts when it doesn't look CPU or IO bound smells a little like something happening in hypervisor land -- I'm assuming this is some sort of cloud host?  Maybe try a quick reboot to see if that shakes anything out?</p>



<a name="1558087"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558087" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558087">(Apr 28 2023 at 19:56)</a>:</h4>
<p>This is KVM machine running in my private cloud based on proxmox</p>



<a name="1558088"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558088" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558088">(Apr 28 2023 at 19:56)</a>:</h4>
<p>Il try  a reboot</p>



<a name="1558089"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558089" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558089">(Apr 28 2023 at 19:56)</a>:</h4>
<p>I can't quite tell from timestamps on the emails you showed, but was the first timeout from <em>before</em> you upgraded?</p>



<a name="1558091"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558091" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558091">(Apr 28 2023 at 19:57)</a>:</h4>
<p>I am not sure to say exactly</p>



<a name="1558093"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558093" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558093">(Apr 28 2023 at 19:57)</a>:</h4>
<p>I think they might be all after reboot</p>



<a name="1558094"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558094" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558094">(Apr 28 2023 at 19:57)</a>:</h4>
<p>upgrade sorry</p>



<a name="1558096"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558096" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558096">(Apr 28 2023 at 19:57)</a>:</h4>
<p>Upgrade was at <code>2023-04-28 16:24:27</code> (presumably UTC)</p>



<a name="1558104"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558104" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558104">(Apr 28 2023 at 20:05)</a>:</h4>
<p>So its all after upgrade then</p>



<a name="1558111"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558111" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558111">(Apr 28 2023 at 20:07)</a>:</h4>
<p>Hm, OK, that points back to the upgrade.  But I'm a little stumped on the mechanism of action.</p>



<a name="1558116"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558116" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558116">(Apr 28 2023 at 20:08)</a>:</h4>
<p>Only thing I notice is that the app is also sluggish from time to time, and. increases CPU usage a lot, speaking on my macbook</p>



<a name="1558117"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558117" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558117">(Apr 28 2023 at 20:09)</a>:</h4>
<p><a href="/user_uploads/2/be/CcljyvoUeqieqFDWoijetM-p/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/be/CcljyvoUeqieqFDWoijetM-p/image.png" title="image.png"><img src="/user_uploads/2/be/CcljyvoUeqieqFDWoijetM-p/image.png"></a></div>



<a name="1558120"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558120" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558120">(Apr 28 2023 at 20:10)</a>:</h4>
<p><a href="/user_uploads/2/3c/EVoKL5QE6JXbxBsYsqfD_pIv/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/3c/EVoKL5QE6JXbxBsYsqfD_pIv/image.png" title="image.png"><img src="/user_uploads/2/3c/EVoKL5QE6JXbxBsYsqfD_pIv/image.png"></a></div>



<a name="1558124"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558124" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558124">(Apr 28 2023 at 20:13)</a>:</h4>
<p>Wonder if the app has something to do with it</p>



<a name="1558125"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558125" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558125">(Apr 28 2023 at 20:14)</a>:</h4>
<p>Cause its increasing CPU only by switching users DMs, or changing the server. I have 2 servers only, this and mine.</p>



<a name="1558129"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558129" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558129">(Apr 28 2023 at 20:16)</a>:</h4>
<p><a href="/user_uploads/2/2a/nB3jZp50wPTnlBPOQUmpMYfq/image.png">image.png</a><br>
this is a bit weird.</p>
<div class="message_inline_image"><a href="/user_uploads/2/2a/nB3jZp50wPTnlBPOQUmpMYfq/image.png" title="image.png"><img src="/user_uploads/2/2a/nB3jZp50wPTnlBPOQUmpMYfq/image.png"></a></div>



<a name="1558130"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558130" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558130">(Apr 28 2023 at 20:16)</a>:</h4>
<p>Seems the app might have some Memory leaks and some CPU hogs</p>



<a name="1558135"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558135" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558135">(Apr 28 2023 at 20:21)</a>:</h4>
<p>Virtual memory size doesn't mean anything (my laptop has 10 Chrome tabs over 1TB of virtual memory right now); the real/shared memory sizes are reasonable.</p>



<a name="1558137"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558137" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558137">(Apr 28 2023 at 20:22)</a>:</h4>
<p><span class="user-mention" data-user-id="20576">@Cosmic Sound</span> can you send <code>top</code> output from the server?</p>



<a name="1558140"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558140" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558140">(Apr 28 2023 at 20:24)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>top<span class="w"> </span>-<span class="w"> </span><span class="m">20</span>:23:53<span class="w"> </span>up<span class="w"> </span><span class="m">26</span><span class="w"> </span>min,<span class="w">  </span><span class="m">1</span><span class="w"> </span>user,<span class="w">  </span>load<span class="w"> </span>average:<span class="w"> </span><span class="m">0</span>.01,<span class="w"> </span><span class="m">0</span>.04,<span class="w"> </span><span class="m">0</span>.16
Tasks:<span class="w"> </span><span class="m">225</span><span class="w"> </span>total,<span class="w">   </span><span class="m">1</span><span class="w"> </span>running,<span class="w"> </span><span class="m">224</span><span class="w"> </span>sleeping,<span class="w">   </span><span class="m">0</span><span class="w"> </span>stopped,<span class="w">   </span><span class="m">0</span><span class="w"> </span>zombie
%Cpu<span class="o">(</span>s<span class="o">)</span>:<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>us,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>sy,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>ni,100.0<span class="w"> </span>id,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>wa,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>hi,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>si,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>st
MiB<span class="w"> </span>Mem<span class="w"> </span>:<span class="w">   </span><span class="m">3982</span>.8<span class="w"> </span>total,<span class="w">    </span><span class="m">189</span>.6<span class="w"> </span>free,<span class="w">   </span><span class="m">3531</span>.1<span class="w"> </span>used,<span class="w">    </span><span class="m">262</span>.2<span class="w"> </span>buff/cache
MiB<span class="w"> </span>Swap:<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>total,<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>free,<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>used.<span class="w">    </span><span class="m">154</span>.5<span class="w"> </span>avail<span class="w"> </span>Mem

<span class="w">    </span>PID<span class="w"> </span>USER<span class="w">      </span>PR<span class="w">  </span>NI<span class="w">    </span>VIRT<span class="w">    </span>RES<span class="w">    </span>SHR<span class="w"> </span>S<span class="w">  </span>%CPU<span class="w">  </span>%MEM<span class="w">     </span>TIME+<span class="w"> </span>COMMAND
<span class="w">   </span><span class="m">1350</span><span class="w"> </span>zulip<span class="w">     </span><span class="m">20</span><span class="w">   </span><span class="m">0</span><span class="w"> </span><span class="m">1606856</span><span class="w">   </span><span class="m">9436</span><span class="w">   </span><span class="m">5184</span><span class="w"> </span>S<span class="w">   </span><span class="m">0</span>.3<span class="w">   </span><span class="m">0</span>.2<span class="w">   </span><span class="m">0</span>:03.83<span class="w"> </span>smokescreen-83e
<span class="w">      </span><span class="m">1</span><span class="w"> </span>root<span class="w">      </span><span class="m">20</span><span class="w">   </span><span class="m">0</span><span class="w">  </span><span class="m">168244</span><span class="w">   </span><span class="m">8224</span><span class="w">   </span><span class="m">5008</span><span class="w"> </span>S<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.2<span class="w">   </span><span class="m">0</span>:01.88<span class="w"> </span>systemd
<span class="w">      </span><span class="m">2</span><span class="w"> </span>root<span class="w">      </span><span class="m">20</span><span class="w">   </span><span class="m">0</span><span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>S<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>:00.00<span class="w"> </span>kthreadd
<span class="w">      </span><span class="m">3</span><span class="w"> </span>root<span class="w">       </span><span class="m">0</span><span class="w"> </span>-20<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>I<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>:00.00<span class="w"> </span>rcu_gp
<span class="w">      </span><span class="m">4</span><span class="w"> </span>root<span class="w">       </span><span class="m">0</span><span class="w"> </span>-20<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>I<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>:00.00<span class="w"> </span>rcu_par_gp
<span class="w">      </span><span class="m">6</span><span class="w"> </span>root<span class="w">       </span><span class="m">0</span><span class="w"> </span>-20<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>I<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>:00.00<span class="w"> </span>kworker/0:0H-kblockd
<span class="w">      </span><span class="m">7</span><span class="w"> </span>root<span class="w">      </span><span class="m">20</span><span class="w">   </span><span class="m">0</span><span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>I<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>.0<span class="w">   </span><span class="m">0</span>:00.08<span class="w"> </span>kworker/u16:0-ev
</code></pre></div>



<a name="1558141"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558141" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558141">(Apr 28 2023 at 20:24)</a>:</h4>
<p>This definitely feels like memory pressure or perhaps load on the system. The actual database queries that are timing out are trivial.</p>



<a name="1558142"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558142" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558142">(Apr 28 2023 at 20:24)</a>:</h4>
<p>The server runs only Zulip</p>



<a name="1558145"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558145" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558145">(Apr 28 2023 at 20:27)</a>:</h4>
<p><a href="http://">Uploading image.png…</a></p>



<a name="1558151"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558151" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558151">(Apr 28 2023 at 20:32)</a>:</h4>
<p>Is this normal?<br>
<a href="http://">Uploading image.png…</a></p>



<a name="1558152"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558152" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558152">(Apr 28 2023 at 20:33)</a>:</h4>
<p>Yeah I get too the same issues, when uploading images, they seem like stuck</p>



<a name="1558153"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558153" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558153">(Apr 28 2023 at 20:33)</a>:</h4>
<p>keep on saying uploading...</p>



<a name="1558177"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558177" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558177">(Apr 28 2023 at 20:51)</a>:</h4>
<p><a href="/user_uploads/2/44/XGesneS_CME9BHhU-HTwa7gH/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/2/44/XGesneS_CME9BHhU-HTwa7gH/image.png" title="image.png"><img src="/user_uploads/2/44/XGesneS_CME9BHhU-HTwa7gH/image.png"></a></div>



<a name="1558178"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558178" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558178">(Apr 28 2023 at 20:51)</a>:</h4>
<p>Is this normal?</p>



<a name="1558179"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558179" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558179">(Apr 28 2023 at 20:51)</a>:</h4>
<p>They are even more, cant fit them all in one view</p>



<a name="1558180"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558180" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Alex Vandiver <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558180">(Apr 28 2023 at 20:51)</a>:</h4>
<p>Erlang runs a lot of threads internally, so depending what you're using to show that, it may be normal.</p>



<a name="1558181"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558181" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558181">(Apr 28 2023 at 20:51)</a>:</h4>
<p>I remove snapd, and some remains from it, memory usage is better now.</p>



<a name="1558182"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558182" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558182">(Apr 28 2023 at 20:51)</a>:</h4>
<p>Ok</p>



<a name="1558184"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558184" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Cosmic Sound <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558184">(Apr 28 2023 at 20:52)</a>:</h4>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>top<span class="w"> </span>-<span class="w"> </span><span class="m">20</span>:52:06<span class="w"> </span>up<span class="w"> </span><span class="m">6</span><span class="w"> </span>min,<span class="w">  </span><span class="m">1</span><span class="w"> </span>user,<span class="w">  </span>load<span class="w"> </span>average:<span class="w"> </span><span class="m">0</span>.09,<span class="w"> </span><span class="m">0</span>.49,<span class="w"> </span><span class="m">0</span>.27
Tasks:<span class="w"> </span><span class="m">223</span><span class="w"> </span>total,<span class="w">   </span><span class="m">1</span><span class="w"> </span>running,<span class="w"> </span><span class="m">222</span><span class="w"> </span>sleeping,<span class="w">   </span><span class="m">0</span><span class="w"> </span>stopped,<span class="w">   </span><span class="m">0</span><span class="w"> </span>zombie
%Cpu<span class="o">(</span>s<span class="o">)</span>:<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>us,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>sy,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>ni,<span class="w"> </span><span class="m">99</span>.8<span class="w"> </span>id,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>wa,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>hi,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>si,<span class="w">  </span><span class="m">0</span>.0<span class="w"> </span>st
MiB<span class="w"> </span>Mem<span class="w"> </span>:<span class="w">   </span><span class="m">3982</span>.8<span class="w"> </span>total,<span class="w">    </span><span class="m">153</span>.6<span class="w"> </span>free,<span class="w">   </span><span class="m">3424</span>.0<span class="w"> </span>used,<span class="w">    </span><span class="m">405</span>.2<span class="w"> </span>buff/cache
MiB<span class="w"> </span>Swap:<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>total,<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>free,<span class="w">      </span><span class="m">0</span>.0<span class="w"> </span>used.<span class="w">    </span><span class="m">261</span>.6<span class="w"> </span>avail<span class="w"> </span>Mem
</code></pre></div>



<a name="1558190"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/user_presence%20timeouts/near/1558190" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/user_presence.20timeouts.html#1558190">(Apr 28 2023 at 20:58)</a>:</h4>
<p>The RES column in top is considerably more useful for what to sort by than the virtual memory one.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>