<html>
<head><meta charset="utf-8"><title>backtrace with s3 · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html">backtrace with s3</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="745161"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745161" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Kumria <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745161">(May 23 2019 at 15:44)</a>:</h4>
<p>Hi,</p>
<p>I received a backtrace when someone was trying to login. I'm unclear what the problem is. Should I report the backtrace here on on github ?</p>



<a name="745162"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745162" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745162">(May 23 2019 at 16:10)</a>:</h4>
<p><span class="user-mention" data-user-id="12314">@Anand Kumria</span> you can start here and we can move to github if needed</p>



<a name="745164"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745164" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Kumria <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745164">(May 23 2019 at 16:15)</a>:</h4>
<div class="codehilite"><pre><span></span>Logger django.request, from module django.core.handlers.exception line 135:
Error generated by Anonymous user (not logged in) on zulip.in.here.com deployment

Traceback (most recent call last):
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/exception.py&quot;, line 41, in inner
    response = get_response(request)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 187, in _get_response
    response = self.process_exception_by_middleware(e, request)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/core/handlers/base.py&quot;, line 185, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;./zerver/views/auth.py&quot;, line 647, in login_page
    extra_context=extra_context, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py&quot;, line 54, in inner
    return func(*args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py&quot;, line 150, in login
    )(request)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/base.py&quot;, line 68, in view
    return self.dispatch(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 67, in _wrapper
    return bound_func(*args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/views/decorators/debug.py&quot;, line 76, in sensitive_post_parameters_wrapper
    return view(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 63, in bound_func
    return func.__get__(self, type(self))(*args2, **kwargs2)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 67, in _wrapper
    return bound_func(*args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 149, in _wrapped_view
    response = view_func(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 63, in bound_func
    return func.__get__(self, type(self))(*args2, **kwargs2)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 67, in _wrapper
    return bound_func(*args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/views/decorators/cache.py&quot;, line 57, in _wrapped_view_func
    response = view_func(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/utils/decorators.py&quot;, line 63, in bound_func
    return func.__get__(self, type(self))(*args2, **kwargs2)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/views.py&quot;, line 90, in dispatch
    return super(LoginView, self).dispatch(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/base.py&quot;, line 88, in dispatch
    return handler(request, *args, **kwargs)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/views/generic/edit.py&quot;, line 182, in post
    if form.is_valid():
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py&quot;, line 183, in is_valid
    return self.is_bound and not self.errors
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py&quot;, line 175, in errors
    self.full_clean()
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py&quot;, line 385, in full_clean
    self._clean_form()
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/forms/forms.py&quot;, line 412, in _clean_form
    cleaned_data = self.clean()
  File &quot;./zerver/forms.py&quot;, line 283, in clean
    realm=realm, return_data=return_data)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/__init__.py&quot;, line 70, in authenticate
    user = _authenticate_with_backend(backend, backend_path, request, credentials)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django/contrib/auth/__init__.py&quot;, line 116, in _authenticate_with_backend
    return backend.authenticate(*args, **credentials)
  File &quot;./zproject/backends.py&quot;, line 431, in authenticate
    password=password)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py&quot;, line 150, in authenticate
    user = self.authenticate_ldap_user(ldap_user, password)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py&quot;, line 210, in authenticate_ldap_user
    return ldap_user.authenticate(password)
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py&quot;, line 350, in authenticate
    self._get_or_create_user()
  File &quot;/home/zulip/deployments/2019-05-20-11-38-33/zulip-py3-venv/lib/python3.6/site-packages/django_auth_ldap/backend.py&quot;, line 591, in _get_or_create_user
    self._user, built = self.backend.get_or_build_user(username, self)
  File &quot;./zproject/backends.py&quot;, line 500, in get_or_build_user
    self.sync_avatar_from_ldap(user_profile, ldap_user)
  File &quot;./zproject/backends.py&quot;, line 307, in sync_avatar_from_ldap
    upload_avatar_image(BytesIO(ldap_user.attrs[avatar_attr_name][0]), user, user)
  File &quot;./zerver/lib/upload.py&quot;, line 769, in upload_avatar_image
    upload_backend.upload_avatar_image(user_file, acting_user_profile, target_user_profile)
  File &quot;./zerver/lib/upload.py&quot;, line 402, in upload_avatar_image
    content_type = guess_type(user_file.name)[0]
AttributeError: &#39;_io.BytesIO&#39; object has no attribute &#39;name&#39;


Deployed code:
- ZULIP_VERSION: 2.0.3
- version: 2.0.3


Request info:
- path: /accounts/login/
- POST: {&#39;csrfmiddlewaretoken&#39;: [&#39;**********&#39;], &#39;username&#39;: [&#39;********************&#39;], &#39;password&#39;: [&#39;**********&#39;], &#39;button&#39;: [&#39;********************&#39;]}
- REMOTE_ADDR: &quot;[&#39;10.176.38.126&#39;]&quot;
- QUERY_STRING: &quot;[&#39;next=******&quot;
- SERVER_NAME: &quot;[&#39;&#39;]&quot;
</pre></div>



<a name="745165"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745165" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Kumria <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745165">(May 23 2019 at 16:15)</a>:</h4>
<p>I recently migrated this deployment from local upload to uploads via S3 (this morning if that is a problem).</p>



<a name="745166"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745166" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Kumria <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745166">(May 23 2019 at 16:16)</a>:</h4>
<p>I am trying to use the LDAP attribute 'thumbnailPhoto' but not all users have that available on their profile.</p>



<a name="745310"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745310" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745310">(May 24 2019 at 00:34)</a>:</h4>
<p><span class="user-mention" data-user-id="12314">@Anand Kumria</span> interesting, thanks for the report!  You can open a GitHub issue for this; I think we haven't tested the S3 backend with the new <code>thumbnailPhoto</code> integration, and it just doesn't work in that way.  <span class="user-mention" data-user-id="907">@Harshit Bansal</span> <span class="user-mention" data-user-id="5263">@Shubham Padia</span> FYI, I think this should be a pretty quick fix.</p>



<a name="745972"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/745972" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anand Kumria <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#745972">(May 27 2019 at 07:34)</a>:</h4>
<p>done. <a href="https://github.com/zulip/zulip/issues/12411" target="_blank" title="https://github.com/zulip/zulip/issues/12411">https://github.com/zulip/zulip/issues/12411</a></p>



<a name="746174"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/backtrace%20with%20s3/near/746174" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/backtrace.20with.20s3.html#746174">(May 27 2019 at 23:31)</a>:</h4>
<p>Cool, replied on the issue and mentioned people who might work on it.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>