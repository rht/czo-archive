<html>
<head><meta charset="utf-8"><title>postgres restore on import · production help · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://rht.github.io/czo-archive/stream/31-production-help/index.html">production help</a></h2>
<h3>Topic: <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html">postgres restore on import</a></h3>

<hr>

<base href="https://chat.zulip.org">

<head><link href="https://rht.github.io/czo-archive/style.css" rel="stylesheet"></head>

<a name="785692"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785692" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785692">(Sep 10 2019 at 00:22)</a>:</h4>
<p>Hi, I was trying to debug the export function and a permission error by telling it to export to the live dir, which caused it to wipe it clean.<br>
I started a fresh install and on step 3 I moved to the restore function from my first and only backup (copying postgres first) just in case as I have chats I'd like to keep. It finds that I have 212 records and asked if I want to keep them, which I do but it stops the restore.<br>
Do I have to rebuild the tar without postgres to get around that?</p>



<a name="785695"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785695" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785695">(Sep 10 2019 at 00:38)</a>:</h4>
<p>Does not look like the db is part of the backup so it appears to be the restore, but I don't know enough.</p>



<a name="785754"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785754" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785754">(Sep 10 2019 at 14:56)</a>:</h4>
<p>Am I in the wrong place here? I had the idea that I could get some help here.</p>



<a name="785755"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785755" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785755">(Sep 10 2019 at 15:06)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> welcome! This is the right place, though you'll have to wait for someone familiar with that part of the code to come online</p>



<a name="785756"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785756" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Rishi Gupta <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785756">(Sep 10 2019 at 15:08)</a>:</h4>
<p>(for fast response support <a href="http://zulipchat.com" target="_blank" title="http://zulipchat.com">zulipchat.com</a> does offer support packages with various SLAs -- ping <a href="mailto:support@zulipchat.com" title="mailto:support@zulipchat.com">support@zulipchat.com</a> for details)</p>



<a name="785762"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785762" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785762">(Sep 10 2019 at 15:48)</a>:</h4>
<p>Aha. Is there not a community supported forum or some such?</p>



<a name="785794"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785794" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785794">(Sep 10 2019 at 20:11)</a>:</h4>
<p>Just realized what you said. Community here, and SLA's for those who can't wait.  Thanks!</p>



<a name="785838"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785838" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785838">(Sep 10 2019 at 22:38)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> can you post precisely what you ran and what error you got?</p>



<a name="785840"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785840" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785840">(Sep 10 2019 at 22:39)</a>:</h4>
<p>Our backup tarballs definitely include the database; so we need more detail to understand your problem.</p>



<a name="785919"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785919" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785919">(Sep 11 2019 at 01:34)</a>:</h4>
<p>Not sure what to add beyond my initial post. Had a working install, manage.py export wiped all the files and directories, now I'm trying to reinstall without also wiping out the 212 entries. There's no error, I simply said no to <br>
"WARNING: This will delete your Zulip database which currently contains 212 messages.<br>
Do you want to proceed?"  due to not wanting to loose the 212.<br>
Now I'm trying to figure out how to best proceed.</p>



<a name="785958"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785958" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785958">(Sep 11 2019 at 11:27)</a>:</h4>
<p>supervisorctl stop all<br>
./manage.py export --output /tmp -r ''<br>
supervisorctl start all<br>
I specified tmp as the export file was not there after running the export.</p>
<p>Seems I should be able to restore a backup of postgres after the install since it is a full restore not a partial which could mess up various indices and pointers.</p>



<a name="785998"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785998" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785998">(Sep 11 2019 at 18:45)</a>:</h4>
<p><code>manage.py export</code> doesn't any data.  Do you mean <code>import</code>?  I don't think we can help you unless you can communicate what you did clearly.</p>



<a name="785999"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/785999" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#785999">(Sep 11 2019 at 18:45)</a>:</h4>
<p>My guess is the you tried to import back into the same server you exported from (rather than an empty server) and got that warning.</p>



<a name="786105"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786105" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786105">(Sep 12 2019 at 03:09)</a>:</h4>
<p>This is what I ran to find the export syntax: <br>
./manage.py --help <br>
(I believe was the parameter) and it gives the syntax for export. Just as it says in the online doc: <br>
<a href="https://zulip.readthedocs.io/en/latest/production/export-and-import.html" target="_blank" title="https://zulip.readthedocs.io/en/latest/production/export-and-import.html">https://zulip.readthedocs.io/en/latest/production/export-and-import.html</a></p>
<p>There are two things going on here.<br>
1) I exported but could not find the export file in tmp as expected and after following the--help options added the /tmp dir manually, which did not help as I still could not find the file. I did see a permission error (see below). <br>
Checked /tmp permissions which were 777 with the sticky bit set. <br>
Then I tried specifying the dir which still did not result in anything either. <br>
So I chose it's own sub dir as the manage.py file was. The result was all files and directories were removed.</p>
<p>2) At that point I made a copy of postgres, and a few things to ensure I at least have those since program files can just be replaced but not so easily the data. Then started a new install, which worked well up to the point of it seeing the 212 comments and stopped asking me if I was OK with overwriting them, to which I said No.</p>
<p>At that point manage.py exited back to the prompt. I was stopped with not enough familiarity nor experience with python to move fwd by myself, and found you here and made my original post. In retrospect it might have been better if I traced down what was behind the systemd error, it just seemed that I was doing something wrong rather than manage.py being wrong so I tried to figure out what is happening. I had run an export before which worked fine.</p>
<p>OK, the traceback:</p>
<p>Traceback (most recent call last):<br>
  File "./manage.py", line 46, in &lt;module&gt;<br>
    execute_from_command_line(sys.argv)<br>
  File "/home/zulip/deployments/2019-08-02-11-28-23/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/__init__.py", line 364, in execute_from_command_line<br>
    utility.execute()<br>
  File "/home/zulip/deployments/2019-08-02-11-28-23/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/__init__.py", line 356, in execute<br>
    self.fetch_command(subcommand).run_from_argv(self.argv)<br>
  File "/home/zulip/deployments/2019-08-02-11-28-23/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py", line 283, in run_from_argv<br>
    self.execute(*args, **cmd_options)<br>
  File "/home/zulip/deployments/2019-08-02-11-28-23/zulip-py3-venv/lib/python3.6/site-packages/django/core/management/base.py", line 330, in execute<br>
    output = self.handle(*args, **options)<br>
  File "/home/zulip/deployments/2019-08-02-11-28-23/zerver/management/commands/export.py", line 115, in handle<br>
    shutil.rmtree(output_dir)<br>
  File "/usr/lib/python3.6/shutil.py", line 486, in rmtree<br>
    _rmtree_safe_fd(fd, path, onerror)<br>
  File "/usr/lib/python3.6/shutil.py", line 420, in _rmtree_safe_fd<br>
    onerror(os.open, fullname, sys.exc_info())<br>
  File "/usr/lib/python3.6/shutil.py", line 418, in _rmtree_safe_fd<br>
    dirfd = os.open(name, os.O_RDONLY, dir_fd=topfd)<br>
PermissionError: [Errno 13] Permission denied: 'systemd-private-9b365e6b782545a2a27b4f716a873f3d-systemd-timesyncd.service-YCq6GS'</p>



<a name="786164"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786164" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786164">(Sep 12 2019 at 17:10)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> can you post precisely what command you ran?</p>



<a name="786243"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786243" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786243">(Sep 12 2019 at 20:49)</a>:</h4>
<p>I'm sorry but that is what I did in the above thread. Copied and pasted.</p>



<a name="786244"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786244" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786244">(Sep 12 2019 at 20:50)</a>:</h4>
<p>What did you pass as the output directory, specifically?</p>



<a name="786245"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786245" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786245">(Sep 12 2019 at 20:51)</a>:</h4>
<p>It sorta looks like the cleanup code after Zulip creates the export tarball is trying to delete some systemd-related file, which I don't understand.</p>



<a name="786246"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786246" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786246">(Sep 12 2019 at 20:52)</a>:</h4>
<p>supervisorctl stop all<br>
./manage.py export --output /tmp -r ''<br>
supervisorctl start all</p>
<p>There are two different parts to this you understand that? There's what caused the damage and me trying to restore the wiped out files.</p>



<a name="786248"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786248" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786248">(Sep 12 2019 at 20:53)</a>:</h4>
<p>Great, <code>/tmp</code> was what I was looking for.</p>



<a name="786249"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786249" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786249">(Sep 12 2019 at 20:55)</a>:</h4>
<p>Ugh, I see the problem.  So, the intent is that you run <code>./manage.py export /tmp/foo</code>, and we remove anything at the path <code>/tmp/foo</code> before creating an archive there.  You passed <code>/tmp</code>, so that cleanup code attempted to remove everything under <code>/tmp</code> on your system, hence the error (early in the process, so no export was attempted).</p>
<p><span class="user-mention" data-user-id="699">@Anders Kaseorg</span> do you have thoughts on what the right way to prevent this error?</p>



<a name="786250"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786250" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786250">(Sep 12 2019 at 20:55)</a>:</h4>
<p>Why wipe out at all when the name has a UUID as part of it?</p>



<a name="786251"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786251" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786251">(Sep 12 2019 at 20:57)</a>:</h4>
<p>The current interface was designed for passing a full path to the export directory if you don't want the default behavior (of creating a new temporary directory under <code>/tmp</code>).</p>



<a name="786252"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786252" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786252">(Sep 12 2019 at 20:58)</a>:</h4>
<p>(This can be useful if you want to control the filename the export is written to, but our implementation is definitely not as intended here)</p>



<a name="786253"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786253" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786253">(Sep 12 2019 at 20:58)</a>:</h4>
<p>We'll fix it.  In the meantime, for what you're trying to do, just don't pass the <code>--output-dir</code> option.</p>



<a name="786254"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786254" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786254">(Sep 12 2019 at 20:58)</a>:</h4>
<p>I did not start with --output-dir, but as I could not find it under /tmp I decided to specify it.</p>



<a name="786257"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786257" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786257">(Sep 12 2019 at 21:00)</a>:</h4>
<p>It prints out the path at the end of its output:</p>
<div class="codehilite"><pre><span></span>...
Finished exporting to /tmp/zulip-export-auxjzypr
Tarball written to /tmp/zulip-export-auxjzypr.tar.gz
</pre></div>



<a name="786258"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786258" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786258">(Sep 12 2019 at 21:00)</a>:</h4>
<p>The 2nd part here is how can I restore the file structure of the program without wiping the 212 comments? I made a backup of postgres.</p>



<a name="786259"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786259" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786259">(Sep 12 2019 at 21:01)</a>:</h4>
<blockquote>
<p>do you have thoughts on what the right way to prevent this error?</p>
</blockquote>
<p>I’m with Steve on this one—we should throw an error if there’s an existing directory in our way rather than blowing it away.</p>



<a name="786261"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786261" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786261">(Sep 12 2019 at 21:06)</a>:</h4>
<p>My goal is to use the export to create an automated backup routine. The file generated can then be scp'd to another machine. I'm preparing a script that finds the name. What I do is use date and time as part of my backup name. Quite handy. With date+time I can easily clean up as often as I want to using cron.</p>



<a name="786262"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786262" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786262">(Sep 12 2019 at 21:12)</a>:</h4>
<p>The intended use of the <code>--output</code> option was that you can give it a fresh directory name, e.g. <code>./manage.py export --output="/var/backups/zulip/zulip-export-$(date -u +%FT%T)"</code></p>



<a name="786264"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786264" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786264">(Sep 12 2019 at 21:13)</a>:</h4>
<p>Makes sense. I'm thinking that why would there be a delete involved. The reason I came up with is that someone wanted to ensure the latest export is there and having many files was not an option. I find a delete in any export to be a dangerous thing to have, and not even give a warning. This thing which is going to write a file will erase everything it can.</p>



<a name="786265"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786265" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786265">(Sep 12 2019 at 21:15)</a>:</h4>
<p>It’s also used to compute the resulting tarball name, which in this case will be <code>/var/backups/zulip/zulip-export-2019-09-12T21:15:38.tar.gz</code>.</p>



<a name="786266"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786266" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786266">(Sep 12 2019 at 21:16)</a>:</h4>
<p>Sure, in short a Good Thing. :)</p>



<a name="786267"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786267" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786267">(Sep 12 2019 at 21:16)</a>:</h4>
<p>The delete was clearly a poor decision. We’re going to get rid of it.</p>



<a name="786268"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786268" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786268">(Sep 12 2019 at 21:17)</a>:</h4>
<p>Cool!<br>
Now any tips on how to get the install files back in without loosing my 212 comments?</p>



<a name="786269"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786269" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786269">(Sep 12 2019 at 21:24)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> well, if your export tarball contains the message history, then that's fine -- the restore tool will delete the copy in the database and replace that with the message history in the export tarball.</p>



<a name="786270"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786270" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786270">(Sep 12 2019 at 21:25)</a>:</h4>
<p>Which is fine, since it sounds like that's what you're trying to do; that error warning is meant to prevent folks from accidentally deleting their production by (e.g.) running the restore tool on the production system, when they meant to restore into an empty Zulip server.</p>



<a name="786283"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786283" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786283">(Sep 12 2019 at 21:56)</a>:</h4>
<p>OK, just to be clear. I'm not trying to have an empty clean server but restored back with all 212 msgs.</p>



<a name="786284"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786284" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786284">(Sep 12 2019 at 21:59)</a>:</h4>
<p>Yeah, as long as your messages are in the <code>messages-*.json</code> files in the exported tarball, that’s what will be restored to the server.</p>



<a name="786285"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786285" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786285">(Sep 12 2019 at 22:00)</a>:</h4>
<p>Any reason they would not be there? I gave no other parameters.</p>



<a name="786295"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786295" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786295">(Sep 12 2019 at 22:00)</a>:</h4>
<p>Nope, they should be there.</p>



<a name="786296"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786296" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786296">(Sep 12 2019 at 22:01)</a>:</h4>
<p>OK, cool. I have a backup of postgres so I could always use that... I'm hoping. Not sure what kind of use of unique keys could be in use such as aa UUID.</p>



<a name="786298"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786298" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786298">(Sep 12 2019 at 22:03)</a>:</h4>
<p>Thanks you guys for your help!</p>



<a name="786299"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786299" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786299">(Sep 12 2019 at 22:05)</a>:</h4>
<p>Suggestion on the warning prompt/ Maybe make it require Enter (This will delete your Zulip database) as a single accidental y would wipe it.</p>



<a name="786300"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786300" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786300">(Sep 12 2019 at 22:09)</a>:</h4>
<p>** Well, OK. Install finished and it is now up and running and none of the streams or anything including messages are here. How do I proceed?</p>



<a name="786302"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786302" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786302">(Sep 12 2019 at 22:48)</a>:</h4>
<p>So after the install fiasco  I copied the old db over the new empty one and I got my messages back. But No users. <br>
Any educated direction would be greately appreciated!</p>



<a name="786303"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786303" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786303">(Sep 12 2019 at 22:50)</a>:</h4>
<p>Where do you keep users any way if not in the SQL db?</p>



<a name="786305"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786305" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786305">(Sep 12 2019 at 22:56)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> our backups docs explain this, but data like the set of users in stored in the Zulip database.  I don't understand how it'd be possible for you to have messages but not users; Zulip can't render messages without users.</p>



<a name="786306"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786306" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786306">(Sep 12 2019 at 22:57)</a>:</h4>
<p>Thanks again for the report about the <code>manage.py export</code> arguments; that's a land mind we'll be very glad to fix.</p>



<a name="786307"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786307" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Anders Kaseorg <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786307">(Sep 12 2019 at 22:58)</a>:</h4>
<p>Said fix is <a href="https://github.com/zulip/zulip/pull/13160" target="_blank" title="https://github.com/zulip/zulip/pull/13160">#13160</a>.</p>



<a name="786341"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786341" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786341">(Sep 13 2019 at 00:29)</a>:</h4>
<p><span class="user-mention" data-user-id="7">@Tim Abbott</span> Well that makes two of us.  So do you know where the user data is, for example what table?</p>



<a name="786342"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786342" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786342">(Sep 13 2019 at 00:54)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> <code>zerver_userprofile</code> in postgres</p>



<a name="786343"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786343" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786343">(Sep 13 2019 at 00:57)</a>:</h4>
<p>Perhaps you can check if <code>zerver_message</code> has the messages, and then see the content of the userprofiles table?</p>



<a name="786361"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786361" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786361">(Sep 13 2019 at 10:58)</a>:</h4>
<p>I'd be more than happy to, unfortunately I'm lost in postgresql. I understand that psql is the client but I'm unable to see anything in there. <br>
I got in as admin user postgres but when I run \dt for tables it says "Did not find any relations." I may not even have the right db. postgres appear not to have any permissions. \ddp shows 0 rows.</p>



<a name="786371"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786371" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786371">(Sep 13 2019 at 12:46)</a>:</h4>
<p>Alright, managed to get a select done on userprofile and it has the users listed. I got to this point by completing the install and then copied the old db over the new one. I had hesitated doing this earlier but were left with no option. My concern was that some pointers could be unlinked as I have no real idea on how Zulip is designed. <br>
OK, so looking through the user table I see something odd. The field pointer is -1 on bots and also a number of the users have a -1 as well. Maybe they have not made a post or something and so has no pointer - I have no idea. :)</p>



<a name="786387"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786387" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786387">(Sep 13 2019 at 16:10)</a>:</h4>
<p>In message I see also 212 rows, nothing looking like an issue, mostly empty fields. Typical notifications so and so signed up etc.</p>



<a name="786389"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786389" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786389">(Sep 13 2019 at 16:44)</a>:</h4>
<p>Going through all user tables: <br>
zerver_useractivity + interval,  userhotspot, usermessage, userpresence, userprofile, are populated with what looks like correct data. <br>
zerver_usergroup, usergroupmembership,  userprofile_groups, userprofile_user_permissions, userstatus  are all empty.<br>
There are in all 71 tables listed. Of course this may not be of much use to you.<br>
auth_permission has zero rows while its permission lists all possible ones.<br>
Nothing stands out to me, but again I'm a novice with Zulip.</p>



<a name="786401"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786401" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786401">(Sep 13 2019 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span>  Sounds good then I think <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span> Can you describe exactly the problem that's occuring then? You're able to log into the realm like before, but it's empty without any streams or messages or users showing up in it? Maybe a screenshot that showcases the situation could be useful?</p>



<a name="786526"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786526" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786526">(Sep 14 2019 at 15:32)</a>:</h4>
<p>Users are usually listed on the right side, but it's empty. I just discovered that Users show up under the Organization tab. Last active is Unknown on all but me, who's the admin and obviously there. Defaults streams are there.  Some linking appear to be broken. Many settings are not set. One user who uploaded his pic is there. Ah, it says he's been deactivated, which is not what it said under Users. But Let's see what happens. I was going to deactivate and then reactivate but they will loose their pwds. Any way of saving them?</p>



<a name="786528"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786528" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786528">(Sep 14 2019 at 15:36)</a>:</h4>
<p>Ooh. I deactivate a test user I have and reactivated it and all the others showed up.</p>



<a name="786530"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786530" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786530">(Sep 14 2019 at 15:44)</a>:</h4>
<p>To be clear all the users were listed and all had the red button saying deactivate. Pushing it on that one user made the button say Reactivate. Pressing that and it returned to Deactivate. Returning to main screen all the users were listed. I logged in as test user and it accepted the old password. That looks pretty good. What's important is to not mess up the users and their posts.<br>
Zulip now comes up and says it needs to send email to confirm users addresses and send notifications and wants me to configure email. If that's all I need to do now I'm quite relieved!</p>



<a name="786554"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786554" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786554">(Sep 14 2019 at 18:54)</a>:</h4>
<p>I'm thinking that something like a reindex might work, is there an easy function to do that. Maybe delete all the index files after shutting down zulip?</p>



<a name="786570"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786570" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mateusz Mandera <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786570">(Sep 14 2019 at 22:22)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> so are the messages showing up for you now?</p>



<a name="786574"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786574" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786574">(Sep 14 2019 at 22:57)</a>:</h4>
<p>Messages were showing up all along (once I copied the db over the new one), what was not showing up was the users.  There appear to be some inconsistencies with messages and what occurs. For example, it said if I disabled the users they would have to verify password all over. Which did not happen. At least not to my test account.  What appears broken is the linking between users and messages. Which is why I posted the above last question.</p>



<a name="786680"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786680" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786680">(Sep 16 2019 at 21:52)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> it's possible the issue has to do with caching; can you try <code>scripts/setup/flush-memcached</code> to see if that helps?</p>



<a name="786683"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786683" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786683">(Sep 16 2019 at 21:53)</a>:</h4>
<p>(Generally we don't expect an organization to be exported and then re-imported into the same physical server; if you wanted to do that without changes, you should use our backup tool, so it's possible we don't clear caches properly if you do that with the export/import tools)</p>



<a name="786753"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786753" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786753">(Sep 17 2019 at 10:40)</a>:</h4>
<p>The reason I went that way was that when I searched your documentation for backup the first thing that came up was export/import. But as you say, once you read the backup notes they are clear. <br>
I ran flush-memcached so we'll see how things are working. Thanks!</p>



<a name="786787"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786787" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786787">(Sep 17 2019 at 18:31)</a>:</h4>
<p><span class="user-mention" data-user-id="13379">@Steve Szmidt</span> the very first section on <a href="https://zulip.readthedocs.io/en/stable/production/export-and-import.html" target="_blank" title="https://zulip.readthedocs.io/en/stable/production/export-and-import.html">https://zulip.readthedocs.io/en/stable/production/export-and-import.html</a> recommends going to the backups documentation instead.  Is there something we could improve in the organization of that page that would have helped you get to the backups page?</p>



<a name="786788"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786788" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786788">(Sep 17 2019 at 18:32)</a>:</h4>
<p>I suppose one option is we could move the section on backups inline into this page (rather than being in the long "maintain, secure, and upgrade" page)</p>



<a name="786859"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786859" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786859">(Sep 17 2019 at 22:54)</a>:</h4>
<p>I'll review it and send you my thought. :)</p>



<a name="786927"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786927" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Steve Szmidt <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786927">(Sep 18 2019 at 00:43)</a>:</h4>
<p>Yeah, I think you are right, bring them in under the same heading. I see the good logic used by the developers behind the subject headings.<br>
My mistake was being under the gun and not reading it all carefully. It just looked like you called it import/export when I scanned it.<br>
If there was a heading such as Backup/Restore &amp; Export Import. Then an introduction which explained when you would use which. <br>
In other words:<br>
Backup / Restore &amp; Export / Import<br>
There are some options available depending on which route you choose to take. For daily backups we created .... It can also be used for ...<br>
Export / Import is primarily intended when moving ... a.s.o.<br>
Most of your wording is there already. The above would change have made it hard to make the wrong choice. :)</p>



<a name="786934"></a>
<h4><a href="https://chat.zulip.org#narrow/stream/31-production%20help/topic/postgres%20restore%20on%20import/near/786934" class="zl"><img src="https://rht.github.io/czo-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Tim Abbott <a href="https://rht.github.io/czo-archive/stream/31-production-help/topic/postgres.20restore.20on.20import.html#786934">(Sep 18 2019 at 00:49)</a>:</h4>
<p>Yeah, I had been thinking about moving "Backups" to its own independent page, and based on this conversation, the right plan is to move it inot this page.  </p>
<p><span class="user-mention" data-user-id="3734">@David Rosa</span> FYI, this probably belongs on your docs TODO list.</p>



<hr><p>Last updated: Oct 02 2023 at 04:38 UTC</p>
</html>